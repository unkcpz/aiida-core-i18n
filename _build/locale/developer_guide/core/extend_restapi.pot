# SOME DESCRIPTIVE TITLE.
# Copyright (C) 2019, ECOLE POLYTECHNIQUE FEDERALE DE LAUSANNE (Theory and Simulation of Materials (THEOS) and National Centre for Computational Design and Discovery of Novel Materials (NCCR MARVEL)), Switzerland and ROBERT BOSCH LLC, USA. All rights reserved
# This file is distributed under the same license as the AiiDA package.
# FIRST AUTHOR <EMAIL@ADDRESS>, YEAR.
#
#, fuzzy
msgid ""
msgstr ""
"Project-Id-Version: AiiDA 1.0\n"
"Report-Msgid-Bugs-To: \n"
"POT-Creation-Date: 2019-05-15 13:38+0800\n"
"PO-Revision-Date: YEAR-MO-DA HO:MI+ZONE\n"
"Last-Translator: FULL NAME <EMAIL@ADDRESS>\n"
"Language-Team: LANGUAGE <LL@li.org>\n"
"MIME-Version: 1.0\n"
"Content-Type: text/plain; charset=UTF-8\n"
"Content-Transfer-Encoding: 8bit\n"

#: ../../source/developer_guide/core/extend_restapi.rst:6
msgid "How to extend the AiiDA REST API"
msgstr ""

#: ../../source/developer_guide/core/extend_restapi.rst:8
msgid "The AiIDA REST API is made of two main classes:"
msgstr ""

#: ../../source/developer_guide/core/extend_restapi.rst:10
msgid "``App``, inheriting ``flask.Flask``. The latter represents any Flask web app, including REST APIs."
msgstr ""

#: ../../source/developer_guide/core/extend_restapi.rst:11
msgid "``Api``, inheriting ``flask_restful.Api``. This represents the API itself."
msgstr ""

#: ../../source/developer_guide/core/extend_restapi.rst:13
msgid "Once instanciated both ``Api`` and ``App`` classes into, say, ``app`` and ``api``, these two objects have to be coupled by adding ``app`` as one of the attributes of ``api``. As we will see in a moment, we provide a function that, besides other things, does exactly this."
msgstr ""

#: ../../source/developer_guide/core/extend_restapi.rst:15
msgid "In a Flask API the resources, e.g. *Nodes*, *Kpoints*, etc., are represented by ``flask_restful.Resource``-derived classes."
msgstr ""

#: ../../source/developer_guide/core/extend_restapi.rst:17
msgid "If you need to include additional endpoints besides those built in the AiiDA REST API you should:"
msgstr ""

#: ../../source/developer_guide/core/extend_restapi.rst:19
msgid "create the resource classes that will be bound to the new endpoints;"
msgstr ""

#: ../../source/developer_guide/core/extend_restapi.rst:20
msgid "extend the class ``Api`` into a user-defined class to register the new endpoints."
msgstr ""

#: ../../source/developer_guide/core/extend_restapi.rst:21
msgid "(Optional) Extend ``App`` into a user-defined class for finer customization."
msgstr ""

#: ../../source/developer_guide/core/extend_restapi.rst:24
msgid "Let's provide a minimal example through which we add the endpoint ``/new-endpoint`` supporting two HTTP methods:"
msgstr ""

#: ../../source/developer_guide/core/extend_restapi.rst:26
msgid "*GET*: retrieves the latest created Dict object and returns its ``id``, ``ctime`` in ISO 8601 format, and ``attributes``."
msgstr ""

#: ../../source/developer_guide/core/extend_restapi.rst:27
msgid "*POST*: creates a Dict object with placeholder attributes, stores it, and returns its ``id``."
msgstr ""

#: ../../source/developer_guide/core/extend_restapi.rst:29
msgid "Let's assume you've put the code in the file ``example.py``, reading:"
msgstr ""

#: ../../source/developer_guide/core/extend_restapi.rst:116
msgid "Let us dissect the previous code explaining each part. First things first: the imports."
msgstr ""

#: ../../source/developer_guide/core/extend_restapi.rst:124
msgid "To start with, we import the base classes to be extended/employed: ``AiidaApi`` and ``App``. For simplicity, it is advisable to import the method ``run_api``, as it provides an interface to configure the Api, parse command-line arguments, and couple the two classes representing the Api and the App. However, you can refer to the documentation of `flask_restful <https://flask-restful.readthedocs.io/>`_ to configure and hook-up an Api through its built-in methods."
msgstr ""

#: ../../source/developer_guide/core/extend_restapi.rst:126
msgid "Then we define a class representing the additional resource:"
msgstr ""

#: ../../source/developer_guide/core/extend_restapi.rst:166
msgid "The class ``NewResource`` contains two methods: ``get`` and ``post``. The names chosen for these functions are not arbitrary but fixed by ``Flask`` to individuate the functions that respond to HTTP request of type GET and POST, respectively. In other words, when the API receives a GET (POST) request to the URL ``new-endpoint``, the function ``NewResource.get()`` (``NewResource.post()``) will be executed. The HTTP response is constructed around the data returned by these functions. The data, which are packed as dictionaries, are serialized by Flask as a JSON stream of data. All the Python built-in types can be serialized by Flask (e.g. ``int``, ``float``, ``str``, etc.), whereas for serialization of custom types we let you refer to the `Flask documentation <http://flask.pocoo.org/docs/>`_ . The documentation of Flask is the main source of information also for topics such as customization of HTTP responses, construction of custom URLs (e.g. accepting parameters), and more advanced serialization issues."
msgstr ""

#: ../../source/developer_guide/core/extend_restapi.rst:168
msgid "Whenever you face the need to handle errors, consider to use the AiiDA REST API-specific exceptions already defined in ``aiida.restapi.common.exceptions``. The reason will become clear slightly later in this section."
msgstr ""

#: ../../source/developer_guide/core/extend_restapi.rst:170
msgid "Once the new resource is defined, we have to register it to the API by assigning it one (or more) endpoint(s). This is done in the ``__init__()`` of ``NewApi`` by means of the method ``add_resource()``:"
msgstr ""

#: ../../source/developer_guide/core/extend_restapi.rst:185
msgid "In our original intentions, the main (if not the only) purpose of overriding the ``__init__()`` method is to register new resources to the API. In fact, the general form of ``__init__()`` is meant to be:"
msgstr ""

#: ../../source/developer_guide/core/extend_restapi.rst:201
msgid "In the example, indeed, the only characteristic line is :python:`self.add_resource(NewResource, '/new-endpoint/', strict_slashes=False)`. Anyway, the method ``add_resource()`` is defined and documented in `Flask <http://flask.pocoo.org/docs/>`_."
msgstr ""

#: ../../source/developer_guide/core/extend_restapi.rst:203
msgid "Finally, the ``main`` code configures and runs the API, thanks to the method ``run_api()``:"
msgstr ""

#: ../../source/developer_guide/core/extend_restapi.rst:234
msgid "The method ``run_api()`` accomplishes several functions: it couples the API to an instance of ``flask.Flask``, namely, the Flask fundamental class representing a web app. Consequently, the app is configured and, if required, hooked up. The spirit of ``run_api`` is to take all the ingredients to setup an API and use them to build up a command-line utility that serves to hook it up."
msgstr ""

#: ../../source/developer_guide/core/extend_restapi.rst:237
msgid "It requires as inputs:"
msgstr ""

#: ../../source/developer_guide/core/extend_restapi.rst:239
msgid "the classes representing the Api and the App. We strongly suggest to pass to ``run_api()`` the class ``aiida.restapi.api.App``, inheriting from ``flask.Flask``, as it handles correctly AiiDA RESTApi-specific exceptions."
msgstr ""

#: ../../source/developer_guide/core/extend_restapi.rst:241
msgid "a tuple of positional arguments representing the command-line arguments/options (notice the use of ``sys.argv``);"
msgstr ""

#: ../../source/developer_guide/core/extend_restapi.rst:243
msgid "a dictionary of key-value arguments to set the default values of the command line options, e.g. ``--port``, ``--host``,  ``--config-dir`` and ``--aiida-profile``. If no default is set, the app will use ``5000``, ``127.0.0.1``, ``aiida.restapi.common`` and ``False``, respectively."
msgstr ""

#: ../../source/developer_guide/core/extend_restapi.rst:245
msgid "You should know few more things before using the script:"
msgstr ""

#: ../../source/developer_guide/core/extend_restapi.rst:247
msgid "If you want to customize further the error handling, you can take inspiration by looking at the definition of ``App`` and create your derived class ``NewApp(App)``."
msgstr ""

#: ../../source/developer_guide/core/extend_restapi.rst:249
msgid "The option ``hookup`` of the configuration dictionary must be set to ``True`` to use the script to start the API from command line. Below, we will show when it is appropriate to set ``hookup=False``."
msgstr ""

#: ../../source/developer_guide/core/extend_restapi.rst:251
msgid "the supported command line options are identical to those of ``verdi restapi``. Use ``verdi restapi --help`` for their full documentation. If you want to add more options or modify the existing ones, create you custom runner taking inspiration from ``run_api``."
msgstr ""

#: ../../source/developer_guide/core/extend_restapi.rst:253
msgid "It is time to run ``example.py``. Type in a terminal"
msgstr ""

#: ../../source/developer_guide/core/extend_restapi.rst:260
msgid "You should read the message"
msgstr ""

#: ../../source/developer_guide/core/extend_restapi.rst:266
msgid "To route a request to the API from a terminal you can employ ``curl``. Alternatively, you can use any REST client providing a GUI. Let us first ask for the latest created node through the GET method:"
msgstr ""

#: ../../source/developer_guide/core/extend_restapi.rst:272
msgid "The form of the output (and only the form) should resemble"
msgstr ""

#: ../../source/developer_guide/core/extend_restapi.rst:278
msgid ", whereas the actual values of the response dictionary as well as the internal structure of the attributes field will be in general very different."
msgstr ""

#: ../../source/developer_guide/core/extend_restapi.rst:280
msgid "Now, let us create a node through the POST method, and check it again through GET:"
msgstr ""

#: ../../source/developer_guide/core/extend_restapi.rst:289
msgid "The POST request triggers the creation of a new Dict node, as confirmed by the response to the GET request."
msgstr ""

#: ../../source/developer_guide/core/extend_restapi.rst:291
msgid "As a final remark, there might be circumstances in which you do not want to hook up the API from command line. For example, you might want to expose the API through Apache for production, rather than the built-in Flask server. In this case, you can invoke ``run_api`` to return two custom objects ``app`` and ``api``."
msgstr ""

#: ../../source/developer_guide/core/extend_restapi.rst:302
msgid "This snippet of code becomes the fundamental block of a *wsgi* file used by Apache as documented in  :ref:`restapi_apache`. Moreover, we recommend to consult the documentation of `mod_wsgi <https://modwsgi.readthedocs.io/mod_wsgi>`_."
msgstr ""

#: ../../source/developer_guide/core/extend_restapi.rst:304
msgid "Notice that we have set ``hookup=False`` and ``catch_internal_server=False``. It is clear why the app is no longer required to be hooked up, i.e. Apache will do the job for us. The second option, instead, is not mandatory but potentially useful. It lets the exceptions thrown during the execution of the apps propagate all the way through until they reach the logger of Apache. Especially when the app is not entirely stable yet, one would like to read the full python error traceback in the Apache error log."
msgstr ""

