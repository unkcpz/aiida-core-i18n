

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>aiida.engine.runners &mdash; AiiDA 1.0.0b2 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../_static/language_data.js"></script>
        <script type="text/javascript" src="../../../_static/contentui.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/contentui.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> AiiDA
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Installation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../install/quick_installation.html">Quick installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../install/prerequisites.html">Prerequisites</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../install/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../install/updating_installation.html">Updating AiiDA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../install/troubleshooting.html">Troubleshooting</a></li>
</ul>
<p class="caption"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../get_started/index.html">First things first</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../get_started/daemon.html">Setup the daemon</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../get_started/computers.html">Setup a computer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../get_started/codes.html">Setup a code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../get_started/plugins.html">Plugins</a></li>
</ul>
<p class="caption"><span class="caption-text">Concepts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../concepts/provenance.html">Provenance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../concepts/processes.html">Processes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../concepts/calculations.html">Calculations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../concepts/workflows.html">Workflows</a></li>
</ul>
<p class="caption"><span class="caption-text">Working with</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../working/processes.html">Processes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../working/functions.html">Calculation and work functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../working/calculations.html">Calculations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../working/workflows.html">Workflows</a></li>
</ul>
<p class="caption"><span class="caption-text">Working with AiiDA</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../working_with_aiida/index.html">Command line interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../working_with_aiida/index.html#scripting">Scripting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../working_with_aiida/index.html#data-types">Data types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../working_with_aiida/index.html#groups">Groups</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../working_with_aiida/index.html#schedulers">Schedulers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../working_with_aiida/index.html#querying-data">Querying data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../working_with_aiida/index.html#caching">Caching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../working_with_aiida/index.html#result-manager">Result manager</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../working_with_aiida/index.html#backups">Backups</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../working_with_aiida/index.html#troubleshooting">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../working_with_aiida/index.html#rest-api">REST API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../working_with_aiida/index.html#cookbook">Cookbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../import_export/index.html">Import and Export</a></li>
</ul>
<p class="caption"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../developer_guide/index.html">AiiDA design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developer_guide/index.html#aiida-core">AiiDA core</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developer_guide/index.html#aiida-plugins">AiiDA plugins</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorial/index.html">StructureData</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorial/index.html#pseudopotentials">Pseudopotentials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorial/index.html#plugin-development">Plugin development</a></li>
</ul>
<p class="caption"><span class="caption-text">API reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="`aiida package &lt;https://aiida-core.readthedocs.io/en/latest/apidoc/aiida.html&gt;`_">`aiida package &lt;https://aiida-core.readthedocs.io/en/latest/apidoc/aiida.html&gt;`_</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">AiiDA</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../../aiida.html">aiida</a> &raquo;</li>
        
      <li>aiida.engine.runners</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for aiida.engine.runners</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1">###########################################################################</span>
<span class="c1"># Copyright (c), The AiiDA team. All rights reserved.                     #</span>
<span class="c1"># This file is part of the AiiDA code.                                    #</span>
<span class="c1">#                                                                         #</span>
<span class="c1"># The code is hosted on GitHub at https://github.com/aiidateam/aiida_core #</span>
<span class="c1"># For further information on the license, see the LICENSE.txt file        #</span>
<span class="c1"># For further information please visit http://www.aiida.net               #</span>
<span class="c1">###########################################################################</span>
<span class="c1"># pylint: disable=cyclic-import,global-statement</span>
<span class="sd">&quot;&quot;&quot;Runners that can run and submit processes.&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">division</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">print_function</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">absolute_import</span>

<span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">namedtuple</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">tornado.ioloop</span>

<span class="kn">import</span> <span class="nn">plumpy</span>

<span class="kn">from</span> <span class="nn">aiida.common</span> <span class="k">import</span> <span class="n">exceptions</span>
<span class="kn">from</span> <span class="nn">aiida.orm</span> <span class="k">import</span> <span class="n">load_node</span>
<span class="kn">from</span> <span class="nn">.processes</span> <span class="k">import</span> <span class="n">futures</span>
<span class="kn">from</span> <span class="nn">.processes.calcjobs</span> <span class="k">import</span> <span class="n">manager</span>
<span class="kn">from</span> <span class="nn">.utils</span> <span class="k">import</span> <span class="n">instantiate_process</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">transports</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">utils</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Runner&#39;</span><span class="p">,)</span>

<span class="n">LOGGER</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="n">ResultAndNode</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;ResultAndNode&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;result&#39;</span><span class="p">,</span> <span class="s1">&#39;node&#39;</span><span class="p">])</span>
<span class="n">ResultAndPk</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;ResultAndPk&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;result&#39;</span><span class="p">,</span> <span class="s1">&#39;pk&#39;</span><span class="p">])</span>


<div class="viewcode-block" id="Runner"><a class="viewcode-back" href="../../../apidoc/aiida.engine.html#aiida.engine.runners.Runner">[docs]</a><span class="k">class</span> <span class="nc">Runner</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>  <span class="c1"># pylint: disable=useless-object-inheritance</span>
    <span class="sd">&quot;&quot;&quot;Class that can launch processes by running in the current interpreter or by submitting them to the daemon.&quot;&quot;&quot;</span>

    <span class="n">_persister</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">_communicator</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">_controller</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">_closed</span> <span class="o">=</span> <span class="kc">False</span>

<div class="viewcode-block" id="Runner.__init__"><a class="viewcode-back" href="../../../apidoc/aiida.engine.html#aiida.engine.runners.Runner.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">poll_interval</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">loop</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">communicator</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rmq_submit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">persister</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Construct a new runner</span>

<span class="sd">        :param poll_interval: interval in seconds between polling for status of active calculations</span>
<span class="sd">        :param loop: an event loop to use, if none is suppled a new one will be created</span>
<span class="sd">        :type loop: :class:`tornado.ioloop.IOLoop`</span>
<span class="sd">        :param communicator: the communicator to use</span>
<span class="sd">        :type communicator: :class:`kiwipy.Communicator`</span>
<span class="sd">        :param rmq_submit: if True, processes will be submitted to RabbitMQ, otherwise they will be scheduled here</span>
<span class="sd">        :param persister: the persister to use to persist processes</span>
<span class="sd">        :type persister: :class:`plumpy.Persister`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="p">(</span><span class="n">rmq_submit</span> <span class="ow">and</span> <span class="n">persister</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">),</span> \
            <span class="s1">&#39;Must supply a persister if you want to submit using communicator&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_loop</span> <span class="o">=</span> <span class="n">loop</span> <span class="k">if</span> <span class="n">loop</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">tornado</span><span class="o">.</span><span class="n">ioloop</span><span class="o">.</span><span class="n">IOLoop</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_poll_interval</span> <span class="o">=</span> <span class="n">poll_interval</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rmq_submit</span> <span class="o">=</span> <span class="n">rmq_submit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_transport</span> <span class="o">=</span> <span class="n">transports</span><span class="o">.</span><span class="n">TransportQueue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_loop</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_job_manager</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">JobManager</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_transport</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_persister</span> <span class="o">=</span> <span class="n">persister</span>

        <span class="k">if</span> <span class="n">communicator</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_communicator</span> <span class="o">=</span> <span class="n">communicator</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_controller</span> <span class="o">=</span> <span class="n">plumpy</span><span class="o">.</span><span class="n">RemoteProcessThreadController</span><span class="p">(</span><span class="n">communicator</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rmq_submit</span><span class="p">:</span>
            <span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Disabling RabbitMQ submission, no communicator provided&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rmq_submit</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Runner.__enter__"><a class="viewcode-back" href="../../../apidoc/aiida.engine.html#aiida.engine.runners.Runner.__enter__">[docs]</a>    <span class="k">def</span> <span class="nf">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Runner.__exit__"><a class="viewcode-back" href="../../../apidoc/aiida.engine.html#aiida.engine.runners.Runner.__exit__">[docs]</a>    <span class="k">def</span> <span class="nf">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_val</span><span class="p">,</span> <span class="n">exc_tb</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">loop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the event loop of this runner</span>

<span class="sd">        :return: the event loop</span>
<span class="sd">        :rtype: :class:`tornado.ioloop.IOLoop`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_loop</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">transport</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transport</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">persister</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_persister</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">communicator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the communicator used by this runner</span>

<span class="sd">        :return: the communicator</span>
<span class="sd">        :rtype: :class:`kiwipy.Communicator`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_communicator</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">job_manager</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_job_manager</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">controller</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_controller</span>

<div class="viewcode-block" id="Runner.is_closed"><a class="viewcode-back" href="../../../apidoc/aiida.engine.html#aiida.engine.runners.Runner.is_closed">[docs]</a>    <span class="k">def</span> <span class="nf">is_closed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_closed</span></div>

<div class="viewcode-block" id="Runner.start"><a class="viewcode-back" href="../../../apidoc/aiida.engine.html#aiida.engine.runners.Runner.start">[docs]</a>    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Start the internal event loop.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_loop</span><span class="o">.</span><span class="n">start</span><span class="p">()</span></div>

<div class="viewcode-block" id="Runner.stop"><a class="viewcode-back" href="../../../apidoc/aiida.engine.html#aiida.engine.runners.Runner.stop">[docs]</a>    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Stop the internal event loop.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_loop</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span></div>

<div class="viewcode-block" id="Runner.run_until_complete"><a class="viewcode-back" href="../../../apidoc/aiida.engine.html#aiida.engine.runners.Runner.run_until_complete">[docs]</a>    <span class="k">def</span> <span class="nf">run_until_complete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">future</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Run the loop until the future has finished and return the result.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">utils</span><span class="o">.</span><span class="n">loop_scope</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_loop</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_loop</span><span class="o">.</span><span class="n">run_sync</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">future</span><span class="p">)</span></div>

<div class="viewcode-block" id="Runner.close"><a class="viewcode-back" href="../../../apidoc/aiida.engine.html#aiida.engine.runners.Runner.close">[docs]</a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Close the runner by stopping the loop.&quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_closed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_closed</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Runner.submit"><a class="viewcode-back" href="../../../apidoc/aiida.engine.html#aiida.engine.runners.Runner.submit">[docs]</a>    <span class="k">def</span> <span class="nf">submit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">process</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">inputs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Submit the process with the supplied inputs to this runner immediately returning control to</span>
<span class="sd">        the interpreter. The return value will be the calculation node of the submitted process</span>

<span class="sd">        :param process: the process class to submit</span>
<span class="sd">        :param inputs: the inputs to be passed to the process</span>
<span class="sd">        :return: the calculation node of the process</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="n">utils</span><span class="o">.</span><span class="n">is_process_function</span><span class="p">(</span><span class="n">process</span><span class="p">),</span> <span class="s1">&#39;Cannot submit a process function&#39;</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_closed</span>

        <span class="n">process</span> <span class="o">=</span> <span class="n">instantiate_process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">process</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">inputs</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">process</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">store_provenance</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">exceptions</span><span class="o">.</span><span class="n">InvalidOperation</span><span class="p">(</span><span class="s1">&#39;cannot submit a process with `store_provenance=False`&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">process</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dry_run&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">exceptions</span><span class="o">.</span><span class="n">InvalidOperation</span><span class="p">(</span><span class="s1">&#39;cannot submit a process from within another with `dry_run=True`&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rmq_submit</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">persister</span><span class="o">.</span><span class="n">save_checkpoint</span><span class="p">(</span><span class="n">process</span><span class="p">)</span>
            <span class="n">process</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">continue_process</span><span class="p">(</span><span class="n">process</span><span class="o">.</span><span class="n">pid</span><span class="p">,</span> <span class="n">nowait</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">no_reply</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">add_callback</span><span class="p">(</span><span class="n">process</span><span class="o">.</span><span class="n">step_until_terminated</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">process</span><span class="o">.</span><span class="n">node</span></div>

<div class="viewcode-block" id="Runner.schedule"><a class="viewcode-back" href="../../../apidoc/aiida.engine.html#aiida.engine.runners.Runner.schedule">[docs]</a>    <span class="k">def</span> <span class="nf">schedule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">process</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">inputs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Schedule a process to be executed by this runner</span>

<span class="sd">        :param process: the process class to submit</span>
<span class="sd">        :param inputs: the inputs to be passed to the process</span>
<span class="sd">        :return: the calculation node of the process</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="n">utils</span><span class="o">.</span><span class="n">is_process_function</span><span class="p">(</span><span class="n">process</span><span class="p">),</span> <span class="s1">&#39;Cannot submit a process function&#39;</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_closed</span>

        <span class="n">process</span> <span class="o">=</span> <span class="n">instantiate_process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">process</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">inputs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">add_callback</span><span class="p">(</span><span class="n">process</span><span class="o">.</span><span class="n">step_until_terminated</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">process</span><span class="o">.</span><span class="n">node</span></div>

<div class="viewcode-block" id="Runner._run"><a class="viewcode-back" href="../../../apidoc/aiida.engine.html#aiida.engine.runners.Runner._run">[docs]</a>    <span class="k">def</span> <span class="nf">_run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">process</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">inputs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Run the process with the supplied inputs in this runner that will block until the process is completed.</span>
<span class="sd">        The return value will be the results of the completed process</span>

<span class="sd">        :param process: the process class or process function to run</span>
<span class="sd">        :param inputs: the inputs to be passed to the process</span>
<span class="sd">        :return: tuple of the outputs of the process and the calculation node</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_closed</span>

        <span class="k">if</span> <span class="n">utils</span><span class="o">.</span><span class="n">is_process_function</span><span class="p">(</span><span class="n">process</span><span class="p">):</span>
            <span class="n">result</span><span class="p">,</span> <span class="n">node</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">run_get_node</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">inputs</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">result</span><span class="p">,</span> <span class="n">node</span>

        <span class="k">with</span> <span class="n">utils</span><span class="o">.</span><span class="n">loop_scope</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">):</span>
            <span class="n">process</span> <span class="o">=</span> <span class="n">instantiate_process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">process</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">inputs</span><span class="p">)</span>
            <span class="n">process</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">process</span><span class="o">.</span><span class="n">outputs</span><span class="p">,</span> <span class="n">process</span><span class="o">.</span><span class="n">node</span></div>

<div class="viewcode-block" id="Runner.run"><a class="viewcode-back" href="../../../apidoc/aiida.engine.html#aiida.engine.runners.Runner.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">process</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">inputs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Run the process with the supplied inputs in this runner that will block until the process is completed.</span>
<span class="sd">        The return value will be the results of the completed process</span>

<span class="sd">        :param process: the process class or process function to run</span>
<span class="sd">        :param inputs: the inputs to be passed to the process</span>
<span class="sd">        :return: the outputs of the process</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run</span><span class="p">(</span><span class="n">process</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">inputs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="Runner.run_get_node"><a class="viewcode-back" href="../../../apidoc/aiida.engine.html#aiida.engine.runners.Runner.run_get_node">[docs]</a>    <span class="k">def</span> <span class="nf">run_get_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">process</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">inputs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Run the process with the supplied inputs in this runner that will block until the process is completed.</span>
<span class="sd">        The return value will be the results of the completed process</span>

<span class="sd">        :param process: the process class or process function to run</span>
<span class="sd">        :param inputs: the inputs to be passed to the process</span>
<span class="sd">        :return: tuple of the outputs of the process and the calculation node</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span><span class="p">,</span> <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run</span><span class="p">(</span><span class="n">process</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">inputs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ResultAndNode</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span></div>

<div class="viewcode-block" id="Runner.run_get_pk"><a class="viewcode-back" href="../../../apidoc/aiida.engine.html#aiida.engine.runners.Runner.run_get_pk">[docs]</a>    <span class="k">def</span> <span class="nf">run_get_pk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">process</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">inputs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Run the process with the supplied inputs in this runner that will block until the process is completed.</span>
<span class="sd">        The return value will be the results of the completed process</span>

<span class="sd">        :param process: the process class or process function to run</span>
<span class="sd">        :param inputs: the inputs to be passed to the process</span>
<span class="sd">        :return: tuple of the outputs of the process and process node pk</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span><span class="p">,</span> <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run</span><span class="p">(</span><span class="n">process</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">inputs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ResultAndPk</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span></div>

<div class="viewcode-block" id="Runner.call_on_calculation_finish"><a class="viewcode-back" href="../../../apidoc/aiida.engine.html#aiida.engine.runners.Runner.call_on_calculation_finish">[docs]</a>    <span class="k">def</span> <span class="nf">call_on_calculation_finish</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pk</span><span class="p">,</span> <span class="n">callback</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Callback to be called when the calculation of the given pk is terminated</span>

<span class="sd">        :param pk: the pk of the calculation</span>
<span class="sd">        :param callback: the function to be called upon calculation termination</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">calculation</span> <span class="o">=</span> <span class="n">load_node</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_poll_calculation</span><span class="p">(</span><span class="n">calculation</span><span class="p">,</span> <span class="n">callback</span><span class="p">)</span></div>

<div class="viewcode-block" id="Runner.get_calculation_future"><a class="viewcode-back" href="../../../apidoc/aiida.engine.html#aiida.engine.runners.Runner.get_calculation_future">[docs]</a>    <span class="k">def</span> <span class="nf">get_calculation_future</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pk</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a future for an orm Calculation. The future will have the calculation node</span>
<span class="sd">        as the result when finished.</span>

<span class="sd">        :return: A future representing the completion of the calculation node</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">futures</span><span class="o">.</span><span class="n">CalculationFuture</span><span class="p">(</span><span class="n">pk</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_loop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_poll_interval</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_communicator</span><span class="p">)</span></div>

<div class="viewcode-block" id="Runner._poll_calculation"><a class="viewcode-back" href="../../../apidoc/aiida.engine.html#aiida.engine.runners.Runner._poll_calculation">[docs]</a>    <span class="k">def</span> <span class="nf">_poll_calculation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">calc_node</span><span class="p">,</span> <span class="n">callback</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">calc_node</span><span class="o">.</span><span class="n">is_terminated</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_loop</span><span class="o">.</span><span class="n">add_callback</span><span class="p">(</span><span class="n">callback</span><span class="p">,</span> <span class="n">calc_node</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_loop</span><span class="o">.</span><span class="n">call_later</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_poll_interval</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_poll_calculation</span><span class="p">,</span> <span class="n">calc_node</span><span class="p">,</span> <span class="n">callback</span><span class="p">)</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, ECOLE POLYTECHNIQUE FEDERALE DE LAUSANNE (Theory and Simulation of Materials (THEOS) and National Centre for Computational Design and Discovery of Novel Materials (NCCR MARVEL)), Switzerland and ROBERT BOSCH LLC, USA. All rights reserved

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>