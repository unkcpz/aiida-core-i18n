

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>aiida.engine.processes.ports &mdash; AiiDA 1.0.0b2 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../../_static/language_data.js"></script>
        <script type="text/javascript" src="../../../../_static/contentui.js"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/contentui.css" type="text/css" />
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../index.html" class="icon icon-home"> AiiDA
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Installation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../install/quick_installation.html">Quick installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../install/prerequisites.html">Prerequisites</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../install/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../install/updating_installation.html">Updating AiiDA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../install/troubleshooting.html">Troubleshooting</a></li>
</ul>
<p class="caption"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../get_started/index.html">First things first</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../get_started/daemon.html">Setup the daemon</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../get_started/computers.html">Setup a computer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../get_started/codes.html">Setup a code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../get_started/plugins.html">Plugins</a></li>
</ul>
<p class="caption"><span class="caption-text">Concepts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../concepts/provenance.html">Provenance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../concepts/processes.html">Processes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../concepts/calculations.html">Calculations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../concepts/workflows.html">Workflows</a></li>
</ul>
<p class="caption"><span class="caption-text">Working with</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../working/processes.html">Processes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working/functions.html">Calculation and work functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working/calculations.html">Calculations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working/workflows.html">Workflows</a></li>
</ul>
<p class="caption"><span class="caption-text">Working with AiiDA</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../working_with_aiida/index.html">Command line interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working_with_aiida/index.html#scripting">Scripting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working_with_aiida/index.html#data-types">Data types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working_with_aiida/index.html#groups">Groups</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working_with_aiida/index.html#schedulers">Schedulers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working_with_aiida/index.html#querying-data">Querying data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working_with_aiida/index.html#caching">Caching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working_with_aiida/index.html#result-manager">Result manager</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working_with_aiida/index.html#backups">Backups</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working_with_aiida/index.html#troubleshooting">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working_with_aiida/index.html#rest-api">REST API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working_with_aiida/index.html#cookbook">Cookbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../import_export/index.html">Import and Export</a></li>
</ul>
<p class="caption"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../developer_guide/index.html">AiiDA design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../developer_guide/index.html#aiida-core">AiiDA core</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../developer_guide/index.html#aiida-plugins">AiiDA plugins</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../tutorial/index.html">StructureData</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tutorial/index.html#pseudopotentials">Pseudopotentials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tutorial/index.html#plugin-development">Plugin development</a></li>
</ul>
<p class="caption"><span class="caption-text">API reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="`aiida package &lt;https://aiida-core.readthedocs.io/en/latest/apidoc/aiida.html&gt;`_">`aiida package &lt;https://aiida-core.readthedocs.io/en/latest/apidoc/aiida.html&gt;`_</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">AiiDA</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../../../aiida.html">aiida</a> &raquo;</li>
        
      <li>aiida.engine.processes.ports</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for aiida.engine.processes.ports</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1">###########################################################################</span>
<span class="c1"># Copyright (c), The AiiDA team. All rights reserved.                     #</span>
<span class="c1"># This file is part of the AiiDA code.                                    #</span>
<span class="c1">#                                                                         #</span>
<span class="c1"># The code is hosted on GitHub at https://github.com/aiidateam/aiida_core #</span>
<span class="c1"># For further information on the license, see the LICENSE.txt file        #</span>
<span class="c1"># For further information please visit http://www.aiida.net               #</span>
<span class="c1">###########################################################################</span>
<span class="sd">&quot;&quot;&quot;AiiDA specific implementation of plumpy Ports and PortNamespaces for the ProcessSpec.&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">division</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">print_function</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">absolute_import</span>

<span class="kn">import</span> <span class="nn">collections</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="kn">from</span> <span class="nn">plumpy</span> <span class="k">import</span> <span class="n">ports</span>

<span class="kn">from</span> <span class="nn">aiida.common.lang</span> <span class="k">import</span> <span class="n">type_check</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;PortNamespace&#39;</span><span class="p">,</span> <span class="s1">&#39;InputPort&#39;</span><span class="p">,</span> <span class="s1">&#39;OutputPort&#39;</span><span class="p">,</span> <span class="s1">&#39;CalcJobOutputPort&#39;</span><span class="p">,</span> <span class="s1">&#39;WithNonDb&#39;</span><span class="p">,</span> <span class="s1">&#39;WithSerialize&#39;</span><span class="p">,</span>
           <span class="s1">&#39;PORT_NAMESPACE_SEPARATOR&#39;</span><span class="p">)</span>

<span class="n">PORT_NAME_MAX_CONSECUTIVE_UNDERSCORES</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># pylint: disable=invalid-name</span>
<span class="n">PORT_NAMESPACE_SEPARATOR</span> <span class="o">=</span> <span class="s1">&#39;__&#39;</span>  <span class="c1"># The character sequence to represent a nested port namespace in a flat link label</span>
<span class="n">OutputPort</span> <span class="o">=</span> <span class="n">ports</span><span class="o">.</span><span class="n">OutputPort</span>  <span class="c1"># pylint: disable=invalid-name</span>


<div class="viewcode-block" id="WithNonDb"><a class="viewcode-back" href="../../../../apidoc/aiida.engine.processes.html#aiida.engine.WithNonDb">[docs]</a><span class="k">class</span> <span class="nc">WithNonDb</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>  <span class="c1"># pylint: disable=useless-object-inheritance</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A mixin that adds support to a port to flag a that should not be stored</span>
<span class="sd">    in the database using the non_db=True flag.</span>

<span class="sd">    The mixins have to go before the main port class in the superclass order</span>
<span class="sd">    to make sure the mixin has the chance to strip out the non_db keyword.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="WithNonDb.__init__"><a class="viewcode-back" href="../../../../apidoc/aiida.engine.processes.html#aiida.engine.WithNonDb.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_non_db_explicitly_set</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="s1">&#39;non_db&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">)</span>
        <span class="n">non_db</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;non_db&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">WithNonDb</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_non_db</span> <span class="o">=</span> <span class="n">non_db</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">non_db_explicitly_set</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return whether the a value for `non_db` was explicitly passed in the construction of the `Port`.</span>

<span class="sd">        :return: boolean, True if `non_db` was explicitly defined during construction, False otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_non_db_explicitly_set</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">non_db</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return whether the value of this `Port` should be stored as a `Node` in the database.</span>

<span class="sd">        :return: boolean, True if it should be storable as a `Node`, False otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_non_db</span>

    <span class="nd">@non_db</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">non_db</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">non_db</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set whether the value of this `Port` should be stored as a `Node` in the database.</span>

<span class="sd">        :param non_db: boolean</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_non_db_explicitly_set</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_non_db</span> <span class="o">=</span> <span class="n">non_db</span></div>


<div class="viewcode-block" id="WithSerialize"><a class="viewcode-back" href="../../../../apidoc/aiida.engine.processes.html#aiida.engine.WithSerialize">[docs]</a><span class="k">class</span> <span class="nc">WithSerialize</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>  <span class="c1"># pylint: disable=useless-object-inheritance</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A mixin that adds support for a serialization function which is automatically applied on inputs</span>
<span class="sd">    that are not AiiDA data types.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="WithSerialize.__init__"><a class="viewcode-back" href="../../../../apidoc/aiida.engine.processes.html#aiida.engine.WithSerialize.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">serializer</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;serializer&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">WithSerialize</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_serializer</span> <span class="o">=</span> <span class="n">serializer</span></div>

<div class="viewcode-block" id="WithSerialize.serialize"><a class="viewcode-back" href="../../../../apidoc/aiida.engine.processes.html#aiida.engine.WithSerialize.serialize">[docs]</a>    <span class="k">def</span> <span class="nf">serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Serialize the given value if it is not already a Data type and a serializer function is defined</span>

<span class="sd">        :param value: the value to be serialized</span>
<span class="sd">        :returns: a serialized version of the value or the unchanged value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">aiida.orm</span> <span class="k">import</span> <span class="n">Data</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_serializer</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">Data</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">value</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_serializer</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="InputPort"><a class="viewcode-back" href="../../../../apidoc/aiida.engine.processes.html#aiida.engine.InputPort">[docs]</a><span class="k">class</span> <span class="nc">InputPort</span><span class="p">(</span><span class="n">WithSerialize</span><span class="p">,</span> <span class="n">WithNonDb</span><span class="p">,</span> <span class="n">ports</span><span class="o">.</span><span class="n">InputPort</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sub class of plumpy.InputPort which mixes in the WithSerialize and WithNonDb mixins to support automatic</span>
<span class="sd">    value serialization to database storable types and support non database storable input types as well.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="InputPort.get_description"><a class="viewcode-back" href="../../../../apidoc/aiida.engine.processes.html#aiida.engine.InputPort.get_description">[docs]</a>    <span class="k">def</span> <span class="nf">get_description</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a description of the InputPort, which will be a dictionary of its attributes</span>

<span class="sd">        :returns: a dictionary of the stringified InputPort attributes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">description</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">InputPort</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_description</span><span class="p">()</span>
        <span class="n">description</span><span class="p">[</span><span class="s1">&#39;non_db&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">non_db</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">description</span></div></div>


<div class="viewcode-block" id="CalcJobOutputPort"><a class="viewcode-back" href="../../../../apidoc/aiida.engine.processes.html#aiida.engine.CalcJobOutputPort">[docs]</a><span class="k">class</span> <span class="nc">CalcJobOutputPort</span><span class="p">(</span><span class="n">ports</span><span class="o">.</span><span class="n">OutputPort</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Sub class of plumpy.OutputPort which adds the `_pass_to_parser` attribute.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="CalcJobOutputPort.__init__"><a class="viewcode-back" href="../../../../apidoc/aiida.engine.processes.html#aiida.engine.CalcJobOutputPort.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">pass_to_parser</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;pass_to_parser&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">CalcJobOutputPort</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pass_to_parser</span> <span class="o">=</span> <span class="n">pass_to_parser</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">pass_to_parser</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pass_to_parser</span></div>


<div class="viewcode-block" id="PortNamespace"><a class="viewcode-back" href="../../../../apidoc/aiida.engine.processes.html#aiida.engine.PortNamespace">[docs]</a><span class="k">class</span> <span class="nc">PortNamespace</span><span class="p">(</span><span class="n">WithNonDb</span><span class="p">,</span> <span class="n">ports</span><span class="o">.</span><span class="n">PortNamespace</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sub class of plumpy.PortNamespace which implements the serialize method to support automatic recursive</span>
<span class="sd">    serialization of a given mapping onto the ports of the PortNamespace.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="PortNamespace.__setitem__"><a class="viewcode-back" href="../../../../apidoc/aiida.engine.processes.html#aiida.engine.PortNamespace.__setitem__">[docs]</a>    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">port</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Ensure that a `Port` being added inherits the `non_db` attribute if not explicitly defined at construction.</span>

<span class="sd">        The reasoning is that if a `PortNamespace` has `non_db=True`, which is different from the default value, very</span>
<span class="sd">        often all leaves should be also `non_db=True`. To prevent a user from having to specify it manually everytime</span>
<span class="sd">        we overload the value here, unless it was specifically set during construction.</span>

<span class="sd">        Note that the `non_db` attribute is not present for all `Port` sub classes so we have to check for it first.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">port</span><span class="p">,</span> <span class="n">ports</span><span class="o">.</span><span class="n">Port</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;port needs to be an instance of Port&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">validate_port_name</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">port</span><span class="p">,</span> <span class="s1">&#39;non_db_explicitly_set&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">port</span><span class="o">.</span><span class="n">non_db_explicitly_set</span><span class="p">:</span>
            <span class="n">port</span><span class="o">.</span><span class="n">non_db</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">non_db</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">PortNamespace</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">port</span><span class="p">)</span></div>

<div class="viewcode-block" id="PortNamespace.validate_port_name"><a class="viewcode-back" href="../../../../apidoc/aiida.engine.processes.html#aiida.engine.PortNamespace.validate_port_name">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">validate_port_name</span><span class="p">(</span><span class="n">port_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate the given port name.</span>

<span class="sd">        Valid port names adhere to the following restrictions:</span>

<span class="sd">            * Is a valid link label (see below)</span>
<span class="sd">            * Does not contain two or more consecutive underscores</span>

<span class="sd">        Valid link labels adhere to the following restrictions:</span>

<span class="sd">            * Has to be a valid python identifier</span>
<span class="sd">            * Can only contain alphanumeric characters and underscores</span>
<span class="sd">            * Can not start or end with an underscore</span>

<span class="sd">        :param port_name: the proposed name of the port to be added</span>
<span class="sd">        :raise TypeError: if the port name is not a string type</span>
<span class="sd">        :raise ValueError: if the port name is invalid</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">aiida.common.links</span> <span class="k">import</span> <span class="n">validate_link_label</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">validate_link_label</span><span class="p">(</span><span class="n">port_name</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">exception</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;invalid port name `</span><span class="si">{}</span><span class="s1">`: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">port_name</span><span class="p">,</span> <span class="n">exception</span><span class="p">))</span>

        <span class="c1"># Following regexes will match all groups of consecutive underscores where each group will be of the form</span>
        <span class="c1"># `(&#39;___&#39;, &#39;_&#39;)`, where the first element is the matched group of consecutive underscores.</span>
        <span class="n">consecutive_underscores</span> <span class="o">=</span> <span class="p">[</span><span class="n">match</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;((_)\2+)&#39;</span><span class="p">,</span> <span class="n">port_name</span><span class="p">)]</span>

        <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">PORT_NAME_MAX_CONSECUTIVE_UNDERSCORES</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">consecutive_underscores</span><span class="p">]):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;invalid port name `</span><span class="si">{}</span><span class="s1">`: more than two consecutive underscores&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">port_name</span><span class="p">))</span></div>

<div class="viewcode-block" id="PortNamespace.serialize"><a class="viewcode-back" href="../../../../apidoc/aiida.engine.processes.html#aiida.engine.PortNamespace.serialize">[docs]</a>    <span class="k">def</span> <span class="nf">serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mapping</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Serialize the given mapping onto this Portnamespace. It will recursively call this function on any</span>
<span class="sd">        nested PortNamespace or the serialize function on any Ports.</span>

<span class="sd">        :param mapping: a mapping of values to be serialized</span>
<span class="sd">        :returns: the serialized mapping</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">mapping</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">type_check</span><span class="p">(</span><span class="n">mapping</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">Mapping</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">mapping</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                <span class="n">port</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
                <span class="n">result</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">port</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">result</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="k">return</span> <span class="n">result</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, ECOLE POLYTECHNIQUE FEDERALE DE LAUSANNE (Theory and Simulation of Materials (THEOS) and National Centre for Computational Design and Discovery of Novel Materials (NCCR MARVEL)), Switzerland and ROBERT BOSCH LLC, USA. All rights reserved

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>