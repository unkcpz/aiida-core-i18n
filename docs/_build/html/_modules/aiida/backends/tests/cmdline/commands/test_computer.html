

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>aiida.backends.tests.cmdline.commands.test_computer &mdash; AiiDA 1.0.0b2 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../../../" src="../../../../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../../../../_static/language_data.js"></script>
        <script type="text/javascript" src="../../../../../../_static/contentui.js"></script>
    
    <script type="text/javascript" src="../../../../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../../_static/contentui.css" type="text/css" />
    <link rel="index" title="Index" href="../../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../../../index.html" class="icon icon-home"> AiiDA
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Installation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../install/quick_installation.html">Quick installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../install/prerequisites.html">Prerequisites</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../install/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../install/updating_installation.html">Updating AiiDA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../install/troubleshooting.html">Troubleshooting</a></li>
</ul>
<p class="caption"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../get_started/index.html">First things first</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../get_started/daemon.html">Setup the daemon</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../get_started/computers.html">Setup a computer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../get_started/codes.html">Setup a code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../get_started/plugins.html">Plugins</a></li>
</ul>
<p class="caption"><span class="caption-text">Concepts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../concepts/provenance.html">Provenance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../concepts/processes.html">Processes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../concepts/calculations.html">Calculations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../concepts/workflows.html">Workflows</a></li>
</ul>
<p class="caption"><span class="caption-text">Working with</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../working/processes.html">Processes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../working/functions.html">Calculation and work functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../working/calculations.html">Calculations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../working/workflows.html">Workflows</a></li>
</ul>
<p class="caption"><span class="caption-text">Working with AiiDA</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../working_with_aiida/index.html">Command line interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../working_with_aiida/index.html#scripting">Scripting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../working_with_aiida/index.html#data-types">Data types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../working_with_aiida/index.html#groups">Groups</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../working_with_aiida/index.html#schedulers">Schedulers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../working_with_aiida/index.html#querying-data">Querying data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../working_with_aiida/index.html#caching">Caching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../working_with_aiida/index.html#result-manager">Result manager</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../working_with_aiida/index.html#backups">Backups</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../working_with_aiida/index.html#troubleshooting">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../working_with_aiida/index.html#rest-api">REST API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../working_with_aiida/index.html#cookbook">Cookbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../import_export/index.html">Import and Export</a></li>
</ul>
<p class="caption"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../developer_guide/index.html">AiiDA design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../developer_guide/index.html#aiida-core">AiiDA core</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../developer_guide/index.html#aiida-plugins">AiiDA plugins</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../tutorial/index.html">StructureData</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../tutorial/index.html#pseudopotentials">Pseudopotentials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../tutorial/index.html#plugin-development">Plugin development</a></li>
</ul>
<p class="caption"><span class="caption-text">API reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="`aiida package &lt;https://aiida-core.readthedocs.io/en/latest/apidoc/aiida.html&gt;`_">`aiida package &lt;https://aiida-core.readthedocs.io/en/latest/apidoc/aiida.html&gt;`_</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../../index.html">AiiDA</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../../../../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../../../../../aiida.html">aiida</a> &raquo;</li>
        
          <li><a href="../../../tests.html">aiida.backends.tests</a> &raquo;</li>
        
      <li>aiida.backends.tests.cmdline.commands.test_computer</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for aiida.backends.tests.cmdline.commands.test_computer</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1">###########################################################################</span>
<span class="c1"># Copyright (c), The AiiDA team. All rights reserved.                     #</span>
<span class="c1"># This file is part of the AiiDA code.                                    #</span>
<span class="c1">#                                                                         #</span>
<span class="c1"># The code is hosted on GitHub at https://github.com/aiidateam/aiida_core #</span>
<span class="c1"># For further information on the license, see the LICENSE.txt file        #</span>
<span class="c1"># For further information please visit http://www.aiida.net               #</span>
<span class="c1">###########################################################################</span>
<span class="sd">&quot;&quot;&quot;Tests for the &#39;verdi computer&#39; command.&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">division</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">print_function</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">absolute_import</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">OrderedDict</span>
<span class="kn">from</span> <span class="nn">click.testing</span> <span class="k">import</span> <span class="n">CliRunner</span>

<span class="kn">from</span> <span class="nn">aiida.backends.testbase</span> <span class="k">import</span> <span class="n">AiidaTestCase</span>
<span class="kn">from</span> <span class="nn">aiida.cmdline.commands.cmd_computer</span> <span class="k">import</span> <span class="n">computer_disable</span><span class="p">,</span> <span class="n">computer_enable</span><span class="p">,</span> <span class="n">computer_setup</span>
<span class="kn">from</span> <span class="nn">aiida.cmdline.commands.cmd_computer</span> <span class="k">import</span> <span class="n">computer_show</span><span class="p">,</span> <span class="n">computer_list</span><span class="p">,</span> <span class="n">computer_rename</span><span class="p">,</span> <span class="n">computer_delete</span>
<span class="kn">from</span> <span class="nn">aiida.cmdline.commands.cmd_computer</span> <span class="k">import</span> <span class="n">computer_test</span><span class="p">,</span> <span class="n">computer_configure</span><span class="p">,</span> <span class="n">computer_duplicate</span>
<span class="kn">from</span> <span class="nn">aiida</span> <span class="k">import</span> <span class="n">orm</span>


<div class="viewcode-block" id="generate_setup_options_dict"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_computer.generate_setup_options_dict">[docs]</a><span class="k">def</span> <span class="nf">generate_setup_options_dict</span><span class="p">(</span><span class="n">replace_args</span><span class="o">=</span><span class="p">{},</span> <span class="n">non_interactive</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a OrderedDict with the key-value pairs for the command line.</span>

<span class="sd">    I use an ordered dict because for changing entries it&#39;s easier</span>
<span class="sd">    to have keys (so, a dict) but the commands might require a specific order,</span>
<span class="sd">    so I use an OrderedDict.</span>

<span class="sd">    This should be then passed to ``generate_setup_options()``.</span>

<span class="sd">    :param replace_args: a dictionary with the keys to replace, if needed</span>
<span class="sd">    :return: an OrderedDict with the command-line options</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">valid_noninteractive_options</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">non_interactive</span><span class="p">:</span>
        <span class="n">valid_noninteractive_options</span><span class="p">[</span><span class="s1">&#39;non-interactive&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">valid_noninteractive_options</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;noninteractive_computer&#39;</span>
    <span class="n">valid_noninteractive_options</span><span class="p">[</span><span class="s1">&#39;hostname&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;localhost&quot;</span>
    <span class="n">valid_noninteractive_options</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;my description&quot;</span>
    <span class="n">valid_noninteractive_options</span><span class="p">[</span><span class="s1">&#39;transport&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;local&quot;</span>
    <span class="n">valid_noninteractive_options</span><span class="p">[</span><span class="s1">&#39;scheduler&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;direct&quot;</span>
    <span class="n">valid_noninteractive_options</span><span class="p">[</span><span class="s1">&#39;shebang&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;#!/bin/bash&quot;</span>
    <span class="n">valid_noninteractive_options</span><span class="p">[</span><span class="s1">&#39;work-dir&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;/scratch/</span><span class="si">{username}</span><span class="s2">/aiida_run&quot;</span>
    <span class="n">valid_noninteractive_options</span><span class="p">[</span><span class="s1">&#39;mpirun-command&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;mpirun -np </span><span class="si">{tot_num_mpiprocs}</span><span class="s2">&quot;</span>
    <span class="n">valid_noninteractive_options</span><span class="p">[</span><span class="s1">&#39;mpiprocs-per-machine&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;2&quot;</span>
    <span class="c1"># Make them multiline to test also multiline options</span>
    <span class="n">valid_noninteractive_options</span><span class="p">[</span><span class="s1">&#39;prepend-text&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;date</span><span class="se">\n</span><span class="s2">echo &#39;second line&#39;&quot;</span>
    <span class="n">valid_noninteractive_options</span><span class="p">[</span><span class="s1">&#39;append-text&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;env</span><span class="se">\n</span><span class="s2">echo &#39;444&#39;</span><span class="se">\n</span><span class="s2">echo &#39;third line&#39;&quot;</span>

    <span class="c1"># I replace kwargs here, so that if they are known, they go at the right order</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">replace_args</span><span class="p">:</span>
        <span class="n">valid_noninteractive_options</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">replace_args</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">valid_noninteractive_options</span></div>


<div class="viewcode-block" id="generate_setup_options"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_computer.generate_setup_options">[docs]</a><span class="k">def</span> <span class="nf">generate_setup_options</span><span class="p">(</span><span class="n">ordereddict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given an (ordered) dict, returns a list of options</span>

<span class="sd">    Note that at this moment the implementation only supports long options</span>
<span class="sd">    (i.e. --option=value) and not short ones (-o value).</span>
<span class="sd">    Set a value to None to avoid the &#39;=value&#39; part.</span>

<span class="sd">    :param ordereddict: as generated by ``generate_setup_options_dict()``</span>
<span class="sd">    :return: a list to be passed as command-line arguments.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">options</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">ordereddict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">options</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;--</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">options</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;--</span><span class="si">{}</span><span class="s1">=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">options</span></div>


<div class="viewcode-block" id="generate_setup_options_interactive"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_computer.generate_setup_options_interactive">[docs]</a><span class="k">def</span> <span class="nf">generate_setup_options_interactive</span><span class="p">(</span><span class="n">ordereddict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given an (ordered) dict, returns a list of options</span>

<span class="sd">    Note that at this moment the implementation only supports long options</span>
<span class="sd">    (i.e. --option=value) and not short ones (-o value).</span>
<span class="sd">    Set a value to None to avoid the &#39;=value&#39; part.</span>

<span class="sd">    :param ordereddict: as generated by ``generate_setup_options_dict()``</span>
<span class="sd">    :return: a list to be passed as command-line arguments.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">options</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">ordereddict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">options</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">options</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">options</span></div>


<div class="viewcode-block" id="TestVerdiComputerSetup"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_computer.TestVerdiComputerSetup">[docs]</a><span class="k">class</span> <span class="nc">TestVerdiComputerSetup</span><span class="p">(</span><span class="n">AiidaTestCase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Tests for the &#39;verdi computer setup&#39; command.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="TestVerdiComputerSetup.setUp"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_computer.TestVerdiComputerSetup.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cli_runner</span> <span class="o">=</span> <span class="n">CliRunner</span><span class="p">()</span></div>

<div class="viewcode-block" id="TestVerdiComputerSetup.test_help"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_computer.TestVerdiComputerSetup.test_help">[docs]</a>    <span class="k">def</span> <span class="nf">test_help</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cli_runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">computer_setup</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;--help&#39;</span><span class="p">],</span> <span class="n">catch_exceptions</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestVerdiComputerSetup.test_reachable"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_computer.TestVerdiComputerSetup.test_reachable">[docs]</a>    <span class="k">def</span> <span class="nf">test_reachable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">subprocess</span> <span class="k">as</span> <span class="nn">sp</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s1">&#39;verdi&#39;</span><span class="p">,</span> <span class="s1">&#39;computer&#39;</span><span class="p">,</span> <span class="s1">&#39;setup&#39;</span><span class="p">,</span> <span class="s1">&#39;--help&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Usage:&#39;</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestVerdiComputerSetup.test_interactive"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_computer.TestVerdiComputerSetup.test_interactive">[docs]</a>    <span class="k">def</span> <span class="nf">test_interactive</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;VISUAL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;sleep 1; vim -cwq&#39;</span>
        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;EDITOR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;sleep 1; vim -cwq&#39;</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;interactive_computer&#39;</span>

        <span class="n">options_dict</span> <span class="o">=</span> <span class="n">generate_setup_options_dict</span><span class="p">(</span><span class="n">replace_args</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="n">label</span><span class="p">},</span> <span class="n">non_interactive</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="c1"># In any case, these would be managed by the visual editor</span>
        <span class="n">options_dict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;prepend-text&#39;</span><span class="p">)</span>
        <span class="n">options_dict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;append-text&#39;</span><span class="p">)</span>
        <span class="n">user_input</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">generate_setup_options_interactive</span><span class="p">(</span><span class="n">options_dict</span><span class="p">))</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cli_runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">computer_setup</span><span class="p">,</span> <span class="nb">input</span><span class="o">=</span><span class="n">user_input</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">exception</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;There was an unexpected exception. Output: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">output</span><span class="p">))</span>

        <span class="n">new_computer</span> <span class="o">=</span> <span class="n">orm</span><span class="o">.</span><span class="n">Computer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">new_computer</span><span class="p">,</span> <span class="n">orm</span><span class="o">.</span><span class="n">Computer</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">new_computer</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="n">options_dict</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">new_computer</span><span class="o">.</span><span class="n">hostname</span><span class="p">,</span> <span class="n">options_dict</span><span class="p">[</span><span class="s1">&#39;hostname&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">new_computer</span><span class="o">.</span><span class="n">get_transport_type</span><span class="p">(),</span> <span class="n">options_dict</span><span class="p">[</span><span class="s1">&#39;transport&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">new_computer</span><span class="o">.</span><span class="n">get_scheduler_type</span><span class="p">(),</span> <span class="n">options_dict</span><span class="p">[</span><span class="s1">&#39;scheduler&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">new_computer</span><span class="o">.</span><span class="n">get_mpirun_command</span><span class="p">(),</span> <span class="n">options_dict</span><span class="p">[</span><span class="s1">&#39;mpirun-command&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">new_computer</span><span class="o">.</span><span class="n">get_shebang</span><span class="p">(),</span> <span class="n">options_dict</span><span class="p">[</span><span class="s1">&#39;shebang&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">new_computer</span><span class="o">.</span><span class="n">get_workdir</span><span class="p">(),</span> <span class="n">options_dict</span><span class="p">[</span><span class="s1">&#39;work-dir&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">new_computer</span><span class="o">.</span><span class="n">get_default_mpiprocs_per_machine</span><span class="p">(),</span> <span class="nb">int</span><span class="p">(</span><span class="n">options_dict</span><span class="p">[</span><span class="s1">&#39;mpiprocs-per-machine&#39;</span><span class="p">]))</span>
        <span class="c1"># For now I&#39;m not writing anything in them</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">new_computer</span><span class="o">.</span><span class="n">get_prepend_text</span><span class="p">(),</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">new_computer</span><span class="o">.</span><span class="n">get_append_text</span><span class="p">(),</span> <span class="s2">&quot;&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestVerdiComputerSetup.test_mixed"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_computer.TestVerdiComputerSetup.test_mixed">[docs]</a>    <span class="k">def</span> <span class="nf">test_mixed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;VISUAL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;sleep 1; vim -cwq&#39;</span>
        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;EDITOR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;sleep 1; vim -cwq&#39;</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;mixed_computer&#39;</span>

        <span class="n">options_dict</span> <span class="o">=</span> <span class="n">generate_setup_options_dict</span><span class="p">(</span><span class="n">replace_args</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="n">label</span><span class="p">})</span>
        <span class="n">options_dict_full</span> <span class="o">=</span> <span class="n">options_dict</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="n">options_dict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;non-interactive&#39;</span><span class="p">,</span> <span class="s1">&#39;None&#39;</span><span class="p">)</span>

        <span class="n">non_interactive_options_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">non_interactive_options_dict</span><span class="p">[</span><span class="s1">&#39;prepend-text&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">options_dict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;prepend-text&#39;</span><span class="p">)</span>
        <span class="n">non_interactive_options_dict</span><span class="p">[</span><span class="s1">&#39;append-text&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">options_dict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;append-text&#39;</span><span class="p">)</span>
        <span class="n">non_interactive_options_dict</span><span class="p">[</span><span class="s1">&#39;shebang&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">options_dict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;shebang&#39;</span><span class="p">)</span>
        <span class="n">non_interactive_options_dict</span><span class="p">[</span><span class="s1">&#39;scheduler&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">options_dict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;scheduler&#39;</span><span class="p">)</span>

        <span class="c1"># In any case, these would be managed by the visual editor</span>
        <span class="n">user_input</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">generate_setup_options_interactive</span><span class="p">(</span><span class="n">options_dict</span><span class="p">))</span>
        <span class="n">options</span> <span class="o">=</span> <span class="n">generate_setup_options</span><span class="p">(</span><span class="n">non_interactive_options_dict</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cli_runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">computer_setup</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="nb">input</span><span class="o">=</span><span class="n">user_input</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">exception</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;There was an unexpected exception. Output: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">output</span><span class="p">))</span>

        <span class="n">new_computer</span> <span class="o">=</span> <span class="n">orm</span><span class="o">.</span><span class="n">Computer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">new_computer</span><span class="p">,</span> <span class="n">orm</span><span class="o">.</span><span class="n">Computer</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">new_computer</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="n">options_dict_full</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">new_computer</span><span class="o">.</span><span class="n">hostname</span><span class="p">,</span> <span class="n">options_dict_full</span><span class="p">[</span><span class="s1">&#39;hostname&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">new_computer</span><span class="o">.</span><span class="n">get_transport_type</span><span class="p">(),</span> <span class="n">options_dict_full</span><span class="p">[</span><span class="s1">&#39;transport&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">new_computer</span><span class="o">.</span><span class="n">get_scheduler_type</span><span class="p">(),</span> <span class="n">options_dict_full</span><span class="p">[</span><span class="s1">&#39;scheduler&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">new_computer</span><span class="o">.</span><span class="n">get_mpirun_command</span><span class="p">(),</span> <span class="n">options_dict_full</span><span class="p">[</span><span class="s1">&#39;mpirun-command&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">new_computer</span><span class="o">.</span><span class="n">get_shebang</span><span class="p">(),</span> <span class="n">options_dict_full</span><span class="p">[</span><span class="s1">&#39;shebang&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">new_computer</span><span class="o">.</span><span class="n">get_workdir</span><span class="p">(),</span> <span class="n">options_dict_full</span><span class="p">[</span><span class="s1">&#39;work-dir&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">new_computer</span><span class="o">.</span><span class="n">get_default_mpiprocs_per_machine</span><span class="p">(),</span>
                         <span class="nb">int</span><span class="p">(</span><span class="n">options_dict_full</span><span class="p">[</span><span class="s1">&#39;mpiprocs-per-machine&#39;</span><span class="p">]))</span>
        <span class="c1"># For now I&#39;m not writing anything in them</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">new_computer</span><span class="o">.</span><span class="n">get_prepend_text</span><span class="p">(),</span> <span class="n">options_dict_full</span><span class="p">[</span><span class="s1">&#39;prepend-text&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">new_computer</span><span class="o">.</span><span class="n">get_append_text</span><span class="p">(),</span> <span class="n">options_dict_full</span><span class="p">[</span><span class="s1">&#39;append-text&#39;</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestVerdiComputerSetup.test_noninteractive"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_computer.TestVerdiComputerSetup.test_noninteractive">[docs]</a>    <span class="k">def</span> <span class="nf">test_noninteractive</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Main test to check if the non-interactive command works</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">options_dict</span> <span class="o">=</span> <span class="n">generate_setup_options_dict</span><span class="p">()</span>
        <span class="n">options</span> <span class="o">=</span> <span class="n">generate_setup_options</span><span class="p">(</span><span class="n">options_dict</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cli_runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">computer_setup</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">exception</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">output</span><span class="p">[</span><span class="o">-</span><span class="mi">1000</span><span class="p">:])</span>
        <span class="n">new_computer</span> <span class="o">=</span> <span class="n">orm</span><span class="o">.</span><span class="n">Computer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">options_dict</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">new_computer</span><span class="p">,</span> <span class="n">orm</span><span class="o">.</span><span class="n">Computer</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">new_computer</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="n">options_dict</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">new_computer</span><span class="o">.</span><span class="n">hostname</span><span class="p">,</span> <span class="n">options_dict</span><span class="p">[</span><span class="s1">&#39;hostname&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">new_computer</span><span class="o">.</span><span class="n">get_transport_type</span><span class="p">(),</span> <span class="n">options_dict</span><span class="p">[</span><span class="s1">&#39;transport&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">new_computer</span><span class="o">.</span><span class="n">get_scheduler_type</span><span class="p">(),</span> <span class="n">options_dict</span><span class="p">[</span><span class="s1">&#39;scheduler&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">new_computer</span><span class="o">.</span><span class="n">get_mpirun_command</span><span class="p">(),</span> <span class="n">options_dict</span><span class="p">[</span><span class="s1">&#39;mpirun-command&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">new_computer</span><span class="o">.</span><span class="n">get_shebang</span><span class="p">(),</span> <span class="n">options_dict</span><span class="p">[</span><span class="s1">&#39;shebang&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">new_computer</span><span class="o">.</span><span class="n">get_workdir</span><span class="p">(),</span> <span class="n">options_dict</span><span class="p">[</span><span class="s1">&#39;work-dir&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">new_computer</span><span class="o">.</span><span class="n">get_default_mpiprocs_per_machine</span><span class="p">(),</span> <span class="nb">int</span><span class="p">(</span><span class="n">options_dict</span><span class="p">[</span><span class="s1">&#39;mpiprocs-per-machine&#39;</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">new_computer</span><span class="o">.</span><span class="n">get_prepend_text</span><span class="p">(),</span> <span class="n">options_dict</span><span class="p">[</span><span class="s1">&#39;prepend-text&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">new_computer</span><span class="o">.</span><span class="n">get_append_text</span><span class="p">(),</span> <span class="n">options_dict</span><span class="p">[</span><span class="s1">&#39;append-text&#39;</span><span class="p">])</span>

        <span class="c1"># Test that I cannot generate twice a computer with the same label</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cli_runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">computer_setup</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">exception</span><span class="p">,</span> <span class="ne">SystemExit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s2">&quot;already exists&quot;</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">output</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestVerdiComputerSetup.test_noninteractive_optional_default_mpiprocs"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_computer.TestVerdiComputerSetup.test_noninteractive_optional_default_mpiprocs">[docs]</a>    <span class="k">def</span> <span class="nf">test_noninteractive_optional_default_mpiprocs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check that if is ok not to specify mpiprocs-per-machine</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">options_dict</span> <span class="o">=</span> <span class="n">generate_setup_options_dict</span><span class="p">({</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;computer_default_mpiprocs&#39;</span><span class="p">})</span>
        <span class="n">options_dict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;mpiprocs-per-machine&#39;</span><span class="p">)</span>
        <span class="n">options</span> <span class="o">=</span> <span class="n">generate_setup_options</span><span class="p">(</span><span class="n">options_dict</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cli_runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">computer_setup</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">exception</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">output</span><span class="p">[</span><span class="o">-</span><span class="mi">1000</span><span class="p">:])</span>

        <span class="n">new_computer</span> <span class="o">=</span> <span class="n">orm</span><span class="o">.</span><span class="n">Computer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">options_dict</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">new_computer</span><span class="p">,</span> <span class="n">orm</span><span class="o">.</span><span class="n">Computer</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">new_computer</span><span class="o">.</span><span class="n">get_default_mpiprocs_per_machine</span><span class="p">())</span></div>

<div class="viewcode-block" id="TestVerdiComputerSetup.test_noninteractive_optional_default_mpiprocs_2"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_computer.TestVerdiComputerSetup.test_noninteractive_optional_default_mpiprocs_2">[docs]</a>    <span class="k">def</span> <span class="nf">test_noninteractive_optional_default_mpiprocs_2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check that if is the specified value is zero, it means unspecified</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">options_dict</span> <span class="o">=</span> <span class="n">generate_setup_options_dict</span><span class="p">({</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;computer_default_mpiprocs_2&#39;</span><span class="p">})</span>
        <span class="n">options_dict</span><span class="p">[</span><span class="s1">&#39;mpiprocs-per-machine&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">options</span> <span class="o">=</span> <span class="n">generate_setup_options</span><span class="p">(</span><span class="n">options_dict</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cli_runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">computer_setup</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">exception</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">output</span><span class="p">[</span><span class="o">-</span><span class="mi">1000</span><span class="p">:])</span>

        <span class="n">new_computer</span> <span class="o">=</span> <span class="n">orm</span><span class="o">.</span><span class="n">Computer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">options_dict</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">new_computer</span><span class="p">,</span> <span class="n">orm</span><span class="o">.</span><span class="n">Computer</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">new_computer</span><span class="o">.</span><span class="n">get_default_mpiprocs_per_machine</span><span class="p">())</span></div>

<div class="viewcode-block" id="TestVerdiComputerSetup.test_noninteractive_optional_default_mpiprocs_3"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_computer.TestVerdiComputerSetup.test_noninteractive_optional_default_mpiprocs_3">[docs]</a>    <span class="k">def</span> <span class="nf">test_noninteractive_optional_default_mpiprocs_3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check that it fails for a negative number of mpiprocs</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">options_dict</span> <span class="o">=</span> <span class="n">generate_setup_options_dict</span><span class="p">({</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;computer_default_mpiprocs_3&#39;</span><span class="p">})</span>
        <span class="n">options_dict</span><span class="p">[</span><span class="s1">&#39;mpiprocs-per-machine&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">options</span> <span class="o">=</span> <span class="n">generate_setup_options</span><span class="p">(</span><span class="n">options_dict</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cli_runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">computer_setup</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">exception</span><span class="p">,</span> <span class="ne">SystemExit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s2">&quot;mpiprocs_per_machine, must be positive&quot;</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">output</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestVerdiComputerSetup.test_noninteractive_wrong_transport_fail"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_computer.TestVerdiComputerSetup.test_noninteractive_wrong_transport_fail">[docs]</a>    <span class="k">def</span> <span class="nf">test_noninteractive_wrong_transport_fail</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check that if fails as expected for an unknown transport</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">options_dict</span> <span class="o">=</span> <span class="n">generate_setup_options_dict</span><span class="p">(</span><span class="n">replace_args</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;fail_computer&#39;</span><span class="p">})</span>
        <span class="n">options_dict</span><span class="p">[</span><span class="s1">&#39;transport&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;unknown_transport&#39;</span>
        <span class="n">options</span> <span class="o">=</span> <span class="n">generate_setup_options</span><span class="p">(</span><span class="n">options_dict</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cli_runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">computer_setup</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">exception</span><span class="p">,</span> <span class="ne">SystemExit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s2">&quot;&#39;unknown_transport&#39; is not valid&quot;</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">output</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestVerdiComputerSetup.test_noninteractive_wrong_scheduler_fail"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_computer.TestVerdiComputerSetup.test_noninteractive_wrong_scheduler_fail">[docs]</a>    <span class="k">def</span> <span class="nf">test_noninteractive_wrong_scheduler_fail</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check that if fails as expected for an unknown transport</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">options_dict</span> <span class="o">=</span> <span class="n">generate_setup_options_dict</span><span class="p">(</span><span class="n">replace_args</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;fail_computer&#39;</span><span class="p">})</span>
        <span class="n">options_dict</span><span class="p">[</span><span class="s1">&#39;scheduler&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;unknown_scheduler&#39;</span>
        <span class="n">options</span> <span class="o">=</span> <span class="n">generate_setup_options</span><span class="p">(</span><span class="n">options_dict</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cli_runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">computer_setup</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">exception</span><span class="p">,</span> <span class="ne">SystemExit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s2">&quot;&#39;unknown_scheduler&#39; is not valid&quot;</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">output</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestVerdiComputerSetup.test_noninteractive_invalid_shebang_fail"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_computer.TestVerdiComputerSetup.test_noninteractive_invalid_shebang_fail">[docs]</a>    <span class="k">def</span> <span class="nf">test_noninteractive_invalid_shebang_fail</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check that if fails as expected for an unknown transport</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">options_dict</span> <span class="o">=</span> <span class="n">generate_setup_options_dict</span><span class="p">(</span><span class="n">replace_args</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;fail_computer&#39;</span><span class="p">})</span>
        <span class="n">options_dict</span><span class="p">[</span><span class="s1">&#39;shebang&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;/bin/bash&#39;</span>  <span class="c1"># Missing #! in front</span>
        <span class="n">options</span> <span class="o">=</span> <span class="n">generate_setup_options</span><span class="p">(</span><span class="n">options_dict</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cli_runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">computer_setup</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">exception</span><span class="p">,</span> <span class="ne">SystemExit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s2">&quot;The shebang line should start with&quot;</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">output</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestVerdiComputerSetup.test_noninteractive_invalid_mpirun_fail"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_computer.TestVerdiComputerSetup.test_noninteractive_invalid_mpirun_fail">[docs]</a>    <span class="k">def</span> <span class="nf">test_noninteractive_invalid_mpirun_fail</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check that if fails as expected for an unknown transport</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">options_dict</span> <span class="o">=</span> <span class="n">generate_setup_options_dict</span><span class="p">(</span><span class="n">replace_args</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;fail_computer&#39;</span><span class="p">})</span>
        <span class="n">options_dict</span><span class="p">[</span><span class="s1">&#39;mpirun-command&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;mpirun -np </span><span class="si">{unknown_key}</span><span class="s1">&#39;</span>
        <span class="n">options</span> <span class="o">=</span> <span class="n">generate_setup_options</span><span class="p">(</span><span class="n">options_dict</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cli_runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">computer_setup</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">exception</span><span class="p">,</span> <span class="ne">SystemExit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s2">&quot;unknown replacement field &#39;unknown_key&#39;&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">output</span><span class="p">))</span></div>

<div class="viewcode-block" id="TestVerdiComputerSetup.test_noninteractive_from_config"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_computer.TestVerdiComputerSetup.test_noninteractive_from_config">[docs]</a>    <span class="k">def</span> <span class="nf">test_noninteractive_from_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Test setting up a computer from a config file&quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">aiida.orm</span> <span class="k">import</span> <span class="n">Computer</span>
        <span class="kn">import</span> <span class="nn">tempfile</span>
        <span class="kn">import</span> <span class="nn">os</span>

        <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;noninteractive_config&#39;</span>

        <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">handle</span><span class="p">:</span>
            <span class="n">handle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;---</span>
<span class="s2">label: </span><span class="si">{l}</span><span class="s2"></span>
<span class="s2">hostname: </span><span class="si">{l}</span><span class="s2"></span>
<span class="s2">transport: local</span>
<span class="s2">scheduler: direct</span>
<span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">l</span><span class="o">=</span><span class="n">label</span><span class="p">))</span>
            <span class="n">handle</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cli_runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">computer_setup</span><span class="p">,</span>
                                            <span class="p">[</span><span class="s1">&#39;--non-interactive&#39;</span><span class="p">,</span> <span class="s1">&#39;--config&#39;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">handle</span><span class="o">.</span><span class="n">name</span><span class="p">)])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertClickResultNoException</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">Computer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">label</span><span class="p">),</span> <span class="n">Computer</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="TestVerdiComputerConfigure"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_computer.TestVerdiComputerConfigure">[docs]</a><span class="k">class</span> <span class="nc">TestVerdiComputerConfigure</span><span class="p">(</span><span class="n">AiidaTestCase</span><span class="p">):</span>

<div class="viewcode-block" id="TestVerdiComputerConfigure.setUp"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_computer.TestVerdiComputerConfigure.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Prepare computer builder with common properties.&quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">aiida.orm.utils.builders.computer</span> <span class="k">import</span> <span class="n">ComputerBuilder</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cli_runner</span> <span class="o">=</span> <span class="n">CliRunner</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user</span> <span class="o">=</span> <span class="n">orm</span><span class="o">.</span><span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_default</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">comp_builder</span> <span class="o">=</span> <span class="n">ComputerBuilder</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;test_comp_setup&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">comp_builder</span><span class="o">.</span><span class="n">hostname</span> <span class="o">=</span> <span class="s1">&#39;localhost&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">comp_builder</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s1">&#39;Test Computer&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">comp_builder</span><span class="o">.</span><span class="n">scheduler</span> <span class="o">=</span> <span class="s1">&#39;direct&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">comp_builder</span><span class="o">.</span><span class="n">work_dir</span> <span class="o">=</span> <span class="s1">&#39;/tmp/aiida&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">comp_builder</span><span class="o">.</span><span class="n">prepend_text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">comp_builder</span><span class="o">.</span><span class="n">append_text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">comp_builder</span><span class="o">.</span><span class="n">mpiprocs_per_machine</span> <span class="o">=</span> <span class="mi">8</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">comp_builder</span><span class="o">.</span><span class="n">mpirun_command</span> <span class="o">=</span> <span class="s1">&#39;mpirun&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">comp_builder</span><span class="o">.</span><span class="n">shebang</span> <span class="o">=</span> <span class="s1">&#39;#!xonsh&#39;</span></div>

<div class="viewcode-block" id="TestVerdiComputerConfigure.test_top_help"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_computer.TestVerdiComputerConfigure.test_top_help">[docs]</a>    <span class="k">def</span> <span class="nf">test_top_help</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Test help option of verdi computer configure.&quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cli_runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">computer_configure</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;--help&#39;</span><span class="p">],</span> <span class="n">catch_exceptions</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;ssh&#39;</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;local&#39;</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">output</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestVerdiComputerConfigure.test_reachable"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_computer.TestVerdiComputerConfigure.test_reachable">[docs]</a>    <span class="k">def</span> <span class="nf">test_reachable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Test reachability of top level and sub commands.&quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">subprocess</span> <span class="k">as</span> <span class="nn">sp</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s1">&#39;verdi&#39;</span><span class="p">,</span> <span class="s1">&#39;computer&#39;</span><span class="p">,</span> <span class="s1">&#39;configure&#39;</span><span class="p">,</span> <span class="s1">&#39;--help&#39;</span><span class="p">])</span>
        <span class="n">sp</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s1">&#39;verdi&#39;</span><span class="p">,</span> <span class="s1">&#39;computer&#39;</span><span class="p">,</span> <span class="s1">&#39;configure&#39;</span><span class="p">,</span> <span class="s1">&#39;local&#39;</span><span class="p">,</span> <span class="s1">&#39;--help&#39;</span><span class="p">])</span>
        <span class="n">sp</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s1">&#39;verdi&#39;</span><span class="p">,</span> <span class="s1">&#39;computer&#39;</span><span class="p">,</span> <span class="s1">&#39;configure&#39;</span><span class="p">,</span> <span class="s1">&#39;ssh&#39;</span><span class="p">,</span> <span class="s1">&#39;--help&#39;</span><span class="p">])</span>
        <span class="n">sp</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s1">&#39;verdi&#39;</span><span class="p">,</span> <span class="s1">&#39;computer&#39;</span><span class="p">,</span> <span class="s1">&#39;configure&#39;</span><span class="p">,</span> <span class="s1">&#39;show&#39;</span><span class="p">,</span> <span class="s1">&#39;--help&#39;</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestVerdiComputerConfigure.test_local_ni_empty"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_computer.TestVerdiComputerConfigure.test_local_ni_empty">[docs]</a>    <span class="k">def</span> <span class="nf">test_local_ni_empty</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test verdi computer configure local &lt;comp&gt;</span>

<span class="sd">        Test twice, with comp setup for local or ssh.</span>

<span class="sd">         * with computer setup for local: should succeed</span>
<span class="sd">         * with computer setup for ssh: should fail</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">comp_builder</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;test_local_ni_empty&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">comp_builder</span><span class="o">.</span><span class="n">transport</span> <span class="o">=</span> <span class="s1">&#39;local&#39;</span>
        <span class="n">comp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">comp_builder</span><span class="o">.</span><span class="n">new</span><span class="p">()</span>
        <span class="n">comp</span><span class="o">.</span><span class="n">store</span><span class="p">()</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cli_runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">computer_configure</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;local&#39;</span><span class="p">,</span> <span class="n">comp</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="s1">&#39;--non-interactive&#39;</span><span class="p">],</span>
                                        <span class="n">catch_exceptions</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">comp</span><span class="o">.</span><span class="n">is_user_configured</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="p">),</span> <span class="n">msg</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">comp_builder</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;test_local_ni_empty_mismatch&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">comp_builder</span><span class="o">.</span><span class="n">transport</span> <span class="o">=</span> <span class="s1">&#39;ssh&#39;</span>
        <span class="n">comp_mismatch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">comp_builder</span><span class="o">.</span><span class="n">new</span><span class="p">()</span>
        <span class="n">comp_mismatch</span><span class="o">.</span><span class="n">store</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cli_runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">computer_configure</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;local&#39;</span><span class="p">,</span> <span class="n">comp_mismatch</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="s1">&#39;--non-interactive&#39;</span><span class="p">],</span>
                                        <span class="n">catch_exceptions</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">exception</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;ssh&#39;</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;local&#39;</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">output</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestVerdiComputerConfigure.test_local_interactive"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_computer.TestVerdiComputerConfigure.test_local_interactive">[docs]</a>    <span class="k">def</span> <span class="nf">test_local_interactive</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">comp_builder</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;test_local_interactive&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">comp_builder</span><span class="o">.</span><span class="n">transport</span> <span class="o">=</span> <span class="s1">&#39;local&#39;</span>
        <span class="n">comp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">comp_builder</span><span class="o">.</span><span class="n">new</span><span class="p">()</span>
        <span class="n">comp</span><span class="o">.</span><span class="n">store</span><span class="p">()</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cli_runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">computer_configure</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;local&#39;</span><span class="p">,</span> <span class="n">comp</span><span class="o">.</span><span class="n">label</span><span class="p">],</span> <span class="nb">input</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">catch_exceptions</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">comp</span><span class="o">.</span><span class="n">is_user_configured</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="p">),</span> <span class="n">msg</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">output</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestVerdiComputerConfigure.test_ssh_ni_empty"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_computer.TestVerdiComputerConfigure.test_ssh_ni_empty">[docs]</a>    <span class="k">def</span> <span class="nf">test_ssh_ni_empty</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test verdi computer configure ssh &lt;comp&gt;</span>

<span class="sd">        Test twice, with comp setup for ssh or local.</span>

<span class="sd">         * with computer setup for ssh: should succeed</span>
<span class="sd">         * with computer setup for local: should fail</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">comp_builder</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;test_ssh_ni_empty&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">comp_builder</span><span class="o">.</span><span class="n">transport</span> <span class="o">=</span> <span class="s1">&#39;ssh&#39;</span>
        <span class="n">comp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">comp_builder</span><span class="o">.</span><span class="n">new</span><span class="p">()</span>
        <span class="n">comp</span><span class="o">.</span><span class="n">store</span><span class="p">()</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cli_runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">computer_configure</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;ssh&#39;</span><span class="p">,</span> <span class="n">comp</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="s1">&#39;--non-interactive&#39;</span><span class="p">],</span>
                                        <span class="n">catch_exceptions</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">comp</span><span class="o">.</span><span class="n">is_user_configured</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="p">),</span> <span class="n">msg</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">comp_builder</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;test_ssh_ni_empty_mismatch&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">comp_builder</span><span class="o">.</span><span class="n">transport</span> <span class="o">=</span> <span class="s1">&#39;local&#39;</span>
        <span class="n">comp_mismatch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">comp_builder</span><span class="o">.</span><span class="n">new</span><span class="p">()</span>
        <span class="n">comp_mismatch</span><span class="o">.</span><span class="n">store</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cli_runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">computer_configure</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;ssh&#39;</span><span class="p">,</span> <span class="n">comp_mismatch</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="s1">&#39;--non-interactive&#39;</span><span class="p">],</span>
                                        <span class="n">catch_exceptions</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">exception</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;local&#39;</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;ssh&#39;</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">output</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestVerdiComputerConfigure.test_ssh_ni_username"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_computer.TestVerdiComputerConfigure.test_ssh_ni_username">[docs]</a>    <span class="k">def</span> <span class="nf">test_ssh_ni_username</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Test verdi computer configure ssh &lt;comp&gt; --username=&lt;username&gt;.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">comp_builder</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;test_ssh_ni_username&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">comp_builder</span><span class="o">.</span><span class="n">transport</span> <span class="o">=</span> <span class="s1">&#39;ssh&#39;</span>
        <span class="n">comp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">comp_builder</span><span class="o">.</span><span class="n">new</span><span class="p">()</span>
        <span class="n">comp</span><span class="o">.</span><span class="n">store</span><span class="p">()</span>

        <span class="n">username</span> <span class="o">=</span> <span class="s1">&#39;TEST&#39;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cli_runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">computer_configure</span><span class="p">,</span>
                                        <span class="p">[</span><span class="s1">&#39;ssh&#39;</span><span class="p">,</span> <span class="n">comp</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="s1">&#39;--non-interactive&#39;</span><span class="p">,</span> <span class="s1">&#39;--username=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">username</span><span class="p">)],</span>
                                        <span class="n">catch_exceptions</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">comp</span><span class="o">.</span><span class="n">is_user_configured</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="p">),</span> <span class="n">msg</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">orm</span><span class="o">.</span><span class="n">AuthInfo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="n">dbcomputer_id</span><span class="o">=</span><span class="n">comp</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">aiidauser_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">get_auth_params</span><span class="p">()[</span><span class="s1">&#39;username&#39;</span><span class="p">],</span>
                         <span class="n">username</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestVerdiComputerConfigure.test_show"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_computer.TestVerdiComputerConfigure.test_show">[docs]</a>    <span class="k">def</span> <span class="nf">test_show</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Test verdi computer configure show &lt;comp&gt;.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">comp_builder</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;test_show&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">comp_builder</span><span class="o">.</span><span class="n">transport</span> <span class="o">=</span> <span class="s1">&#39;ssh&#39;</span>
        <span class="n">comp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">comp_builder</span><span class="o">.</span><span class="n">new</span><span class="p">()</span>
        <span class="n">comp</span><span class="o">.</span><span class="n">store</span><span class="p">()</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cli_runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">computer_configure</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;show&#39;</span><span class="p">,</span> <span class="n">comp</span><span class="o">.</span><span class="n">label</span><span class="p">],</span> <span class="n">catch_exceptions</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cli_runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">computer_configure</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;show&#39;</span><span class="p">,</span> <span class="n">comp</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="s1">&#39;--defaults&#39;</span><span class="p">],</span> <span class="n">catch_exceptions</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;* username&#39;</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cli_runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">computer_configure</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;show&#39;</span><span class="p">,</span> <span class="n">comp</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="s1">&#39;--defaults&#39;</span><span class="p">,</span> <span class="s1">&#39;--as-option-string&#39;</span><span class="p">],</span>
                                        <span class="n">catch_exceptions</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;--username=&#39;</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>

        <span class="n">config_cmd</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ssh&#39;</span><span class="p">,</span> <span class="n">comp</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="s1">&#39;--non-interactive&#39;</span><span class="p">]</span>
        <span class="n">config_cmd</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">))</span>
        <span class="n">result_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cli_runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">computer_configure</span><span class="p">,</span> <span class="n">config_cmd</span><span class="p">,</span> <span class="n">catch_exceptions</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">comp</span><span class="o">.</span><span class="n">is_user_configured</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="p">),</span> <span class="n">msg</span><span class="o">=</span><span class="n">result_config</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>

        <span class="n">result_cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cli_runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">computer_configure</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;show&#39;</span><span class="p">,</span> <span class="n">comp</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="s1">&#39;--as-option-string&#39;</span><span class="p">],</span>
                                            <span class="n">catch_exceptions</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;--username=&#39;</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result_cur</span><span class="o">.</span><span class="n">output</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">output</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="TestVerdiComputerCommands"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_computer.TestVerdiComputerCommands">[docs]</a><span class="k">class</span> <span class="nc">TestVerdiComputerCommands</span><span class="p">(</span><span class="n">AiidaTestCase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Testing verdi computer commands.</span>

<span class="sd">    Testing everything besides `computer setup`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="TestVerdiComputerCommands.setUpClass"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_computer.TestVerdiComputerCommands.setUpClass">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">setUpClass</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a new computer&gt; I create a new one because I want to configure it and I don&#39;t want to</span>
<span class="sd">        interfere with other tests&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TestVerdiComputerCommands</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">setUpClass</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">computer_name</span> <span class="o">=</span> <span class="s2">&quot;comp_cli_test_computer&quot;</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">comp</span> <span class="o">=</span> <span class="n">orm</span><span class="o">.</span><span class="n">Computer</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="bp">cls</span><span class="o">.</span><span class="n">computer_name</span><span class="p">,</span>
            <span class="n">hostname</span><span class="o">=</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span>
            <span class="n">transport_type</span><span class="o">=</span><span class="s1">&#39;local&#39;</span><span class="p">,</span>
            <span class="n">scheduler_type</span><span class="o">=</span><span class="s1">&#39;direct&#39;</span><span class="p">,</span>
            <span class="n">workdir</span><span class="o">=</span><span class="s1">&#39;/tmp/aiida&#39;</span><span class="p">)</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">comp</span><span class="o">.</span><span class="n">set_default_mpiprocs_per_machine</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">comp</span><span class="o">.</span><span class="n">store</span><span class="p">()</span></div>

<div class="viewcode-block" id="TestVerdiComputerCommands.setUp"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_computer.TestVerdiComputerCommands.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prepare the computer and user</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user</span> <span class="o">=</span> <span class="n">orm</span><span class="o">.</span><span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_default</span><span class="p">()</span>

        <span class="c1"># I need to configure the computer here; being &#39;local&#39;,</span>
        <span class="c1"># there should not be any options asked here</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">comp</span><span class="o">.</span><span class="n">configure</span><span class="p">()</span>

        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">comp</span><span class="o">.</span><span class="n">is_user_configured</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="p">),</span> <span class="s2">&quot;There was a problem configuring the test computer&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cli_runner</span> <span class="o">=</span> <span class="n">CliRunner</span><span class="p">()</span></div>

<div class="viewcode-block" id="TestVerdiComputerCommands.test_computer_test"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_computer.TestVerdiComputerCommands.test_computer_test">[docs]</a>    <span class="k">def</span> <span class="nf">test_computer_test</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test if the &#39;verdi computer test&#39; command works</span>

<span class="sd">        It should work as it is a local connection</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Testing the wrong computer will fail</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cli_runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">computer_test</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;non-existent-computer&#39;</span><span class="p">])</span>
        <span class="c1"># An exception should arise</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">exception</span><span class="p">)</span>

        <span class="c1"># Testing the right computer should pass locally</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cli_runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">computer_test</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;comp_cli_test_computer&#39;</span><span class="p">])</span>
        <span class="c1"># No exceptions should arise</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">exception</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">output</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestVerdiComputerCommands.test_computer_list"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_computer.TestVerdiComputerCommands.test_computer_list">[docs]</a>    <span class="k">def</span> <span class="nf">test_computer_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test if &#39;verdi computer list&#39; command works</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Check the vanilla command works</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cli_runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">computer_list</span><span class="p">,</span> <span class="p">[])</span>
        <span class="c1"># No exceptions should arise</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">exception</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>
        <span class="c1"># Something should be printed to stdout</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>

        <span class="c1"># Check all options run</span>
        <span class="k">for</span> <span class="n">opt</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;-r&#39;</span><span class="p">,</span> <span class="s1">&#39;--raw&#39;</span><span class="p">,</span> <span class="s1">&#39;-a&#39;</span><span class="p">,</span> <span class="s1">&#39;--all&#39;</span><span class="p">]:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cli_runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">computer_list</span><span class="p">,</span> <span class="p">[</span><span class="n">opt</span><span class="p">])</span>
            <span class="c1"># No exceptions should arise</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">exception</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>
            <span class="c1"># Something should be printed to stdout</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">output</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestVerdiComputerCommands.test_computer_show"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_computer.TestVerdiComputerCommands.test_computer_show">[docs]</a>    <span class="k">def</span> <span class="nf">test_computer_show</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test if &#39;verdi computer show&#39; command works</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">traceback</span>

        <span class="c1"># See if we can display info about the test computer.</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cli_runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">computer_show</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;comp_cli_test_computer&#39;</span><span class="p">])</span>

        <span class="c1"># No exceptions should arise</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertClickResultNoException</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="c1"># Something should be printed to stdout</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>

        <span class="c1"># See if a non-existent computer will raise an error.</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cli_runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">computer_show</span><span class="p">,</span> <span class="s1">&#39;non_existent_computer_name&#39;</span><span class="p">)</span>
        <span class="c1"># Exceptions should arise</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">exception</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestVerdiComputerCommands.test_computer_rename"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_computer.TestVerdiComputerCommands.test_computer_rename">[docs]</a>    <span class="k">def</span> <span class="nf">test_computer_rename</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test if &#39;verdi computer rename&#39; command works</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">aiida.common.exceptions</span> <span class="k">import</span> <span class="n">NotExistent</span>

        <span class="c1"># See if the command complains about not getting an invalid computer</span>
        <span class="n">options</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;not_existent_computer_name&#39;</span><span class="p">]</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cli_runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">computer_rename</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
        <span class="c1"># Exception should be raised</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">exception</span><span class="p">)</span>

        <span class="c1"># See if the command complains about not getting both names</span>
        <span class="n">options</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;comp_cli_test_computer&#39;</span><span class="p">]</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cli_runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">computer_rename</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
        <span class="c1"># Exception should be raised</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">exception</span><span class="p">)</span>

        <span class="c1"># The new name must be different to the old one</span>
        <span class="n">options</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;comp_cli_test_computer&#39;</span><span class="p">,</span> <span class="s1">&#39;comp_cli_test_computer&#39;</span><span class="p">]</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cli_runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">computer_rename</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
        <span class="c1"># Exception should be raised</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">exception</span><span class="p">)</span>

        <span class="c1"># Change a computer name successully.</span>
        <span class="n">options</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;comp_cli_test_computer&#39;</span><span class="p">,</span> <span class="s1">&#39;renamed_test_computer&#39;</span><span class="p">]</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cli_runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">computer_rename</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
        <span class="c1"># Exception should be not be raised</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">exception</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>

        <span class="c1"># Check that the name really was changed</span>
        <span class="c1"># The old name should not be available</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">NotExistent</span><span class="p">):</span>
            <span class="n">orm</span><span class="o">.</span><span class="n">Computer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;comp_cli_test_computer&#39;</span><span class="p">)</span>
        <span class="c1"># The new name should be avilable</span>
        <span class="n">orm</span><span class="o">.</span><span class="n">Computer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;renamed_test_computer&#39;</span><span class="p">)</span>

        <span class="c1"># Now change the name back</span>
        <span class="n">options</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;renamed_test_computer&#39;</span><span class="p">,</span> <span class="s1">&#39;comp_cli_test_computer&#39;</span><span class="p">]</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cli_runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">computer_rename</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
        <span class="c1"># Exception should be not be raised</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">exception</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>

        <span class="c1"># Check that the name really was changed</span>
        <span class="c1"># The old name should not be available</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">NotExistent</span><span class="p">):</span>
            <span class="n">orm</span><span class="o">.</span><span class="n">Computer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;renamed_test_computer&#39;</span><span class="p">)</span>
        <span class="c1"># The new name should be avilable</span>
        <span class="n">orm</span><span class="o">.</span><span class="n">Computer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;comp_cli_test_computer&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestVerdiComputerCommands.test_computer_delete"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_computer.TestVerdiComputerCommands.test_computer_delete">[docs]</a>    <span class="k">def</span> <span class="nf">test_computer_delete</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test if &#39;verdi computer delete&#39; command works</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">aiida.common.exceptions</span> <span class="k">import</span> <span class="n">NotExistent</span>

        <span class="c1"># Setup a computer to delete during the test</span>
        <span class="n">comp</span> <span class="o">=</span> <span class="n">orm</span><span class="o">.</span><span class="n">Computer</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;computer_for_test_delete&#39;</span><span class="p">,</span> <span class="n">hostname</span><span class="o">=</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span>
                            <span class="n">transport_type</span><span class="o">=</span><span class="s1">&#39;local&#39;</span><span class="p">,</span> <span class="n">scheduler_type</span><span class="o">=</span><span class="s1">&#39;direct&#39;</span><span class="p">,</span> <span class="n">workdir</span><span class="o">=</span><span class="s1">&#39;/tmp/aiida&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">store</span><span class="p">()</span>

        <span class="c1"># See if the command complains about not getting an invalid computer</span>
        <span class="n">options</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;non_existent_computer_name&#39;</span><span class="p">]</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cli_runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">computer_delete</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
        <span class="c1"># Exception should be raised</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">exception</span><span class="p">)</span>

        <span class="c1"># Delete a computer name successully.</span>
        <span class="n">options</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;computer_for_test_delete&#39;</span><span class="p">]</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cli_runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">computer_delete</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
        <span class="c1"># Exception should be not be raised</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertClickResultNoException</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="c1"># Check that the computer really was deleted</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">NotExistent</span><span class="p">):</span>
            <span class="n">orm</span><span class="o">.</span><span class="n">Computer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;computer_for_test_delete&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestVerdiComputerCommands.test_computer_duplicate_interactive"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_computer.TestVerdiComputerCommands.test_computer_duplicate_interactive">[docs]</a>    <span class="k">def</span> <span class="nf">test_computer_duplicate_interactive</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;VISUAL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;sleep 1; vim -cwq&#39;</span>
        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;EDITOR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;sleep 1; vim -cwq&#39;</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;computer_duplicate_interactive&#39;</span>
        <span class="n">user_input</span> <span class="o">=</span> <span class="n">label</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n\n\n\n\n\n\n\n\n</span><span class="s1">N&#39;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cli_runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">computer_duplicate</span><span class="p">,</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">comp</span><span class="o">.</span><span class="n">pk</span><span class="p">)],</span> <span class="nb">input</span><span class="o">=</span><span class="n">user_input</span><span class="p">,</span>
                                        <span class="n">catch_exceptions</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">exception</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>

        <span class="n">new_computer</span> <span class="o">=</span> <span class="n">orm</span><span class="o">.</span><span class="n">Computer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">comp</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="n">new_computer</span><span class="o">.</span><span class="n">description</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">comp</span><span class="o">.</span><span class="n">get_hostname</span><span class="p">(),</span> <span class="n">new_computer</span><span class="o">.</span><span class="n">get_hostname</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">comp</span><span class="o">.</span><span class="n">get_transport_type</span><span class="p">(),</span> <span class="n">new_computer</span><span class="o">.</span><span class="n">get_transport_type</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">comp</span><span class="o">.</span><span class="n">get_scheduler_type</span><span class="p">(),</span> <span class="n">new_computer</span><span class="o">.</span><span class="n">get_scheduler_type</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">comp</span><span class="o">.</span><span class="n">get_shebang</span><span class="p">(),</span> <span class="n">new_computer</span><span class="o">.</span><span class="n">get_shebang</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">comp</span><span class="o">.</span><span class="n">get_workdir</span><span class="p">(),</span> <span class="n">new_computer</span><span class="o">.</span><span class="n">get_workdir</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">comp</span><span class="o">.</span><span class="n">get_mpirun_command</span><span class="p">(),</span> <span class="n">new_computer</span><span class="o">.</span><span class="n">get_mpirun_command</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">comp</span><span class="o">.</span><span class="n">get_default_mpiprocs_per_machine</span><span class="p">(),</span> <span class="n">new_computer</span><span class="o">.</span><span class="n">get_default_mpiprocs_per_machine</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">comp</span><span class="o">.</span><span class="n">get_prepend_text</span><span class="p">(),</span> <span class="n">new_computer</span><span class="o">.</span><span class="n">get_prepend_text</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">comp</span><span class="o">.</span><span class="n">get_append_text</span><span class="p">(),</span> <span class="n">new_computer</span><span class="o">.</span><span class="n">get_append_text</span><span class="p">())</span></div>

<div class="viewcode-block" id="TestVerdiComputerCommands.test_computer_duplicate_non_interactive"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_computer.TestVerdiComputerCommands.test_computer_duplicate_non_interactive">[docs]</a>    <span class="k">def</span> <span class="nf">test_computer_duplicate_non_interactive</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;computer_duplicate_noninteractive&#39;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cli_runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">computer_duplicate</span><span class="p">,</span>
                                        <span class="p">[</span><span class="s1">&#39;--non-interactive&#39;</span><span class="p">,</span> <span class="s1">&#39;--label=&#39;</span> <span class="o">+</span> <span class="n">label</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">comp</span><span class="o">.</span><span class="n">pk</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">exception</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>

        <span class="n">new_computer</span> <span class="o">=</span> <span class="n">orm</span><span class="o">.</span><span class="n">Computer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">comp</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="n">new_computer</span><span class="o">.</span><span class="n">description</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">comp</span><span class="o">.</span><span class="n">get_hostname</span><span class="p">(),</span> <span class="n">new_computer</span><span class="o">.</span><span class="n">get_hostname</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">comp</span><span class="o">.</span><span class="n">get_transport_type</span><span class="p">(),</span> <span class="n">new_computer</span><span class="o">.</span><span class="n">get_transport_type</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">comp</span><span class="o">.</span><span class="n">get_scheduler_type</span><span class="p">(),</span> <span class="n">new_computer</span><span class="o">.</span><span class="n">get_scheduler_type</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">comp</span><span class="o">.</span><span class="n">get_shebang</span><span class="p">(),</span> <span class="n">new_computer</span><span class="o">.</span><span class="n">get_shebang</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">comp</span><span class="o">.</span><span class="n">get_workdir</span><span class="p">(),</span> <span class="n">new_computer</span><span class="o">.</span><span class="n">get_workdir</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">comp</span><span class="o">.</span><span class="n">get_mpirun_command</span><span class="p">(),</span> <span class="n">new_computer</span><span class="o">.</span><span class="n">get_mpirun_command</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">comp</span><span class="o">.</span><span class="n">get_default_mpiprocs_per_machine</span><span class="p">(),</span> <span class="n">new_computer</span><span class="o">.</span><span class="n">get_default_mpiprocs_per_machine</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">comp</span><span class="o">.</span><span class="n">get_prepend_text</span><span class="p">(),</span> <span class="n">new_computer</span><span class="o">.</span><span class="n">get_prepend_text</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">comp</span><span class="o">.</span><span class="n">get_append_text</span><span class="p">(),</span> <span class="n">new_computer</span><span class="o">.</span><span class="n">get_append_text</span><span class="p">())</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, ECOLE POLYTECHNIQUE FEDERALE DE LAUSANNE (Theory and Simulation of Materials (THEOS) and National Centre for Computational Design and Discovery of Novel Materials (NCCR MARVEL)), Switzerland and ROBERT BOSCH LLC, USA. All rights reserved

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>