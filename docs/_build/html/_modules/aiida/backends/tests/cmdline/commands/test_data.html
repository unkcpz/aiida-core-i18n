

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>aiida.backends.tests.cmdline.commands.test_data &mdash; AiiDA 1.0.0b2 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../../../" src="../../../../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../../../../_static/language_data.js"></script>
        <script type="text/javascript" src="../../../../../../_static/contentui.js"></script>
    
    <script type="text/javascript" src="../../../../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../../_static/contentui.css" type="text/css" />
    <link rel="index" title="Index" href="../../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../../../index.html" class="icon icon-home"> AiiDA
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Installation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../install/quick_installation.html">Quick installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../install/prerequisites.html">Prerequisites</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../install/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../install/updating_installation.html">Updating AiiDA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../install/troubleshooting.html">Troubleshooting</a></li>
</ul>
<p class="caption"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../get_started/index.html">First things first</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../get_started/daemon.html">Setup the daemon</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../get_started/computers.html">Setup a computer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../get_started/codes.html">Setup a code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../get_started/plugins.html">Plugins</a></li>
</ul>
<p class="caption"><span class="caption-text">Concepts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../concepts/provenance.html">Provenance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../concepts/processes.html">Processes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../concepts/calculations.html">Calculations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../concepts/workflows.html">Workflows</a></li>
</ul>
<p class="caption"><span class="caption-text">Working with</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../working/processes.html">Processes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../working/functions.html">Calculation and work functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../working/calculations.html">Calculations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../working/workflows.html">Workflows</a></li>
</ul>
<p class="caption"><span class="caption-text">Working with AiiDA</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../working_with_aiida/index.html">Command line interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../working_with_aiida/index.html#scripting">Scripting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../working_with_aiida/index.html#data-types">Data types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../working_with_aiida/index.html#groups">Groups</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../working_with_aiida/index.html#schedulers">Schedulers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../working_with_aiida/index.html#querying-data">Querying data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../working_with_aiida/index.html#caching">Caching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../working_with_aiida/index.html#result-manager">Result manager</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../working_with_aiida/index.html#backups">Backups</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../working_with_aiida/index.html#troubleshooting">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../working_with_aiida/index.html#rest-api">REST API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../working_with_aiida/index.html#cookbook">Cookbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../import_export/index.html">Import and Export</a></li>
</ul>
<p class="caption"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../developer_guide/index.html">AiiDA design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../developer_guide/index.html#aiida-core">AiiDA core</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../developer_guide/index.html#aiida-plugins">AiiDA plugins</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../tutorial/index.html">StructureData</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../tutorial/index.html#pseudopotentials">Pseudopotentials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../tutorial/index.html#plugin-development">Plugin development</a></li>
</ul>
<p class="caption"><span class="caption-text">API reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="`aiida package &lt;https://aiida-core.readthedocs.io/en/latest/apidoc/aiida.html&gt;`_">`aiida package &lt;https://aiida-core.readthedocs.io/en/latest/apidoc/aiida.html&gt;`_</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../../index.html">AiiDA</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../../../../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../../../../../aiida.html">aiida</a> &raquo;</li>
        
          <li><a href="../../../tests.html">aiida.backends.tests</a> &raquo;</li>
        
      <li>aiida.backends.tests.cmdline.commands.test_data</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for aiida.backends.tests.cmdline.commands.test_data</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1">###########################################################################</span>
<span class="c1"># Copyright (c), The AiiDA team. All rights reserved.                     #</span>
<span class="c1"># This file is part of the AiiDA code.                                    #</span>
<span class="c1">#                                                                         #</span>
<span class="c1"># The code is hosted on GitHub at https://github.com/aiidateam/aiida_core #</span>
<span class="c1"># For further information on the license, see the LICENSE.txt file        #</span>
<span class="c1"># For further information please visit http://www.aiida.net               #</span>
<span class="c1">###########################################################################</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">print_function</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">absolute_import</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">division</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">io</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">subprocess</span> <span class="k">as</span> <span class="nn">sp</span>

<span class="kn">from</span> <span class="nn">six.moves</span> <span class="k">import</span> <span class="n">cStringIO</span> <span class="k">as</span> <span class="n">StringIO</span>

<span class="kn">from</span> <span class="nn">contextlib</span> <span class="k">import</span> <span class="n">contextmanager</span>
<span class="kn">from</span> <span class="nn">click.testing</span> <span class="k">import</span> <span class="n">CliRunner</span>

<span class="kn">from</span> <span class="nn">aiida</span> <span class="k">import</span> <span class="n">orm</span>
<span class="kn">from</span> <span class="nn">aiida.backends.testbase</span> <span class="k">import</span> <span class="n">AiidaTestCase</span>
<span class="kn">from</span> <span class="nn">aiida.cmdline.commands.cmd_data</span> <span class="k">import</span> <span class="n">cmd_array</span>
<span class="kn">from</span> <span class="nn">aiida.cmdline.commands.cmd_data</span> <span class="k">import</span> <span class="n">cmd_bands</span>
<span class="kn">from</span> <span class="nn">aiida.cmdline.commands.cmd_data</span> <span class="k">import</span> <span class="n">cmd_cif</span>
<span class="kn">from</span> <span class="nn">aiida.cmdline.commands.cmd_data</span> <span class="k">import</span> <span class="n">cmd_dict</span>
<span class="kn">from</span> <span class="nn">aiida.cmdline.commands.cmd_data</span> <span class="k">import</span> <span class="n">cmd_remote</span>
<span class="kn">from</span> <span class="nn">aiida.cmdline.commands.cmd_data</span> <span class="k">import</span> <span class="n">cmd_structure</span>
<span class="kn">from</span> <span class="nn">aiida.cmdline.commands.cmd_data</span> <span class="k">import</span> <span class="n">cmd_trajectory</span>
<span class="kn">from</span> <span class="nn">aiida.cmdline.commands.cmd_data</span> <span class="k">import</span> <span class="n">cmd_upf</span>
<span class="kn">from</span> <span class="nn">aiida.engine</span> <span class="k">import</span> <span class="n">calcfunction</span>
<span class="kn">from</span> <span class="nn">aiida.orm.nodes.data.cif</span> <span class="k">import</span> <span class="n">has_pycifrw</span>
<span class="kn">from</span> <span class="nn">aiida.orm</span> <span class="k">import</span> <span class="n">Group</span><span class="p">,</span> <span class="n">ArrayData</span><span class="p">,</span> <span class="n">BandsData</span><span class="p">,</span> <span class="n">KpointsData</span><span class="p">,</span> <span class="n">CifData</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">RemoteData</span><span class="p">,</span> <span class="n">StructureData</span><span class="p">,</span> <span class="n">TrajectoryData</span>


<div class="viewcode-block" id="captured_output"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_data.captured_output">[docs]</a><span class="nd">@contextmanager</span>
<span class="k">def</span> <span class="nf">captured_output</span><span class="p">():</span>
    <span class="n">new_out</span><span class="p">,</span> <span class="n">new_err</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">(),</span> <span class="n">StringIO</span><span class="p">()</span>
    <span class="n">old_out</span><span class="p">,</span> <span class="n">old_err</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span> <span class="o">=</span> <span class="n">new_out</span><span class="p">,</span> <span class="n">new_err</span>
        <span class="k">yield</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span> <span class="o">=</span> <span class="n">old_out</span><span class="p">,</span> <span class="n">old_err</span></div>


<div class="viewcode-block" id="TestVerdiDataExportable"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_data.TestVerdiDataExportable">[docs]</a><span class="k">class</span> <span class="nc">TestVerdiDataExportable</span><span class="p">:</span>

<div class="viewcode-block" id="TestVerdiDataExportable.__init__"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_data.TestVerdiDataExportable.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span></div>

    <span class="n">NODE_ID_STR</span> <span class="o">=</span> <span class="s2">&quot;node_id&quot;</span>
    <span class="n">EMPTY_GROUP_ID_STR</span> <span class="o">=</span> <span class="s1">&#39;empty_group_id&#39;</span>
    <span class="n">EMPTY_GROUP_NAME_STR</span> <span class="o">=</span> <span class="s1">&#39;empty_group&#39;</span>
    <span class="n">NON_EMPTY_GROUP_ID_STR</span> <span class="o">=</span> <span class="s1">&#39;non_empty_group_id&#39;</span>
    <span class="n">NON_EMPTY_GROUP_NAME_STR</span> <span class="o">=</span> <span class="s1">&#39;non_empty_group&#39;</span>

<div class="viewcode-block" id="TestVerdiDataExportable.data_export_test"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_data.TestVerdiDataExportable.data_export_test">[docs]</a>    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skipUnless</span><span class="p">(</span><span class="n">has_pycifrw</span><span class="p">(),</span> <span class="s2">&quot;Unable to import PyCifRW&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">data_export_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">datatype</span><span class="p">,</span> <span class="n">ids</span><span class="p">,</span> <span class="n">supported_formats</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method tests that the data listing works as expected with all</span>
<span class="sd">        possible flags and arguments for different datatypes.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="kn">from</span> <span class="nn">aiida.cmdline.commands.cmd_data.cmd_cif</span> <span class="k">import</span> <span class="n">cif_export</span>
        <span class="kn">from</span> <span class="nn">aiida.cmdline.commands.cmd_data.cmd_structure</span> <span class="k">import</span> <span class="n">structure_export</span>
        <span class="kn">from</span> <span class="nn">aiida.cmdline.commands.cmd_data.cmd_trajectory</span> <span class="k">import</span> <span class="n">trajectory_export</span>

        <span class="n">datatype_mapping</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">CifData</span><span class="p">:</span> <span class="n">cif_export</span><span class="p">,</span>
            <span class="n">StructureData</span><span class="p">:</span> <span class="n">structure_export</span><span class="p">,</span>
            <span class="n">TrajectoryData</span><span class="p">:</span> <span class="n">trajectory_export</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">datatype</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">datatype</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">datatype_mapping</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;The listing of the objects </span><span class="si">{}</span><span class="s2"> is not supported&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">datatype</span><span class="p">))</span>

        <span class="n">export_cmd</span> <span class="o">=</span> <span class="n">datatype_mapping</span><span class="p">[</span><span class="n">datatype</span><span class="p">]</span>

        <span class="c1"># Check that the simple command works as expected</span>
        <span class="n">options</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">ids</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">NODE_ID_STR</span><span class="p">])]</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cli_runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">export_cmd</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">catch_exceptions</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">exit_code</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;The command did not finish correctly&quot;</span><span class="p">)</span>

        <span class="n">dump_flags</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;-F&#39;</span><span class="p">,</span> <span class="s1">&#39;--format&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">flag</span> <span class="ow">in</span> <span class="n">dump_flags</span><span class="p">:</span>
            <span class="k">for</span> <span class="nb">format</span> <span class="ow">in</span> <span class="n">supported_formats</span><span class="p">:</span>
                <span class="c1"># with captured_output() as (out, err):</span>
                <span class="n">options</span> <span class="o">=</span> <span class="p">[</span><span class="n">flag</span><span class="p">,</span> <span class="nb">format</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">ids</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">NODE_ID_STR</span><span class="p">])]</span>
                <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cli_runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">export_cmd</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span>
                                             <span class="n">catch_exceptions</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">exit_code</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                                  <span class="s2">&quot;The command did not finish &quot;</span>
                                  <span class="s2">&quot;correctly. Output:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">output</span><span class="p">))</span>

        <span class="c1"># Check that the output to file flags work correctly:</span>
        <span class="c1"># -o, --output</span>
        <span class="n">output_flags</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;-o&#39;</span><span class="p">,</span> <span class="s1">&#39;--output&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">flag</span> <span class="ow">in</span> <span class="n">output_flags</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">tmpd</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">()</span>
                <span class="n">filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmpd</span><span class="p">,</span> <span class="s1">&#39;output_file.txt&#39;</span><span class="p">)</span>
                <span class="n">options</span> <span class="o">=</span> <span class="p">[</span><span class="n">flag</span><span class="p">,</span> <span class="n">filepath</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">ids</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">NODE_ID_STR</span><span class="p">])]</span>
                <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cli_runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">export_cmd</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span>
                                             <span class="n">catch_exceptions</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">exit_code</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                                  <span class="s2">&quot;The command should finish correctly.&quot;</span>
                                  <span class="s2">&quot;Output:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">output</span><span class="p">))</span>

                <span class="c1"># Try to export it again. It should fail because the</span>
                <span class="c1"># file exists</span>
                <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cli_runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">export_cmd</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">catch_exceptions</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertNotEquals</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">exit_code</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;The command should fail because the file already exists&quot;</span><span class="p">)</span>

                <span class="c1"># Now we force the export of the file and it should overwrite</span>
                <span class="c1"># existing files</span>
                <span class="n">options</span> <span class="o">=</span> <span class="p">[</span><span class="n">flag</span><span class="p">,</span> <span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;-f&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">ids</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">NODE_ID_STR</span><span class="p">])]</span>
                <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cli_runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">export_cmd</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span>
                                             <span class="n">catch_exceptions</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">exit_code</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                                  <span class="s2">&quot;The command should finish correctly.&quot;</span>
                                  <span class="s2">&quot;Output: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">output</span><span class="p">))</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">tmpd</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="TestVerdiDataListable"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_data.TestVerdiDataListable">[docs]</a><span class="k">class</span> <span class="nc">TestVerdiDataListable</span><span class="p">:</span>

<div class="viewcode-block" id="TestVerdiDataListable.__init__"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_data.TestVerdiDataListable.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span></div>

    <span class="n">NODE_ID_STR</span> <span class="o">=</span> <span class="s2">&quot;node_id&quot;</span>
    <span class="n">EMPTY_GROUP_ID_STR</span> <span class="o">=</span> <span class="s1">&#39;empty_group_id&#39;</span>
    <span class="n">EMPTY_GROUP_NAME_STR</span> <span class="o">=</span> <span class="s1">&#39;empty_group&#39;</span>
    <span class="n">NON_EMPTY_GROUP_ID_STR</span> <span class="o">=</span> <span class="s1">&#39;non_empty_group_id&#39;</span>
    <span class="n">NON_EMPTY_GROUP_NAME_STR</span> <span class="o">=</span> <span class="s1">&#39;non_empty_group&#39;</span>

<div class="viewcode-block" id="TestVerdiDataListable.data_listing_test"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_data.TestVerdiDataListable.data_listing_test">[docs]</a>    <span class="k">def</span> <span class="nf">data_listing_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">datatype</span><span class="p">,</span> <span class="n">search_string</span><span class="p">,</span> <span class="n">ids</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method tests that the data listing works as expected with all</span>
<span class="sd">        possible flags and arguments for different datatypes.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="kn">from</span> <span class="nn">aiida.cmdline.commands.cmd_data.cmd_cif</span> <span class="k">import</span> <span class="n">cif_list</span>
        <span class="kn">from</span> <span class="nn">aiida.cmdline.commands.cmd_data.cmd_structure</span> <span class="k">import</span> <span class="n">structure_list</span>
        <span class="kn">from</span> <span class="nn">aiida.cmdline.commands.cmd_data.cmd_trajectory</span> <span class="k">import</span> <span class="n">trajectory_list</span>
        <span class="kn">from</span> <span class="nn">aiida.cmdline.commands.cmd_data.cmd_bands</span> <span class="k">import</span> <span class="n">bands_list</span>

        <span class="kn">from</span> <span class="nn">aiida.cmdline.commands.cmd_data.cmd_structure</span> <span class="k">import</span> <span class="n">LIST_PROJECT_HEADERS</span> <span class="k">as</span> <span class="n">p_str</span>
        <span class="kn">from</span> <span class="nn">aiida.cmdline.commands.cmd_data.cmd_cif</span> <span class="k">import</span> <span class="n">LIST_PROJECT_HEADERS</span> <span class="k">as</span> <span class="n">p_cif</span>
        <span class="kn">from</span> <span class="nn">aiida.cmdline.commands.cmd_data.cmd_trajectory</span> <span class="k">import</span> <span class="n">LIST_PROJECT_HEADERS</span> <span class="k">as</span> <span class="n">p_tr</span>
        <span class="kn">from</span> <span class="nn">aiida.cmdline.commands.cmd_data.cmd_bands</span> <span class="k">import</span> <span class="n">LIST_PROJECT_HEADERS</span> <span class="k">as</span> <span class="n">p_bands</span>

        <span class="n">headers_mapping</span> <span class="o">=</span> <span class="p">{</span><span class="n">CifData</span><span class="p">:</span> <span class="n">p_cif</span><span class="p">,</span> <span class="n">StructureData</span><span class="p">:</span> <span class="n">p_str</span><span class="p">,</span> <span class="n">TrajectoryData</span><span class="p">:</span> <span class="n">p_tr</span><span class="p">,</span> <span class="n">BandsData</span><span class="p">:</span> <span class="n">p_bands</span><span class="p">}</span>

        <span class="n">datatype_mapping</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">CifData</span><span class="p">:</span> <span class="n">cif_list</span><span class="p">,</span>
            <span class="n">StructureData</span><span class="p">:</span> <span class="n">structure_list</span><span class="p">,</span>
            <span class="n">TrajectoryData</span><span class="p">:</span> <span class="n">trajectory_list</span><span class="p">,</span>
            <span class="n">BandsData</span><span class="p">:</span> <span class="n">bands_list</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">datatype</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">datatype</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">datatype_mapping</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;The listing of the objects </span><span class="si">{}</span><span class="s2"> is not supported&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">datatype</span><span class="p">))</span>

        <span class="n">listing_cmd</span> <span class="o">=</span> <span class="n">datatype_mapping</span><span class="p">[</span><span class="n">datatype</span><span class="p">]</span>
        <span class="n">project_headers</span> <span class="o">=</span> <span class="n">headers_mapping</span><span class="p">[</span><span class="n">datatype</span><span class="p">]</span>

        <span class="c1"># the output we are comparing to is un-decoded bytes, convert search strings:</span>
        <span class="n">search_string_bytes</span> <span class="o">=</span> <span class="n">search_string</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>

        <span class="c1"># Check that the normal listing works as expected</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cli_runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">listing_cmd</span><span class="p">,</span> <span class="p">[],</span> <span class="n">catch_exceptions</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">search_string_bytes</span><span class="p">,</span> <span class="n">res</span><span class="o">.</span><span class="n">stdout_bytes</span><span class="p">,</span> <span class="s1">&#39;The string </span><span class="si">{}</span><span class="s1"> was not found in the listing&#39;</span>
                      <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">search_string</span><span class="p">))</span>

        <span class="c1"># Check that the past days filter works as expected</span>
        <span class="n">past_days_flags</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;-p&#39;</span><span class="p">,</span> <span class="s1">&#39;--past-days&#39;</span><span class="p">]</span>
        <span class="c1"># past_days_flags = [&#39;-p&#39;]</span>
        <span class="k">for</span> <span class="n">flag</span> <span class="ow">in</span> <span class="n">past_days_flags</span><span class="p">:</span>
            <span class="n">options</span> <span class="o">=</span> <span class="p">[</span><span class="n">flag</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">]</span>
            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cli_runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">listing_cmd</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">catch_exceptions</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">search_string_bytes</span><span class="p">,</span> <span class="n">res</span><span class="o">.</span><span class="n">stdout_bytes</span><span class="p">,</span> <span class="s1">&#39;The string </span><span class="si">{}</span><span class="s1"> was not found in the listing&#39;</span>
                          <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">search_string</span><span class="p">))</span>

            <span class="n">options</span> <span class="o">=</span> <span class="p">[</span><span class="n">flag</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">]</span>
            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cli_runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">listing_cmd</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">catch_exceptions</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="n">search_string_bytes</span><span class="p">,</span> <span class="n">res</span><span class="o">.</span><span class="n">stdout_bytes</span><span class="p">,</span> <span class="s1">&#39;A not expected string </span><span class="si">{}</span><span class="s1"> was found in the listing&#39;</span>
                             <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">search_string</span><span class="p">))</span>

        <span class="c1"># Check that the group filter works as expected</span>
        <span class="n">group_flags</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;-G&#39;</span><span class="p">,</span> <span class="s1">&#39;--groups&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">flag</span> <span class="ow">in</span> <span class="n">group_flags</span><span class="p">:</span>
            <span class="c1"># Non empty group</span>
            <span class="k">for</span> <span class="n">non_empty</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">NON_EMPTY_GROUP_NAME_STR</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">ids</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">NON_EMPTY_GROUP_ID_STR</span><span class="p">])]:</span>
                <span class="n">options</span> <span class="o">=</span> <span class="p">[</span><span class="n">flag</span><span class="p">,</span> <span class="n">non_empty</span><span class="p">]</span>
                <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cli_runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">listing_cmd</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">catch_exceptions</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">search_string_bytes</span><span class="p">,</span> <span class="n">res</span><span class="o">.</span><span class="n">stdout_bytes</span><span class="p">,</span> <span class="s1">&#39;The string </span><span class="si">{}</span><span class="s1"> was not found in the listing&#39;</span><span class="p">)</span>

            <span class="c1"># Empty group</span>
            <span class="k">for</span> <span class="n">empty</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">EMPTY_GROUP_NAME_STR</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">ids</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">EMPTY_GROUP_ID_STR</span><span class="p">])]:</span>
                <span class="n">options</span> <span class="o">=</span> <span class="p">[</span><span class="n">flag</span><span class="p">,</span> <span class="n">empty</span><span class="p">]</span>
                <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cli_runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">listing_cmd</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">catch_exceptions</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="n">search_string_bytes</span><span class="p">,</span> <span class="n">res</span><span class="o">.</span><span class="n">stdout_bytes</span><span class="p">,</span>
                                 <span class="s1">&#39;A not expected string </span><span class="si">{}</span><span class="s1"> was found in the listing&#39;</span><span class="p">)</span>

            <span class="c1"># Group combination</span>
            <span class="k">for</span> <span class="n">non_empty</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">NON_EMPTY_GROUP_NAME_STR</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">ids</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">NON_EMPTY_GROUP_ID_STR</span><span class="p">])]:</span>
                <span class="k">for</span> <span class="n">empty</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">EMPTY_GROUP_NAME_STR</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">ids</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">EMPTY_GROUP_ID_STR</span><span class="p">])]:</span>
                    <span class="n">options</span> <span class="o">=</span> <span class="p">[</span><span class="n">flag</span><span class="p">,</span> <span class="n">non_empty</span><span class="p">,</span> <span class="n">empty</span><span class="p">]</span>
                    <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cli_runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">listing_cmd</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">catch_exceptions</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">search_string_bytes</span><span class="p">,</span> <span class="n">res</span><span class="o">.</span><span class="n">stdout_bytes</span><span class="p">,</span> <span class="s1">&#39;The string </span><span class="si">{}</span><span class="s1"> was not found in the listing&#39;</span><span class="p">)</span>

        <span class="c1"># Check raw flag</span>
        <span class="n">raw_flags</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;-r&#39;</span><span class="p">,</span> <span class="s1">&#39;--raw&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">flag</span> <span class="ow">in</span> <span class="n">raw_flags</span><span class="p">:</span>
            <span class="n">options</span> <span class="o">=</span> <span class="p">[</span><span class="n">flag</span><span class="p">]</span>
            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cli_runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">listing_cmd</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">catch_exceptions</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">header</span> <span class="ow">in</span> <span class="n">project_headers</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="n">header</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">),</span> <span class="n">res</span><span class="o">.</span><span class="n">stdout_bytes</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="TestVerdiData"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_data.TestVerdiData">[docs]</a><span class="k">class</span> <span class="nc">TestVerdiData</span><span class="p">(</span><span class="n">AiidaTestCase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Testing reachability of the verdi data subcommands</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="TestVerdiData.setUpClass"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_data.TestVerdiData.setUpClass">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">setUpClass</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TestVerdiData</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">setUpClass</span><span class="p">()</span></div>

<div class="viewcode-block" id="TestVerdiData.setUp"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_data.TestVerdiData.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="TestVerdiData.test_reachable"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_data.TestVerdiData.test_reachable">[docs]</a>    <span class="k">def</span> <span class="nf">test_reachable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Testing reachability of the following commands:</span>
<span class="sd">        verdi data array</span>
<span class="sd">        verdi data bands</span>
<span class="sd">        verdi data cif</span>
<span class="sd">        verdi data dict</span>
<span class="sd">        verdi data remote</span>
<span class="sd">        verdi data structure</span>
<span class="sd">        verdi data trajectory</span>
<span class="sd">        verdi data upf</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">subcommands</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;array&#39;</span><span class="p">,</span> <span class="s1">&#39;bands&#39;</span><span class="p">,</span> <span class="s1">&#39;cif&#39;</span><span class="p">,</span> <span class="s1">&#39;dict&#39;</span><span class="p">,</span> <span class="s1">&#39;remote&#39;</span><span class="p">,</span> <span class="s1">&#39;structure&#39;</span><span class="p">,</span> <span class="s1">&#39;trajectory&#39;</span><span class="p">,</span> <span class="s1">&#39;upf&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">sub_cmd</span> <span class="ow">in</span> <span class="n">subcommands</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s1">&#39;verdi&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="n">sub_cmd</span><span class="p">,</span> <span class="s1">&#39;--help&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Usage:&#39;</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="s2">&quot;Sub-command verdi data </span><span class="si">{}</span><span class="s2"> --help failed.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sub_cmd</span><span class="p">))</span></div></div>


<div class="viewcode-block" id="TestVerdiDataArray"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_data.TestVerdiDataArray">[docs]</a><span class="k">class</span> <span class="nc">TestVerdiDataArray</span><span class="p">(</span><span class="n">AiidaTestCase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Testing verdi data array</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="TestVerdiDataArray.setUpClass"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_data.TestVerdiDataArray.setUpClass">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">setUpClass</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TestVerdiDataArray</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">setUpClass</span><span class="p">()</span></div>

<div class="viewcode-block" id="TestVerdiDataArray.setUp"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_data.TestVerdiDataArray.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="n">ArrayData</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">set_array</span><span class="p">(</span><span class="s1">&#39;test_array&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">store</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cli_runner</span> <span class="o">=</span> <span class="n">CliRunner</span><span class="p">()</span></div>

<div class="viewcode-block" id="TestVerdiDataArray.test_arrayshowhelp"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_data.TestVerdiDataArray.test_arrayshowhelp">[docs]</a>    <span class="k">def</span> <span class="nf">test_arrayshowhelp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s1">&#39;verdi&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;array&#39;</span><span class="p">,</span> <span class="s1">&#39;show&#39;</span><span class="p">,</span> <span class="s1">&#39;--help&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Usage:&#39;</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="s2">&quot;Sub-command verdi data array show --help failed.&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestVerdiDataArray.test_arrayshow"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_data.TestVerdiDataArray.test_arrayshow">[docs]</a>    <span class="k">def</span> <span class="nf">test_arrayshow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># with captured_output() as (out, err):</span>
        <span class="n">options</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="p">)]</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cli_runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">cmd_array</span><span class="o">.</span><span class="n">array_show</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">catch_exceptions</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">exit_code</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;The command did not finish correctly&quot;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="TestVerdiDataBands"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_data.TestVerdiDataBands">[docs]</a><span class="k">class</span> <span class="nc">TestVerdiDataBands</span><span class="p">(</span><span class="n">AiidaTestCase</span><span class="p">,</span> <span class="n">TestVerdiDataListable</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Testing verdi data bands </span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="TestVerdiDataBands.create_structure_bands"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_data.TestVerdiDataBands.create_structure_bands">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">create_structure_bands</span><span class="p">():</span>
        <span class="n">alat</span> <span class="o">=</span> <span class="mf">4.</span>  <span class="c1"># angstrom</span>
        <span class="n">cell</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span>
                <span class="n">alat</span><span class="p">,</span>
                <span class="mf">0.</span><span class="p">,</span>
                <span class="mf">0.</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="p">[</span>
                <span class="mf">0.</span><span class="p">,</span>
                <span class="n">alat</span><span class="p">,</span>
                <span class="mf">0.</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="p">[</span>
                <span class="mf">0.</span><span class="p">,</span>
                <span class="mf">0.</span><span class="p">,</span>
                <span class="n">alat</span><span class="p">,</span>
            <span class="p">],</span>
        <span class="p">]</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">StructureData</span><span class="p">(</span><span class="n">cell</span><span class="o">=</span><span class="n">cell</span><span class="p">)</span>
        <span class="n">s</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Fe&#39;</span><span class="p">)</span>
        <span class="n">s</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="n">alat</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">,</span> <span class="n">alat</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">,</span> <span class="n">alat</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;O&#39;</span><span class="p">)</span>
        <span class="n">s</span><span class="o">.</span><span class="n">store</span><span class="p">()</span>

        <span class="nd">@calcfunction</span>
        <span class="k">def</span> <span class="nf">connect_structure_bands</span><span class="p">(</span><span class="n">structure</span><span class="p">):</span>
            <span class="n">alat</span> <span class="o">=</span> <span class="mf">4.</span>
            <span class="n">cell</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
                <span class="p">[</span><span class="n">alat</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="n">alat</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">alat</span><span class="p">],</span>
            <span class="p">])</span>

            <span class="n">k</span> <span class="o">=</span> <span class="n">KpointsData</span><span class="p">()</span>
            <span class="n">k</span><span class="o">.</span><span class="n">set_cell</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span>
            <span class="n">k</span><span class="o">.</span><span class="n">set_kpoints_path</span><span class="p">([(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)])</span>

            <span class="n">b</span> <span class="o">=</span> <span class="n">BandsData</span><span class="p">()</span>
            <span class="n">b</span><span class="o">.</span><span class="n">set_kpointsdata</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="n">b</span><span class="o">.</span><span class="n">set_bands</span><span class="p">([[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">]])</span>

            <span class="k">return</span> <span class="n">b</span>

        <span class="n">b</span> <span class="o">=</span> <span class="n">connect_structure_bands</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

        <span class="c1"># Create 2 groups and add the data to one of them</span>
        <span class="n">g_ne</span> <span class="o">=</span> <span class="n">Group</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;non_empty_group&#39;</span><span class="p">)</span>
        <span class="n">g_ne</span><span class="o">.</span><span class="n">store</span><span class="p">()</span>
        <span class="n">g_ne</span><span class="o">.</span><span class="n">add_nodes</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

        <span class="n">g_e</span> <span class="o">=</span> <span class="n">Group</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;empty_group&#39;</span><span class="p">)</span>
        <span class="n">g_e</span><span class="o">.</span><span class="n">store</span><span class="p">()</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="n">TestVerdiDataListable</span><span class="o">.</span><span class="n">NODE_ID_STR</span><span class="p">:</span> <span class="n">b</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="n">TestVerdiDataListable</span><span class="o">.</span><span class="n">NON_EMPTY_GROUP_ID_STR</span><span class="p">:</span> <span class="n">g_ne</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="n">TestVerdiDataListable</span><span class="o">.</span><span class="n">EMPTY_GROUP_ID_STR</span><span class="p">:</span> <span class="n">g_e</span><span class="o">.</span><span class="n">id</span>
        <span class="p">}</span></div>

<div class="viewcode-block" id="TestVerdiDataBands.setUpClass"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_data.TestVerdiDataBands.setUpClass">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">setUpClass</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TestVerdiDataBands</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">setUpClass</span><span class="p">()</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">ids</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">create_structure_bands</span><span class="p">()</span></div>

<div class="viewcode-block" id="TestVerdiDataBands.setUp"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_data.TestVerdiDataBands.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cli_runner</span> <span class="o">=</span> <span class="n">CliRunner</span><span class="p">()</span></div>

<div class="viewcode-block" id="TestVerdiDataBands.test_bandsshowhelp"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_data.TestVerdiDataBands.test_bandsshowhelp">[docs]</a>    <span class="k">def</span> <span class="nf">test_bandsshowhelp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s1">&#39;verdi&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;bands&#39;</span><span class="p">,</span> <span class="s1">&#39;show&#39;</span><span class="p">,</span> <span class="s1">&#39;--help&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Usage:&#39;</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="s2">&quot;Sub-command verdi data bands show --help failed.&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestVerdiDataBands.test_bandlistshelp"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_data.TestVerdiDataBands.test_bandlistshelp">[docs]</a>    <span class="k">def</span> <span class="nf">test_bandlistshelp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s1">&#39;verdi&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;bands&#39;</span><span class="p">,</span> <span class="s1">&#39;list&#39;</span><span class="p">,</span> <span class="s1">&#39;--help&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Usage:&#39;</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="s2">&quot;Sub-command verdi data bands show --help failed.&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestVerdiDataBands.test_bandslist"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_data.TestVerdiDataBands.test_bandslist">[docs]</a>    <span class="k">def</span> <span class="nf">test_bandslist</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">aiida.orm</span> <span class="k">import</span> <span class="n">BandsData</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data_listing_test</span><span class="p">(</span><span class="n">BandsData</span><span class="p">,</span> <span class="s1">&#39;FeO&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ids</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestVerdiDataBands.test_bandexporthelp"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_data.TestVerdiDataBands.test_bandexporthelp">[docs]</a>    <span class="k">def</span> <span class="nf">test_bandexporthelp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s1">&#39;verdi&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;bands&#39;</span><span class="p">,</span> <span class="s1">&#39;export&#39;</span><span class="p">,</span> <span class="s1">&#39;--help&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Usage:&#39;</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="s2">&quot;Sub-command verdi data bands export --help failed.&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestVerdiDataBands.test_bandsexport"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_data.TestVerdiDataBands.test_bandsexport">[docs]</a>    <span class="k">def</span> <span class="nf">test_bandsexport</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">options</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ids</span><span class="p">[</span><span class="n">TestVerdiDataListable</span><span class="o">.</span><span class="n">NODE_ID_STR</span><span class="p">])]</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cli_runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">cmd_bands</span><span class="o">.</span><span class="n">bands_export</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">catch_exceptions</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">exit_code</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;The command did not finish correctly&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;[1.0, 3.0]&quot;</span><span class="p">,</span> <span class="n">res</span><span class="o">.</span><span class="n">stdout_bytes</span><span class="p">,</span> <span class="s1">&#39;The string [1.0, 3.0] was not found in the bands&#39;</span> <span class="s1">&#39;export&#39;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="TestVerdiDataDict"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_data.TestVerdiDataDict">[docs]</a><span class="k">class</span> <span class="nc">TestVerdiDataDict</span><span class="p">(</span><span class="n">AiidaTestCase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Testing verdi data dict</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="TestVerdiDataDict.setUpClass"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_data.TestVerdiDataDict.setUpClass">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">setUpClass</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TestVerdiDataDict</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">setUpClass</span><span class="p">()</span></div>

<div class="viewcode-block" id="TestVerdiDataDict.setUp"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_data.TestVerdiDataDict.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">set_dict</span><span class="p">({</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">store</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cli_runner</span> <span class="o">=</span> <span class="n">CliRunner</span><span class="p">()</span></div>

<div class="viewcode-block" id="TestVerdiDataDict.test_dictshowhelp"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_data.TestVerdiDataDict.test_dictshowhelp">[docs]</a>    <span class="k">def</span> <span class="nf">test_dictshowhelp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s1">&#39;verdi&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;dict&#39;</span><span class="p">,</span> <span class="s1">&#39;show&#39;</span><span class="p">,</span> <span class="s1">&#39;--help&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Usage:&#39;</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="s2">&quot;Sub-command verdi data dict show --help failed.&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestVerdiDataDict.test_dictshow"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_data.TestVerdiDataDict.test_dictshow">[docs]</a>    <span class="k">def</span> <span class="nf">test_dictshow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">supported_formats</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;json_date&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="nb">format</span> <span class="ow">in</span> <span class="n">supported_formats</span><span class="p">:</span>
            <span class="n">options</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">id</span><span class="p">)]</span>
            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cli_runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">cmd_dict</span><span class="o">.</span><span class="n">dictionary_show</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">catch_exceptions</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">exit_code</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;The command verdi data dict show did not finish correctly&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;&quot;a&quot;: 1&#39;</span><span class="p">,</span> <span class="n">res</span><span class="o">.</span><span class="n">stdout_bytes</span><span class="p">,</span> <span class="s1">&#39;The string &quot;a&quot;: 1 was not found in the output&#39;</span>
                                                   <span class="s1">&#39; of verdi data dict show&#39;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="TestVerdiDataRemote"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_data.TestVerdiDataRemote">[docs]</a><span class="k">class</span> <span class="nc">TestVerdiDataRemote</span><span class="p">(</span><span class="n">AiidaTestCase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Testing verdi data remote </span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="TestVerdiDataRemote.setUpClass"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_data.TestVerdiDataRemote.setUpClass">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">setUpClass</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TestVerdiDataRemote</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">setUpClass</span><span class="p">()</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">orm</span><span class="o">.</span><span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_default</span><span class="p">()</span>
        <span class="n">orm</span><span class="o">.</span><span class="n">AuthInfo</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">computer</span><span class="p">,</span> <span class="n">user</span><span class="p">)</span><span class="o">.</span><span class="n">store</span><span class="p">()</span></div>

<div class="viewcode-block" id="TestVerdiDataRemote.setUp"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_data.TestVerdiDataRemote.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">comp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">computer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r</span> <span class="o">=</span> <span class="n">RemoteData</span><span class="p">()</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">set_remote_path</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">io</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="s1">&#39;/file.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fhandle</span><span class="p">:</span>
            <span class="n">fhandle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;test string&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">computer</span> <span class="o">=</span> <span class="n">comp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">store</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cli_runner</span> <span class="o">=</span> <span class="n">CliRunner</span><span class="p">()</span></div>

<div class="viewcode-block" id="TestVerdiDataRemote.test_remoteshowhelp"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_data.TestVerdiDataRemote.test_remoteshowhelp">[docs]</a>    <span class="k">def</span> <span class="nf">test_remoteshowhelp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s1">&#39;verdi&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;remote&#39;</span><span class="p">,</span> <span class="s1">&#39;show&#39;</span><span class="p">,</span> <span class="s1">&#39;--help&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Usage:&#39;</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="s2">&quot;Sub-command verdi data remote show --help failed.&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestVerdiDataRemote.test_remoteshow"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_data.TestVerdiDataRemote.test_remoteshow">[docs]</a>    <span class="k">def</span> <span class="nf">test_remoteshow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">options</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">id</span><span class="p">)]</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cli_runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">cmd_remote</span><span class="o">.</span><span class="n">remote_show</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">catch_exceptions</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">exit_code</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;The command verdi data remote show did not finish correctly&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Remote computer name:&#39;</span><span class="p">,</span> <span class="n">res</span><span class="o">.</span><span class="n">stdout_bytes</span><span class="p">,</span>
                      <span class="s1">&#39;The string &quot;Remote computer name:&quot; was not found in the&#39;</span>
                      <span class="s1">&#39; output of verdi data remote show&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Remote folder full path:&#39;</span><span class="p">,</span> <span class="n">res</span><span class="o">.</span><span class="n">stdout_bytes</span><span class="p">,</span>
                      <span class="s1">&#39;The string &quot;Remote folder full path:&quot; was not found in the&#39;</span>
                      <span class="s1">&#39; output of verdi data remote show&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestVerdiDataRemote.test_remotelshelp"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_data.TestVerdiDataRemote.test_remotelshelp">[docs]</a>    <span class="k">def</span> <span class="nf">test_remotelshelp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s1">&#39;verdi&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;remote&#39;</span><span class="p">,</span> <span class="s1">&#39;ls&#39;</span><span class="p">,</span> <span class="s1">&#39;--help&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Usage:&#39;</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="s2">&quot;Sub-command verdi data remote ls --help failed.&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestVerdiDataRemote.test_remotels"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_data.TestVerdiDataRemote.test_remotels">[docs]</a>    <span class="k">def</span> <span class="nf">test_remotels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">options</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;--long&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">id</span><span class="p">)]</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cli_runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">cmd_remote</span><span class="o">.</span><span class="n">remote_ls</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">catch_exceptions</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">exit_code</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;The command verdi data remote ls did not finish correctly&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;file.txt&#39;</span><span class="p">,</span> <span class="n">res</span><span class="o">.</span><span class="n">stdout_bytes</span><span class="p">,</span> <span class="s1">&#39;The file &quot;file.txt&quot; was not found in the output&#39;</span>
                                                     <span class="s1">&#39; of verdi data remote ls&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestVerdiDataRemote.test_remotecathelp"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_data.TestVerdiDataRemote.test_remotecathelp">[docs]</a>    <span class="k">def</span> <span class="nf">test_remotecathelp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s1">&#39;verdi&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;remote&#39;</span><span class="p">,</span> <span class="s1">&#39;cat&#39;</span><span class="p">,</span> <span class="s1">&#39;--help&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Usage:&#39;</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="s2">&quot;Sub-command verdi data remote cat --help failed.&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestVerdiDataRemote.test_remotecat"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_data.TestVerdiDataRemote.test_remotecat">[docs]</a>    <span class="k">def</span> <span class="nf">test_remotecat</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">options</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">id</span><span class="p">),</span> <span class="s1">&#39;file.txt&#39;</span><span class="p">]</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cli_runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">cmd_remote</span><span class="o">.</span><span class="n">remote_cat</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">catch_exceptions</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">exit_code</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;The command verdi data remote cat did not finish correctly&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;test string&#39;</span><span class="p">,</span> <span class="n">res</span><span class="o">.</span><span class="n">stdout_bytes</span><span class="p">,</span> <span class="s1">&#39;The string &quot;test string&quot; was not found in the output&#39;</span>
                                                        <span class="s1">&#39; of verdi data remote cat file.txt&#39;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="TestVerdiDataTrajectory"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_data.TestVerdiDataTrajectory">[docs]</a><span class="k">class</span> <span class="nc">TestVerdiDataTrajectory</span><span class="p">(</span><span class="n">AiidaTestCase</span><span class="p">,</span> <span class="n">TestVerdiDataListable</span><span class="p">,</span> <span class="n">TestVerdiDataExportable</span><span class="p">):</span>

<div class="viewcode-block" id="TestVerdiDataTrajectory.create_trajectory_data"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_data.TestVerdiDataTrajectory.create_trajectory_data">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">create_trajectory_data</span><span class="p">():</span>
        <span class="kn">import</span> <span class="nn">numpy</span>

        <span class="c1"># Create a node with two arrays</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">TrajectoryData</span><span class="p">()</span>

        <span class="c1"># I create sample data</span>
        <span class="n">stepids</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">60</span><span class="p">,</span> <span class="mi">70</span><span class="p">])</span>
        <span class="n">times</span> <span class="o">=</span> <span class="n">stepids</span> <span class="o">*</span> <span class="mf">0.01</span>
        <span class="n">cells</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[[</span>
            <span class="mf">2.</span><span class="p">,</span>
            <span class="mf">0.</span><span class="p">,</span>
            <span class="mf">0.</span><span class="p">,</span>
        <span class="p">],</span> <span class="p">[</span>
            <span class="mf">0.</span><span class="p">,</span>
            <span class="mf">2.</span><span class="p">,</span>
            <span class="mf">0.</span><span class="p">,</span>
        <span class="p">],</span> <span class="p">[</span>
            <span class="mf">0.</span><span class="p">,</span>
            <span class="mf">0.</span><span class="p">,</span>
            <span class="mf">2.</span><span class="p">,</span>
        <span class="p">]],</span> <span class="p">[[</span>
            <span class="mf">3.</span><span class="p">,</span>
            <span class="mf">0.</span><span class="p">,</span>
            <span class="mf">0.</span><span class="p">,</span>
        <span class="p">],</span> <span class="p">[</span>
            <span class="mf">0.</span><span class="p">,</span>
            <span class="mf">3.</span><span class="p">,</span>
            <span class="mf">0.</span><span class="p">,</span>
        <span class="p">],</span> <span class="p">[</span>
            <span class="mf">0.</span><span class="p">,</span>
            <span class="mf">0.</span><span class="p">,</span>
            <span class="mf">3.</span><span class="p">,</span>
        <span class="p">]]])</span>
        <span class="n">symbols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">]</span>
        <span class="n">positions</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">]],</span> <span class="p">[[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span>
                                                                                    <span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">]]])</span>
        <span class="n">velocities</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">]],</span> <span class="p">[[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span>
                                                                               <span class="p">[</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">]]])</span>

        <span class="c1"># I set the node</span>
        <span class="n">n</span><span class="o">.</span><span class="n">set_trajectory</span><span class="p">(</span>
            <span class="n">stepids</span><span class="o">=</span><span class="n">stepids</span><span class="p">,</span> <span class="n">cells</span><span class="o">=</span><span class="n">cells</span><span class="p">,</span> <span class="n">symbols</span><span class="o">=</span><span class="n">symbols</span><span class="p">,</span> <span class="n">positions</span><span class="o">=</span><span class="n">positions</span><span class="p">,</span> <span class="n">times</span><span class="o">=</span><span class="n">times</span><span class="p">,</span> <span class="n">velocities</span><span class="o">=</span><span class="n">velocities</span><span class="p">)</span>

        <span class="n">n</span><span class="o">.</span><span class="n">store</span><span class="p">()</span>

        <span class="c1"># Create 2 groups and add the data to one of them</span>
        <span class="n">g_ne</span> <span class="o">=</span> <span class="n">Group</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;non_empty_group&#39;</span><span class="p">)</span>
        <span class="n">g_ne</span><span class="o">.</span><span class="n">store</span><span class="p">()</span>
        <span class="n">g_ne</span><span class="o">.</span><span class="n">add_nodes</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

        <span class="n">g_e</span> <span class="o">=</span> <span class="n">Group</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;empty_group&#39;</span><span class="p">)</span>
        <span class="n">g_e</span><span class="o">.</span><span class="n">store</span><span class="p">()</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="n">TestVerdiDataListable</span><span class="o">.</span><span class="n">NODE_ID_STR</span><span class="p">:</span> <span class="n">n</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="n">TestVerdiDataListable</span><span class="o">.</span><span class="n">NON_EMPTY_GROUP_ID_STR</span><span class="p">:</span> <span class="n">g_ne</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="n">TestVerdiDataListable</span><span class="o">.</span><span class="n">EMPTY_GROUP_ID_STR</span><span class="p">:</span> <span class="n">g_e</span><span class="o">.</span><span class="n">id</span>
        <span class="p">}</span></div>

<div class="viewcode-block" id="TestVerdiDataTrajectory.setUpClass"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_data.TestVerdiDataTrajectory.setUpClass">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">setUpClass</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TestVerdiDataTrajectory</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">setUpClass</span><span class="p">()</span>
        <span class="n">orm</span><span class="o">.</span><span class="n">Computer</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s1">&#39;comp&#39;</span><span class="p">,</span>
            <span class="n">hostname</span><span class="o">=</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span>
            <span class="n">transport_type</span><span class="o">=</span><span class="s1">&#39;local&#39;</span><span class="p">,</span>
            <span class="n">scheduler_type</span><span class="o">=</span><span class="s1">&#39;direct&#39;</span><span class="p">,</span>
            <span class="n">workdir</span><span class="o">=</span><span class="s1">&#39;/tmp/aiida&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">store</span><span class="p">()</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">ids</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">create_trajectory_data</span><span class="p">()</span></div>

<div class="viewcode-block" id="TestVerdiDataTrajectory.setUp"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_data.TestVerdiDataTrajectory.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">comp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">computer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">runner</span> <span class="o">=</span> <span class="n">CliRunner</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">this_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">this_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cli_runner</span> <span class="o">=</span> <span class="n">CliRunner</span><span class="p">()</span></div>

<div class="viewcode-block" id="TestVerdiDataTrajectory.test_showhelp"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_data.TestVerdiDataTrajectory.test_showhelp">[docs]</a>    <span class="k">def</span> <span class="nf">test_showhelp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">cmd_trajectory</span><span class="o">.</span><span class="n">trajectory_show</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;--help&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Usage:&#39;</span><span class="p">,</span> <span class="n">res</span><span class="o">.</span><span class="n">stdout_bytes</span><span class="p">,</span> <span class="s1">&#39;The string &quot;Usage: &quot; was not found in the output&#39;</span>
                                                   <span class="s1">&#39; of verdi data trajecotry show --help&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestVerdiDataTrajectory.test_list"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_data.TestVerdiDataTrajectory.test_list">[docs]</a>    <span class="k">def</span> <span class="nf">test_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_listing_test</span><span class="p">(</span><span class="n">TrajectoryData</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ids</span><span class="p">[</span><span class="n">TestVerdiDataListable</span><span class="o">.</span><span class="n">NODE_ID_STR</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">ids</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestVerdiDataTrajectory.test_export"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_data.TestVerdiDataTrajectory.test_export">[docs]</a>    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skipUnless</span><span class="p">(</span><span class="n">has_pycifrw</span><span class="p">(),</span> <span class="s2">&quot;Unable to import PyCifRW&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_export</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">aiida.cmdline.commands.cmd_data.cmd_trajectory</span> <span class="k">import</span> <span class="n">EXPORT_FORMATS</span><span class="p">,</span> <span class="n">trajectory_export</span>

        <span class="n">new_supported_formats</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">EXPORT_FORMATS</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_export_test</span><span class="p">(</span><span class="n">TrajectoryData</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ids</span><span class="p">,</span> <span class="n">new_supported_formats</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="TestVerdiDataStructure"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_data.TestVerdiDataStructure">[docs]</a><span class="k">class</span> <span class="nc">TestVerdiDataStructure</span><span class="p">(</span><span class="n">AiidaTestCase</span><span class="p">,</span> <span class="n">TestVerdiDataListable</span><span class="p">,</span> <span class="n">TestVerdiDataExportable</span><span class="p">):</span>

<div class="viewcode-block" id="TestVerdiDataStructure.create_structure_data"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_data.TestVerdiDataStructure.create_structure_data">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">create_structure_data</span><span class="p">():</span>
        <span class="n">alat</span> <span class="o">=</span> <span class="mf">4.</span>  <span class="c1"># angstrom</span>
        <span class="n">cell</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span>
                <span class="n">alat</span><span class="p">,</span>
                <span class="mf">0.</span><span class="p">,</span>
                <span class="mf">0.</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="p">[</span>
                <span class="mf">0.</span><span class="p">,</span>
                <span class="n">alat</span><span class="p">,</span>
                <span class="mf">0.</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="p">[</span>
                <span class="mf">0.</span><span class="p">,</span>
                <span class="mf">0.</span><span class="p">,</span>
                <span class="n">alat</span><span class="p">,</span>
            <span class="p">],</span>
        <span class="p">]</span>

        <span class="c1"># BaTiO3 cubic structure</span>
        <span class="n">struc</span> <span class="o">=</span> <span class="n">StructureData</span><span class="p">(</span><span class="n">cell</span><span class="o">=</span><span class="n">cell</span><span class="p">)</span>
        <span class="n">struc</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Ba&#39;</span><span class="p">)</span>
        <span class="n">struc</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="n">alat</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">,</span> <span class="n">alat</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">,</span> <span class="n">alat</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Ti&#39;</span><span class="p">)</span>
        <span class="n">struc</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="n">alat</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">,</span> <span class="n">alat</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;O&#39;</span><span class="p">)</span>
        <span class="n">struc</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="n">alat</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">alat</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;O&#39;</span><span class="p">)</span>
        <span class="n">struc</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">alat</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">,</span> <span class="n">alat</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;O&#39;</span><span class="p">)</span>
        <span class="n">struc</span><span class="o">.</span><span class="n">store</span><span class="p">()</span>

        <span class="c1"># Create 2 groups and add the data to one of them</span>
        <span class="n">g_ne</span> <span class="o">=</span> <span class="n">Group</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;non_empty_group&#39;</span><span class="p">)</span>
        <span class="n">g_ne</span><span class="o">.</span><span class="n">store</span><span class="p">()</span>
        <span class="n">g_ne</span><span class="o">.</span><span class="n">add_nodes</span><span class="p">(</span><span class="n">struc</span><span class="p">)</span>

        <span class="n">g_e</span> <span class="o">=</span> <span class="n">Group</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;empty_group&#39;</span><span class="p">)</span>
        <span class="n">g_e</span><span class="o">.</span><span class="n">store</span><span class="p">()</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="n">TestVerdiDataListable</span><span class="o">.</span><span class="n">NODE_ID_STR</span><span class="p">:</span> <span class="n">struc</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="n">TestVerdiDataListable</span><span class="o">.</span><span class="n">NON_EMPTY_GROUP_ID_STR</span><span class="p">:</span> <span class="n">g_ne</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="n">TestVerdiDataListable</span><span class="o">.</span><span class="n">EMPTY_GROUP_ID_STR</span><span class="p">:</span> <span class="n">g_e</span><span class="o">.</span><span class="n">id</span>
        <span class="p">}</span></div>

<div class="viewcode-block" id="TestVerdiDataStructure.setUpClass"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_data.TestVerdiDataStructure.setUpClass">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">setUpClass</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TestVerdiDataStructure</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">setUpClass</span><span class="p">()</span>
        <span class="n">orm</span><span class="o">.</span><span class="n">Computer</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;comp&#39;</span><span class="p">,</span>
                     <span class="n">hostname</span><span class="o">=</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span>
                     <span class="n">transport_type</span><span class="o">=</span><span class="s1">&#39;local&#39;</span><span class="p">,</span>
                     <span class="n">scheduler_type</span><span class="o">=</span><span class="s1">&#39;direct&#39;</span><span class="p">,</span>
                     <span class="n">workdir</span><span class="o">=</span><span class="s1">&#39;/tmp/aiida&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">store</span><span class="p">()</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">ids</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">create_structure_data</span><span class="p">()</span></div>

<div class="viewcode-block" id="TestVerdiDataStructure.setUp"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_data.TestVerdiDataStructure.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">comp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">computer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">runner</span> <span class="o">=</span> <span class="n">CliRunner</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">this_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">this_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cli_runner</span> <span class="o">=</span> <span class="n">CliRunner</span><span class="p">()</span></div>

<div class="viewcode-block" id="TestVerdiDataStructure.test_importhelp"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_data.TestVerdiDataStructure.test_importhelp">[docs]</a>    <span class="k">def</span> <span class="nf">test_importhelp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">cmd_structure</span><span class="o">.</span><span class="n">structure_import</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;--help&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Usage:&#39;</span><span class="p">,</span> <span class="n">res</span><span class="o">.</span><span class="n">stdout_bytes</span><span class="p">,</span> <span class="s1">&#39;The string &quot;Usage: &quot; was not found in the output&#39;</span>
                                                   <span class="s1">&#39; of verdi data import --help&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestVerdiDataStructure.test_import"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_data.TestVerdiDataStructure.test_import">[docs]</a>    <span class="k">def</span> <span class="nf">test_import</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">xyzcontent</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">        2</span>

<span class="s1">        Fe     0.0 0.0 0.0</span>
<span class="s1">        O      2.0 2.0 2.0</span>
<span class="s1">        &#39;&#39;&#39;</span>
        <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w+&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fhandle</span><span class="p">:</span>
            <span class="n">fhandle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">xyzcontent</span><span class="p">)</span>
            <span class="n">fhandle</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
            <span class="n">options</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">fhandle</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="s1">&#39;--format&#39;</span><span class="p">,</span>
                <span class="s1">&#39;xyz&#39;</span><span class="p">,</span>
                <span class="s1">&#39;--vacuum-factor&#39;</span><span class="p">,</span>
                <span class="s1">&#39;1.0&#39;</span><span class="p">,</span>
                <span class="s1">&#39;--vacuum-addition&#39;</span><span class="p">,</span>
                <span class="s1">&#39;10.0&#39;</span><span class="p">,</span>
                <span class="s1">&#39;--pbc&#39;</span><span class="p">,</span>
                <span class="s1">&#39;1&#39;</span><span class="p">,</span>
                <span class="s1">&#39;1&#39;</span><span class="p">,</span>
                <span class="s1">&#39;1&#39;</span><span class="p">,</span>
            <span class="p">]</span>
            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cli_runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">cmd_structure</span><span class="o">.</span><span class="n">structure_import</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">catch_exceptions</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;PK = None&#39;</span><span class="p">,</span> <span class="n">res</span><span class="o">.</span><span class="n">stdout_bytes</span><span class="p">,</span> <span class="s1">&#39;The string &quot;PK = None&quot; was not found in the output&#39;</span>
                                                          <span class="s1">&#39; of verdi data structure import with --store option.&#39;</span><span class="p">)</span>
            <span class="n">options</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;--store&#39;</span><span class="p">)</span>
            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cli_runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">cmd_structure</span><span class="o">.</span><span class="n">structure_import</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">catch_exceptions</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Succesfully imported&#39;</span><span class="p">,</span> <span class="n">res</span><span class="o">.</span><span class="n">stdout_bytes</span><span class="p">,</span>
                          <span class="s1">&#39;The string &quot;Succesfully imported&quot; was not found in the output&#39;</span>
                          <span class="s1">&#39; of verdi data structure import.&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestVerdiDataStructure.test_showhelp"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_data.TestVerdiDataStructure.test_showhelp">[docs]</a>    <span class="k">def</span> <span class="nf">test_showhelp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">cmd_structure</span><span class="o">.</span><span class="n">structure_import</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;--help&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Usage:&#39;</span><span class="p">,</span> <span class="n">res</span><span class="o">.</span><span class="n">stdout_bytes</span><span class="p">,</span> <span class="s1">&#39;The string &quot;Usage: &quot; was not found in the output&#39;</span>
                                                   <span class="s1">&#39; of verdi data show --help&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestVerdiDataStructure.test_list"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_data.TestVerdiDataStructure.test_list">[docs]</a>    <span class="k">def</span> <span class="nf">test_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_listing_test</span><span class="p">(</span><span class="n">StructureData</span><span class="p">,</span> <span class="s1">&#39;BaO3Ti&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ids</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestVerdiDataStructure.test_export"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_data.TestVerdiDataStructure.test_export">[docs]</a>    <span class="k">def</span> <span class="nf">test_export</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">aiida.cmdline.commands.cmd_data.cmd_structure</span> <span class="k">import</span> <span class="n">EXPORT_FORMATS</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_export_test</span><span class="p">(</span><span class="n">StructureData</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ids</span><span class="p">,</span> <span class="n">EXPORT_FORMATS</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="TestVerdiDataCif"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_data.TestVerdiDataCif">[docs]</a><span class="nd">@unittest</span><span class="o">.</span><span class="n">skipUnless</span><span class="p">(</span><span class="n">has_pycifrw</span><span class="p">(),</span> <span class="s2">&quot;Unable to import PyCifRW&quot;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">TestVerdiDataCif</span><span class="p">(</span><span class="n">AiidaTestCase</span><span class="p">,</span> <span class="n">TestVerdiDataListable</span><span class="p">,</span> <span class="n">TestVerdiDataExportable</span><span class="p">):</span>
    <span class="n">valid_sample_cif_str</span> <span class="o">=</span> <span class="sa">u</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">        data_test</span>
<span class="s1">        _cell_length_a    10</span>
<span class="s1">        _cell_length_b    10</span>
<span class="s1">        _cell_length_c    10</span>
<span class="s1">        _cell_angle_alpha 90</span>
<span class="s1">        _cell_angle_beta  90</span>
<span class="s1">        _cell_angle_gamma 90</span>
<span class="s1">        _chemical_formula_sum &#39;C O2&#39;</span>
<span class="s1">        loop_</span>
<span class="s1">        _atom_site_label</span>
<span class="s1">        _atom_site_fract_x</span>
<span class="s1">        _atom_site_fract_y</span>
<span class="s1">        _atom_site_fract_z</span>
<span class="s1">        _atom_site_attached_hydrogens</span>
<span class="s1">        C 0 0 0 0</span>
<span class="s1">        O 0.5 0.5 0.5 .</span>
<span class="s1">        H 0.75 0.75 0.75 0</span>
<span class="s1">    &#39;&#39;&#39;</span>

<div class="viewcode-block" id="TestVerdiDataCif.create_cif_data"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_data.TestVerdiDataCif.create_cif_data">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">create_cif_data</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w+&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fhandle</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">fhandle</span><span class="o">.</span><span class="n">name</span>
            <span class="n">fhandle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">valid_sample_cif_str</span><span class="p">)</span>
            <span class="n">fhandle</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">CifData</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;version&#39;</span><span class="p">:</span> <span class="s1">&#39;1234&#39;</span><span class="p">,</span> <span class="s1">&#39;db_name&#39;</span><span class="p">:</span> <span class="s1">&#39;COD&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;0000001&#39;</span><span class="p">})</span>
            <span class="n">a</span><span class="o">.</span><span class="n">store</span><span class="p">()</span>

            <span class="n">g_ne</span> <span class="o">=</span> <span class="n">Group</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;non_empty_group&#39;</span><span class="p">)</span>
            <span class="n">g_ne</span><span class="o">.</span><span class="n">store</span><span class="p">()</span>
            <span class="n">g_ne</span><span class="o">.</span><span class="n">add_nodes</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

            <span class="n">g_e</span> <span class="o">=</span> <span class="n">Group</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;empty_group&#39;</span><span class="p">)</span>
            <span class="n">g_e</span><span class="o">.</span><span class="n">store</span><span class="p">()</span>

        <span class="bp">cls</span><span class="o">.</span><span class="n">cif</span> <span class="o">=</span> <span class="n">a</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="n">TestVerdiDataListable</span><span class="o">.</span><span class="n">NODE_ID_STR</span><span class="p">:</span> <span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="n">TestVerdiDataListable</span><span class="o">.</span><span class="n">NON_EMPTY_GROUP_ID_STR</span><span class="p">:</span> <span class="n">g_ne</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="n">TestVerdiDataListable</span><span class="o">.</span><span class="n">EMPTY_GROUP_ID_STR</span><span class="p">:</span> <span class="n">g_e</span><span class="o">.</span><span class="n">id</span>
        <span class="p">}</span></div>

<div class="viewcode-block" id="TestVerdiDataCif.setUpClass"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_data.TestVerdiDataCif.setUpClass">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">setUpClass</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TestVerdiDataCif</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">setUpClass</span><span class="p">()</span>
        <span class="n">orm</span><span class="o">.</span><span class="n">Computer</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s1">&#39;comp&#39;</span><span class="p">,</span>
            <span class="n">hostname</span><span class="o">=</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span>
            <span class="n">transport_type</span><span class="o">=</span><span class="s1">&#39;local&#39;</span><span class="p">,</span>
            <span class="n">scheduler_type</span><span class="o">=</span><span class="s1">&#39;direct&#39;</span><span class="p">,</span>
            <span class="n">workdir</span><span class="o">=</span><span class="s1">&#39;/tmp/aiida&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">store</span><span class="p">()</span>

        <span class="bp">cls</span><span class="o">.</span><span class="n">ids</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">create_cif_data</span><span class="p">()</span></div>

<div class="viewcode-block" id="TestVerdiDataCif.setUp"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_data.TestVerdiDataCif.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TestVerdiDataCif</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">setUp</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">comp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">computer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">runner</span> <span class="o">=</span> <span class="n">CliRunner</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">this_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">this_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cli_runner</span> <span class="o">=</span> <span class="n">CliRunner</span><span class="p">()</span></div>

<div class="viewcode-block" id="TestVerdiDataCif.test_list"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_data.TestVerdiDataCif.test_list">[docs]</a>    <span class="k">def</span> <span class="nf">test_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method tests that the Cif listing works as expected with all</span>
<span class="sd">        possible flags and arguments.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_listing_test</span><span class="p">(</span><span class="n">CifData</span><span class="p">,</span> <span class="s1">&#39;C O2&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ids</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestVerdiDataCif.test_showhelp"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_data.TestVerdiDataCif.test_showhelp">[docs]</a>    <span class="k">def</span> <span class="nf">test_showhelp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">options</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;--help&#39;</span><span class="p">]</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cli_runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">cmd_cif</span><span class="o">.</span><span class="n">cif_show</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">catch_exceptions</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Usage:&#39;</span><span class="p">,</span> <span class="n">res</span><span class="o">.</span><span class="n">stdout_bytes</span><span class="p">,</span> <span class="s1">&#39;The string &quot;Usage: &quot; was not found in the output&#39;</span>
                                                   <span class="s1">&#39; of verdi data show help&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestVerdiDataCif.test_importhelp"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_data.TestVerdiDataCif.test_importhelp">[docs]</a>    <span class="k">def</span> <span class="nf">test_importhelp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">options</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;--help&#39;</span><span class="p">]</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cli_runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">cmd_cif</span><span class="o">.</span><span class="n">cif_import</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">catch_exceptions</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Usage:&#39;</span><span class="p">,</span> <span class="n">res</span><span class="o">.</span><span class="n">stdout_bytes</span><span class="p">,</span> <span class="s1">&#39;The string &quot;Usage: &quot; was not found in the output&#39;</span>
                                                   <span class="s1">&#39; of verdi data import help&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestVerdiDataCif.test_import"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_data.TestVerdiDataCif.test_import">[docs]</a>    <span class="k">def</span> <span class="nf">test_import</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w+&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fhandle</span><span class="p">:</span>
            <span class="n">fhandle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">valid_sample_cif_str</span><span class="p">)</span>
            <span class="n">fhandle</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
            <span class="n">options</span> <span class="o">=</span> <span class="p">[</span><span class="n">fhandle</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cli_runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">cmd_cif</span><span class="o">.</span><span class="n">cif_import</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">catch_exceptions</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;imported uuid&#39;</span><span class="p">,</span> <span class="n">res</span><span class="o">.</span><span class="n">stdout_bytes</span><span class="p">,</span> <span class="s1">&#39;The string &quot;imported uuid&quot; was not found in the output&#39;</span>
                                                              <span class="s1">&#39; of verdi data import.&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestVerdiDataCif.test_content"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_data.TestVerdiDataCif.test_content">[docs]</a>    <span class="k">def</span> <span class="nf">test_content</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Test that `verdi data cif content` returns the content of the file.&quot;&quot;&quot;</span>
        <span class="n">options</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cif</span><span class="o">.</span><span class="n">uuid</span><span class="p">)]</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cli_runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">cmd_cif</span><span class="o">.</span><span class="n">cif_content</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">catch_exceptions</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">valid_sample_cif_str</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestVerdiDataCif.test_export"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_data.TestVerdiDataCif.test_export">[docs]</a>    <span class="k">def</span> <span class="nf">test_export</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method checks if the Cif export works as expected with all</span>
<span class="sd">        possible flags and arguments.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">aiida.cmdline.commands.cmd_data.cmd_cif</span> <span class="k">import</span> <span class="n">EXPORT_FORMATS</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_export_test</span><span class="p">(</span><span class="n">CifData</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ids</span><span class="p">,</span> <span class="n">EXPORT_FORMATS</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="TestVerdiDataUpf"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_data.TestVerdiDataUpf">[docs]</a><span class="k">class</span> <span class="nc">TestVerdiDataUpf</span><span class="p">(</span><span class="n">AiidaTestCase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Testing verdi data upf</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="TestVerdiDataUpf.setUpClass"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_data.TestVerdiDataUpf.setUpClass">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">setUpClass</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TestVerdiDataUpf</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">setUpClass</span><span class="p">()</span></div>

<div class="viewcode-block" id="TestVerdiDataUpf.setUp"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_data.TestVerdiDataUpf.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filepath_pseudos</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="n">os</span><span class="o">.</span><span class="n">pardir</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">pardir</span><span class="p">,</span> <span class="s1">&#39;fixtures&#39;</span><span class="p">,</span> <span class="s1">&#39;pseudos&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cli_runner</span> <span class="o">=</span> <span class="n">CliRunner</span><span class="p">()</span></div>

<div class="viewcode-block" id="TestVerdiDataUpf.upload_family"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_data.TestVerdiDataUpf.upload_family">[docs]</a>    <span class="k">def</span> <span class="nf">upload_family</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">options</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath_pseudos</span><span class="p">,</span> <span class="s2">&quot;test_group&quot;</span><span class="p">,</span> <span class="s2">&quot;test description&quot;</span><span class="p">]</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cli_runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">cmd_upf</span><span class="o">.</span><span class="n">upf_uploadfamily</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">catch_exceptions</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;UPF files found: 3&#39;</span><span class="p">,</span> <span class="n">res</span><span class="o">.</span><span class="n">stdout_bytes</span><span class="p">,</span> <span class="s1">&#39;The string &quot;UPF files found: 3&quot; was not found in the&#39;</span>
                                                               <span class="s1">&#39; output of verdi data upf uploadfamily&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestVerdiDataUpf.test_uploadfamilyhelp"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_data.TestVerdiDataUpf.test_uploadfamilyhelp">[docs]</a>    <span class="k">def</span> <span class="nf">test_uploadfamilyhelp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s1">&#39;verdi&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;upf&#39;</span><span class="p">,</span> <span class="s1">&#39;uploadfamily&#39;</span><span class="p">,</span> <span class="s1">&#39;--help&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Usage:&#39;</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="s2">&quot;Sub-command verdi data upf uploadfamily --help failed: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">output</span><span class="p">))</span></div>

<div class="viewcode-block" id="TestVerdiDataUpf.test_uploadfamily"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_data.TestVerdiDataUpf.test_uploadfamily">[docs]</a>    <span class="k">def</span> <span class="nf">test_uploadfamily</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">upload_family</span><span class="p">()</span>
        <span class="n">options</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath_pseudos</span><span class="p">,</span> <span class="s2">&quot;test_group&quot;</span><span class="p">,</span> <span class="s2">&quot;test description&quot;</span><span class="p">,</span> <span class="s2">&quot;--stop-if-existing&quot;</span><span class="p">]</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cli_runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">cmd_upf</span><span class="o">.</span><span class="n">upf_uploadfamily</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">catch_exceptions</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestVerdiDataUpf.test_exportfamilyhelp"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_data.TestVerdiDataUpf.test_exportfamilyhelp">[docs]</a>    <span class="k">def</span> <span class="nf">test_exportfamilyhelp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s1">&#39;verdi&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;upf&#39;</span><span class="p">,</span> <span class="s1">&#39;exportfamily&#39;</span><span class="p">,</span> <span class="s1">&#39;--help&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Usage:&#39;</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="s2">&quot;Sub-command verdi data upf exportfamily --help failed.&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestVerdiDataUpf.test_exportfamily"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_data.TestVerdiDataUpf.test_exportfamily">[docs]</a>    <span class="k">def</span> <span class="nf">test_exportfamily</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">upload_family</span><span class="p">()</span>

        <span class="n">p</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">()</span>
        <span class="n">options</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="s1">&#39;test_group&#39;</span><span class="p">]</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cli_runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">cmd_upf</span><span class="o">.</span><span class="n">upf_exportfamily</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">catch_exceptions</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertClickResultNoException</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s1">&#39;ls&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Ba.pbesol-spn-rrkjus_psl.0.2.3-tot-pslib030.UPF&#39;</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span>
                      <span class="s2">&quot;Sub-command verdi data upf exportfamily --help failed: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">output</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;O.pbesol-n-rrkjus_psl.0.1-tested-pslib030.UPF&#39;</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span>
                      <span class="s2">&quot;Sub-command verdi data upf exportfamily --help failed.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Ti.pbesol-spn-rrkjus_psl.0.2.3-tot-pslib030.UPF&#39;</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span>
                      <span class="s2">&quot;Sub-command verdi data upf exportfamily --help failed.&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestVerdiDataUpf.test_listfamilieshelp"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_data.TestVerdiDataUpf.test_listfamilieshelp">[docs]</a>    <span class="k">def</span> <span class="nf">test_listfamilieshelp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s1">&#39;verdi&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;upf&#39;</span><span class="p">,</span> <span class="s1">&#39;listfamilies&#39;</span><span class="p">,</span> <span class="s1">&#39;--help&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Usage:&#39;</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="s2">&quot;Sub-command verdi data upf listfamilies --help failed.&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestVerdiDataUpf.test_listfamilies"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_data.TestVerdiDataUpf.test_listfamilies">[docs]</a>    <span class="k">def</span> <span class="nf">test_listfamilies</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">upload_family</span><span class="p">()</span>

        <span class="n">options</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;-d&#39;</span><span class="p">,</span> <span class="s1">&#39;-e&#39;</span><span class="p">,</span> <span class="s1">&#39;Ba&#39;</span><span class="p">]</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cli_runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">cmd_upf</span><span class="o">.</span><span class="n">upf_listfamilies</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">catch_exceptions</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;test_group&#39;</span><span class="p">,</span> <span class="n">res</span><span class="o">.</span><span class="n">stdout_bytes</span><span class="p">,</span> <span class="s1">&#39;The string &quot;test_group&quot; was not found in the&#39;</span>
                                                       <span class="s1">&#39; output of verdi data upf listfamilies: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">output</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;test description&#39;</span><span class="p">,</span> <span class="n">res</span><span class="o">.</span><span class="n">stdout_bytes</span><span class="p">,</span> <span class="s1">&#39;The string &quot;test_group&quot; was not found in the&#39;</span>
                                                             <span class="s1">&#39; output of verdi data upf listfamilies&#39;</span><span class="p">)</span>

        <span class="n">options</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;-d&#39;</span><span class="p">,</span> <span class="s1">&#39;-e&#39;</span><span class="p">,</span> <span class="s1">&#39;Fe&#39;</span><span class="p">]</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cli_runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">cmd_upf</span><span class="o">.</span><span class="n">upf_listfamilies</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">catch_exceptions</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;No valid UPF pseudopotential&#39;</span><span class="p">,</span> <span class="n">res</span><span class="o">.</span><span class="n">stdout_bytes</span><span class="p">,</span>
                      <span class="s1">&#39;The string &quot;No valid UPF pseudopotential&quot; was not&#39;</span>
                      <span class="s1">&#39; found in the output of verdi data upf listfamilies&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestVerdiDataUpf.test_importhelp"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_data.TestVerdiDataUpf.test_importhelp">[docs]</a>    <span class="k">def</span> <span class="nf">test_importhelp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s1">&#39;verdi&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;upf&#39;</span><span class="p">,</span> <span class="s1">&#39;import&#39;</span><span class="p">,</span> <span class="s1">&#39;--help&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Usage:&#39;</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="s2">&quot;Sub-command verdi data upf listfamilies --help failed.&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestVerdiDataUpf.test_import"><a class="viewcode-back" href="../../../../../../apidoc/aiida.backends.tests.cmdline.commands.html#aiida.backends.tests.cmdline.commands.test_data.TestVerdiDataUpf.test_import">[docs]</a>    <span class="k">def</span> <span class="nf">test_import</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">options</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath_pseudos</span><span class="p">,</span> <span class="s1">&#39;Ti.pbesol-spn-rrkjus_psl.0.2.3-tot-pslib030.UPF&#39;</span><span class="p">)]</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cli_runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">cmd_upf</span><span class="o">.</span><span class="n">upf_import</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">catch_exceptions</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Imported&#39;</span><span class="p">,</span> <span class="n">res</span><span class="o">.</span><span class="n">stdout_bytes</span><span class="p">,</span> <span class="s1">&#39;The string &quot;Imported&quot; was not&#39;</span>
                                                     <span class="s1">&#39; found in the output of verdi data import: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">output</span><span class="p">))</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, ECOLE POLYTECHNIQUE FEDERALE DE LAUSANNE (Theory and Simulation of Materials (THEOS) and National Centre for Computational Design and Discovery of Novel Materials (NCCR MARVEL)), Switzerland and ROBERT BOSCH LLC, USA. All rights reserved

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>