

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>aiida.backends.tests.test_dataclasses &mdash; AiiDA 1.0.0b2 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../../_static/language_data.js"></script>
        <script type="text/javascript" src="../../../../_static/contentui.js"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/contentui.css" type="text/css" />
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../index.html" class="icon icon-home"> AiiDA
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Installation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../install/quick_installation.html">Quick installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../install/prerequisites.html">Prerequisites</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../install/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../install/updating_installation.html">Updating AiiDA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../install/troubleshooting.html">Troubleshooting</a></li>
</ul>
<p class="caption"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../get_started/index.html">First things first</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../get_started/daemon.html">Setup the daemon</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../get_started/computers.html">Setup a computer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../get_started/codes.html">Setup a code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../get_started/plugins.html">Plugins</a></li>
</ul>
<p class="caption"><span class="caption-text">Concepts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../concepts/provenance.html">Provenance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../concepts/processes.html">Processes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../concepts/calculations.html">Calculations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../concepts/workflows.html">Workflows</a></li>
</ul>
<p class="caption"><span class="caption-text">Working with</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../working/processes.html">Processes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working/functions.html">Calculation and work functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working/calculations.html">Calculations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working/workflows.html">Workflows</a></li>
</ul>
<p class="caption"><span class="caption-text">Working with AiiDA</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../working_with_aiida/index.html">Command line interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working_with_aiida/index.html#scripting">Scripting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working_with_aiida/index.html#data-types">Data types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working_with_aiida/index.html#groups">Groups</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working_with_aiida/index.html#schedulers">Schedulers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working_with_aiida/index.html#querying-data">Querying data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working_with_aiida/index.html#caching">Caching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working_with_aiida/index.html#result-manager">Result manager</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working_with_aiida/index.html#backups">Backups</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working_with_aiida/index.html#troubleshooting">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working_with_aiida/index.html#rest-api">REST API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working_with_aiida/index.html#cookbook">Cookbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../import_export/index.html">Import and Export</a></li>
</ul>
<p class="caption"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../developer_guide/index.html">AiiDA design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../developer_guide/index.html#aiida-core">AiiDA core</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../developer_guide/index.html#aiida-plugins">AiiDA plugins</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../tutorial/index.html">StructureData</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tutorial/index.html#pseudopotentials">Pseudopotentials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tutorial/index.html#plugin-development">Plugin development</a></li>
</ul>
<p class="caption"><span class="caption-text">API reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="`aiida package &lt;https://aiida-core.readthedocs.io/en/latest/apidoc/aiida.html&gt;`_">`aiida package &lt;https://aiida-core.readthedocs.io/en/latest/apidoc/aiida.html&gt;`_</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">AiiDA</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../../../aiida.html">aiida</a> &raquo;</li>
        
          <li><a href="../tests.html">aiida.backends.tests</a> &raquo;</li>
        
      <li>aiida.backends.tests.test_dataclasses</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for aiida.backends.tests.test_dataclasses</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1">###########################################################################</span>
<span class="c1"># Copyright (c), The AiiDA team. All rights reserved.                     #</span>
<span class="c1"># This file is part of the AiiDA code.                                    #</span>
<span class="c1">#                                                                         #</span>
<span class="c1"># The code is hosted on GitHub at https://github.com/aiidateam/aiida_core #</span>
<span class="c1"># For further information on the license, see the LICENSE.txt file        #</span>
<span class="c1"># For further information please visit http://www.aiida.net               #</span>
<span class="c1">###########################################################################</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Tests for specific subclasses of Data</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">print_function</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">absolute_import</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">division</span>

<span class="kn">import</span> <span class="nn">io</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">import</span> <span class="nn">unittest</span>

<span class="kn">from</span> <span class="nn">six.moves</span> <span class="k">import</span> <span class="nb">range</span>

<span class="kn">from</span> <span class="nn">aiida.backends.testbase</span> <span class="k">import</span> <span class="n">AiidaTestCase</span>
<span class="kn">from</span> <span class="nn">aiida.common.exceptions</span> <span class="k">import</span> <span class="n">ModificationNotAllowed</span>
<span class="kn">from</span> <span class="nn">aiida.common.utils</span> <span class="k">import</span> <span class="n">Capturing</span>
<span class="kn">from</span> <span class="nn">aiida.orm</span> <span class="k">import</span> <span class="n">load_node</span>
<span class="kn">from</span> <span class="nn">aiida.orm</span> <span class="k">import</span> <span class="n">CifData</span><span class="p">,</span> <span class="n">StructureData</span><span class="p">,</span> <span class="n">KpointsData</span><span class="p">,</span> <span class="n">BandsData</span><span class="p">,</span> <span class="n">ArrayData</span><span class="p">,</span> <span class="n">TrajectoryData</span><span class="p">,</span> <span class="n">Dict</span>
<span class="kn">from</span> <span class="nn">aiida.orm.nodes.data.structure</span> <span class="k">import</span> <span class="n">Kind</span><span class="p">,</span> <span class="n">Site</span>


<div class="viewcode-block" id="has_seekpath"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.has_seekpath">[docs]</a><span class="k">def</span> <span class="nf">has_seekpath</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check if there is the seekpath dependency</span>

<span class="sd">    :return: True if seekpath is installed, False otherwise</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">seekpath</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="to_list_of_lists"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.to_list_of_lists">[docs]</a><span class="k">def</span> <span class="nf">to_list_of_lists</span><span class="p">(</span><span class="n">lofl</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts an iterable of iterables to a list of lists, needed</span>
<span class="sd">    for some tests (e.g. when one has a tuple of lists, a list of tuples, ...)</span>

<span class="sd">    :param lofl: an iterable of iterables</span>

<span class="sd">    :return: a list of lists</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[[</span><span class="n">el</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">l</span><span class="p">]</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">lofl</span><span class="p">]</span></div>


<div class="viewcode-block" id="simplify"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.simplify">[docs]</a><span class="k">def</span> <span class="nf">simplify</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Takes a string, strips spaces in each line and returns it</span>
<span class="sd">    Useful to compare strings when different versions of a code give</span>
<span class="sd">    different spaces.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">string</span><span class="o">.</span><span class="n">split</span><span class="p">())</span></div>


<div class="viewcode-block" id="TestCifData"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestCifData">[docs]</a><span class="k">class</span> <span class="nc">TestCifData</span><span class="p">(</span><span class="n">AiidaTestCase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Tests for CifData class.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">distutils.version</span> <span class="k">import</span> <span class="n">StrictVersion</span>
    <span class="kn">from</span> <span class="nn">aiida.orm.nodes.data.cif</span> <span class="k">import</span> <span class="n">has_pycifrw</span>
    <span class="kn">from</span> <span class="nn">aiida.orm.nodes.data.structure</span> <span class="k">import</span> <span class="n">has_ase</span><span class="p">,</span> <span class="n">has_pymatgen</span><span class="p">,</span> <span class="n">has_spglib</span><span class="p">,</span> <span class="n">get_pymatgen_version</span>

    <span class="n">valid_sample_cif_str</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">        data_test</span>
<span class="s1">        _cell_length_a    10</span>
<span class="s1">        _cell_length_b    10</span>
<span class="s1">        _cell_length_c    10</span>
<span class="s1">        _cell_angle_alpha 90</span>
<span class="s1">        _cell_angle_beta  90</span>
<span class="s1">        _cell_angle_gamma 90</span>
<span class="s1">        _chemical_formula_sum &#39;C O2&#39;</span>
<span class="s1">        loop_</span>
<span class="s1">        _atom_site_label</span>
<span class="s1">        _atom_site_fract_x</span>
<span class="s1">        _atom_site_fract_y</span>
<span class="s1">        _atom_site_fract_z</span>
<span class="s1">        _atom_site_attached_hydrogens</span>
<span class="s1">        C 0 0 0 0</span>
<span class="s1">        O 0.5 0.5 0.5 .</span>
<span class="s1">        H 0.75 0.75 0.75 0</span>
<span class="s1">    &#39;&#39;&#39;</span>

    <span class="n">valid_sample_cif_str_2</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">        data_test</span>
<span class="s1">        _cell_length_a    10</span>
<span class="s1">        _cell_length_b    10</span>
<span class="s1">        _cell_length_c    10</span>
<span class="s1">        _cell_angle_alpha 90</span>
<span class="s1">        _cell_angle_beta  90</span>
<span class="s1">        _cell_angle_gamma 90</span>
<span class="s1">        _chemical_formula_sum &#39;C O&#39;</span>
<span class="s1">        loop_</span>
<span class="s1">        _atom_site_label</span>
<span class="s1">        _atom_site_fract_x</span>
<span class="s1">        _atom_site_fract_y</span>
<span class="s1">        _atom_site_fract_z</span>
<span class="s1">        _atom_site_attached_hydrogens</span>
<span class="s1">        C 0 0 0 0</span>
<span class="s1">        O 0.5 0.5 0.5 .</span>
<span class="s1">    &#39;&#39;&#39;</span>

<div class="viewcode-block" id="TestCifData.test_reload_cifdata"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestCifData.test_reload_cifdata">[docs]</a>    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skipIf</span><span class="p">(</span><span class="ow">not</span> <span class="n">has_pycifrw</span><span class="p">(),</span> <span class="s2">&quot;Unable to import PyCifRW&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_reload_cifdata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">file_content</span> <span class="o">=</span> <span class="s2">&quot;data_test _cell_length_a 10(1)&quot;</span>
        <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w+&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">tmpf</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">tmpf</span><span class="o">.</span><span class="n">name</span>
            <span class="n">basename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">filename</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">tmpf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">file_content</span><span class="p">)</span>
            <span class="n">tmpf</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">CifData</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;version&#39;</span><span class="p">:</span> <span class="s1">&#39;1234&#39;</span><span class="p">,</span> <span class="s1">&#39;db_name&#39;</span><span class="p">:</span> <span class="s1">&#39;COD&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;0000001&#39;</span><span class="p">})</span>

        <span class="c1"># Key &#39;db_kind&#39; is not allowed in source description:</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">KeyError</span><span class="p">):</span>
            <span class="n">a</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;db_kind&#39;</span><span class="p">:</span> <span class="s1">&#39;small molecule&#39;</span><span class="p">}</span>

        <span class="n">the_uuid</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">uuid</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">list_object_names</span><span class="p">(),</span> <span class="p">[</span><span class="n">basename</span><span class="p">])</span>

        <span class="k">with</span> <span class="n">a</span><span class="o">.</span><span class="n">open</span><span class="p">()</span> <span class="k">as</span> <span class="n">fhandle</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">fhandle</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="n">file_content</span><span class="p">)</span>

        <span class="n">a</span><span class="o">.</span><span class="n">store</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">source</span><span class="p">,</span> <span class="p">{</span>
            <span class="s1">&#39;db_name&#39;</span><span class="p">:</span> <span class="s1">&#39;COD&#39;</span><span class="p">,</span>
            <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;0000001&#39;</span><span class="p">,</span>
            <span class="s1">&#39;version&#39;</span><span class="p">:</span> <span class="s1">&#39;1234&#39;</span><span class="p">,</span>
        <span class="p">})</span>

        <span class="k">with</span> <span class="n">a</span><span class="o">.</span><span class="n">open</span><span class="p">()</span> <span class="k">as</span> <span class="n">fhandle</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">fhandle</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="n">file_content</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">list_object_names</span><span class="p">(),</span> <span class="p">[</span><span class="n">basename</span><span class="p">])</span>

        <span class="n">b</span> <span class="o">=</span> <span class="n">load_node</span><span class="p">(</span><span class="n">the_uuid</span><span class="p">)</span>

        <span class="c1"># I check the retrieved object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">CifData</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">list_object_names</span><span class="p">(),</span> <span class="p">[</span><span class="n">basename</span><span class="p">])</span>
        <span class="k">with</span> <span class="n">b</span><span class="o">.</span><span class="n">open</span><span class="p">()</span> <span class="k">as</span> <span class="n">fhandle</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">fhandle</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="n">file_content</span><span class="p">)</span>

        <span class="c1"># Checking the get_or_create() method:</span>
        <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w+&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">tmpf</span><span class="p">:</span>
            <span class="n">tmpf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">file_content</span><span class="p">)</span>
            <span class="n">tmpf</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
            <span class="n">c</span><span class="p">,</span> <span class="n">created</span> <span class="o">=</span> <span class="n">CifData</span><span class="o">.</span><span class="n">get_or_create</span><span class="p">(</span><span class="n">tmpf</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">store_cif</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">CifData</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="ow">not</span> <span class="n">created</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">get_content</span><span class="p">(),</span> <span class="n">file_content</span><span class="p">)</span>

        <span class="n">other_content</span> <span class="o">=</span> <span class="s2">&quot;data_test _cell_length_b 10(1)&quot;</span>
        <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w+&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">tmpf</span><span class="p">:</span>
            <span class="n">tmpf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">other_content</span><span class="p">)</span>
            <span class="n">tmpf</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
            <span class="n">c</span><span class="p">,</span> <span class="n">created</span> <span class="o">=</span> <span class="n">CifData</span><span class="o">.</span><span class="n">get_or_create</span><span class="p">(</span><span class="n">tmpf</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">store_cif</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">CifData</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">created</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">get_content</span><span class="p">(),</span> <span class="n">other_content</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestCifData.test_parse_cifdata"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestCifData.test_parse_cifdata">[docs]</a>    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skipIf</span><span class="p">(</span><span class="ow">not</span> <span class="n">has_pycifrw</span><span class="p">(),</span> <span class="s2">&quot;Unable to import PyCifRW&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_parse_cifdata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">file_content</span> <span class="o">=</span> <span class="s2">&quot;data_test _cell_length_a 10(1)&quot;</span>
        <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w+&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">tmpf</span><span class="p">:</span>
            <span class="n">tmpf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">file_content</span><span class="p">)</span>
            <span class="n">tmpf</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">CifData</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">tmpf</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestCifData.test_change_cifdata_file"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestCifData.test_change_cifdata_file">[docs]</a>    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skipIf</span><span class="p">(</span><span class="ow">not</span> <span class="n">has_pycifrw</span><span class="p">(),</span> <span class="s2">&quot;Unable to import PyCifRW&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_change_cifdata_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">file_content_1</span> <span class="o">=</span> <span class="s2">&quot;data_test _cell_length_a 10(1)&quot;</span>
        <span class="n">file_content_2</span> <span class="o">=</span> <span class="s2">&quot;data_test _cell_length_a 11(1)&quot;</span>
        <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w+&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">tmpf</span><span class="p">:</span>
            <span class="n">tmpf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">file_content_1</span><span class="p">)</span>
            <span class="n">tmpf</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">CifData</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">tmpf</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">][</span><span class="s1">&#39;_cell_length_a&#39;</span><span class="p">],</span> <span class="s1">&#39;10(1)&#39;</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w+&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">tmpf</span><span class="p">:</span>
            <span class="n">tmpf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">file_content_2</span><span class="p">)</span>
            <span class="n">tmpf</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
            <span class="n">a</span><span class="o">.</span><span class="n">set_file</span><span class="p">(</span><span class="n">tmpf</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">][</span><span class="s1">&#39;_cell_length_a&#39;</span><span class="p">],</span> <span class="s1">&#39;11(1)&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestCifData.test_get_structure"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestCifData.test_get_structure">[docs]</a>    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skipIf</span><span class="p">(</span><span class="ow">not</span> <span class="n">has_ase</span><span class="p">(),</span> <span class="s2">&quot;Unable to import ase&quot;</span><span class="p">)</span>
    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skipIf</span><span class="p">(</span><span class="ow">not</span> <span class="n">has_pycifrw</span><span class="p">(),</span> <span class="s2">&quot;Unable to import PyCifRW&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_get_structure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w+&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">tmpf</span><span class="p">:</span>
            <span class="n">tmpf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">data_test</span>
<span class="s1">_cell_length_a    10</span>
<span class="s1">_cell_length_b    10</span>
<span class="s1">_cell_length_c    10</span>
<span class="s1">_cell_angle_alpha 90</span>
<span class="s1">_cell_angle_beta  90</span>
<span class="s1">_cell_angle_gamma 90</span>
<span class="s1">loop_</span>
<span class="s1">_symmetry_equiv_pos_site_id</span>
<span class="s1">_symmetry_equiv_pos_as_xyz</span>
<span class="s1">1 +x,+y,+z</span>
<span class="s1">loop_</span>
<span class="s1">_atom_site_label</span>
<span class="s1">_atom_site_fract_x</span>
<span class="s1">_atom_site_fract_y</span>
<span class="s1">_atom_site_fract_z</span>
<span class="s1">C 0 0 0</span>
<span class="s1">O 0.5 0.5 0.5</span>
<span class="s1">            &#39;&#39;&#39;</span><span class="p">)</span>
            <span class="n">tmpf</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">CifData</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">tmpf</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="n">a</span><span class="o">.</span><span class="n">get_structure</span><span class="p">(</span><span class="n">converter</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>

        <span class="n">c</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">get_structure</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">get_kind_names</span><span class="p">(),</span> <span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestCifData.test_ase_primitive_and_conventional_cells_ase"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestCifData.test_ase_primitive_and_conventional_cells_ase">[docs]</a>    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skipIf</span><span class="p">(</span><span class="ow">not</span> <span class="n">has_ase</span><span class="p">(),</span> <span class="s2">&quot;Unable to import ase&quot;</span><span class="p">)</span>
    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skipIf</span><span class="p">(</span><span class="ow">not</span> <span class="n">has_pycifrw</span><span class="p">(),</span> <span class="s2">&quot;Unable to import PyCifRW&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_ase_primitive_and_conventional_cells_ase</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checking the number of atoms per primitive/conventional cell</span>
<span class="sd">        returned by ASE ase.io.read() method. Test input is</span>
<span class="sd">        adapted from http://www.crystallography.net/cod/9012064.cif@120115</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">ase</span>

        <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w+&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">tmpf</span><span class="p">:</span>
            <span class="n">tmpf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">                data_9012064</span>
<span class="s1">                _space_group_IT_number           166</span>
<span class="s1">                _symmetry_space_group_name_H-M   &#39;R -3 m :H&#39;</span>
<span class="s1">                _cell_angle_alpha                90</span>
<span class="s1">                _cell_angle_beta                 90</span>
<span class="s1">                _cell_angle_gamma                120</span>
<span class="s1">                _cell_length_a                   4.395</span>
<span class="s1">                _cell_length_b                   4.395</span>
<span class="s1">                _cell_length_c                   30.440</span>
<span class="s1">                _cod_database_code               9012064</span>
<span class="s1">                loop_</span>
<span class="s1">                _atom_site_label</span>
<span class="s1">                _atom_site_fract_x</span>
<span class="s1">                _atom_site_fract_y</span>
<span class="s1">                _atom_site_fract_z</span>
<span class="s1">                _atom_site_U_iso_or_equiv</span>
<span class="s1">                Bi 0.00000 0.00000 0.40046 0.02330</span>
<span class="s1">                Te1 0.00000 0.00000 0.00000 0.01748</span>
<span class="s1">                Te2 0.00000 0.00000 0.79030 0.01912</span>
<span class="s1">            &#39;&#39;&#39;</span><span class="p">)</span>
            <span class="n">tmpf</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">CifData</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">tmpf</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="n">ase</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">get_structure</span><span class="p">(</span><span class="n">converter</span><span class="o">=</span><span class="s1">&#39;ase&#39;</span><span class="p">,</span> <span class="n">primitive_cell</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">get_ase</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">ase</span><span class="o">.</span><span class="n">get_number_of_atoms</span><span class="p">(),</span> <span class="mi">15</span><span class="p">)</span>

        <span class="n">ase</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">get_structure</span><span class="p">(</span><span class="n">converter</span><span class="o">=</span><span class="s1">&#39;ase&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get_ase</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">ase</span><span class="o">.</span><span class="n">get_number_of_atoms</span><span class="p">(),</span> <span class="mi">15</span><span class="p">)</span>

        <span class="n">ase</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">get_structure</span><span class="p">(</span><span class="n">converter</span><span class="o">=</span><span class="s1">&#39;ase&#39;</span><span class="p">,</span> <span class="n">primitive_cell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">subtrans_included</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">get_ase</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">ase</span><span class="o">.</span><span class="n">get_number_of_atoms</span><span class="p">(),</span> <span class="mi">5</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestCifData.test_ase_primitive_and_conventional_cells_pymatgen"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestCifData.test_ase_primitive_and_conventional_cells_pymatgen">[docs]</a>    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skipIf</span><span class="p">(</span><span class="ow">not</span> <span class="n">has_ase</span><span class="p">(),</span> <span class="s2">&quot;Unable to import ase&quot;</span><span class="p">)</span>
    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skipIf</span><span class="p">(</span><span class="ow">not</span> <span class="n">has_pycifrw</span><span class="p">(),</span> <span class="s2">&quot;Unable to import PyCifRW&quot;</span><span class="p">)</span>
    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skipIf</span><span class="p">(</span><span class="ow">not</span> <span class="n">has_pymatgen</span><span class="p">(),</span> <span class="s2">&quot;Unable to import pymatgen&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_ase_primitive_and_conventional_cells_pymatgen</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checking the number of atoms per primitive/conventional cell</span>
<span class="sd">        returned by ASE ase.io.read() method. Test input is</span>
<span class="sd">        adapted from http://www.crystallography.net/cod/9012064.cif@120115</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w+&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">tmpf</span><span class="p">:</span>
            <span class="n">tmpf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">data_9012064</span>
<span class="s1">_space_group_IT_number           166</span>
<span class="s1">_symmetry_space_group_name_H-M   &#39;R -3 m :H&#39;</span>
<span class="s1">_cell_angle_alpha                90</span>
<span class="s1">_cell_angle_beta                 90</span>
<span class="s1">_cell_angle_gamma                120</span>
<span class="s1">_cell_length_a                   4.395</span>
<span class="s1">_cell_length_b                   4.395</span>
<span class="s1">_cell_length_c                   30.440</span>
<span class="s1">_cod_database_code               9012064</span>
<span class="s1">loop_</span>
<span class="s1">_symmetry_equiv_pos_as_xyz</span>
<span class="s1">x,y,z</span>
<span class="s1">2/3+x,1/3+y,1/3+z</span>
<span class="s1">1/3+x,2/3+y,2/3+z</span>
<span class="s1">x,x-y,z</span>
<span class="s1">2/3+x,1/3+x-y,1/3+z</span>
<span class="s1">1/3+x,2/3+x-y,2/3+z</span>
<span class="s1">y,x,-z</span>
<span class="s1">2/3+y,1/3+x,1/3-z</span>
<span class="s1">1/3+y,2/3+x,2/3-z</span>
<span class="s1">-x+y,y,z</span>
<span class="s1">loop_</span>
<span class="s1">_atom_site_label</span>
<span class="s1">_atom_site_fract_x</span>
<span class="s1">_atom_site_fract_y</span>
<span class="s1">_atom_site_fract_z</span>
<span class="s1">_atom_site_U_iso_or_equiv</span>
<span class="s1">Bi 0.00000 0.00000 0.40046 0.02330</span>
<span class="s1">Te1 0.00000 0.00000 0.00000 0.01748</span>
<span class="s1">Te2 0.00000 0.00000 0.79030 0.01912</span>
<span class="s1">            &#39;&#39;&#39;</span><span class="p">)</span>
            <span class="n">tmpf</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">CifData</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">tmpf</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="n">ase</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">get_structure</span><span class="p">(</span><span class="n">converter</span><span class="o">=</span><span class="s1">&#39;pymatgen&#39;</span><span class="p">,</span> <span class="n">primitive_cell</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">get_ase</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">ase</span><span class="o">.</span><span class="n">get_number_of_atoms</span><span class="p">(),</span> <span class="mi">15</span><span class="p">)</span>

        <span class="n">ase</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">get_structure</span><span class="p">(</span><span class="n">converter</span><span class="o">=</span><span class="s1">&#39;pymatgen&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get_ase</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">ase</span><span class="o">.</span><span class="n">get_number_of_atoms</span><span class="p">(),</span> <span class="mi">15</span><span class="p">)</span>

        <span class="n">ase</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">get_structure</span><span class="p">(</span><span class="n">converter</span><span class="o">=</span><span class="s1">&#39;pymatgen&#39;</span><span class="p">,</span> <span class="n">primitive_cell</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">get_ase</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">ase</span><span class="o">.</span><span class="n">get_number_of_atoms</span><span class="p">(),</span> <span class="mi">5</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestCifData.test_pycifrw_from_datablocks"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestCifData.test_pycifrw_from_datablocks">[docs]</a>    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skipIf</span><span class="p">(</span><span class="ow">not</span> <span class="n">has_pycifrw</span><span class="p">(),</span> <span class="s2">&quot;Unable to import PyCifRW&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_pycifrw_from_datablocks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tests CifData.pycifrw_from_cif()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">aiida.orm.nodes.data.cif</span> <span class="k">import</span> <span class="n">pycifrw_from_cif</span>
        <span class="kn">import</span> <span class="nn">re</span>

        <span class="n">datablocks</span> <span class="o">=</span> <span class="p">[{</span>
            <span class="s1">&#39;_atom_site_label&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">],</span>
            <span class="s1">&#39;_atom_site_occupancy&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span>
            <span class="s1">&#39;_publ_section_title&#39;</span><span class="p">:</span> <span class="s1">&#39;Test CIF&#39;</span>
        <span class="p">}]</span>
        <span class="k">with</span> <span class="n">Capturing</span><span class="p">():</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">pycifrw_from_cif</span><span class="p">(</span><span class="n">datablocks</span><span class="p">)</span><span class="o">.</span><span class="n">WriteOut</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">non_comments</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;^#&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
                <span class="n">non_comments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span>
            <span class="n">simplify</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">non_comments</span><span class="p">)),</span>
            <span class="n">simplify</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">data_0</span>
<span class="s1">loop_</span>
<span class="s1">  _atom_site_label</span>
<span class="s1">   A</span>
<span class="s1">   B</span>
<span class="s1">   C</span>

<span class="s1">loop_</span>
<span class="s1">  _atom_site_occupancy</span>
<span class="s1">   1.0</span>
<span class="s1">   0.5</span>
<span class="s1">   0.5</span>

<span class="s1">_publ_section_title                     &#39;Test CIF&#39;</span>
<span class="s1">&#39;&#39;&#39;</span><span class="p">))</span>

        <span class="n">loops</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;_atom_site&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;_atom_site_label&#39;</span><span class="p">,</span> <span class="s1">&#39;_atom_site_occupancy&#39;</span><span class="p">]}</span>
        <span class="k">with</span> <span class="n">Capturing</span><span class="p">():</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">pycifrw_from_cif</span><span class="p">(</span><span class="n">datablocks</span><span class="p">,</span> <span class="n">loops</span><span class="p">)</span><span class="o">.</span><span class="n">WriteOut</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">non_comments</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;^#&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
                <span class="n">non_comments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span>
            <span class="n">simplify</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">non_comments</span><span class="p">)),</span>
            <span class="n">simplify</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">data_0</span>
<span class="s1">loop_</span>
<span class="s1">  _atom_site_label</span>
<span class="s1">  _atom_site_occupancy</span>
<span class="s1">   A  1.0</span>
<span class="s1">   B  0.5</span>
<span class="s1">   C  0.5</span>

<span class="s1">_publ_section_title                     &#39;Test CIF&#39;</span>
<span class="s1">&#39;&#39;&#39;</span><span class="p">))</span></div>

<div class="viewcode-block" id="TestCifData.test_pycifrw_syntax"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestCifData.test_pycifrw_syntax">[docs]</a>    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skipIf</span><span class="p">(</span><span class="ow">not</span> <span class="n">has_pycifrw</span><span class="p">(),</span> <span class="s2">&quot;Unable to import PyCifRW&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_pycifrw_syntax</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tests CifData.pycifrw_from_cif() - check syntax pb in PyCifRW 3.6</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">aiida.orm.nodes.data.cif</span> <span class="k">import</span> <span class="n">pycifrw_from_cif</span>
        <span class="kn">import</span> <span class="nn">re</span>

        <span class="n">datablocks</span> <span class="o">=</span> <span class="p">[{</span>
            <span class="s1">&#39;_tag&#39;</span><span class="p">:</span> <span class="s1">&#39;[value]&#39;</span><span class="p">,</span>
        <span class="p">}]</span>
        <span class="k">with</span> <span class="n">Capturing</span><span class="p">():</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">pycifrw_from_cif</span><span class="p">(</span><span class="n">datablocks</span><span class="p">)</span><span class="o">.</span><span class="n">WriteOut</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">non_comments</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;^#&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
                <span class="n">non_comments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span>
            <span class="n">simplify</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">non_comments</span><span class="p">)),</span> <span class="n">simplify</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">data_0</span>
<span class="s1">_tag                                    &#39;[value]&#39;</span>
<span class="s1">&#39;&#39;&#39;</span><span class="p">))</span></div>

<div class="viewcode-block" id="TestCifData.test_cif_with_long_line"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestCifData.test_cif_with_long_line">[docs]</a>    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skipIf</span><span class="p">(</span><span class="ow">not</span> <span class="n">has_pycifrw</span><span class="p">(),</span> <span class="s2">&quot;Unable to import PyCifRW&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_cif_with_long_line</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tests CifData - check that long lines (longer than 2048 characters)</span>
<span class="sd">        are supported.</span>
<span class="sd">        Should not raise any error.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w+&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">tmpf</span><span class="p">:</span>
            <span class="n">tmpf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">data_0</span>
<span class="s1">_tag   </span><span class="si">{}</span><span class="s1"></span>
<span class="s1"> &#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;a&#39;</span> <span class="o">*</span> <span class="mi">5000</span><span class="p">))</span>
            <span class="n">tmpf</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
            <span class="n">_</span> <span class="o">=</span> <span class="n">CifData</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">tmpf</span><span class="o">.</span><span class="n">name</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestCifData.test_cif_roundtrip"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestCifData.test_cif_roundtrip">[docs]</a>    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skipIf</span><span class="p">(</span><span class="ow">not</span> <span class="n">has_ase</span><span class="p">(),</span> <span class="s2">&quot;Unable to import ase&quot;</span><span class="p">)</span>
    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skipIf</span><span class="p">(</span><span class="ow">not</span> <span class="n">has_pycifrw</span><span class="p">(),</span> <span class="s2">&quot;Unable to import PyCifRW&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_cif_roundtrip</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w+&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">tmpf</span><span class="p">:</span>
            <span class="n">tmpf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">                data_test</span>
<span class="s1">                _cell_length_a    10</span>
<span class="s1">                _cell_length_b    10</span>
<span class="s1">                _cell_length_c    10</span>
<span class="s1">                _cell_angle_alpha 90</span>
<span class="s1">                _cell_angle_beta  90</span>
<span class="s1">                _cell_angle_gamma 90</span>
<span class="s1">                loop_</span>
<span class="s1">                _atom_site_label</span>
<span class="s1">                _atom_site_fract_x</span>
<span class="s1">                _atom_site_fract_y</span>
<span class="s1">                _atom_site_fract_z</span>
<span class="s1">                C 0 0 0</span>
<span class="s1">                O 0.5 0.5 0.5</span>
<span class="s1">                _cod_database_code 0000001</span>
<span class="s1">                _[local]_flags     &#39;&#39;</span>
<span class="s1">            &#39;&#39;&#39;</span><span class="p">)</span>
            <span class="n">tmpf</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">CifData</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">tmpf</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="n">b</span> <span class="o">=</span> <span class="n">CifData</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="n">a</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">CifData</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="n">b</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">_prepare_cif</span><span class="p">(),</span> <span class="n">c</span><span class="o">.</span><span class="n">_prepare_cif</span><span class="p">())</span>

        <span class="n">b</span> <span class="o">=</span> <span class="n">CifData</span><span class="p">(</span><span class="n">ase</span><span class="o">=</span><span class="n">a</span><span class="o">.</span><span class="n">ase</span><span class="p">)</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">CifData</span><span class="p">(</span><span class="n">ase</span><span class="o">=</span><span class="n">b</span><span class="o">.</span><span class="n">ase</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">_prepare_cif</span><span class="p">(),</span> <span class="n">c</span><span class="o">.</span><span class="n">_prepare_cif</span><span class="p">())</span></div>

<div class="viewcode-block" id="TestCifData.test_symop_string_from_symop_matrix_tr"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestCifData.test_symop_string_from_symop_matrix_tr">[docs]</a>    <span class="k">def</span> <span class="nf">test_symop_string_from_symop_matrix_tr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">aiida.tools.data.cif</span> <span class="k">import</span> <span class="n">symop_string_from_symop_matrix_tr</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">symop_string_from_symop_matrix_tr</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]),</span> <span class="s2">&quot;x,y,z&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">symop_string_from_symop_matrix_tr</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]),</span> <span class="s2">&quot;x,-y,y+z&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span>
            <span class="n">symop_string_from_symop_matrix_tr</span><span class="p">([[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]),</span> <span class="s2">&quot;-x+1,y-1,z&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestCifData.test_attached_hydrogens"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestCifData.test_attached_hydrogens">[docs]</a>    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skipIf</span><span class="p">(</span><span class="ow">not</span> <span class="n">has_ase</span><span class="p">(),</span> <span class="s2">&quot;Unable to import ase&quot;</span><span class="p">)</span>
    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skipIf</span><span class="p">(</span><span class="ow">not</span> <span class="n">has_pycifrw</span><span class="p">(),</span> <span class="s2">&quot;Unable to import PyCifRW&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_attached_hydrogens</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w+&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">tmpf</span><span class="p">:</span>
            <span class="n">tmpf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">                data_test</span>
<span class="s1">                _cell_length_a    10</span>
<span class="s1">                _cell_length_b    10</span>
<span class="s1">                _cell_length_c    10</span>
<span class="s1">                _cell_angle_alpha 90</span>
<span class="s1">                _cell_angle_beta  90</span>
<span class="s1">                _cell_angle_gamma 90</span>
<span class="s1">                loop_</span>
<span class="s1">                _atom_site_label</span>
<span class="s1">                _atom_site_fract_x</span>
<span class="s1">                _atom_site_fract_y</span>
<span class="s1">                _atom_site_fract_z</span>
<span class="s1">                _atom_site_attached_hydrogens</span>
<span class="s1">                C 0 0 0 ?</span>
<span class="s1">                O 0.5 0.5 0.5 .</span>
<span class="s1">                H 0.75 0.75 0.75 0</span>
<span class="s1">            &#39;&#39;&#39;</span><span class="p">)</span>
            <span class="n">tmpf</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">CifData</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">tmpf</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">has_attached_hydrogens</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w+&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">tmpf</span><span class="p">:</span>
            <span class="n">tmpf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">                data_test</span>
<span class="s1">                _cell_length_a    10</span>
<span class="s1">                _cell_length_b    10</span>
<span class="s1">                _cell_length_c    10</span>
<span class="s1">                _cell_angle_alpha 90</span>
<span class="s1">                _cell_angle_beta  90</span>
<span class="s1">                _cell_angle_gamma 90</span>
<span class="s1">                loop_</span>
<span class="s1">                _atom_site_label</span>
<span class="s1">                _atom_site_fract_x</span>
<span class="s1">                _atom_site_fract_y</span>
<span class="s1">                _atom_site_fract_z</span>
<span class="s1">                _atom_site_attached_hydrogens</span>
<span class="s1">                C 0 0 0 ?</span>
<span class="s1">                O 0.5 0.5 0.5 1</span>
<span class="s1">                H 0.75 0.75 0.75 0</span>
<span class="s1">            &#39;&#39;&#39;</span><span class="p">)</span>
            <span class="n">tmpf</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">CifData</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">tmpf</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">has_attached_hydrogens</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestCifData.test_refine"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestCifData.test_refine">[docs]</a>    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skipIf</span><span class="p">(</span><span class="ow">not</span> <span class="n">has_ase</span><span class="p">(),</span> <span class="s2">&quot;Unable to import ase&quot;</span><span class="p">)</span>
    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skipIf</span><span class="p">(</span><span class="ow">not</span> <span class="n">has_pycifrw</span><span class="p">(),</span> <span class="s2">&quot;Unable to import PyCifRW&quot;</span><span class="p">)</span>
    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skipIf</span><span class="p">(</span><span class="ow">not</span> <span class="n">has_spglib</span><span class="p">(),</span> <span class="s2">&quot;Unable to import spglib&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_refine</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test case for refinement (space group determination) for a</span>
<span class="sd">        CifData object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">aiida.tools.data.cif</span> <span class="k">import</span> <span class="n">refine_inline</span>

        <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w+&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">tmpf</span><span class="p">:</span>
            <span class="n">tmpf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">                data_test</span>
<span class="s1">                _cell_length_a    10</span>
<span class="s1">                _cell_length_b    10</span>
<span class="s1">                _cell_length_c    10</span>
<span class="s1">                _cell_angle_alpha 90</span>
<span class="s1">                _cell_angle_beta  90</span>
<span class="s1">                _cell_angle_gamma 90</span>
<span class="s1">                loop_</span>
<span class="s1">                _atom_site_label</span>
<span class="s1">                _atom_site_fract_x</span>
<span class="s1">                _atom_site_fract_y</span>
<span class="s1">                _atom_site_fract_z</span>
<span class="s1">                C 0.5 0.5 0.5</span>
<span class="s1">                O 0.25 0.5 0.5</span>
<span class="s1">                O 0.75 0.5 0.5</span>
<span class="s1">            &#39;&#39;&#39;</span><span class="p">)</span>
            <span class="n">tmpf</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">CifData</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">tmpf</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="n">ret_dict</span> <span class="o">=</span> <span class="n">refine_inline</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">ret_dict</span><span class="p">[</span><span class="s1">&#39;cif&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">][</span><span class="s1">&#39;_chemical_formula_sum&#39;</span><span class="p">],</span> <span class="s1">&#39;C O2&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">][</span><span class="s1">&#39;_symmetry_equiv_pos_as_xyz&#39;</span><span class="p">],</span> <span class="p">[</span>
            <span class="s1">&#39;x,y,z&#39;</span><span class="p">,</span> <span class="s1">&#39;-x,-y,-z&#39;</span><span class="p">,</span> <span class="s1">&#39;-y,x,z&#39;</span><span class="p">,</span> <span class="s1">&#39;y,-x,-z&#39;</span><span class="p">,</span> <span class="s1">&#39;-x,-y,z&#39;</span><span class="p">,</span> <span class="s1">&#39;x,y,-z&#39;</span><span class="p">,</span> <span class="s1">&#39;y,-x,z&#39;</span><span class="p">,</span> <span class="s1">&#39;-y,x,-z&#39;</span><span class="p">,</span> <span class="s1">&#39;x,-y,-z&#39;</span><span class="p">,</span> <span class="s1">&#39;-x,y,z&#39;</span><span class="p">,</span>
            <span class="s1">&#39;-y,-x,-z&#39;</span><span class="p">,</span> <span class="s1">&#39;y,x,z&#39;</span><span class="p">,</span> <span class="s1">&#39;-x,y,-z&#39;</span><span class="p">,</span> <span class="s1">&#39;x,-y,z&#39;</span><span class="p">,</span> <span class="s1">&#39;y,x,-z&#39;</span><span class="p">,</span> <span class="s1">&#39;-y,-x,z&#39;</span>
        <span class="p">])</span>

        <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w+&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">tmpf</span><span class="p">:</span>
            <span class="n">tmpf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">                data_a</span>
<span class="s1">                data_b</span>
<span class="s1">            &#39;&#39;&#39;</span><span class="p">)</span>
            <span class="n">tmpf</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">CifData</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">tmpf</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="n">ret_dict</span> <span class="o">=</span> <span class="n">refine_inline</span><span class="p">(</span><span class="n">c</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestCifData.test_parse_formula"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestCifData.test_parse_formula">[docs]</a>    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skipIf</span><span class="p">(</span><span class="ow">not</span> <span class="n">has_ase</span><span class="p">(),</span> <span class="s2">&quot;Unable to import ase&quot;</span><span class="p">)</span>
    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skipIf</span><span class="p">(</span><span class="ow">not</span> <span class="n">has_pycifrw</span><span class="p">(),</span> <span class="s2">&quot;Unable to import PyCifRW&quot;</span><span class="p">)</span>
    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skipIf</span><span class="p">(</span><span class="ow">not</span> <span class="n">has_spglib</span><span class="p">(),</span> <span class="s2">&quot;Unable to import spglib&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_parse_formula</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">aiida.orm.nodes.data.cif</span> <span class="k">import</span> <span class="n">parse_formula</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">parse_formula</span><span class="p">(</span><span class="s2">&quot;C H&quot;</span><span class="p">),</span> <span class="p">{</span><span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">parse_formula</span><span class="p">(</span><span class="s2">&quot;C5 H1&quot;</span><span class="p">),</span> <span class="p">{</span><span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">parse_formula</span><span class="p">(</span><span class="s2">&quot;Ca5 Ho&quot;</span><span class="p">),</span> <span class="p">{</span><span class="s1">&#39;Ca&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;Ho&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">parse_formula</span><span class="p">(</span><span class="s2">&quot;H0.5 O&quot;</span><span class="p">),</span> <span class="p">{</span><span class="s1">&#39;H&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">parse_formula</span><span class="p">(</span><span class="s2">&quot;C0 O0&quot;</span><span class="p">),</span> <span class="p">{</span><span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">parse_formula</span><span class="p">(</span><span class="s2">&quot;C1 H1 &quot;</span><span class="p">),</span> <span class="p">{</span><span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>  <span class="c1"># Trailing spaces should be accepted</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">parse_formula</span><span class="p">(</span><span class="s2">&quot; C1 H1&quot;</span><span class="p">),</span> <span class="p">{</span><span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>  <span class="c1"># Leading spaces should be accepted</span>

        <span class="c1"># Invalid literal for float()</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="n">parse_formula</span><span class="p">(</span><span class="s2">&quot;H0.5.2 O&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestCifData.test_scan_type"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestCifData.test_scan_type">[docs]</a>    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skipIf</span><span class="p">(</span><span class="ow">not</span> <span class="n">has_pycifrw</span><span class="p">(),</span> <span class="s2">&quot;Unable to import PyCifRW&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_scan_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check that different scan_types of PyCifRW produce the same result.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w+&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">tmpf</span><span class="p">:</span>
            <span class="n">tmpf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">valid_sample_cif_str</span><span class="p">)</span>
            <span class="n">tmpf</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

            <span class="n">default</span> <span class="o">=</span> <span class="n">CifData</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">tmpf</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">default2</span> <span class="o">=</span> <span class="n">CifData</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">tmpf</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">scan_type</span><span class="o">=</span><span class="s1">&#39;standard&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">default</span><span class="o">.</span><span class="n">_prepare_cif</span><span class="p">(),</span> <span class="n">default2</span><span class="o">.</span><span class="n">_prepare_cif</span><span class="p">())</span>

            <span class="n">flex</span> <span class="o">=</span> <span class="n">CifData</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">tmpf</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">scan_type</span><span class="o">=</span><span class="s1">&#39;flex&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">default</span><span class="o">.</span><span class="n">_prepare_cif</span><span class="p">(),</span> <span class="n">flex</span><span class="o">.</span><span class="n">_prepare_cif</span><span class="p">())</span></div>

<div class="viewcode-block" id="TestCifData.test_empty_cif"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestCifData.test_empty_cif">[docs]</a>    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skipIf</span><span class="p">(</span><span class="ow">not</span> <span class="n">has_pycifrw</span><span class="p">(),</span> <span class="s2">&quot;Unable to import PyCifRW&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_empty_cif</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test empty CifData</span>

<span class="sd">        Note: This test does not need PyCifRW.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w+&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">tmpf</span><span class="p">:</span>
            <span class="n">tmpf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">valid_sample_cif_str</span><span class="p">)</span>
            <span class="n">tmpf</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

            <span class="c1"># empty cifdata should be possible</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">CifData</span><span class="p">()</span>

            <span class="c1"># but it does not have a file</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">AttributeError</span><span class="p">):</span>
                <span class="n">a</span><span class="o">.</span><span class="n">filename</span>

            <span class="c1">#now it has</span>
            <span class="n">a</span><span class="o">.</span><span class="n">set_file</span><span class="p">(</span><span class="n">tmpf</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">a</span><span class="o">.</span><span class="n">filename</span>

            <span class="n">a</span><span class="o">.</span><span class="n">store</span><span class="p">()</span></div>

<div class="viewcode-block" id="TestCifData.test_parse_policy"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestCifData.test_parse_policy">[docs]</a>    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skipIf</span><span class="p">(</span><span class="ow">not</span> <span class="n">has_pycifrw</span><span class="p">(),</span> <span class="s2">&quot;Unable to import PyCifRW&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_parse_policy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test that loading of CIF file occurs as defined by parse_policy.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w+&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">tmpf</span><span class="p">:</span>
            <span class="n">tmpf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">valid_sample_cif_str</span><span class="p">)</span>
            <span class="n">tmpf</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

            <span class="c1"># this will parse the cif</span>
            <span class="n">eager</span> <span class="o">=</span> <span class="n">CifData</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">tmpf</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">parse_policy</span><span class="o">=</span><span class="s1">&#39;eager&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNot</span><span class="p">(</span><span class="n">eager</span><span class="o">.</span><span class="n">_values</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

            <span class="c1"># this should not parse the cif</span>
            <span class="n">lazy</span> <span class="o">=</span> <span class="n">CifData</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">tmpf</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">parse_policy</span><span class="o">=</span><span class="s1">&#39;lazy&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">lazy</span><span class="o">.</span><span class="n">_values</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

            <span class="c1"># also lazy-loaded nodes should be storable</span>
            <span class="n">lazy</span><span class="o">.</span><span class="n">store</span><span class="p">()</span>

            <span class="c1"># this should parse the cif</span>
            <span class="n">lazy</span><span class="o">.</span><span class="n">values</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNot</span><span class="p">(</span><span class="n">lazy</span><span class="o">.</span><span class="n">_values</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestCifData.test_set_file"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestCifData.test_set_file">[docs]</a>    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skipIf</span><span class="p">(</span><span class="ow">not</span> <span class="n">has_pycifrw</span><span class="p">(),</span> <span class="s2">&quot;Unable to import PyCifRW&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_set_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test that setting a new file clears formulae and spacegroups.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w+&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">tmpf</span><span class="p">:</span>
            <span class="n">tmpf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">valid_sample_cif_str</span><span class="p">)</span>
            <span class="n">tmpf</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

            <span class="n">a</span> <span class="o">=</span> <span class="n">CifData</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">tmpf</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">f1</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">get_formulae</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNot</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w+&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">tmpf</span><span class="p">:</span>
            <span class="n">tmpf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">valid_sample_cif_str_2</span><span class="p">)</span>
            <span class="n">tmpf</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

            <span class="c1"># this should reset formulae and spacegroup_numbers</span>
            <span class="n">a</span><span class="o">.</span><span class="n">set_file</span><span class="p">(</span><span class="n">tmpf</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;formulae&#39;</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;spacegroup_numbers&#39;</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>

            <span class="c1"># this should populate formulae</span>
            <span class="n">a</span><span class="o">.</span><span class="n">parse</span><span class="p">()</span>
            <span class="n">f2</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">get_formulae</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNot</span><span class="p">(</span><span class="n">f2</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

            <span class="c1"># empty cifdata should be possible</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">CifData</span><span class="p">()</span>
            <span class="c1"># but it does not have a file</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">AttributeError</span><span class="p">):</span>
                <span class="n">a</span><span class="o">.</span><span class="n">filename</span>
            <span class="c1"># now it has</span>
            <span class="n">a</span><span class="o">.</span><span class="n">set_file</span><span class="p">(</span><span class="n">tmpf</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">a</span><span class="o">.</span><span class="n">parse</span><span class="p">()</span>
            <span class="n">a</span><span class="o">.</span><span class="n">filename</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotEquals</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestCifData.test_has_partial_occupancies"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestCifData.test_has_partial_occupancies">[docs]</a>    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skipIf</span><span class="p">(</span><span class="ow">not</span> <span class="n">has_pycifrw</span><span class="p">(),</span> <span class="s2">&quot;Unable to import PyCifRW&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_has_partial_occupancies</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tests</span> <span class="o">=</span> <span class="p">[</span>
            <span class="c1"># Unreadable occupations should not count as a partial occupancy</span>
            <span class="p">(</span><span class="s1">&#39;O 0.5 0.5(1) 0.5 ?&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
            <span class="c1"># The default epsilon for deviation of unity for an occupation to be considered partial is 1E-6</span>
            <span class="p">(</span><span class="s1">&#39;O 0.5 0.5(1) 0.5 1.0(000000001)&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
            <span class="c1"># Partial occupancies should be able to deal with parentheses in the value</span>
            <span class="p">(</span><span class="s1">&#39;O 0.5 0.5(1) 0.5 1.0(000132)&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
            <span class="c1"># Partial occupancies should be able to deal with parentheses in the value</span>
            <span class="p">(</span><span class="s1">&#39;O 0.5 0.5(1) 0.5 0.9(0000132)&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
        <span class="p">]</span>

        <span class="k">for</span> <span class="n">test_string</span><span class="p">,</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">tests</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w+&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">handle</span><span class="p">:</span>
                <span class="n">handle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                    data_test</span>
<span class="s2">                    loop_</span>
<span class="s2">                    _atom_site_label</span>
<span class="s2">                    _atom_site_fract_x</span>
<span class="s2">                    _atom_site_fract_y</span>
<span class="s2">                    _atom_site_fract_z</span>
<span class="s2">                    _atom_site_occupancy</span>
<span class="s2">                    </span><span class="si">{}</span><span class="s2"></span>
<span class="s2">                &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">test_string</span><span class="p">))</span>
                <span class="n">handle</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
                <span class="n">cif</span> <span class="o">=</span> <span class="n">CifData</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">handle</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">cif</span><span class="o">.</span><span class="n">has_partial_occupancies</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestCifData.test_has_unknown_species"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestCifData.test_has_unknown_species">[docs]</a>    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skipIf</span><span class="p">(</span><span class="ow">not</span> <span class="n">has_pycifrw</span><span class="p">(),</span> <span class="s2">&quot;Unable to import PyCifRW&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_has_unknown_species</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tests</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="s1">&#39;H2 O&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>  <span class="c1"># No unknown species</span>
            <span class="p">(</span><span class="s1">&#39;OsAx&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>   <span class="c1"># Ax is an unknown specie</span>
            <span class="p">(</span><span class="s1">&#39;UX&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>     <span class="c1"># X counts as unknown specie despite being defined in aiida.common.constants.elements</span>
            <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>       <span class="c1"># If no chemical formula is defined, None should be returned</span>
        <span class="p">]</span>

        <span class="k">for</span> <span class="n">formula</span><span class="p">,</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">tests</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w+&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">handle</span><span class="p">:</span>
                <span class="n">formula_string</span> <span class="o">=</span> <span class="s2">&quot;_chemical_formula_sum &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">formula</span><span class="p">)</span> <span class="k">if</span> <span class="n">formula</span> <span class="k">else</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="n">handle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;data_test</span><span class="se">\n</span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">formula_string</span><span class="p">))</span>
                <span class="n">handle</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
                <span class="n">cif</span> <span class="o">=</span> <span class="n">CifData</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">handle</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">cif</span><span class="o">.</span><span class="n">has_unknown_species</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="n">formula_string</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestCifData.test_has_undefined_atomic_sites"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestCifData.test_has_undefined_atomic_sites">[docs]</a>    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skipIf</span><span class="p">(</span><span class="ow">not</span> <span class="n">has_pycifrw</span><span class="p">(),</span> <span class="s2">&quot;Unable to import PyCifRW&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_has_undefined_atomic_sites</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tests</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="s1">&#39;C 0.0 0.0 0.0&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>  <span class="c1"># Should return False because all sites have valid coordinates</span>
            <span class="p">(</span><span class="s1">&#39;C 0.0 0.0 ?&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>     <span class="c1"># Should return True because one site has an undefined coordinate</span>
            <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>                <span class="c1"># Should return True if no sites defined at all</span>
        <span class="p">]</span>

        <span class="k">for</span> <span class="n">test_string</span><span class="p">,</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">tests</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w+&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">handle</span><span class="p">:</span>
                <span class="n">base</span> <span class="o">=</span> <span class="s1">&#39;loop_</span><span class="se">\n</span><span class="s1">_atom_site_label</span><span class="se">\n</span><span class="s1">_atom_site_fract_x</span><span class="se">\n</span><span class="s1">_atom_site_fract_y</span><span class="se">\n</span><span class="s1">_atom_site_fract_z&#39;</span>
                <span class="n">atomic_site_string</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="se">\n</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">test_string</span><span class="p">)</span> <span class="k">if</span> <span class="n">test_string</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
                <span class="n">handle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;data_test</span><span class="se">\n</span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">atomic_site_string</span><span class="p">))</span>
                <span class="n">handle</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
                <span class="n">cif</span> <span class="o">=</span> <span class="n">CifData</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">handle</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">cif</span><span class="o">.</span><span class="n">has_undefined_atomic_sites</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="TestKindValidSymbols"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestKindValidSymbols">[docs]</a><span class="k">class</span> <span class="nc">TestKindValidSymbols</span><span class="p">(</span><span class="n">AiidaTestCase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Tests the symbol validation of the</span>
<span class="sd">    aiida.orm.nodes.data.structure.Kind class.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="TestKindValidSymbols.test_bad_symbol"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestKindValidSymbols.test_bad_symbol">[docs]</a>    <span class="k">def</span> <span class="nf">test_bad_symbol</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Should not accept a non-existing symbol.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="n">Kind</span><span class="p">(</span><span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Hxx&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestKindValidSymbols.test_empty_list_symbols"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestKindValidSymbols.test_empty_list_symbols">[docs]</a>    <span class="k">def</span> <span class="nf">test_empty_list_symbols</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Should not accept an empty list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="n">Kind</span><span class="p">(</span><span class="n">symbols</span><span class="o">=</span><span class="p">[])</span></div>

<div class="viewcode-block" id="TestKindValidSymbols.test_valid_list"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestKindValidSymbols.test_valid_list">[docs]</a>    <span class="k">def</span> <span class="nf">test_valid_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Should not raise any error.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Kind</span><span class="p">(</span><span class="n">symbols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;He&#39;</span><span class="p">],</span> <span class="n">weights</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestKindValidSymbols.test_unknown_symbol"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestKindValidSymbols.test_unknown_symbol">[docs]</a>    <span class="k">def</span> <span class="nf">test_unknown_symbol</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Should test if symbol X is valid and defined</span>
<span class="sd">        in the elements dictionary.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Kind</span><span class="p">(</span><span class="n">symbols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">])</span></div></div>


<div class="viewcode-block" id="TestSiteValidWeights"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestSiteValidWeights">[docs]</a><span class="k">class</span> <span class="nc">TestSiteValidWeights</span><span class="p">(</span><span class="n">AiidaTestCase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Tests valid weight lists.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="TestSiteValidWeights.test_isnot_list"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestSiteValidWeights.test_isnot_list">[docs]</a>    <span class="k">def</span> <span class="nf">test_isnot_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Should not accept a non-list, non-number weight</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="n">Kind</span><span class="p">(</span><span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Ba&#39;</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="s1">&#39;aaa&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestSiteValidWeights.test_empty_list_weights"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestSiteValidWeights.test_empty_list_weights">[docs]</a>    <span class="k">def</span> <span class="nf">test_empty_list_weights</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Should not accept an empty list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="n">Kind</span><span class="p">(</span><span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Ba&#39;</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="p">[])</span></div>

<div class="viewcode-block" id="TestSiteValidWeights.test_symbol_weight_mismatch"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestSiteValidWeights.test_symbol_weight_mismatch">[docs]</a>    <span class="k">def</span> <span class="nf">test_symbol_weight_mismatch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Should not accept a size mismatch of the symbols and weights</span>
<span class="sd">        list.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="n">Kind</span><span class="p">(</span><span class="n">symbols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Ba&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">],</span> <span class="n">weights</span><span class="o">=</span><span class="p">[</span><span class="mf">1.</span><span class="p">])</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="n">Kind</span><span class="p">(</span><span class="n">symbols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Ba&#39;</span><span class="p">],</span> <span class="n">weights</span><span class="o">=</span><span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestSiteValidWeights.test_negative_value"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestSiteValidWeights.test_negative_value">[docs]</a>    <span class="k">def</span> <span class="nf">test_negative_value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Should not accept a negative weight</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="n">Kind</span><span class="p">(</span><span class="n">symbols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Ba&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">],</span> <span class="n">weights</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestSiteValidWeights.test_sum_greater_one"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestSiteValidWeights.test_sum_greater_one">[docs]</a>    <span class="k">def</span> <span class="nf">test_sum_greater_one</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Should not accept a sum of weights larger than one</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="n">Kind</span><span class="p">(</span><span class="n">symbols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Ba&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">],</span> <span class="n">weights</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestSiteValidWeights.test_sum_one_weights"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestSiteValidWeights.test_sum_one_weights">[docs]</a>    <span class="k">def</span> <span class="nf">test_sum_one_weights</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Should accept a sum equal to one</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Kind</span><span class="p">(</span><span class="n">symbols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Ba&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">],</span> <span class="n">weights</span><span class="o">=</span><span class="p">[</span><span class="mf">1.</span> <span class="o">/</span> <span class="mf">3.</span><span class="p">,</span> <span class="mf">2.</span> <span class="o">/</span> <span class="mf">3.</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestSiteValidWeights.test_sum_less_one_weights"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestSiteValidWeights.test_sum_less_one_weights">[docs]</a>    <span class="k">def</span> <span class="nf">test_sum_less_one_weights</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Should accept a sum equal less than one</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Kind</span><span class="p">(</span><span class="n">symbols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Ba&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">],</span> <span class="n">weights</span><span class="o">=</span><span class="p">[</span><span class="mf">1.</span> <span class="o">/</span> <span class="mf">3.</span><span class="p">,</span> <span class="mf">1.</span> <span class="o">/</span> <span class="mf">3.</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestSiteValidWeights.test_none"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestSiteValidWeights.test_none">[docs]</a>    <span class="k">def</span> <span class="nf">test_none</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Should accept None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Kind</span><span class="p">(</span><span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Ba&#39;</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="TestKindTestGeneral"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestKindTestGeneral">[docs]</a><span class="k">class</span> <span class="nc">TestKindTestGeneral</span><span class="p">(</span><span class="n">AiidaTestCase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Tests the creation of Kind objects and their methods.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="TestKindTestGeneral.test_sum_one_general"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestKindTestGeneral.test_sum_one_general">[docs]</a>    <span class="k">def</span> <span class="nf">test_sum_one_general</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Should accept a sum equal to one</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">Kind</span><span class="p">(</span><span class="n">symbols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Ba&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">],</span> <span class="n">weights</span><span class="o">=</span><span class="p">[</span><span class="mf">1.</span> <span class="o">/</span> <span class="mf">3.</span><span class="p">,</span> <span class="mf">2.</span> <span class="o">/</span> <span class="mf">3.</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">is_alloy</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">has_vacancies</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestKindTestGeneral.test_sum_less_one_general"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestKindTestGeneral.test_sum_less_one_general">[docs]</a>    <span class="k">def</span> <span class="nf">test_sum_less_one_general</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Should accept a sum equal less than one</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">Kind</span><span class="p">(</span><span class="n">symbols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Ba&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">],</span> <span class="n">weights</span><span class="o">=</span><span class="p">[</span><span class="mf">1.</span> <span class="o">/</span> <span class="mf">3.</span><span class="p">,</span> <span class="mf">1.</span> <span class="o">/</span> <span class="mf">3.</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">is_alloy</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">has_vacancies</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestKindTestGeneral.test_no_position"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestKindTestGeneral.test_no_position">[docs]</a>    <span class="k">def</span> <span class="nf">test_no_position</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Should not accept a &#39;positions&#39; parameter</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="n">Kind</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="n">symbols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Ba&#39;</span><span class="p">],</span> <span class="n">weights</span><span class="o">=</span><span class="p">[</span><span class="mf">1.</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestKindTestGeneral.test_simple"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestKindTestGeneral.test_simple">[docs]</a>    <span class="k">def</span> <span class="nf">test_simple</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Should recognize a simple element.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">Kind</span><span class="p">(</span><span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Ba&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">is_alloy</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">has_vacancies</span><span class="p">)</span>

        <span class="n">b</span> <span class="o">=</span> <span class="n">Kind</span><span class="p">(</span><span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Ba&#39;</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">is_alloy</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">has_vacancies</span><span class="p">)</span>

        <span class="n">c</span> <span class="o">=</span> <span class="n">Kind</span><span class="p">(</span><span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Ba&#39;</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">is_alloy</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">has_vacancies</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestKindTestGeneral.test_automatic_name"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestKindTestGeneral.test_automatic_name">[docs]</a>    <span class="k">def</span> <span class="nf">test_automatic_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check the automatic name generator.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">Kind</span><span class="p">(</span><span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Ba&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;Ba&#39;</span><span class="p">)</span>

        <span class="n">a</span> <span class="o">=</span> <span class="n">Kind</span><span class="p">(</span><span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;X&#39;</span><span class="p">)</span>

        <span class="n">a</span> <span class="o">=</span> <span class="n">Kind</span><span class="p">(</span><span class="n">symbols</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;Si&#39;</span><span class="p">,</span> <span class="s1">&#39;Ge&#39;</span><span class="p">),</span> <span class="n">weights</span><span class="o">=</span><span class="p">(</span><span class="mf">1.</span> <span class="o">/</span> <span class="mf">3.</span><span class="p">,</span> <span class="mf">2.</span> <span class="o">/</span> <span class="mf">3.</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;GeSi&#39;</span><span class="p">)</span>

        <span class="n">a</span> <span class="o">=</span> <span class="n">Kind</span><span class="p">(</span><span class="n">symbols</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;Si&#39;</span><span class="p">,</span> <span class="s1">&#39;X&#39;</span><span class="p">),</span> <span class="n">weights</span><span class="o">=</span><span class="p">(</span><span class="mf">1.</span> <span class="o">/</span> <span class="mf">3.</span><span class="p">,</span> <span class="mf">2.</span> <span class="o">/</span> <span class="mf">3.</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;SiX&#39;</span><span class="p">)</span>

        <span class="n">a</span> <span class="o">=</span> <span class="n">Kind</span><span class="p">(</span><span class="n">symbols</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;Si&#39;</span><span class="p">,</span> <span class="s1">&#39;Ge&#39;</span><span class="p">),</span> <span class="n">weights</span><span class="o">=</span><span class="p">(</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;GeSiX&#39;</span><span class="p">)</span>

        <span class="n">a</span> <span class="o">=</span> <span class="n">Kind</span><span class="p">(</span><span class="n">symbols</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;Si&#39;</span><span class="p">,</span> <span class="s1">&#39;X&#39;</span><span class="p">),</span> <span class="n">weights</span><span class="o">=</span><span class="p">(</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;SiXX&#39;</span><span class="p">)</span>

        <span class="c1"># Manually setting the name of the species</span>
        <span class="n">a</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;newstring&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;newstring&#39;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="TestKindTestMasses"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestKindTestMasses">[docs]</a><span class="k">class</span> <span class="nc">TestKindTestMasses</span><span class="p">(</span><span class="n">AiidaTestCase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Tests the management of masses during the creation of Kind objects.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="TestKindTestMasses.test_auto_mass_one"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestKindTestMasses.test_auto_mass_one">[docs]</a>    <span class="k">def</span> <span class="nf">test_auto_mass_one</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        mass for elements with sum one</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">aiida.orm.nodes.data.structure</span> <span class="k">import</span> <span class="n">_atomic_masses</span>

        <span class="n">a</span> <span class="o">=</span> <span class="n">Kind</span><span class="p">(</span><span class="n">symbols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Ba&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">],</span> <span class="n">weights</span><span class="o">=</span><span class="p">[</span><span class="mf">1.</span> <span class="o">/</span> <span class="mf">3.</span><span class="p">,</span> <span class="mf">2.</span> <span class="o">/</span> <span class="mf">3.</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">mass</span><span class="p">,</span> <span class="p">(</span><span class="n">_atomic_masses</span><span class="p">[</span><span class="s1">&#39;Ba&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">_atomic_masses</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="mf">3.</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestKindTestMasses.test_sum_less_one_masses"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestKindTestMasses.test_sum_less_one_masses">[docs]</a>    <span class="k">def</span> <span class="nf">test_sum_less_one_masses</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        mass for elements with sum less than one</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">aiida.orm.nodes.data.structure</span> <span class="k">import</span> <span class="n">_atomic_masses</span>

        <span class="n">a</span> <span class="o">=</span> <span class="n">Kind</span><span class="p">(</span><span class="n">symbols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Ba&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">],</span> <span class="n">weights</span><span class="o">=</span><span class="p">[</span><span class="mf">1.</span> <span class="o">/</span> <span class="mf">3.</span><span class="p">,</span> <span class="mf">1.</span> <span class="o">/</span> <span class="mf">3.</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">mass</span><span class="p">,</span> <span class="p">(</span><span class="n">_atomic_masses</span><span class="p">[</span><span class="s1">&#39;Ba&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">_atomic_masses</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestKindTestMasses.test_sum_less_one_singleelem"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestKindTestMasses.test_sum_less_one_singleelem">[docs]</a>    <span class="k">def</span> <span class="nf">test_sum_less_one_singleelem</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        mass for a single element</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">aiida.orm.nodes.data.structure</span> <span class="k">import</span> <span class="n">_atomic_masses</span>

        <span class="n">a</span> <span class="o">=</span> <span class="n">Kind</span><span class="p">(</span><span class="n">symbols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Ba&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">mass</span><span class="p">,</span> <span class="n">_atomic_masses</span><span class="p">[</span><span class="s1">&#39;Ba&#39;</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestKindTestMasses.test_manual_mass"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestKindTestMasses.test_manual_mass">[docs]</a>    <span class="k">def</span> <span class="nf">test_manual_mass</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        mass set manually</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">Kind</span><span class="p">(</span><span class="n">symbols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Ba&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">],</span> <span class="n">weights</span><span class="o">=</span><span class="p">[</span><span class="mf">1.</span> <span class="o">/</span> <span class="mf">3.</span><span class="p">,</span> <span class="mf">1.</span> <span class="o">/</span> <span class="mf">3.</span><span class="p">],</span> <span class="n">mass</span><span class="o">=</span><span class="mf">1000.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">mass</span><span class="p">,</span> <span class="mf">1000.</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="TestStructureDataInit"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestStructureDataInit">[docs]</a><span class="k">class</span> <span class="nc">TestStructureDataInit</span><span class="p">(</span><span class="n">AiidaTestCase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Tests the creation of StructureData objects (cell and pbc).</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="TestStructureDataInit.test_cell_wrong_size_1"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestStructureDataInit.test_cell_wrong_size_1">[docs]</a>    <span class="k">def</span> <span class="nf">test_cell_wrong_size_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Wrong cell size (not 3x3)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="n">StructureData</span><span class="p">(</span><span class="n">cell</span><span class="o">=</span><span class="p">((</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">),))</span></div>

<div class="viewcode-block" id="TestStructureDataInit.test_cell_wrong_size_2"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestStructureDataInit.test_cell_wrong_size_2">[docs]</a>    <span class="k">def</span> <span class="nf">test_cell_wrong_size_2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Wrong cell size (not 3x3)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="n">StructureData</span><span class="p">(</span><span class="n">cell</span><span class="o">=</span><span class="p">((</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">)))</span></div>

<div class="viewcode-block" id="TestStructureDataInit.test_cell_zero_vector"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestStructureDataInit.test_cell_zero_vector">[docs]</a>    <span class="k">def</span> <span class="nf">test_cell_zero_vector</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Wrong cell (one vector has zero length)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="n">StructureData</span><span class="p">(</span><span class="n">cell</span><span class="o">=</span><span class="p">((</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">)))</span></div>

<div class="viewcode-block" id="TestStructureDataInit.test_cell_zero_volume"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestStructureDataInit.test_cell_zero_volume">[docs]</a>    <span class="k">def</span> <span class="nf">test_cell_zero_volume</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Wrong cell (volume is zero)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="n">StructureData</span><span class="p">(</span><span class="n">cell</span><span class="o">=</span><span class="p">((</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)))</span></div>

<div class="viewcode-block" id="TestStructureDataInit.test_cell_ok_init"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestStructureDataInit.test_cell_ok_init">[docs]</a>    <span class="k">def</span> <span class="nf">test_cell_ok_init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Correct cell</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cell</span> <span class="o">=</span> <span class="p">((</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">))</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">StructureData</span><span class="p">(</span><span class="n">cell</span><span class="o">=</span><span class="n">cell</span><span class="p">)</span>
        <span class="n">out_cell</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">cell</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">cell</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">out_cell</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestStructureDataInit.test_volume"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestStructureDataInit.test_volume">[docs]</a>    <span class="k">def</span> <span class="nf">test_volume</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check the volume calculation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">StructureData</span><span class="p">(</span><span class="n">cell</span><span class="o">=</span><span class="p">((</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">get_cell_volume</span><span class="p">(),</span> <span class="mf">6.</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestStructureDataInit.test_wrong_pbc_1"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestStructureDataInit.test_wrong_pbc_1">[docs]</a>    <span class="k">def</span> <span class="nf">test_wrong_pbc_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Wrong pbc parameter (not bool or iterable)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="n">cell</span> <span class="o">=</span> <span class="p">((</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">))</span>
            <span class="n">StructureData</span><span class="p">(</span><span class="n">cell</span><span class="o">=</span><span class="n">cell</span><span class="p">,</span> <span class="n">pbc</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestStructureDataInit.test_wrong_pbc_2"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestStructureDataInit.test_wrong_pbc_2">[docs]</a>    <span class="k">def</span> <span class="nf">test_wrong_pbc_2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Wrong pbc parameter (iterable but with wrong len)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="n">cell</span> <span class="o">=</span> <span class="p">((</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">))</span>
            <span class="n">StructureData</span><span class="p">(</span><span class="n">cell</span><span class="o">=</span><span class="n">cell</span><span class="p">,</span> <span class="n">pbc</span><span class="o">=</span><span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestStructureDataInit.test_wrong_pbc_3"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestStructureDataInit.test_wrong_pbc_3">[docs]</a>    <span class="k">def</span> <span class="nf">test_wrong_pbc_3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Wrong pbc parameter (iterable but with wrong len)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="n">cell</span> <span class="o">=</span> <span class="p">((</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">))</span>
            <span class="n">StructureData</span><span class="p">(</span><span class="n">cell</span><span class="o">=</span><span class="n">cell</span><span class="p">,</span> <span class="n">pbc</span><span class="o">=</span><span class="p">[])</span></div>

<div class="viewcode-block" id="TestStructureDataInit.test_ok_pbc_1"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestStructureDataInit.test_ok_pbc_1">[docs]</a>    <span class="k">def</span> <span class="nf">test_ok_pbc_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Single pbc value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cell</span> <span class="o">=</span> <span class="p">((</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">))</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">StructureData</span><span class="p">(</span><span class="n">cell</span><span class="o">=</span><span class="n">cell</span><span class="p">,</span> <span class="n">pbc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">pbc</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">([</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">]))</span>

        <span class="n">a</span> <span class="o">=</span> <span class="n">StructureData</span><span class="p">(</span><span class="n">cell</span><span class="o">=</span><span class="n">cell</span><span class="p">,</span> <span class="n">pbc</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">pbc</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">([</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">]))</span></div>

<div class="viewcode-block" id="TestStructureDataInit.test_ok_pbc_2"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestStructureDataInit.test_ok_pbc_2">[docs]</a>    <span class="k">def</span> <span class="nf">test_ok_pbc_2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        One-element list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cell</span> <span class="o">=</span> <span class="p">((</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">))</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">StructureData</span><span class="p">(</span><span class="n">cell</span><span class="o">=</span><span class="n">cell</span><span class="p">,</span> <span class="n">pbc</span><span class="o">=</span><span class="p">[</span><span class="kc">True</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">pbc</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">([</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">]))</span>

        <span class="n">a</span> <span class="o">=</span> <span class="n">StructureData</span><span class="p">(</span><span class="n">cell</span><span class="o">=</span><span class="n">cell</span><span class="p">,</span> <span class="n">pbc</span><span class="o">=</span><span class="p">[</span><span class="kc">False</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">pbc</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">([</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">]))</span></div>

<div class="viewcode-block" id="TestStructureDataInit.test_ok_pbc_3"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestStructureDataInit.test_ok_pbc_3">[docs]</a>    <span class="k">def</span> <span class="nf">test_ok_pbc_3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Three-element list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cell</span> <span class="o">=</span> <span class="p">((</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">))</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">StructureData</span><span class="p">(</span><span class="n">cell</span><span class="o">=</span><span class="n">cell</span><span class="p">,</span> <span class="n">pbc</span><span class="o">=</span><span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">pbc</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">([</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">]))</span></div></div>


<div class="viewcode-block" id="TestStructureData"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestStructureData">[docs]</a><span class="k">class</span> <span class="nc">TestStructureData</span><span class="p">(</span><span class="n">AiidaTestCase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Tests the creation of StructureData objects (cell and pbc).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">aiida.orm.nodes.data.structure</span> <span class="k">import</span> <span class="n">has_ase</span><span class="p">,</span> <span class="n">has_spglib</span>
    <span class="kn">from</span> <span class="nn">aiida.orm.nodes.data.cif</span> <span class="k">import</span> <span class="n">has_pycifrw</span>

<div class="viewcode-block" id="TestStructureData.test_cell_ok_and_atoms"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestStructureData.test_cell_ok_and_atoms">[docs]</a>    <span class="k">def</span> <span class="nf">test_cell_ok_and_atoms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test the creation of a cell and the appending of atoms</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cell</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">2.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">]]</span>

        <span class="n">a</span> <span class="o">=</span> <span class="n">StructureData</span><span class="p">(</span><span class="n">cell</span><span class="o">=</span><span class="n">cell</span><span class="p">)</span>
        <span class="n">out_cell</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">cell</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEquals</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">out_cell</span><span class="p">)</span>

        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Ba&#39;</span><span class="p">])</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Ti&#39;</span><span class="p">])</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">1.2</span><span class="p">,</span> <span class="mf">1.4</span><span class="p">,</span> <span class="mf">1.6</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Ti&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">is_alloy</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">has_vacancies</span><span class="p">)</span>
        <span class="c1"># There should be only two kinds! (two atoms of kind Ti should</span>
        <span class="c1"># belong to the same kind)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">kinds</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>

        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">],</span> <span class="n">weights</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">is_alloy</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">has_vacancies</span><span class="p">)</span>

        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;O&#39;</span><span class="p">],</span> <span class="n">weights</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">is_alloy</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">has_vacancies</span><span class="p">)</span>

        <span class="n">a</span><span class="o">.</span><span class="n">clear_kinds</span><span class="p">()</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;O&#39;</span><span class="p">],</span> <span class="n">weights</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">is_alloy</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">has_vacancies</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestStructureData.test_cell_ok_and_unknown_atoms"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestStructureData.test_cell_ok_and_unknown_atoms">[docs]</a>    <span class="k">def</span> <span class="nf">test_cell_ok_and_unknown_atoms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test the creation of a cell and the appending of atoms, including</span>
<span class="sd">        the unknown entry.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cell</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">2.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">]]</span>

        <span class="n">a</span> <span class="o">=</span> <span class="n">StructureData</span><span class="p">(</span><span class="n">cell</span><span class="o">=</span><span class="n">cell</span><span class="p">)</span>
        <span class="n">out_cell</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">cell</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEquals</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">out_cell</span><span class="p">)</span>

        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Ba&#39;</span><span class="p">])</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">])</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">1.2</span><span class="p">,</span> <span class="mf">1.4</span><span class="p">,</span> <span class="mf">1.6</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">is_alloy</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">has_vacancies</span><span class="p">)</span>
        <span class="c1"># There should be only two kinds! (two atoms of kind X should</span>
        <span class="c1"># belong to the same kind)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">kinds</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>

        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">],</span> <span class="n">weights</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">is_alloy</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">has_vacancies</span><span class="p">)</span>

        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;O&#39;</span><span class="p">],</span> <span class="n">weights</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">is_alloy</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">has_vacancies</span><span class="p">)</span>

        <span class="n">a</span><span class="o">.</span><span class="n">clear_kinds</span><span class="p">()</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">],</span> <span class="n">weights</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">is_alloy</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">has_vacancies</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestStructureData.test_kind_1"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestStructureData.test_kind_1">[docs]</a>    <span class="k">def</span> <span class="nf">test_kind_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test the management of kinds (automatic detection of kind of</span>
<span class="sd">        simple atoms).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">StructureData</span><span class="p">(</span><span class="n">cell</span><span class="o">=</span><span class="p">((</span><span class="mf">2.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">)))</span>

        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Ba&#39;</span><span class="p">])</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Ba&#39;</span><span class="p">])</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Ti&#39;</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">kinds</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># I should only have two types</span>
        <span class="c1"># I check for the default names of kinds</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">kinds</span><span class="p">),</span> <span class="nb">set</span><span class="p">((</span><span class="s1">&#39;Ba&#39;</span><span class="p">,</span> <span class="s1">&#39;Ti&#39;</span><span class="p">)))</span></div>

<div class="viewcode-block" id="TestStructureData.test_kind_1_unknown"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestStructureData.test_kind_1_unknown">[docs]</a>    <span class="k">def</span> <span class="nf">test_kind_1_unknown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test the management of kinds (automatic detection of kind of</span>
<span class="sd">        simple atoms), inluding the unknown entry.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">StructureData</span><span class="p">(</span><span class="n">cell</span><span class="o">=</span><span class="p">((</span><span class="mf">2.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">)))</span>

        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">])</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">])</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Ti&#39;</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">kinds</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># I should only have two types</span>
        <span class="c1"># I check for the default names of kinds</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">kinds</span><span class="p">),</span> <span class="nb">set</span><span class="p">((</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;Ti&#39;</span><span class="p">)))</span></div>

<div class="viewcode-block" id="TestStructureData.test_kind_2"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestStructureData.test_kind_2">[docs]</a>    <span class="k">def</span> <span class="nf">test_kind_2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test the management of kinds (manual specification of kind name).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">StructureData</span><span class="p">(</span><span class="n">cell</span><span class="o">=</span><span class="p">((</span><span class="mf">2.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">)))</span>

        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Ba&#39;</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Ba1&#39;</span><span class="p">)</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Ba&#39;</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Ba2&#39;</span><span class="p">)</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Ti&#39;</span><span class="p">])</span>

        <span class="n">kind_list</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">kinds</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">kind_list</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>  <span class="c1"># I should have now three kinds</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">kind_list</span><span class="p">),</span> <span class="nb">set</span><span class="p">((</span><span class="s1">&#39;Ba1&#39;</span><span class="p">,</span> <span class="s1">&#39;Ba2&#39;</span><span class="p">,</span> <span class="s1">&#39;Ti&#39;</span><span class="p">)))</span></div>

<div class="viewcode-block" id="TestStructureData.test_kind_2_unknown"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestStructureData.test_kind_2_unknown">[docs]</a>    <span class="k">def</span> <span class="nf">test_kind_2_unknown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test the management of kinds (manual specification of kind name),</span>
<span class="sd">        including the unknown entry.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">StructureData</span><span class="p">(</span><span class="n">cell</span><span class="o">=</span><span class="p">((</span><span class="mf">2.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">)))</span>

        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;X1&#39;</span><span class="p">)</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;X2&#39;</span><span class="p">)</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Ti&#39;</span><span class="p">])</span>

        <span class="n">kind_list</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">kinds</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">kind_list</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>  <span class="c1"># I should have now three kinds</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">kind_list</span><span class="p">),</span> <span class="nb">set</span><span class="p">((</span><span class="s1">&#39;X1&#39;</span><span class="p">,</span> <span class="s1">&#39;X2&#39;</span><span class="p">,</span> <span class="s1">&#39;Ti&#39;</span><span class="p">)))</span></div>

<div class="viewcode-block" id="TestStructureData.test_kind_3"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestStructureData.test_kind_3">[docs]</a>    <span class="k">def</span> <span class="nf">test_kind_3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test the management of kinds (adding an atom with different mass).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">StructureData</span><span class="p">(</span><span class="n">cell</span><span class="o">=</span><span class="p">((</span><span class="mf">2.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">)))</span>

        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Ba&#39;</span><span class="p">],</span> <span class="n">mass</span><span class="o">=</span><span class="mf">100.</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="c1"># Shouldn&#39;t allow, I am adding two sites with the same name &#39;Ba&#39;</span>
            <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Ba&#39;</span><span class="p">],</span> <span class="n">mass</span><span class="o">=</span><span class="mf">101.</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Ba&#39;</span><span class="p">)</span>

            <span class="c1"># now it should work because I am using a different kind name</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Ba&#39;</span><span class="p">],</span> <span class="n">mass</span><span class="o">=</span><span class="mf">101.</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Ba2&#39;</span><span class="p">)</span>

        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Ti&#39;</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">kinds</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>  <span class="c1"># I should have now three types</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">sites</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>  <span class="c1"># and 3 sites</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">kinds</span><span class="p">),</span> <span class="nb">set</span><span class="p">((</span><span class="s1">&#39;Ba&#39;</span><span class="p">,</span> <span class="s1">&#39;Ba2&#39;</span><span class="p">,</span> <span class="s1">&#39;Ti&#39;</span><span class="p">)))</span></div>

<div class="viewcode-block" id="TestStructureData.test_kind_3_unknown"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestStructureData.test_kind_3_unknown">[docs]</a>    <span class="k">def</span> <span class="nf">test_kind_3_unknown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test the management of kinds (adding an atom with different mass),</span>
<span class="sd">        including the unknown entry.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">StructureData</span><span class="p">(</span><span class="n">cell</span><span class="o">=</span><span class="p">((</span><span class="mf">2.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">)))</span>

        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">],</span> <span class="n">mass</span><span class="o">=</span><span class="mf">100.</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="c1"># Shouldn&#39;t allow, I am adding two sites with the same name &#39;Ba&#39;</span>
            <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">],</span> <span class="n">mass</span><span class="o">=</span><span class="mf">101.</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">)</span>

            <span class="c1"># now it should work because I am using a different kind name</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">],</span> <span class="n">mass</span><span class="o">=</span><span class="mf">101.</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;X2&#39;</span><span class="p">)</span>

        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Ti&#39;</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">kinds</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>  <span class="c1"># I should have now three types</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">sites</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>  <span class="c1"># and 3 sites</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">kinds</span><span class="p">),</span> <span class="nb">set</span><span class="p">((</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;X2&#39;</span><span class="p">,</span> <span class="s1">&#39;Ti&#39;</span><span class="p">)))</span></div>

<div class="viewcode-block" id="TestStructureData.test_kind_4"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestStructureData.test_kind_4">[docs]</a>    <span class="k">def</span> <span class="nf">test_kind_4</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test the management of kind (adding an atom with different symbols</span>
<span class="sd">        or weights).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">StructureData</span><span class="p">(</span><span class="n">cell</span><span class="o">=</span><span class="p">((</span><span class="mf">2.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">)))</span>

        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Ba&#39;</span><span class="p">,</span> <span class="s1">&#39;Ti&#39;</span><span class="p">],</span> <span class="n">weights</span><span class="o">=</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;mytype&#39;</span><span class="p">)</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="c1"># Shouldn&#39;t allow, different weights</span>
            <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Ba&#39;</span><span class="p">,</span> <span class="s1">&#39;Ti&#39;</span><span class="p">],</span> <span class="n">weights</span><span class="o">=</span><span class="p">(</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;mytype&#39;</span><span class="p">)</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="c1"># Shouldn&#39;t allow, different weights (with vacancy)</span>
            <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Ba&#39;</span><span class="p">,</span> <span class="s1">&#39;Ti&#39;</span><span class="p">],</span> <span class="n">weights</span><span class="o">=</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;mytype&#39;</span><span class="p">)</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="c1"># Shouldn&#39;t allow, different symbols list</span>
            <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Ba&#39;</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;mytype&#39;</span><span class="p">)</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="c1"># Shouldn&#39;t allow, different symbols list</span>
            <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Si&#39;</span><span class="p">,</span> <span class="s1">&#39;Ti&#39;</span><span class="p">],</span> <span class="n">weights</span><span class="o">=</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;mytype&#39;</span><span class="p">)</span>

            <span class="c1"># should allow because every property is identical</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Ba&#39;</span><span class="p">,</span> <span class="s1">&#39;Ti&#39;</span><span class="p">],</span> <span class="n">weights</span><span class="o">=</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;mytype&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">kinds</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestStructureData.test_kind_4_unknown"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestStructureData.test_kind_4_unknown">[docs]</a>    <span class="k">def</span> <span class="nf">test_kind_4_unknown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test the management of kind (adding an atom with different symbols</span>
<span class="sd">        or weights), including the unknown entry.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">StructureData</span><span class="p">(</span><span class="n">cell</span><span class="o">=</span><span class="p">((</span><span class="mf">2.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">)))</span>

        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;Ti&#39;</span><span class="p">],</span> <span class="n">weights</span><span class="o">=</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;mytype&#39;</span><span class="p">)</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="c1"># Shouldn&#39;t allow, different weights</span>
            <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;Ti&#39;</span><span class="p">],</span> <span class="n">weights</span><span class="o">=</span><span class="p">(</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;mytype&#39;</span><span class="p">)</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="c1"># Shouldn&#39;t allow, different weights (with vacancy)</span>
            <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;Ti&#39;</span><span class="p">],</span> <span class="n">weights</span><span class="o">=</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;mytype&#39;</span><span class="p">)</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="c1"># Shouldn&#39;t allow, different symbols list</span>
            <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;mytype&#39;</span><span class="p">)</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="c1"># Shouldn&#39;t allow, different symbols list</span>
            <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Si&#39;</span><span class="p">,</span> <span class="s1">&#39;Ti&#39;</span><span class="p">],</span> <span class="n">weights</span><span class="o">=</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;mytype&#39;</span><span class="p">)</span>

            <span class="c1"># should allow because every property is identical</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;Ti&#39;</span><span class="p">],</span> <span class="n">weights</span><span class="o">=</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;mytype&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">kinds</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestStructureData.test_kind_5"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestStructureData.test_kind_5">[docs]</a>    <span class="k">def</span> <span class="nf">test_kind_5</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test the management of kinds (automatic creation of new kind</span>
<span class="sd">        if name is not specified and properties are different).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">StructureData</span><span class="p">(</span><span class="n">cell</span><span class="o">=</span><span class="p">((</span><span class="mf">2.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">)))</span>

        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Ba&#39;</span><span class="p">,</span> <span class="n">mass</span><span class="o">=</span><span class="mf">100.</span><span class="p">)</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Ti&#39;</span><span class="p">)</span>
        <span class="c1"># The name does not exist</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Ti&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Ti2&#39;</span><span class="p">)</span>
        <span class="c1"># The name already exists, but the properties are identical =&gt; OK</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Ti&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Ti2&#39;</span><span class="p">)</span>
        <span class="c1"># The name already exists, but the properties are different!</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Ti&#39;</span><span class="p">,</span> <span class="n">mass</span><span class="o">=</span><span class="mf">100.</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Ti2&#39;</span><span class="p">)</span>
        <span class="c1"># Should not complain, should create a new type</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Ba&#39;</span><span class="p">,</span> <span class="n">mass</span><span class="o">=</span><span class="mf">150.</span><span class="p">)</span>

        <span class="c1"># There should be 4 kinds, the automatic name for the last one</span>
        <span class="c1"># should be Ba1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">([</span><span class="n">k</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">kinds</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;Ba&#39;</span><span class="p">,</span> <span class="s1">&#39;Ti&#39;</span><span class="p">,</span> <span class="s1">&#39;Ti2&#39;</span><span class="p">,</span> <span class="s1">&#39;Ba1&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">sites</span><span class="p">),</span> <span class="mi">5</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestStructureData.test_kind_5_unknown"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestStructureData.test_kind_5_unknown">[docs]</a>    <span class="k">def</span> <span class="nf">test_kind_5_unknown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test the management of kinds (automatic creation of new kind</span>
<span class="sd">        if name is not specified and properties are different), including</span>
<span class="sd">        the unknown entry.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">StructureData</span><span class="p">(</span><span class="n">cell</span><span class="o">=</span><span class="p">((</span><span class="mf">2.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">)))</span>

        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="n">mass</span><span class="o">=</span><span class="mf">100.</span><span class="p">)</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Ti&#39;</span><span class="p">)</span>
        <span class="c1"># The name does not exist</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Ti&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Ti2&#39;</span><span class="p">)</span>
        <span class="c1"># The name already exists, but the properties are identical =&gt; OK</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Ti&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Ti2&#39;</span><span class="p">)</span>
        <span class="c1"># The name already exists, but the properties are different!</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Ti&#39;</span><span class="p">,</span> <span class="n">mass</span><span class="o">=</span><span class="mf">100.</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Ti2&#39;</span><span class="p">)</span>
        <span class="c1"># Should not complain, should create a new type</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="n">mass</span><span class="o">=</span><span class="mf">150.</span><span class="p">)</span>

        <span class="c1"># There should be 4 kinds, the automatic name for the last one</span>
        <span class="c1"># should be Ba1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">([</span><span class="n">k</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">kinds</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;Ti&#39;</span><span class="p">,</span> <span class="s1">&#39;Ti2&#39;</span><span class="p">,</span> <span class="s1">&#39;X1&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">sites</span><span class="p">),</span> <span class="mi">5</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestStructureData.test_kind_5_bis"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestStructureData.test_kind_5_bis">[docs]</a>    <span class="k">def</span> <span class="nf">test_kind_5_bis</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test the management of kinds (automatic creation of new kind</span>
<span class="sd">        if name is not specified and properties are different).</span>
<span class="sd">        This test was failing in, e.g., commit f6a8f4b.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">aiida.common.constants</span> <span class="k">import</span> <span class="n">elements</span>

        <span class="n">s</span> <span class="o">=</span> <span class="n">StructureData</span><span class="p">(</span><span class="n">cell</span><span class="o">=</span><span class="p">((</span><span class="mf">6.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">6.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">6.</span><span class="p">)))</span>

        <span class="n">s</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Fe&#39;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">mass</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        <span class="n">s</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Fe&#39;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">mass</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        <span class="n">s</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Fe&#39;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">mass</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        <span class="n">s</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Fe&#39;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">s</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Fe&#39;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

        <span class="c1"># I expect only two species, the first one with name &#39;Fe&#39;, mass 12,</span>
        <span class="c1"># and referencing the first three atoms; the second with name</span>
        <span class="c1"># &#39;Fe1&#39;, mass = elements[26][&#39;mass&#39;], and referencing the last two atoms</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">set</span><span class="p">([(</span><span class="n">k</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">k</span><span class="o">.</span><span class="n">mass</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">kinds</span><span class="p">]),</span> <span class="nb">set</span><span class="p">([(</span><span class="s1">&#39;Fe&#39;</span><span class="p">,</span> <span class="mf">12.0</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;Fe1&#39;</span><span class="p">,</span> <span class="n">elements</span><span class="p">[</span><span class="mi">26</span><span class="p">][</span><span class="s1">&#39;mass&#39;</span><span class="p">])]))</span>

        <span class="n">kind_of_each_site</span> <span class="o">=</span> <span class="p">[</span><span class="n">site</span><span class="o">.</span><span class="n">kind_name</span> <span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">sites</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">kind_of_each_site</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Fe&#39;</span><span class="p">,</span> <span class="s1">&#39;Fe&#39;</span><span class="p">,</span> <span class="s1">&#39;Fe&#39;</span><span class="p">,</span> <span class="s1">&#39;Fe1&#39;</span><span class="p">,</span> <span class="s1">&#39;Fe1&#39;</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestStructureData.test_kind_5_bis_unknown"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestStructureData.test_kind_5_bis_unknown">[docs]</a>    <span class="k">def</span> <span class="nf">test_kind_5_bis_unknown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test the management of kinds (automatic creation of new kind</span>
<span class="sd">        if name is not specified and properties are different).</span>
<span class="sd">        This test was failing in, e.g., commit f6a8f4b. This also includes</span>
<span class="sd">        the unknown entry.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">aiida.common.constants</span> <span class="k">import</span> <span class="n">elements</span>

        <span class="n">s</span> <span class="o">=</span> <span class="n">StructureData</span><span class="p">(</span><span class="n">cell</span><span class="o">=</span><span class="p">((</span><span class="mf">6.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">6.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">6.</span><span class="p">)))</span>

        <span class="n">s</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">mass</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        <span class="n">s</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">mass</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        <span class="n">s</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">mass</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        <span class="n">s</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">s</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

        <span class="c1"># I expect only two species, the first one with name &#39;X&#39;, mass 12,</span>
        <span class="c1"># and referencing the first three atoms; the second with name</span>
        <span class="c1"># &#39;X&#39;, mass = elements[0][&#39;mass&#39;], and referencing the last two atoms</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">set</span><span class="p">([(</span><span class="n">k</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">k</span><span class="o">.</span><span class="n">mass</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">kinds</span><span class="p">]),</span> <span class="nb">set</span><span class="p">([(</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="mf">12.0</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;X1&#39;</span><span class="p">,</span> <span class="n">elements</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;mass&#39;</span><span class="p">])]))</span>

        <span class="n">kind_of_each_site</span> <span class="o">=</span> <span class="p">[</span><span class="n">site</span><span class="o">.</span><span class="n">kind_name</span> <span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">sites</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">kind_of_each_site</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;X1&#39;</span><span class="p">,</span> <span class="s1">&#39;X1&#39;</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestStructureData.test_kind_5_bis_ase"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestStructureData.test_kind_5_bis_ase">[docs]</a>    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skipIf</span><span class="p">(</span><span class="ow">not</span> <span class="n">has_ase</span><span class="p">(),</span> <span class="s2">&quot;Unable to import ase&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_kind_5_bis_ase</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Same test as test_kind_5_bis, but using ase</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">ase</span>

        <span class="n">asecell</span> <span class="o">=</span> <span class="n">ase</span><span class="o">.</span><span class="n">Atoms</span><span class="p">(</span><span class="s1">&#39;Fe5&#39;</span><span class="p">,</span> <span class="n">cell</span><span class="o">=</span><span class="p">((</span><span class="mf">6.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">6.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">6.</span><span class="p">)))</span>
        <span class="n">asecell</span><span class="o">.</span><span class="n">set_positions</span><span class="p">([</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">])</span>

        <span class="n">asecell</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">mass</span> <span class="o">=</span> <span class="mf">12.</span>
        <span class="n">asecell</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">mass</span> <span class="o">=</span> <span class="mf">12.</span>
        <span class="n">asecell</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">mass</span> <span class="o">=</span> <span class="mf">12.</span>

        <span class="n">s</span> <span class="o">=</span> <span class="n">StructureData</span><span class="p">(</span><span class="n">ase</span><span class="o">=</span><span class="n">asecell</span><span class="p">)</span>

        <span class="c1"># I expect only two species, the first one with name &#39;Fe&#39;, mass 12,</span>
        <span class="c1"># and referencing the first three atoms; the second with name</span>
        <span class="c1"># &#39;Fe1&#39;, mass = elements[26][&#39;mass&#39;], and referencing the last two atoms</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">set</span><span class="p">([(</span><span class="n">k</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">k</span><span class="o">.</span><span class="n">mass</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">kinds</span><span class="p">]),</span> <span class="nb">set</span><span class="p">([(</span><span class="s1">&#39;Fe&#39;</span><span class="p">,</span> <span class="mf">12.0</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;Fe1&#39;</span><span class="p">,</span> <span class="n">asecell</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">mass</span><span class="p">)]))</span>

        <span class="n">kind_of_each_site</span> <span class="o">=</span> <span class="p">[</span><span class="n">site</span><span class="o">.</span><span class="n">kind_name</span> <span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">sites</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">kind_of_each_site</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Fe&#39;</span><span class="p">,</span> <span class="s1">&#39;Fe&#39;</span><span class="p">,</span> <span class="s1">&#39;Fe&#39;</span><span class="p">,</span> <span class="s1">&#39;Fe1&#39;</span><span class="p">,</span> <span class="s1">&#39;Fe1&#39;</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestStructureData.test_kind_5_bis_ase_unknown"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestStructureData.test_kind_5_bis_ase_unknown">[docs]</a>    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skipIf</span><span class="p">(</span><span class="ow">not</span> <span class="n">has_ase</span><span class="p">(),</span> <span class="s2">&quot;Unable to import ase&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_kind_5_bis_ase_unknown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Same test as test_kind_5_bis_unknown, but using ase</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">ase</span>

        <span class="n">asecell</span> <span class="o">=</span> <span class="n">ase</span><span class="o">.</span><span class="n">Atoms</span><span class="p">(</span><span class="s1">&#39;X5&#39;</span><span class="p">,</span> <span class="n">cell</span><span class="o">=</span><span class="p">((</span><span class="mf">6.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">6.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">6.</span><span class="p">)))</span>
        <span class="n">asecell</span><span class="o">.</span><span class="n">set_positions</span><span class="p">([</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">])</span>

        <span class="n">asecell</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">mass</span> <span class="o">=</span> <span class="mf">12.</span>
        <span class="n">asecell</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">mass</span> <span class="o">=</span> <span class="mf">12.</span>
        <span class="n">asecell</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">mass</span> <span class="o">=</span> <span class="mf">12.</span>

        <span class="n">s</span> <span class="o">=</span> <span class="n">StructureData</span><span class="p">(</span><span class="n">ase</span><span class="o">=</span><span class="n">asecell</span><span class="p">)</span>

        <span class="c1"># I expect only two species, the first one with name &#39;X&#39;, mass 12,</span>
        <span class="c1"># and referencing the first three atoms; the second with name</span>
        <span class="c1"># &#39;X1&#39;, mass = elements[26][&#39;mass&#39;], and referencing the last two atoms</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">set</span><span class="p">([(</span><span class="n">k</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">k</span><span class="o">.</span><span class="n">mass</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">kinds</span><span class="p">]),</span> <span class="nb">set</span><span class="p">([(</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="mf">12.0</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;X1&#39;</span><span class="p">,</span> <span class="n">asecell</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">mass</span><span class="p">)]))</span>

        <span class="n">kind_of_each_site</span> <span class="o">=</span> <span class="p">[</span><span class="n">site</span><span class="o">.</span><span class="n">kind_name</span> <span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">sites</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">kind_of_each_site</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;X1&#39;</span><span class="p">,</span> <span class="s1">&#39;X1&#39;</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestStructureData.test_kind_6"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestStructureData.test_kind_6">[docs]</a>    <span class="k">def</span> <span class="nf">test_kind_6</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test the returning of kinds from the string name (most of the code</span>
<span class="sd">        copied from :py:meth:`.test_kind_5`).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">StructureData</span><span class="p">(</span><span class="n">cell</span><span class="o">=</span><span class="p">((</span><span class="mf">2.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">)))</span>

        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Ba&#39;</span><span class="p">,</span> <span class="n">mass</span><span class="o">=</span><span class="mf">100.</span><span class="p">)</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Ti&#39;</span><span class="p">)</span>
        <span class="c1"># The name does not exist</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Ti&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Ti2&#39;</span><span class="p">)</span>
        <span class="c1"># The name already exists, but the properties are identical =&gt; OK</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Ti&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Ti2&#39;</span><span class="p">)</span>
        <span class="c1"># Should not complain, should create a new type</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Ba&#39;</span><span class="p">,</span> <span class="n">mass</span><span class="o">=</span><span class="mf">150.</span><span class="p">)</span>
        <span class="c1"># There should be 4 kinds, the automatic name for the last one</span>
        <span class="c1"># should be Ba1 (same check of test_kind_5</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">([</span><span class="n">k</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">kinds</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;Ba&#39;</span><span class="p">,</span> <span class="s1">&#39;Ti&#39;</span><span class="p">,</span> <span class="s1">&#39;Ti2&#39;</span><span class="p">,</span> <span class="s1">&#39;Ba1&#39;</span><span class="p">])</span>
        <span class="c1">#############################</span>
        <span class="c1"># Here I start the real tests</span>
        <span class="c1"># No such kind</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="n">a</span><span class="o">.</span><span class="n">get_kind</span><span class="p">(</span><span class="s1">&#39;Ti3&#39;</span><span class="p">)</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">get_kind</span><span class="p">(</span><span class="s1">&#39;Ba1&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">symbols</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;Ba&#39;</span><span class="p">,))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">mass</span><span class="p">,</span> <span class="mf">150.</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestStructureData.test_kind_6_unknown"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestStructureData.test_kind_6_unknown">[docs]</a>    <span class="k">def</span> <span class="nf">test_kind_6_unknown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test the returning of kinds from the string name (most of the code</span>
<span class="sd">        copied from :py:meth:`.test_kind_5`), including the unknown entry.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">StructureData</span><span class="p">(</span><span class="n">cell</span><span class="o">=</span><span class="p">((</span><span class="mf">2.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">)))</span>

        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="n">mass</span><span class="o">=</span><span class="mf">100.</span><span class="p">)</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Ti&#39;</span><span class="p">)</span>
        <span class="c1"># The name does not exist</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Ti&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Ti2&#39;</span><span class="p">)</span>
        <span class="c1"># The name already exists, but the properties are identical =&gt; OK</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Ti&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Ti2&#39;</span><span class="p">)</span>
        <span class="c1"># Should not complain, should create a new type</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="n">mass</span><span class="o">=</span><span class="mf">150.</span><span class="p">)</span>
        <span class="c1"># There should be 4 kinds, the automatic name for the last one</span>
        <span class="c1"># should be Ba1 (same check of test_kind_5</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">([</span><span class="n">k</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">kinds</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;Ti&#39;</span><span class="p">,</span> <span class="s1">&#39;Ti2&#39;</span><span class="p">,</span> <span class="s1">&#39;X1&#39;</span><span class="p">])</span>
        <span class="c1">#############################</span>
        <span class="c1"># Here I start the real tests</span>
        <span class="c1"># No such kind</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="n">a</span><span class="o">.</span><span class="n">get_kind</span><span class="p">(</span><span class="s1">&#39;Ti3&#39;</span><span class="p">)</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">get_kind</span><span class="p">(</span><span class="s1">&#39;X1&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">symbols</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">,))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">mass</span><span class="p">,</span> <span class="mf">150.</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestStructureData.test_kind_7"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestStructureData.test_kind_7">[docs]</a>    <span class="k">def</span> <span class="nf">test_kind_7</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test the functions returning the list of kinds, symbols, ...</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">StructureData</span><span class="p">(</span><span class="n">cell</span><span class="o">=</span><span class="p">((</span><span class="mf">2.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">)))</span>

        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Ba&#39;</span><span class="p">,</span> <span class="n">mass</span><span class="o">=</span><span class="mf">100.</span><span class="p">)</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Ti&#39;</span><span class="p">)</span>
        <span class="c1"># The name does not exist</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Ti&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Ti2&#39;</span><span class="p">)</span>
        <span class="c1"># The name already exists, but the properties are identical =&gt; OK</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">],</span> <span class="n">weights</span><span class="o">=</span><span class="p">[</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">],</span> <span class="n">mass</span><span class="o">=</span><span class="mf">15.</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">get_symbols_set</span><span class="p">(),</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;Ba&#39;</span><span class="p">,</span> <span class="s1">&#39;Ti&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">]))</span></div>

<div class="viewcode-block" id="TestStructureData.test_kind_7_unknown"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestStructureData.test_kind_7_unknown">[docs]</a>    <span class="k">def</span> <span class="nf">test_kind_7_unknown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test the functions returning the list of kinds, symbols, ...</span>
<span class="sd">        including the unknown entry.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">StructureData</span><span class="p">(</span><span class="n">cell</span><span class="o">=</span><span class="p">((</span><span class="mf">2.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">)))</span>

        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Ba&#39;</span><span class="p">,</span> <span class="n">mass</span><span class="o">=</span><span class="mf">100.</span><span class="p">)</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">)</span>
        <span class="c1"># The name does not exist</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;X2&#39;</span><span class="p">)</span>
        <span class="c1"># The name already exists, but the properties are identical =&gt; OK</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">],</span> <span class="n">weights</span><span class="o">=</span><span class="p">[</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">],</span> <span class="n">mass</span><span class="o">=</span><span class="mf">15.</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">get_symbols_set</span><span class="p">(),</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;Ba&#39;</span><span class="p">,</span> <span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">]))</span></div>

<div class="viewcode-block" id="TestStructureData.test_kind_8"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestStructureData.test_kind_8">[docs]</a>    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skipIf</span><span class="p">(</span><span class="ow">not</span> <span class="n">has_ase</span><span class="p">(),</span> <span class="s2">&quot;Unable to import ase&quot;</span><span class="p">)</span>
    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skipIf</span><span class="p">(</span><span class="ow">not</span> <span class="n">has_spglib</span><span class="p">(),</span> <span class="s2">&quot;Unable to import spglib&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_kind_8</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test the ase_refine_cell() function</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">aiida.orm.nodes.data.structure</span> <span class="k">import</span> <span class="n">ase_refine_cell</span>
        <span class="kn">import</span> <span class="nn">ase</span>
        <span class="kn">import</span> <span class="nn">math</span>
        <span class="kn">import</span> <span class="nn">numpy</span>

        <span class="n">a</span> <span class="o">=</span> <span class="n">ase</span><span class="o">.</span><span class="n">Atoms</span><span class="p">(</span><span class="n">cell</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">])</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ase</span><span class="o">.</span><span class="n">Atom</span><span class="p">(</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]))</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ase</span><span class="o">.</span><span class="n">Atom</span><span class="p">(</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]))</span>
        <span class="n">b</span><span class="p">,</span> <span class="n">sym</span> <span class="o">=</span> <span class="n">ase_refine_cell</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="n">sym</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;rotations&#39;</span><span class="p">)</span>
        <span class="n">sym</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;translations&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">get_chemical_symbols</span><span class="p">(),</span> <span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="p">[[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">sym</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;hall&#39;</span><span class="p">:</span> <span class="s1">&#39;-P 4 2&#39;</span><span class="p">,</span> <span class="s1">&#39;hm&#39;</span><span class="p">:</span> <span class="s1">&#39;P4/mmm&#39;</span><span class="p">,</span> <span class="s1">&#39;tables&#39;</span><span class="p">:</span> <span class="mi">123</span><span class="p">})</span>

        <span class="n">a</span> <span class="o">=</span> <span class="n">ase</span><span class="o">.</span><span class="n">Atoms</span><span class="p">(</span><span class="n">cell</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">75</span><span class="p">),</span> <span class="mi">10</span><span class="p">])</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ase</span><span class="o">.</span><span class="n">Atom</span><span class="p">(</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]))</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ase</span><span class="o">.</span><span class="n">Atom</span><span class="p">(</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">75</span><span class="p">),</span> <span class="mi">0</span><span class="p">]))</span>
        <span class="n">b</span><span class="p">,</span> <span class="n">sym</span> <span class="o">=</span> <span class="n">ase_refine_cell</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="n">sym</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;rotations&#39;</span><span class="p">)</span>
        <span class="n">sym</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;translations&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">get_chemical_symbols</span><span class="p">(),</span> <span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">cell</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="p">[[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mf">8.66</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">sym</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;hall&#39;</span><span class="p">:</span> <span class="s1">&#39;-P 6 2&#39;</span><span class="p">,</span> <span class="s1">&#39;hm&#39;</span><span class="p">:</span> <span class="s1">&#39;P6/mmm&#39;</span><span class="p">,</span> <span class="s1">&#39;tables&#39;</span><span class="p">:</span> <span class="mi">191</span><span class="p">})</span>

        <span class="n">a</span> <span class="o">=</span> <span class="n">ase</span><span class="o">.</span><span class="n">Atoms</span><span class="p">(</span><span class="n">cell</span><span class="o">=</span><span class="p">[[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">]])</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ase</span><span class="o">.</span><span class="n">Atom</span><span class="p">(</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">]))</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ase</span><span class="o">.</span><span class="n">Atom</span><span class="p">(</span><span class="s1">&#39;F&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]))</span>
        <span class="n">b</span><span class="p">,</span> <span class="n">sym</span> <span class="o">=</span> <span class="n">ase_refine_cell</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="n">sym</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;rotations&#39;</span><span class="p">)</span>
        <span class="n">sym</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;translations&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">get_chemical_symbols</span><span class="p">(),</span> <span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;F&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="p">[[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">get_scaled_positions</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="p">[[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">sym</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;hall&#39;</span><span class="p">:</span> <span class="s1">&#39;-P 4 2 3&#39;</span><span class="p">,</span> <span class="s1">&#39;hm&#39;</span><span class="p">:</span> <span class="s1">&#39;Pm-3m&#39;</span><span class="p">,</span> <span class="s1">&#39;tables&#39;</span><span class="p">:</span> <span class="mi">221</span><span class="p">})</span>

        <span class="n">a</span> <span class="o">=</span> <span class="n">ase</span><span class="o">.</span><span class="n">Atoms</span><span class="p">(</span><span class="n">cell</span><span class="o">=</span><span class="p">[[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">]])</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ase</span><span class="o">.</span><span class="n">Atom</span><span class="p">(</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]))</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ase</span><span class="o">.</span><span class="n">Atom</span><span class="p">(</span><span class="s1">&#39;F&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">]))</span>
        <span class="n">b</span><span class="p">,</span> <span class="n">sym</span> <span class="o">=</span> <span class="n">ase_refine_cell</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="n">sym</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;rotations&#39;</span><span class="p">)</span>
        <span class="n">sym</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;translations&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">get_chemical_symbols</span><span class="p">(),</span> <span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;F&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="p">[[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">get_scaled_positions</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">sym</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;hall&#39;</span><span class="p">:</span> <span class="s1">&#39;-P 4 2 3&#39;</span><span class="p">,</span> <span class="s1">&#39;hm&#39;</span><span class="p">:</span> <span class="s1">&#39;Pm-3m&#39;</span><span class="p">,</span> <span class="s1">&#39;tables&#39;</span><span class="p">:</span> <span class="mi">221</span><span class="p">})</span>

        <span class="n">a</span> <span class="o">=</span> <span class="n">ase</span><span class="o">.</span><span class="n">Atoms</span><span class="p">(</span><span class="n">cell</span><span class="o">=</span><span class="p">[[</span><span class="mf">12.132</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">6.0606</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">8.0956</span><span class="p">]])</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ase</span><span class="o">.</span><span class="n">Atom</span><span class="p">(</span><span class="s1">&#39;Ba&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mf">1.5334848</span><span class="p">,</span> <span class="mf">1.3999986</span><span class="p">,</span> <span class="mf">2.00042276</span><span class="p">]))</span>
        <span class="n">b</span><span class="p">,</span> <span class="n">sym</span> <span class="o">=</span> <span class="n">ase_refine_cell</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="n">sym</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;rotations&#39;</span><span class="p">)</span>
        <span class="n">sym</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;translations&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="p">[[</span><span class="mf">6.0606</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">8.0956</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">12.132</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">get_scaled_positions</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>

        <span class="n">a</span> <span class="o">=</span> <span class="n">ase</span><span class="o">.</span><span class="n">Atoms</span><span class="p">(</span><span class="n">cell</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">])</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ase</span><span class="o">.</span><span class="n">Atom</span><span class="p">(</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">]))</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ase</span><span class="o">.</span><span class="n">Atom</span><span class="p">(</span><span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mf">2.5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">]))</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ase</span><span class="o">.</span><span class="n">Atom</span><span class="p">(</span><span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mf">7.5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">]))</span>
        <span class="n">b</span><span class="p">,</span> <span class="n">sym</span> <span class="o">=</span> <span class="n">ase_refine_cell</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="n">sym</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;rotations&#39;</span><span class="p">)</span>
        <span class="n">sym</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;translations&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">get_chemical_symbols</span><span class="p">(),</span> <span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">sym</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;hall&#39;</span><span class="p">:</span> <span class="s1">&#39;-P 4 2&#39;</span><span class="p">,</span> <span class="s1">&#39;hm&#39;</span><span class="p">:</span> <span class="s1">&#39;P4/mmm&#39;</span><span class="p">,</span> <span class="s1">&#39;tables&#39;</span><span class="p">:</span> <span class="mi">123</span><span class="p">})</span>

        <span class="c1"># Generated from COD entry 1507756</span>
        <span class="c1"># (http://www.crystallography.net/cod/1507756.cif@87343)</span>
        <span class="kn">from</span> <span class="nn">ase.spacegroup</span> <span class="k">import</span> <span class="n">crystal</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">crystal</span><span class="p">(</span>
            <span class="p">[</span><span class="s1">&#39;Ba&#39;</span><span class="p">,</span> <span class="s1">&#39;Ti&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">],</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.482</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.016</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.515</span><span class="p">]],</span>
            <span class="n">cell</span><span class="o">=</span><span class="p">[</span><span class="mf">3.9999</span><span class="p">,</span> <span class="mf">3.9999</span><span class="p">,</span> <span class="mf">4.0170</span><span class="p">],</span>
            <span class="n">spacegroup</span><span class="o">=</span><span class="mi">99</span><span class="p">)</span>
        <span class="n">b</span><span class="p">,</span> <span class="n">sym</span> <span class="o">=</span> <span class="n">ase_refine_cell</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="n">sym</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;rotations&#39;</span><span class="p">)</span>
        <span class="n">sym</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;translations&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">get_chemical_symbols</span><span class="p">(),</span> <span class="p">[</span><span class="s1">&#39;Ba&#39;</span><span class="p">,</span> <span class="s1">&#39;Ti&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">sym</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;hall&#39;</span><span class="p">:</span> <span class="s1">&#39;P 4 -2&#39;</span><span class="p">,</span> <span class="s1">&#39;hm&#39;</span><span class="p">:</span> <span class="s1">&#39;P4mm&#39;</span><span class="p">,</span> <span class="s1">&#39;tables&#39;</span><span class="p">:</span> <span class="mi">99</span><span class="p">})</span></div>

<div class="viewcode-block" id="TestStructureData.test_get_formula"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestStructureData.test_get_formula">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_formula</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tests the generation of formula</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">aiida.orm.nodes.data.structure</span> <span class="k">import</span> <span class="n">get_formula</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">get_formula</span><span class="p">([</span><span class="s1">&#39;Ba&#39;</span><span class="p">,</span> <span class="s1">&#39;Ti&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;O&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">),</span> <span class="s1">&#39;BaO3Ti&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">get_formula</span><span class="p">([</span><span class="s1">&#39;Ba&#39;</span><span class="p">,</span> <span class="s1">&#39;Ti&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;O&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span> <span class="n">separator</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">),</span> <span class="s1">&#39;C Ba O3 Ti&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">get_formula</span><span class="p">([</span><span class="s1">&#39;H&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">6</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">6</span><span class="p">),</span> <span class="s1">&#39;C6H6&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">get_formula</span><span class="p">([</span><span class="s1">&#39;H&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">6</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">6</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;hill_compact&quot;</span><span class="p">),</span> <span class="s1">&#39;CH&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">get_formula</span><span class="p">(([</span><span class="s1">&#39;Ba&#39;</span><span class="p">,</span> <span class="s1">&#39;Ti&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;O&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> \
                                      <span class="p">[</span><span class="s1">&#39;Ba&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;Ti&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;O&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span>
                                      <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;group&quot;</span><span class="p">),</span>
                          <span class="s1">&#39;(BaTiO3)2BaTi2O3&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">get_formula</span><span class="p">(([</span><span class="s1">&#39;Ba&#39;</span><span class="p">,</span> <span class="s1">&#39;Ti&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;O&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> \
                                      <span class="p">[</span><span class="s1">&#39;Ba&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;Ti&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;O&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span>
                                      <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;group&quot;</span><span class="p">,</span> <span class="n">separator</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">),</span>
                          <span class="s1">&#39;(Ba Ti O3)2 Ba Ti2 O3&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">get_formula</span><span class="p">(([</span><span class="s1">&#39;Ba&#39;</span><span class="p">,</span> <span class="s1">&#39;Ti&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;O&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> \
                                      <span class="p">[</span><span class="s1">&#39;Ba&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;Ti&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;O&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span>
                                      <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;reduce&quot;</span><span class="p">),</span>
                          <span class="s1">&#39;BaTiO3BaTiO3BaTi2O3&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">get_formula</span><span class="p">(([</span><span class="s1">&#39;Ba&#39;</span><span class="p">,</span> <span class="s1">&#39;Ti&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;O&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> \
                                      <span class="p">[</span><span class="s1">&#39;Ba&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;Ti&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;O&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span>
                                      <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;reduce&quot;</span><span class="p">,</span> <span class="n">separator</span><span class="o">=</span><span class="s2">&quot;, &quot;</span><span class="p">),</span>
                          <span class="s1">&#39;Ba, Ti, O3, Ba, Ti, O3, Ba, Ti2, O3&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">get_formula</span><span class="p">(([</span><span class="s1">&#39;Ba&#39;</span><span class="p">,</span> <span class="s1">&#39;Ti&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;O&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;count&quot;</span><span class="p">),</span> <span class="s1">&#39;Ba2Ti2O6&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">get_formula</span><span class="p">(([</span><span class="s1">&#39;Ba&#39;</span><span class="p">,</span> <span class="s1">&#39;Ti&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;O&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;count_compact&quot;</span><span class="p">),</span> <span class="s1">&#39;BaTiO3&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestStructureData.test_get_formula_unknown"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestStructureData.test_get_formula_unknown">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_formula_unknown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tests the generation of formula, including unknown entry.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">aiida.orm.nodes.data.structure</span> <span class="k">import</span> <span class="n">get_formula</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">get_formula</span><span class="p">([</span><span class="s1">&#39;Ba&#39;</span><span class="p">,</span> <span class="s1">&#39;Ti&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">),</span> <span class="s1">&#39;BaTiX3&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">get_formula</span><span class="p">([</span><span class="s1">&#39;Ba&#39;</span><span class="p">,</span> <span class="s1">&#39;Ti&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span> <span class="n">separator</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">),</span> <span class="s1">&#39;C Ba Ti X3&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">get_formula</span><span class="p">([</span><span class="s1">&#39;X&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">6</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">6</span><span class="p">),</span> <span class="s1">&#39;C6X6&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">get_formula</span><span class="p">([</span><span class="s1">&#39;X&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">6</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">6</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;hill_compact&quot;</span><span class="p">),</span> <span class="s1">&#39;CX&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">get_formula</span><span class="p">(([</span><span class="s1">&#39;Ba&#39;</span><span class="p">,</span> <span class="s1">&#39;Ti&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> \
                                      <span class="p">[</span><span class="s1">&#39;Ba&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;O&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span>
                                      <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;group&quot;</span><span class="p">),</span>
                          <span class="s1">&#39;(BaTiX3)2BaX2O3&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">get_formula</span><span class="p">(([</span><span class="s1">&#39;Ba&#39;</span><span class="p">,</span> <span class="s1">&#39;Ti&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> \
                                      <span class="p">[</span><span class="s1">&#39;Ba&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;O&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span>
                                      <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;group&quot;</span><span class="p">,</span> <span class="n">separator</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">),</span>
                          <span class="s1">&#39;(Ba Ti X3)2 Ba X2 O3&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">get_formula</span><span class="p">(([</span><span class="s1">&#39;Ba&#39;</span><span class="p">,</span> <span class="s1">&#39;Ti&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> \
                                      <span class="p">[</span><span class="s1">&#39;Ba&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;Ti&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span>
                                      <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;reduce&quot;</span><span class="p">),</span>
                          <span class="s1">&#39;BaTiX3BaTiX3BaTi2X3&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">get_formula</span><span class="p">(([</span><span class="s1">&#39;Ba&#39;</span><span class="p">,</span> <span class="s1">&#39;Ti&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> \
                                      <span class="p">[</span><span class="s1">&#39;Ba&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;Ti&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span>
                                      <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;reduce&quot;</span><span class="p">,</span> <span class="n">separator</span><span class="o">=</span><span class="s2">&quot;, &quot;</span><span class="p">),</span>
                          <span class="s1">&#39;Ba, Ti, X3, Ba, Ti, X3, Ba, Ti2, X3&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">get_formula</span><span class="p">(([</span><span class="s1">&#39;Ba&#39;</span><span class="p">,</span> <span class="s1">&#39;Ti&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;O&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;count&quot;</span><span class="p">),</span> <span class="s1">&#39;Ba2Ti2O6&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">get_formula</span><span class="p">(([</span><span class="s1">&#39;Ba&#39;</span><span class="p">,</span> <span class="s1">&#39;Ti&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;count_compact&quot;</span><span class="p">),</span> <span class="s1">&#39;BaTiX3&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestStructureData.test_get_cif"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestStructureData.test_get_cif">[docs]</a>    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skipIf</span><span class="p">(</span><span class="ow">not</span> <span class="n">has_ase</span><span class="p">(),</span> <span class="s2">&quot;Unable to import ase&quot;</span><span class="p">)</span>
    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skipIf</span><span class="p">(</span><span class="ow">not</span> <span class="n">has_pycifrw</span><span class="p">(),</span> <span class="s2">&quot;Unable to import PyCifRW&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_get_cif</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tests the conversion to CifData</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">re</span>

        <span class="n">a</span> <span class="o">=</span> <span class="n">StructureData</span><span class="p">(</span><span class="n">cell</span><span class="o">=</span><span class="p">((</span><span class="mf">2.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">)))</span>

        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Ba&#39;</span><span class="p">])</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Ba&#39;</span><span class="p">])</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Ti&#39;</span><span class="p">])</span>

        <span class="n">c</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">get_cif</span><span class="p">()</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">_prepare_cif</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">non_comments</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;^#&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
                <span class="n">non_comments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span>
            <span class="n">simplify</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">non_comments</span><span class="p">)),</span>
            <span class="n">simplify</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">data_0</span>
<span class="s2">loop_</span>
<span class="s2">  _atom_site_label</span>
<span class="s2">  _atom_site_fract_x</span>
<span class="s2">  _atom_site_fract_y</span>
<span class="s2">  _atom_site_fract_z</span>
<span class="s2">  _atom_site_type_symbol</span>
<span class="s2">   Ba1  0.0  0.0  0.0  Ba</span>
<span class="s2">   Ba2  0.25  0.25  0.25  Ba</span>
<span class="s2">   Ti1  0.5  0.5  0.5  Ti</span>

<span class="s2">_cell_angle_alpha                       90.0</span>
<span class="s2">_cell_angle_beta                        90.0</span>
<span class="s2">_cell_angle_gamma                       90.0</span>
<span class="s2">_cell_length_a                          2.0</span>
<span class="s2">_cell_length_b                          2.0</span>
<span class="s2">_cell_length_c                          2.0</span>
<span class="s2">loop_</span>
<span class="s2">  _symmetry_equiv_pos_as_xyz</span>
<span class="s2">   &#39;x, y, z&#39;</span>

<span class="s2">_symmetry_Int_Tables_number             1</span>
<span class="s2">_symmetry_space_group_name_H-M          &#39;P 1&#39;</span>
<span class="s2">_symmetry_space_group_name_Hall         &#39;P 1&#39;</span>
<span class="s2">_cell_formula_units_Z                   1</span>
<span class="s2">_chemical_formula_sum                   &#39;Ba2 Ti&#39;</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">))</span></div>

<div class="viewcode-block" id="TestStructureData.test_xyz_parser"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestStructureData.test_xyz_parser">[docs]</a>    <span class="k">def</span> <span class="nf">test_xyz_parser</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">aiida.orm.nodes.data.structure</span> <span class="k">import</span> <span class="n">StructureData</span>
        <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
        <span class="n">xyz_string1</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">3</span>

<span class="s2">Li      0.00000000       0.00000000       0.00000000       6.94100000        3 </span>
<span class="s2">Si      4.39194796       0.00000000      10.10068356      28.08550000       14 </span>
<span class="s2">Si      4.39194796       0.00000000       3.79747116      28.08550000       14 </span>
<span class="s2">&quot;&quot;&quot;</span>
        <span class="n">xyz_string2</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">2</span>
<span class="s2">Silver dimer;</span>
<span class="s2">Ag 0 0 0</span>
<span class="s2">Ag 0 0 2.5335</span>
<span class="s2">&quot;&quot;&quot;</span>

        <span class="n">xyz_string3</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">2</span>
<span class="s2">Shifted Silver dimer;</span>
<span class="s2">Ag 0 0 -.5</span>
<span class="s2">Ag 0 0 2.0335</span>
<span class="s2">&quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">xyz_string</span> <span class="ow">in</span> <span class="p">(</span><span class="n">xyz_string1</span><span class="p">,</span> <span class="n">xyz_string2</span><span class="p">,</span> <span class="n">xyz_string3</span><span class="p">):</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">StructureData</span><span class="p">()</span>
            <span class="c1"># Parsing the string:</span>
            <span class="n">s</span><span class="o">.</span><span class="n">_parse_xyz</span><span class="p">(</span><span class="n">xyz_string</span><span class="p">)</span>
            <span class="c1"># Making sure that the periodic boundary condition are not True</span>
            <span class="c1"># because I cannot parse a cell!</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="ow">not</span> <span class="p">(</span><span class="nb">any</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">pbc</span><span class="p">)))</span>
            <span class="c1"># Making sure that the structure has sites, kinds and a cell</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">sites</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">kinds</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">cell</span><span class="p">)</span>
            <span class="c1"># The default cell is given in these cases:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">cell</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>

        <span class="c1"># Testing a case where 1</span>
        <span class="n">xyz_string4</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">1</span>

<span class="s2">Li      0.00000000       0.00000000       0.00000000       6.94100000        3 </span>
<span class="s2">Si      4.39194796       0.00000000      10.10068356      28.08550000       14 </span>
<span class="s2">Si      4.39194796       0.00000000       3.79747116      28.08550000       14 </span>
<span class="s2">&quot;&quot;&quot;</span>
        <span class="n">xyz_string5</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">10</span>

<span class="s2">Li      0.00000000       0.00000000       0.00000000       6.94100000        3 </span>
<span class="s2">Si      4.39194796       0.00000000      10.10068356      28.08550000       14 </span>
<span class="s2">Si      4.39194796       0.00000000       3.79747116      28.08550000       14 </span>
<span class="s2">&quot;&quot;&quot;</span>
        <span class="n">xyz_string6</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">2</span>
<span class="s2">Shifted Silver dimer;</span>
<span class="s2">Ag 0 0 -.5</span>
<span class="s2">Ag 0 0</span>
<span class="s2">&quot;&quot;&quot;</span>

        <span class="c1"># The above cases have to fail because the number of atoms is wrong</span>
        <span class="k">for</span> <span class="n">xyz_string</span> <span class="ow">in</span> <span class="p">(</span><span class="n">xyz_string4</span><span class="p">,</span> <span class="n">xyz_string5</span><span class="p">,</span> <span class="n">xyz_string6</span><span class="p">):</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span>
                <span class="n">StructureData</span><span class="p">()</span><span class="o">.</span><span class="n">_parse_xyz</span><span class="p">(</span><span class="n">xyz_string</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="TestStructureDataLock"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestStructureDataLock">[docs]</a><span class="k">class</span> <span class="nc">TestStructureDataLock</span><span class="p">(</span><span class="n">AiidaTestCase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Tests that the structure is locked after storage</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="TestStructureDataLock.test_lock"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestStructureDataLock.test_lock">[docs]</a>    <span class="k">def</span> <span class="nf">test_lock</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Start from a StructureData object, convert to raw and then back</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cell</span> <span class="o">=</span> <span class="p">((</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">))</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">StructureData</span><span class="p">(</span><span class="n">cell</span><span class="o">=</span><span class="n">cell</span><span class="p">)</span>

        <span class="n">a</span><span class="o">.</span><span class="n">pbc</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">]</span>

        <span class="n">k</span> <span class="o">=</span> <span class="n">Kind</span><span class="p">(</span><span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Ba&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Ba&#39;</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">Site</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="n">kind_name</span><span class="o">=</span><span class="s1">&#39;Ba&#39;</span><span class="p">)</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_kind</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_site</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Ti&#39;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">])</span>

        <span class="n">a</span><span class="o">.</span><span class="n">store</span><span class="p">()</span>

        <span class="n">k2</span> <span class="o">=</span> <span class="n">Kind</span><span class="p">(</span><span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Ba&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Ba&#39;</span><span class="p">)</span>
        <span class="c1"># Nothing should be changed after store()</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">ModificationNotAllowed</span><span class="p">):</span>
            <span class="n">a</span><span class="o">.</span><span class="n">append_kind</span><span class="p">(</span><span class="n">k2</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">ModificationNotAllowed</span><span class="p">):</span>
            <span class="n">a</span><span class="o">.</span><span class="n">append_site</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">ModificationNotAllowed</span><span class="p">):</span>
            <span class="n">a</span><span class="o">.</span><span class="n">clear_sites</span><span class="p">()</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">ModificationNotAllowed</span><span class="p">):</span>
            <span class="n">a</span><span class="o">.</span><span class="n">clear_kinds</span><span class="p">()</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">ModificationNotAllowed</span><span class="p">):</span>
            <span class="n">a</span><span class="o">.</span><span class="n">cell</span> <span class="o">=</span> <span class="n">cell</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">ModificationNotAllowed</span><span class="p">):</span>
            <span class="n">a</span><span class="o">.</span><span class="n">pbc</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">]</span>

        <span class="n">_</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">get_cell_volume</span><span class="p">()</span>
        <span class="n">_</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">is_alloy</span>
        <span class="n">_</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">has_vacancies</span>

        <span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
        <span class="c1"># I check that clone returned an unstored copy and so can be altered</span>
        <span class="n">b</span><span class="o">.</span><span class="n">append_site</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="n">b</span><span class="o">.</span><span class="n">clear_sites</span><span class="p">()</span>
        <span class="c1"># I check that the original did not change</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">sites</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">b</span><span class="o">.</span><span class="n">cell</span> <span class="o">=</span> <span class="n">cell</span>
        <span class="n">b</span><span class="o">.</span><span class="n">pbc</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">]</span></div></div>


<div class="viewcode-block" id="TestStructureDataReload"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestStructureDataReload">[docs]</a><span class="k">class</span> <span class="nc">TestStructureDataReload</span><span class="p">(</span><span class="n">AiidaTestCase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Tests the creation of StructureData, converting it to a raw format and</span>
<span class="sd">    converting it back.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="TestStructureDataReload.test_reload"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestStructureDataReload.test_reload">[docs]</a>    <span class="k">def</span> <span class="nf">test_reload</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Start from a StructureData object, convert to raw and then back</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cell</span> <span class="o">=</span> <span class="p">((</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">))</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">StructureData</span><span class="p">(</span><span class="n">cell</span><span class="o">=</span><span class="n">cell</span><span class="p">)</span>

        <span class="n">a</span><span class="o">.</span><span class="n">pbc</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">]</span>

        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Ba&#39;</span><span class="p">])</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Ti&#39;</span><span class="p">])</span>

        <span class="n">a</span><span class="o">.</span><span class="n">store</span><span class="p">()</span>

        <span class="n">b</span> <span class="o">=</span> <span class="n">load_node</span><span class="p">(</span><span class="n">uuid</span><span class="o">=</span><span class="n">a</span><span class="o">.</span><span class="n">uuid</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">cell</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">b</span><span class="o">.</span><span class="n">cell</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">pbc</span><span class="p">,</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">sites</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">kinds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;Ba&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">kinds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;Ti&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">sites</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">sites</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mf">1.</span><span class="p">)</span>

        <span class="c1"># Fully reload from UUID</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">load_node</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">uuid</span><span class="p">,</span> <span class="n">sub_classes</span><span class="o">=</span><span class="p">(</span><span class="n">StructureData</span><span class="p">,))</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">cell</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">b</span><span class="o">.</span><span class="n">cell</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">pbc</span><span class="p">,</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">sites</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">kinds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;Ba&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">kinds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;Ti&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">sites</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">sites</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mf">1.</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestStructureDataReload.test_clone"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestStructureDataReload.test_clone">[docs]</a>    <span class="k">def</span> <span class="nf">test_clone</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Start from a StructureData object, clone it and see if it is preserved</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cell</span> <span class="o">=</span> <span class="p">((</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">))</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">StructureData</span><span class="p">(</span><span class="n">cell</span><span class="o">=</span><span class="n">cell</span><span class="p">)</span>

        <span class="n">a</span><span class="o">.</span><span class="n">pbc</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">]</span>

        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Ba&#39;</span><span class="p">])</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Ti&#39;</span><span class="p">])</span>

        <span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">cell</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">b</span><span class="o">.</span><span class="n">cell</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">pbc</span><span class="p">,</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">kinds</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">sites</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">kinds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;Ba&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">kinds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;Ti&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">sites</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">sites</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mf">1.</span><span class="p">)</span>

        <span class="n">a</span><span class="o">.</span><span class="n">store</span><span class="p">()</span>

        <span class="c1"># Clone after store()</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">cell</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">c</span><span class="o">.</span><span class="n">cell</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">pbc</span><span class="p">,</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">kinds</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">sites</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">kinds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;Ba&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">kinds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;Ti&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">sites</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">sites</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mf">1.</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="TestStructureDataFromAse"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestStructureDataFromAse">[docs]</a><span class="k">class</span> <span class="nc">TestStructureDataFromAse</span><span class="p">(</span><span class="n">AiidaTestCase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Tests the creation of Sites from/to a ASE object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">aiida.orm.nodes.data.structure</span> <span class="k">import</span> <span class="n">has_ase</span>

<div class="viewcode-block" id="TestStructureDataFromAse.test_ase"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestStructureDataFromAse.test_ase">[docs]</a>    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skipIf</span><span class="p">(</span><span class="ow">not</span> <span class="n">has_ase</span><span class="p">(),</span> <span class="s2">&quot;Unable to import ase&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_ase</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tests roundtrip ASE -&gt; StructureData -&gt; ASE</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">aiida.orm.nodes.data.structure</span> <span class="k">import</span> <span class="n">StructureData</span>
        <span class="kn">import</span> <span class="nn">ase</span>

        <span class="n">a</span> <span class="o">=</span> <span class="n">ase</span><span class="o">.</span><span class="n">Atoms</span><span class="p">(</span><span class="s1">&#39;SiGe&#39;</span><span class="p">,</span> <span class="n">cell</span><span class="o">=</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">),</span> <span class="n">pbc</span><span class="o">=</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
        <span class="n">a</span><span class="o">.</span><span class="n">set_positions</span><span class="p">((</span>
            <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">),</span>
        <span class="p">))</span>
        <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">mass</span> <span class="o">=</span> <span class="mf">110.2</span>

        <span class="n">b</span> <span class="o">=</span> <span class="n">StructureData</span><span class="p">(</span><span class="n">ase</span><span class="o">=</span><span class="n">a</span><span class="p">)</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">get_ase</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span><span class="p">,</span> <span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span><span class="p">,</span> <span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">cell</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">c</span><span class="o">.</span><span class="n">cell</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">mass</span><span class="p">,</span> <span class="mf">110.2</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestStructureDataFromAse.test_conversion_of_types_1"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestStructureDataFromAse.test_conversion_of_types_1">[docs]</a>    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skipIf</span><span class="p">(</span><span class="ow">not</span> <span class="n">has_ase</span><span class="p">(),</span> <span class="s2">&quot;Unable to import ase&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_conversion_of_types_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tests roundtrip ASE -&gt; StructureData -&gt; ASE, with tags</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">ase</span>

        <span class="n">a</span> <span class="o">=</span> <span class="n">ase</span><span class="o">.</span><span class="n">Atoms</span><span class="p">(</span><span class="s1">&#39;Si4Ge4&#39;</span><span class="p">,</span> <span class="n">cell</span><span class="o">=</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">),</span> <span class="n">pbc</span><span class="o">=</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
        <span class="n">a</span><span class="o">.</span><span class="n">set_positions</span><span class="p">((</span>
            <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">),</span>
        <span class="p">))</span>

        <span class="n">a</span><span class="o">.</span><span class="n">set_tags</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>

        <span class="n">b</span> <span class="o">=</span> <span class="n">StructureData</span><span class="p">(</span><span class="n">ase</span><span class="o">=</span><span class="n">a</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">([</span><span class="n">k</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">b</span><span class="o">.</span><span class="n">kinds</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;Si&quot;</span><span class="p">,</span> <span class="s2">&quot;Si1&quot;</span><span class="p">,</span> <span class="s2">&quot;Si2&quot;</span><span class="p">,</span> <span class="s2">&quot;Si3&quot;</span><span class="p">,</span> <span class="s2">&quot;Ge4&quot;</span><span class="p">,</span> <span class="s2">&quot;Ge5&quot;</span><span class="p">,</span> <span class="s2">&quot;Ge6&quot;</span><span class="p">,</span> <span class="s2">&quot;Ge7&quot;</span><span class="p">])</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">get_ase</span><span class="p">()</span>

        <span class="n">a_tags</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">get_tags</span><span class="p">())</span>
        <span class="n">c_tags</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">get_tags</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">a_tags</span><span class="p">,</span> <span class="n">c_tags</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestStructureDataFromAse.test_conversion_of_types_2"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestStructureDataFromAse.test_conversion_of_types_2">[docs]</a>    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skipIf</span><span class="p">(</span><span class="ow">not</span> <span class="n">has_ase</span><span class="p">(),</span> <span class="s2">&quot;Unable to import ase&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_conversion_of_types_2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tests roundtrip ASE -&gt; StructureData -&gt; ASE, with tags, and </span>
<span class="sd">        changing the atomic masses</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">ase</span>

        <span class="n">a</span> <span class="o">=</span> <span class="n">ase</span><span class="o">.</span><span class="n">Atoms</span><span class="p">(</span><span class="s1">&#39;Si4&#39;</span><span class="p">,</span> <span class="n">cell</span><span class="o">=</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">),</span> <span class="n">pbc</span><span class="o">=</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
        <span class="n">a</span><span class="o">.</span><span class="n">set_positions</span><span class="p">((</span>
            <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">),</span>
        <span class="p">))</span>

        <span class="n">a</span><span class="o">.</span><span class="n">set_tags</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">mass</span> <span class="o">=</span> <span class="mf">100.</span>
        <span class="n">a</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">mass</span> <span class="o">=</span> <span class="mf">300.</span>

        <span class="n">b</span> <span class="o">=</span> <span class="n">StructureData</span><span class="p">(</span><span class="n">ase</span><span class="o">=</span><span class="n">a</span><span class="p">)</span>
        <span class="c1"># This will give funny names to the kinds, because I am using</span>
        <span class="c1"># both tags and different properties (mass). I just check to have</span>
        <span class="c1"># 4 kinds</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">kinds</span><span class="p">),</span> <span class="mi">4</span><span class="p">)</span>

        <span class="c1"># Do I get the same tags after one full iteration back and forth?</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">get_ase</span><span class="p">()</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">StructureData</span><span class="p">(</span><span class="n">ase</span><span class="o">=</span><span class="n">c</span><span class="p">)</span>
        <span class="n">e</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get_ase</span><span class="p">()</span>
        <span class="n">c_tags</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">get_tags</span><span class="p">())</span>
        <span class="n">e_tags</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">get_tags</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">c_tags</span><span class="p">,</span> <span class="n">e_tags</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestStructureDataFromAse.test_conversion_of_types_3"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestStructureDataFromAse.test_conversion_of_types_3">[docs]</a>    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skipIf</span><span class="p">(</span><span class="ow">not</span> <span class="n">has_ase</span><span class="p">(),</span> <span class="s2">&quot;Unable to import ase&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_conversion_of_types_3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tests StructureData -&gt; ASE, with all sorts of kind names</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">StructureData</span><span class="p">()</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Ba&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Ba&#39;</span><span class="p">)</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Ba&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Ba1&#39;</span><span class="p">)</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Cu&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Cu&#39;</span><span class="p">)</span>
        <span class="c1"># continues with a number</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Cu&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Cu2&#39;</span><span class="p">)</span>
        <span class="c1"># does not continue with a number</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Cu&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Cu_my&#39;</span><span class="p">)</span>
        <span class="c1"># random string</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Cu&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;a_name&#39;</span><span class="p">)</span>
        <span class="c1"># a name of another chemical symbol</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Cu&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Fe&#39;</span><span class="p">)</span>
        <span class="c1"># lowercase! as if it were a random string</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Cu&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;cu1&#39;</span><span class="p">)</span>

        <span class="c1"># Just to be sure that the species were saved with the correct name</span>
        <span class="c1"># in the first place</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">([</span><span class="n">k</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">kinds</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;Ba&#39;</span><span class="p">,</span> <span class="s1">&#39;Ba1&#39;</span><span class="p">,</span> <span class="s1">&#39;Cu&#39;</span><span class="p">,</span> <span class="s1">&#39;Cu2&#39;</span><span class="p">,</span> <span class="s1">&#39;Cu_my&#39;</span><span class="p">,</span> <span class="s1">&#39;a_name&#39;</span><span class="p">,</span> <span class="s1">&#39;Fe&#39;</span><span class="p">,</span> <span class="s1">&#39;cu1&#39;</span><span class="p">])</span>

        <span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">get_ase</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">get_chemical_symbols</span><span class="p">(),</span> <span class="p">[</span><span class="s1">&#39;Ba&#39;</span><span class="p">,</span> <span class="s1">&#39;Ba&#39;</span><span class="p">,</span> <span class="s1">&#39;Cu&#39;</span><span class="p">,</span> <span class="s1">&#39;Cu&#39;</span><span class="p">,</span> <span class="s1">&#39;Cu&#39;</span><span class="p">,</span> <span class="s1">&#39;Cu&#39;</span><span class="p">,</span> <span class="s1">&#39;Cu&#39;</span><span class="p">,</span> <span class="s1">&#39;Cu&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">get_tags</span><span class="p">()),</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestStructureDataFromAse.test_conversion_of_types_4"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestStructureDataFromAse.test_conversion_of_types_4">[docs]</a>    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skipIf</span><span class="p">(</span><span class="ow">not</span> <span class="n">has_ase</span><span class="p">(),</span> <span class="s2">&quot;Unable to import ase&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_conversion_of_types_4</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tests ASE -&gt; StructureData -&gt; ASE, in particular conversion tags / kind names</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">ase</span>

        <span class="n">atoms</span> <span class="o">=</span> <span class="n">ase</span><span class="o">.</span><span class="n">Atoms</span><span class="p">(</span><span class="s1">&#39;Fe5&#39;</span><span class="p">)</span>
        <span class="n">atoms</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">atoms</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">atoms</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="n">atoms</span><span class="o">.</span><span class="n">set_cell</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">StructureData</span><span class="p">(</span><span class="n">ase</span><span class="o">=</span><span class="n">atoms</span><span class="p">)</span>
        <span class="n">kindnames</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">k</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">kinds</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">kindnames</span><span class="p">,</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;Fe&#39;</span><span class="p">,</span> <span class="s1">&#39;Fe1&#39;</span><span class="p">,</span> <span class="s1">&#39;Fe4&#39;</span><span class="p">]))</span>
        <span class="c1"># check roundtrip ASE -&gt; StructureData -&gt; ASE</span>
        <span class="n">atoms2</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">get_ase</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">atoms2</span><span class="o">.</span><span class="n">get_tags</span><span class="p">()),</span> <span class="nb">list</span><span class="p">(</span><span class="n">atoms</span><span class="o">.</span><span class="n">get_tags</span><span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">atoms2</span><span class="o">.</span><span class="n">get_chemical_symbols</span><span class="p">()),</span> <span class="nb">list</span><span class="p">(</span><span class="n">atoms</span><span class="o">.</span><span class="n">get_chemical_symbols</span><span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">atoms2</span><span class="o">.</span><span class="n">get_chemical_formula</span><span class="p">(),</span> <span class="s1">&#39;Fe5&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestStructureDataFromAse.test_conversion_of_types_5"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestStructureDataFromAse.test_conversion_of_types_5">[docs]</a>    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skipIf</span><span class="p">(</span><span class="ow">not</span> <span class="n">has_ase</span><span class="p">(),</span> <span class="s2">&quot;Unable to import ase&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_conversion_of_types_5</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tests ASE -&gt; StructureData -&gt; ASE, in particular conversion tags / kind names</span>
<span class="sd">        (subtle variation of test_conversion_of_types_4)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">ase</span>

        <span class="n">atoms</span> <span class="o">=</span> <span class="n">ase</span><span class="o">.</span><span class="n">Atoms</span><span class="p">(</span><span class="s1">&#39;Fe5&#39;</span><span class="p">)</span>
        <span class="n">atoms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">atoms</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">atoms</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="n">atoms</span><span class="o">.</span><span class="n">set_cell</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">StructureData</span><span class="p">(</span><span class="n">ase</span><span class="o">=</span><span class="n">atoms</span><span class="p">)</span>
        <span class="n">kindnames</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">k</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">kinds</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">kindnames</span><span class="p">,</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;Fe&#39;</span><span class="p">,</span> <span class="s1">&#39;Fe1&#39;</span><span class="p">,</span> <span class="s1">&#39;Fe4&#39;</span><span class="p">]))</span>
        <span class="c1"># check roundtrip ASE -&gt; StructureData -&gt; ASE</span>
        <span class="n">atoms2</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">get_ase</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">atoms2</span><span class="o">.</span><span class="n">get_tags</span><span class="p">()),</span> <span class="nb">list</span><span class="p">(</span><span class="n">atoms</span><span class="o">.</span><span class="n">get_tags</span><span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">atoms2</span><span class="o">.</span><span class="n">get_chemical_symbols</span><span class="p">()),</span> <span class="nb">list</span><span class="p">(</span><span class="n">atoms</span><span class="o">.</span><span class="n">get_chemical_symbols</span><span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">atoms2</span><span class="o">.</span><span class="n">get_chemical_formula</span><span class="p">(),</span> <span class="s1">&#39;Fe5&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestStructureDataFromAse.test_conversion_of_types_6"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestStructureDataFromAse.test_conversion_of_types_6">[docs]</a>    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skipIf</span><span class="p">(</span><span class="ow">not</span> <span class="n">has_ase</span><span class="p">(),</span> <span class="s2">&quot;Unable to import ase&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_conversion_of_types_6</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tests roundtrip StructureData -&gt; ASE -&gt; StructureData, with tags/kind names</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">StructureData</span><span class="p">(</span><span class="n">cell</span><span class="o">=</span><span class="p">[[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">]])</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Ni&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Ni1&#39;</span><span class="p">)</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Ni&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Ni2&#39;</span><span class="p">)</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Cl&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Cl&#39;</span><span class="p">)</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Cl&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Cl&#39;</span><span class="p">)</span>

        <span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">get_ase</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">get_chemical_symbols</span><span class="p">(),</span> <span class="p">[</span><span class="s1">&#39;Ni&#39;</span><span class="p">,</span> <span class="s1">&#39;Ni&#39;</span><span class="p">,</span> <span class="s1">&#39;Cl&#39;</span><span class="p">,</span> <span class="s1">&#39;Cl&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">get_tags</span><span class="p">()),</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

        <span class="n">c</span> <span class="o">=</span> <span class="n">StructureData</span><span class="p">(</span><span class="n">ase</span><span class="o">=</span><span class="n">b</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">get_site_kindnames</span><span class="p">(),</span> <span class="p">[</span><span class="s1">&#39;Ni1&#39;</span><span class="p">,</span> <span class="s1">&#39;Ni2&#39;</span><span class="p">,</span> <span class="s1">&#39;Cl&#39;</span><span class="p">,</span> <span class="s1">&#39;Cl&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">([</span><span class="n">k</span><span class="o">.</span><span class="n">symbol</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">c</span><span class="o">.</span><span class="n">kinds</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;Ni&#39;</span><span class="p">,</span> <span class="s1">&#39;Ni&#39;</span><span class="p">,</span> <span class="s1">&#39;Cl&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">([</span><span class="n">s</span><span class="o">.</span><span class="n">position</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">c</span><span class="o">.</span><span class="n">sites</span><span class="p">],</span> <span class="p">[(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">2.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">),</span> <span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">),</span> <span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">)])</span></div></div>


<div class="viewcode-block" id="TestStructureDataFromPymatgen"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestStructureDataFromPymatgen">[docs]</a><span class="k">class</span> <span class="nc">TestStructureDataFromPymatgen</span><span class="p">(</span><span class="n">AiidaTestCase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Tests the creation of StructureData from a pymatgen Structure and</span>
<span class="sd">    Molecule objects.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">aiida.orm.nodes.data.structure</span> <span class="k">import</span> <span class="n">has_pymatgen</span><span class="p">,</span> <span class="n">get_pymatgen_version</span>

<div class="viewcode-block" id="TestStructureDataFromPymatgen.test_1"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestStructureDataFromPymatgen.test_1">[docs]</a>    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skipIf</span><span class="p">(</span><span class="ow">not</span> <span class="n">has_pymatgen</span><span class="p">(),</span> <span class="s2">&quot;Unable to import pymatgen&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tests roundtrip pymatgen -&gt; StructureData -&gt; pymatgen</span>
<span class="sd">        Test&#39;s input is derived from COD entry 9011963, processed with</span>
<span class="sd">        cif_mark_disorder (from cod-tools) and abbreviated.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">pymatgen.io.cif</span> <span class="k">import</span> <span class="n">CifParser</span>

        <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w+&#39;</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;.cif&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">tmpf</span><span class="p">:</span>
            <span class="n">tmpf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;data_9011963</span>
<span class="s2">                _space_group_IT_number           166</span>
<span class="s2">                _symmetry_space_group_name_Hall  &#39;-R 3 2&quot;&#39;</span>
<span class="s2">                _symmetry_space_group_name_H-M   &#39;R -3 m :H&#39;</span>
<span class="s2">                _cell_angle_alpha                90</span>
<span class="s2">                _cell_angle_beta                 90</span>
<span class="s2">                _cell_angle_gamma                120</span>
<span class="s2">                _cell_length_a                   4.298</span>
<span class="s2">                _cell_length_b                   4.298</span>
<span class="s2">                _cell_length_c                   29.774</span>
<span class="s2">                loop_</span>
<span class="s2">                _atom_site_label</span>
<span class="s2">                _atom_site_fract_x</span>
<span class="s2">                _atom_site_fract_y</span>
<span class="s2">                _atom_site_fract_z</span>
<span class="s2">                _atom_site_occupancy</span>
<span class="s2">                _atom_site_U_iso_or_equiv</span>
<span class="s2">                _atom_site_disorder_assembly</span>
<span class="s2">                _atom_site_disorder_group</span>
<span class="s2">                Bi 0.00000 0.00000 0.39580 1.00000 0.02343 . .</span>
<span class="s2">                Te1 0.00000 0.00000 0.00000 0.66667 0.02343 A 1</span>
<span class="s2">                Se1 0.00000 0.00000 0.00000 0.33333 0.02343 A 2</span>
<span class="s2">                Te2 0.00000 0.00000 0.21180 0.66667 0.02343 B 1</span>
<span class="s2">                Se2 0.00000 0.00000 0.21180 0.33333 0.02343 B 2</span>
<span class="s2">                &quot;&quot;&quot;</span><span class="p">)</span>
            <span class="n">tmpf</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
            <span class="n">pymatgen_parser</span> <span class="o">=</span> <span class="n">CifParser</span><span class="p">(</span><span class="n">tmpf</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">pymatgen_struct</span> <span class="o">=</span> <span class="n">pymatgen_parser</span><span class="o">.</span><span class="n">get_structures</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">structs_to_test</span> <span class="o">=</span> <span class="p">[</span><span class="n">StructureData</span><span class="p">(</span><span class="n">pymatgen</span><span class="o">=</span><span class="n">pymatgen_struct</span><span class="p">),</span> <span class="n">StructureData</span><span class="p">(</span><span class="n">pymatgen_structure</span><span class="o">=</span><span class="n">pymatgen_struct</span><span class="p">)]</span>

        <span class="k">for</span> <span class="n">struct</span> <span class="ow">in</span> <span class="n">structs_to_test</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">get_site_kindnames</span><span class="p">(),</span> <span class="p">[</span><span class="s1">&#39;Bi&#39;</span><span class="p">,</span> <span class="s1">&#39;Bi&#39;</span><span class="p">,</span> <span class="s1">&#39;SeTe&#39;</span><span class="p">,</span> <span class="s1">&#39;SeTe&#39;</span><span class="p">,</span> <span class="s1">&#39;SeTe&#39;</span><span class="p">])</span>

            <span class="c1"># Pymatgen&#39;s Composition does not guarantee any particular ordering of the kinds,</span>
            <span class="c1"># see the definition of its internal datatype at</span>
            <span class="c1">#   pymatgen/core/composition.py#L135 (d4fe64c18a52949a4e22bfcf7b45de5b87242c51)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">([</span><span class="nb">sorted</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">symbols</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">struct</span><span class="o">.</span><span class="n">kinds</span><span class="p">],</span> <span class="p">[[</span>
                <span class="s1">&#39;Bi&#39;</span><span class="p">,</span>
            <span class="p">],</span> <span class="p">[</span><span class="s1">&#39;Se&#39;</span><span class="p">,</span> <span class="s1">&#39;Te&#39;</span><span class="p">]])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">([</span><span class="nb">sorted</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">weights</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">struct</span><span class="o">.</span><span class="n">kinds</span><span class="p">],</span> <span class="p">[[</span>
                <span class="mf">1.0</span><span class="p">,</span>
            <span class="p">],</span> <span class="p">[</span><span class="mf">0.33333</span><span class="p">,</span> <span class="mf">0.66667</span><span class="p">]])</span>

        <span class="n">struct</span> <span class="o">=</span> <span class="n">StructureData</span><span class="p">(</span><span class="n">pymatgen_structure</span><span class="o">=</span><span class="n">pymatgen_struct</span><span class="p">)</span>

        <span class="c1"># Testing pymatgen Structure -&gt; StructureData -&gt; pymatgen Structure</span>
        <span class="c1"># roundtrip.</span>

        <span class="n">pymatgen_struct_roundtrip</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">get_pymatgen_structure</span><span class="p">()</span>
        <span class="n">dict1</span> <span class="o">=</span> <span class="n">pymatgen_struct</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()</span>
        <span class="n">dict2</span> <span class="o">=</span> <span class="n">pymatgen_struct_roundtrip</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">dict1</span><span class="p">[</span><span class="s1">&#39;sites&#39;</span><span class="p">]:</span>
            <span class="n">i</span><span class="p">[</span><span class="s1">&#39;abc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;abc&#39;</span><span class="p">]]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">dict2</span><span class="p">[</span><span class="s1">&#39;sites&#39;</span><span class="p">]:</span>
            <span class="n">i</span><span class="p">[</span><span class="s1">&#39;abc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;abc&#39;</span><span class="p">]]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">dict1</span><span class="p">,</span> <span class="n">dict2</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestStructureDataFromPymatgen.test_2"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestStructureDataFromPymatgen.test_2">[docs]</a>    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skipIf</span><span class="p">(</span><span class="ow">not</span> <span class="n">has_pymatgen</span><span class="p">(),</span> <span class="s2">&quot;Unable to import pymatgen&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tests xyz -&gt; pymatgen -&gt; StructureData</span>
<span class="sd">        Input source: http://pymatgen.org/_static/Molecule.html</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">pymatgen.io.xyz</span> <span class="k">import</span> <span class="n">XYZ</span>

        <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w+&#39;</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;.xyz&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">tmpf</span><span class="p">:</span>
            <span class="n">tmpf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;5</span>
<span class="s2">                H4 C1</span>
<span class="s2">                C 0.000000 0.000000 0.000000</span>
<span class="s2">                H 0.000000 0.000000 1.089000</span>
<span class="s2">                H 1.026719 0.000000 -0.363000</span>
<span class="s2">                H -0.513360 -0.889165 -0.363000</span>
<span class="s2">                H -0.513360 0.889165 -0.363000&quot;&quot;&quot;</span><span class="p">)</span>
            <span class="n">tmpf</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
            <span class="n">pymatgen_xyz</span> <span class="o">=</span> <span class="n">XYZ</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">tmpf</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">pymatgen_mol</span> <span class="o">=</span> <span class="n">pymatgen_xyz</span><span class="o">.</span><span class="n">molecule</span>

        <span class="k">for</span> <span class="n">struct</span> <span class="ow">in</span> <span class="p">[</span><span class="n">StructureData</span><span class="p">(</span><span class="n">pymatgen</span><span class="o">=</span><span class="n">pymatgen_mol</span><span class="p">),</span> <span class="n">StructureData</span><span class="p">(</span><span class="n">pymatgen_molecule</span><span class="o">=</span><span class="n">pymatgen_mol</span><span class="p">)]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">get_site_kindnames</span><span class="p">(),</span> <span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">pbc</span><span class="p">,</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">([</span><span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">sites</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">position</span><span class="p">)],</span> <span class="p">[</span><span class="mf">5.77</span><span class="p">,</span> <span class="mf">5.89</span><span class="p">,</span> <span class="mf">6.81</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">([</span><span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">sites</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">position</span><span class="p">)],</span> <span class="p">[</span><span class="mf">6.8</span><span class="p">,</span> <span class="mf">5.89</span><span class="p">,</span> <span class="mf">5.36</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">([</span><span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">sites</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">position</span><span class="p">)],</span> <span class="p">[</span><span class="mf">5.26</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">5.36</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">([</span><span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">sites</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">position</span><span class="p">)],</span> <span class="p">[</span><span class="mf">5.26</span><span class="p">,</span> <span class="mf">6.78</span><span class="p">,</span> <span class="mf">5.36</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">([</span><span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">sites</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">position</span><span class="p">)],</span> <span class="p">[</span><span class="mf">5.77</span><span class="p">,</span> <span class="mf">5.89</span><span class="p">,</span> <span class="mf">5.73</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestStructureDataFromPymatgen.test_partial_occ_and_spin"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestStructureDataFromPymatgen.test_partial_occ_and_spin">[docs]</a>    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skipIf</span><span class="p">(</span><span class="ow">not</span> <span class="n">has_pymatgen</span><span class="p">(),</span> <span class="s2">&quot;Unable to import pymatgen&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_partial_occ_and_spin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tests pymatgen -&gt; StructureData, with partial occupancies and spins.</span>
<span class="sd">        This should raise a ValueError.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">pymatgen</span>

        <span class="n">Fe_spin_up</span> <span class="o">=</span> <span class="n">pymatgen</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">Specie</span><span class="p">(</span><span class="s1">&#39;Fe&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">properties</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;spin&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
        <span class="n">Mn_spin_up</span> <span class="o">=</span> <span class="n">pymatgen</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">Specie</span><span class="p">(</span><span class="s1">&#39;Mn&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">properties</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;spin&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
        <span class="n">Fe_spin_down</span> <span class="o">=</span> <span class="n">pymatgen</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">Specie</span><span class="p">(</span><span class="s1">&#39;Fe&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">properties</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;spin&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">})</span>
        <span class="n">Mn_spin_down</span> <span class="o">=</span> <span class="n">pymatgen</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">Specie</span><span class="p">(</span><span class="s1">&#39;Mn&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">properties</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;spin&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">})</span>
        <span class="n">FeMn1</span> <span class="o">=</span> <span class="n">pymatgen</span><span class="o">.</span><span class="n">Composition</span><span class="p">({</span><span class="n">Fe_spin_up</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">Mn_spin_up</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">})</span>
        <span class="n">FeMn2</span> <span class="o">=</span> <span class="n">pymatgen</span><span class="o">.</span><span class="n">Composition</span><span class="p">({</span><span class="n">Fe_spin_down</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">Mn_spin_down</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">})</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">pymatgen</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">Structure</span><span class="p">(</span>
            <span class="n">lattice</span><span class="o">=</span><span class="p">[[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">]],</span> <span class="n">species</span><span class="o">=</span><span class="p">[</span><span class="n">FeMn1</span><span class="p">,</span> <span class="n">FeMn2</span><span class="p">],</span> <span class="n">coords</span><span class="o">=</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]])</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="n">StructureData</span><span class="p">(</span><span class="n">pymatgen</span><span class="o">=</span><span class="n">a</span><span class="p">)</span>

        <span class="c1"># same, with vacancies</span>
        <span class="n">Fe1</span> <span class="o">=</span> <span class="n">pymatgen</span><span class="o">.</span><span class="n">Composition</span><span class="p">({</span><span class="n">Fe_spin_up</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">})</span>
        <span class="n">Fe2</span> <span class="o">=</span> <span class="n">pymatgen</span><span class="o">.</span><span class="n">Composition</span><span class="p">({</span><span class="n">Fe_spin_down</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">})</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">pymatgen</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">Structure</span><span class="p">(</span>
            <span class="n">lattice</span><span class="o">=</span><span class="p">[[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">]],</span> <span class="n">species</span><span class="o">=</span><span class="p">[</span><span class="n">Fe1</span><span class="p">,</span> <span class="n">Fe2</span><span class="p">],</span> <span class="n">coords</span><span class="o">=</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]])</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="n">StructureData</span><span class="p">(</span><span class="n">pymatgen</span><span class="o">=</span><span class="n">a</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestStructureDataFromPymatgen.test_multiple_kinds_partial_occupancies"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestStructureDataFromPymatgen.test_multiple_kinds_partial_occupancies">[docs]</a>    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skipIf</span><span class="p">(</span><span class="ow">not</span> <span class="n">has_pymatgen</span><span class="p">(),</span> <span class="s2">&quot;Unable to import pymatgen&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_multiple_kinds_partial_occupancies</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tests that a structure with multiple sites with the same element but different</span>
<span class="sd">        partial occupancies, get their own unique kind name</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">pymatgen</span>

        <span class="n">Mg1</span> <span class="o">=</span> <span class="n">pymatgen</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">Composition</span><span class="p">({</span><span class="s1">&#39;Mg&#39;</span><span class="p">:</span> <span class="mf">0.50</span><span class="p">})</span>
        <span class="n">Mg2</span> <span class="o">=</span> <span class="n">pymatgen</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">Composition</span><span class="p">({</span><span class="s1">&#39;Mg&#39;</span><span class="p">:</span> <span class="mf">0.25</span><span class="p">})</span>

        <span class="n">a</span> <span class="o">=</span> <span class="n">pymatgen</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">Structure</span><span class="p">(</span>
            <span class="n">lattice</span><span class="o">=</span><span class="p">[[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">]],</span> <span class="n">species</span><span class="o">=</span><span class="p">[</span><span class="n">Mg1</span><span class="p">,</span> <span class="n">Mg2</span><span class="p">],</span> <span class="n">coords</span><span class="o">=</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]])</span>

        <span class="n">structure</span> <span class="o">=</span> <span class="n">StructureData</span><span class="p">(</span><span class="n">pymatgen</span><span class="o">=</span><span class="n">a</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestStructureDataFromPymatgen.test_multiple_kinds_alloy"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestStructureDataFromPymatgen.test_multiple_kinds_alloy">[docs]</a>    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skipIf</span><span class="p">(</span><span class="ow">not</span> <span class="n">has_pymatgen</span><span class="p">(),</span> <span class="s2">&quot;Unable to import pymatgen&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_multiple_kinds_alloy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tests that a structure with multiple sites with the same alloy symbols but different</span>
<span class="sd">        weights, get their own unique kind name</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">pymatgen</span>

        <span class="n">alloy_one</span> <span class="o">=</span> <span class="n">pymatgen</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">Composition</span><span class="p">({</span><span class="s1">&#39;Mg&#39;</span><span class="p">:</span> <span class="mf">0.25</span><span class="p">,</span> <span class="s1">&#39;Al&#39;</span><span class="p">:</span> <span class="mf">0.75</span><span class="p">})</span>
        <span class="n">alloy_two</span> <span class="o">=</span> <span class="n">pymatgen</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">Composition</span><span class="p">({</span><span class="s1">&#39;Mg&#39;</span><span class="p">:</span> <span class="mf">0.45</span><span class="p">,</span> <span class="s1">&#39;Al&#39;</span><span class="p">:</span> <span class="mf">0.55</span><span class="p">})</span>

        <span class="n">a</span> <span class="o">=</span> <span class="n">pymatgen</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">Structure</span><span class="p">(</span>
            <span class="n">lattice</span><span class="o">=</span><span class="p">[[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">]],</span>
            <span class="n">species</span><span class="o">=</span><span class="p">[</span><span class="n">alloy_one</span><span class="p">,</span> <span class="n">alloy_two</span><span class="p">],</span>
            <span class="n">coords</span><span class="o">=</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]])</span>

        <span class="n">structure</span> <span class="o">=</span> <span class="n">StructureData</span><span class="p">(</span><span class="n">pymatgen</span><span class="o">=</span><span class="n">a</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="TestPymatgenFromStructureData"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestPymatgenFromStructureData">[docs]</a><span class="k">class</span> <span class="nc">TestPymatgenFromStructureData</span><span class="p">(</span><span class="n">AiidaTestCase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Tests the creation of pymatgen Structure and Molecule objects from</span>
<span class="sd">    StructureData.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">aiida.orm.nodes.data.structure</span> <span class="k">import</span> <span class="n">has_ase</span><span class="p">,</span> <span class="n">has_pymatgen</span><span class="p">,</span> <span class="n">get_pymatgen_version</span>

<div class="viewcode-block" id="TestPymatgenFromStructureData.test_1"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestPymatgenFromStructureData.test_1">[docs]</a>    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skipIf</span><span class="p">(</span><span class="ow">not</span> <span class="n">has_pymatgen</span><span class="p">(),</span> <span class="s2">&quot;Unable to import pymatgen&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tests the check of periodic boundary conditions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">aiida.orm.nodes.data.structure</span> <span class="k">import</span> <span class="n">StructureData</span>

        <span class="n">struct</span> <span class="o">=</span> <span class="n">StructureData</span><span class="p">()</span>

        <span class="n">struct</span><span class="o">.</span><span class="n">pbc</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">]</span>
        <span class="n">pmg_struct</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">get_pymatgen_structure</span><span class="p">()</span>

        <span class="n">struct</span><span class="o">.</span><span class="n">pbc</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="n">pmg_struct</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">get_pymatgen_structure</span><span class="p">()</span></div>

<div class="viewcode-block" id="TestPymatgenFromStructureData.test_2"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestPymatgenFromStructureData.test_2">[docs]</a>    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skipIf</span><span class="p">(</span><span class="ow">not</span> <span class="n">has_ase</span><span class="p">(),</span> <span class="s2">&quot;Unable to import ase&quot;</span><span class="p">)</span>
    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skipIf</span><span class="p">(</span><span class="ow">not</span> <span class="n">has_pymatgen</span><span class="p">(),</span> <span class="s2">&quot;Unable to import pymatgen&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tests ASE -&gt; StructureData -&gt; pymatgen</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">ase</span>

        <span class="n">aseatoms</span> <span class="o">=</span> <span class="n">ase</span><span class="o">.</span><span class="n">Atoms</span><span class="p">(</span><span class="s1">&#39;Si4&#39;</span><span class="p">,</span> <span class="n">cell</span><span class="o">=</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">),</span> <span class="n">pbc</span><span class="o">=</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>
        <span class="n">aseatoms</span><span class="o">.</span><span class="n">set_scaled_positions</span><span class="p">((</span>
            <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">),</span>
        <span class="p">))</span>

        <span class="n">a_struct</span> <span class="o">=</span> <span class="n">StructureData</span><span class="p">(</span><span class="n">ase</span><span class="o">=</span><span class="n">aseatoms</span><span class="p">)</span>
        <span class="n">p_struct</span> <span class="o">=</span> <span class="n">a_struct</span><span class="o">.</span><span class="n">get_pymatgen_structure</span><span class="p">()</span>

        <span class="n">p_struct_dict</span> <span class="o">=</span> <span class="n">p_struct</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()</span>
        <span class="n">coord_array</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;abc&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">p_struct_dict</span><span class="p">[</span><span class="s1">&#39;sites&#39;</span><span class="p">]]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">coord_array</span><span class="p">)):</span>
            <span class="n">coord_array</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">coord_array</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">coord_array</span><span class="p">,</span> <span class="p">[[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">]])</span></div>

<div class="viewcode-block" id="TestPymatgenFromStructureData.test_3"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestPymatgenFromStructureData.test_3">[docs]</a>    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skipIf</span><span class="p">(</span><span class="ow">not</span> <span class="n">has_ase</span><span class="p">(),</span> <span class="s2">&quot;Unable to import ase&quot;</span><span class="p">)</span>
    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skipIf</span><span class="p">(</span><span class="ow">not</span> <span class="n">has_pymatgen</span><span class="p">(),</span> <span class="s2">&quot;Unable to import pymatgen&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tests the conversion of StructureData to pymatgen&#39;s Molecule</span>
<span class="sd">        (ASE -&gt; StructureData -&gt; pymatgen)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">ase</span>

        <span class="n">aseatoms</span> <span class="o">=</span> <span class="n">ase</span><span class="o">.</span><span class="n">Atoms</span><span class="p">(</span><span class="s1">&#39;Si4&#39;</span><span class="p">,</span> <span class="n">cell</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">pbc</span><span class="o">=</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>
        <span class="n">aseatoms</span><span class="o">.</span><span class="n">set_scaled_positions</span><span class="p">((</span>
            <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">),</span>
        <span class="p">))</span>

        <span class="n">a_struct</span> <span class="o">=</span> <span class="n">StructureData</span><span class="p">(</span><span class="n">ase</span><span class="o">=</span><span class="n">aseatoms</span><span class="p">)</span>
        <span class="n">p_mol</span> <span class="o">=</span> <span class="n">a_struct</span><span class="o">.</span><span class="n">get_pymatgen_molecule</span><span class="p">()</span>

        <span class="n">p_mol_dict</span> <span class="o">=</span> <span class="n">p_mol</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;xyz&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">p_mol_dict</span><span class="p">[</span><span class="s1">&#39;sites&#39;</span><span class="p">]],</span>
                          <span class="p">[[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">]])</span></div>

<div class="viewcode-block" id="TestPymatgenFromStructureData.test_roundtrip"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestPymatgenFromStructureData.test_roundtrip">[docs]</a>    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skipIf</span><span class="p">(</span><span class="ow">not</span> <span class="n">has_pymatgen</span><span class="p">(),</span> <span class="s2">&quot;Unable to import pymatgen&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_roundtrip</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tests roundtrip StructureData -&gt; pymatgen -&gt; StructureData</span>
<span class="sd">        (no spins)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">StructureData</span><span class="p">(</span><span class="n">cell</span><span class="o">=</span><span class="p">[[</span><span class="mf">5.6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">5.6</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">5.6</span><span class="p">]])</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Cl&#39;</span><span class="p">)</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">2.8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">2.8</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Cl&#39;</span><span class="p">)</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">2.8</span><span class="p">,</span> <span class="mf">2.8</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Cl&#39;</span><span class="p">)</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">2.8</span><span class="p">,</span> <span class="mf">2.8</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Cl&#39;</span><span class="p">)</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">2.8</span><span class="p">,</span> <span class="mf">2.8</span><span class="p">,</span> <span class="mf">2.8</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Na&#39;</span><span class="p">)</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">2.8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Na&#39;</span><span class="p">)</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">2.8</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Na&#39;</span><span class="p">)</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">2.8</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Na&#39;</span><span class="p">)</span>

        <span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">get_pymatgen</span><span class="p">()</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">StructureData</span><span class="p">(</span><span class="n">pymatgen</span><span class="o">=</span><span class="n">b</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">get_site_kindnames</span><span class="p">(),</span> <span class="p">[</span><span class="s1">&#39;Cl&#39;</span><span class="p">,</span> <span class="s1">&#39;Cl&#39;</span><span class="p">,</span> <span class="s1">&#39;Cl&#39;</span><span class="p">,</span> <span class="s1">&#39;Cl&#39;</span><span class="p">,</span> <span class="s1">&#39;Na&#39;</span><span class="p">,</span> <span class="s1">&#39;Na&#39;</span><span class="p">,</span> <span class="s1">&#39;Na&#39;</span><span class="p">,</span> <span class="s1">&#39;Na&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">([</span><span class="n">k</span><span class="o">.</span><span class="n">symbol</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">c</span><span class="o">.</span><span class="n">kinds</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;Cl&#39;</span><span class="p">,</span> <span class="s1">&#39;Na&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">([</span><span class="n">s</span><span class="o">.</span><span class="n">position</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">c</span><span class="o">.</span><span class="n">sites</span><span class="p">],</span> <span class="p">[(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">2.8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">2.8</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">2.8</span><span class="p">,</span> <span class="mf">2.8</span><span class="p">),</span> <span class="p">(</span><span class="mf">2.8</span><span class="p">,</span> <span class="mf">2.8</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                                                          <span class="p">(</span><span class="mf">2.8</span><span class="p">,</span> <span class="mf">2.8</span><span class="p">,</span> <span class="mf">2.8</span><span class="p">),</span> <span class="p">(</span><span class="mf">2.8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">2.8</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">2.8</span><span class="p">)])</span></div>

<div class="viewcode-block" id="TestPymatgenFromStructureData.test_roundtrip_kindnames"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestPymatgenFromStructureData.test_roundtrip_kindnames">[docs]</a>    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skipIf</span><span class="p">(</span><span class="ow">not</span> <span class="n">has_pymatgen</span><span class="p">(),</span> <span class="s2">&quot;Unable to import pymatgen&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_roundtrip_kindnames</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tests roundtrip StructureData -&gt; pymatgen -&gt; StructureData</span>
<span class="sd">        (no spins, but with all kind of kind names)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">StructureData</span><span class="p">(</span><span class="n">cell</span><span class="o">=</span><span class="p">[[</span><span class="mf">5.6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">5.6</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">5.6</span><span class="p">]])</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Cl&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Cl&#39;</span><span class="p">)</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">2.8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">2.8</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Cl&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Cl10&#39;</span><span class="p">)</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">2.8</span><span class="p">,</span> <span class="mf">2.8</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Cl&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Cla&#39;</span><span class="p">)</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">2.8</span><span class="p">,</span> <span class="mf">2.8</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Cl&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;cl_x&#39;</span><span class="p">)</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">2.8</span><span class="p">,</span> <span class="mf">2.8</span><span class="p">,</span> <span class="mf">2.8</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Na&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Na1&#39;</span><span class="p">)</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">2.8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Na&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Na2&#39;</span><span class="p">)</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">2.8</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Na&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Na_Na&#39;</span><span class="p">)</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">2.8</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Na&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Na4&#39;</span><span class="p">)</span>

        <span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">get_pymatgen</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">([</span><span class="n">site</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="s1">&#39;kind_name&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="n">b</span><span class="o">.</span><span class="n">sites</span><span class="p">],</span>
                          <span class="p">[</span><span class="s1">&#39;Cl&#39;</span><span class="p">,</span> <span class="s1">&#39;Cl10&#39;</span><span class="p">,</span> <span class="s1">&#39;Cla&#39;</span><span class="p">,</span> <span class="s1">&#39;cl_x&#39;</span><span class="p">,</span> <span class="s1">&#39;Na1&#39;</span><span class="p">,</span> <span class="s1">&#39;Na2&#39;</span><span class="p">,</span> <span class="s1">&#39;Na_Na&#39;</span><span class="p">,</span> <span class="s1">&#39;Na4&#39;</span><span class="p">])</span>

        <span class="n">c</span> <span class="o">=</span> <span class="n">StructureData</span><span class="p">(</span><span class="n">pymatgen</span><span class="o">=</span><span class="n">b</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">get_site_kindnames</span><span class="p">(),</span> <span class="p">[</span><span class="s1">&#39;Cl&#39;</span><span class="p">,</span> <span class="s1">&#39;Cl10&#39;</span><span class="p">,</span> <span class="s1">&#39;Cla&#39;</span><span class="p">,</span> <span class="s1">&#39;cl_x&#39;</span><span class="p">,</span> <span class="s1">&#39;Na1&#39;</span><span class="p">,</span> <span class="s1">&#39;Na2&#39;</span><span class="p">,</span> <span class="s1">&#39;Na_Na&#39;</span><span class="p">,</span> <span class="s1">&#39;Na4&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">get_symbols_set</span><span class="p">(),</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;Cl&#39;</span><span class="p">,</span> <span class="s1">&#39;Na&#39;</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">([</span><span class="n">s</span><span class="o">.</span><span class="n">position</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">c</span><span class="o">.</span><span class="n">sites</span><span class="p">],</span> <span class="p">[(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">2.8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">2.8</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">2.8</span><span class="p">,</span> <span class="mf">2.8</span><span class="p">),</span> <span class="p">(</span><span class="mf">2.8</span><span class="p">,</span> <span class="mf">2.8</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                                                          <span class="p">(</span><span class="mf">2.8</span><span class="p">,</span> <span class="mf">2.8</span><span class="p">,</span> <span class="mf">2.8</span><span class="p">),</span> <span class="p">(</span><span class="mf">2.8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">2.8</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">2.8</span><span class="p">)])</span></div>

<div class="viewcode-block" id="TestPymatgenFromStructureData.test_roundtrip_spins"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestPymatgenFromStructureData.test_roundtrip_spins">[docs]</a>    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skipIf</span><span class="p">(</span><span class="ow">not</span> <span class="n">has_pymatgen</span><span class="p">(),</span> <span class="s2">&quot;Unable to import pymatgen&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_roundtrip_spins</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tests roundtrip StructureData -&gt; pymatgen -&gt; StructureData</span>
<span class="sd">        (with spins)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">StructureData</span><span class="p">(</span><span class="n">cell</span><span class="o">=</span><span class="p">[[</span><span class="mf">5.6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">5.6</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">5.6</span><span class="p">]])</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Mn&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Mn1&#39;</span><span class="p">)</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">2.8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">2.8</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Mn&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Mn1&#39;</span><span class="p">)</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">2.8</span><span class="p">,</span> <span class="mf">2.8</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Mn&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Mn1&#39;</span><span class="p">)</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">2.8</span><span class="p">,</span> <span class="mf">2.8</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Mn&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Mn1&#39;</span><span class="p">)</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">2.8</span><span class="p">,</span> <span class="mf">2.8</span><span class="p">,</span> <span class="mf">2.8</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Mn&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Mn2&#39;</span><span class="p">)</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">2.8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Mn&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Mn2&#39;</span><span class="p">)</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">2.8</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Mn&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Mn2&#39;</span><span class="p">)</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">2.8</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Mn&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Mn2&#39;</span><span class="p">)</span>

        <span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">get_pymatgen</span><span class="p">(</span><span class="n">add_spin</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># check the spins</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">([</span><span class="n">s</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()[</span><span class="s1">&#39;properties&#39;</span><span class="p">][</span><span class="s1">&#39;spin&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">b</span><span class="o">.</span><span class="n">species</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="c1"># back to StructureData</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">StructureData</span><span class="p">(</span><span class="n">pymatgen</span><span class="o">=</span><span class="n">b</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">get_site_kindnames</span><span class="p">(),</span> <span class="p">[</span><span class="s1">&#39;Mn1&#39;</span><span class="p">,</span> <span class="s1">&#39;Mn1&#39;</span><span class="p">,</span> <span class="s1">&#39;Mn1&#39;</span><span class="p">,</span> <span class="s1">&#39;Mn1&#39;</span><span class="p">,</span> <span class="s1">&#39;Mn2&#39;</span><span class="p">,</span> <span class="s1">&#39;Mn2&#39;</span><span class="p">,</span> <span class="s1">&#39;Mn2&#39;</span><span class="p">,</span> <span class="s1">&#39;Mn2&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">([</span><span class="n">k</span><span class="o">.</span><span class="n">symbol</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">c</span><span class="o">.</span><span class="n">kinds</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;Mn&#39;</span><span class="p">,</span> <span class="s1">&#39;Mn&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">([</span><span class="n">s</span><span class="o">.</span><span class="n">position</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">c</span><span class="o">.</span><span class="n">sites</span><span class="p">],</span> <span class="p">[(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">2.8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">2.8</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">2.8</span><span class="p">,</span> <span class="mf">2.8</span><span class="p">),</span> <span class="p">(</span><span class="mf">2.8</span><span class="p">,</span> <span class="mf">2.8</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                                                          <span class="p">(</span><span class="mf">2.8</span><span class="p">,</span> <span class="mf">2.8</span><span class="p">,</span> <span class="mf">2.8</span><span class="p">),</span> <span class="p">(</span><span class="mf">2.8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">2.8</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">2.8</span><span class="p">)])</span></div>

<div class="viewcode-block" id="TestPymatgenFromStructureData.test_roundtrip_partial_occ"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestPymatgenFromStructureData.test_roundtrip_partial_occ">[docs]</a>    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skipIf</span><span class="p">(</span><span class="ow">not</span> <span class="n">has_pymatgen</span><span class="p">(),</span> <span class="s2">&quot;Unable to import pymatgen&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_roundtrip_partial_occ</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tests roundtrip StructureData -&gt; pymatgen -&gt; StructureData</span>
<span class="sd">        (with partial occupancies).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">StructureData</span><span class="p">(</span><span class="n">cell</span><span class="o">=</span><span class="p">[[</span><span class="mf">4.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mf">2.</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">16.</span><span class="p">]])</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">13.5</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Mn&#39;</span><span class="p">)</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">2.6</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Mn&#39;</span><span class="p">)</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">5.5</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Mn&#39;</span><span class="p">)</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">11.</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Mn&#39;</span><span class="p">)</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">2.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">12.</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Mn&#39;</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">2.2</span><span class="p">,</span> <span class="mf">4.</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Mn&#39;</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">2.2</span><span class="p">,</span> <span class="mf">12.</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Si&#39;</span><span class="p">)</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">2.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">4.</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Si&#39;</span><span class="p">)</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">2.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">15.</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;N&#39;</span><span class="p">)</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">2.2</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;N&#39;</span><span class="p">)</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">2.2</span><span class="p">,</span> <span class="mf">7.</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;N&#39;</span><span class="p">)</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">2.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">9.5</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;N&#39;</span><span class="p">)</span>

        <span class="c1"># a few checks on the structure kinds and symbols</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">get_symbols_set</span><span class="p">(),</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;Mn&#39;</span><span class="p">,</span> <span class="s1">&#39;Si&#39;</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">get_site_kindnames</span><span class="p">(),</span>
                          <span class="p">[</span><span class="s1">&#39;Mn&#39;</span><span class="p">,</span> <span class="s1">&#39;Mn&#39;</span><span class="p">,</span> <span class="s1">&#39;Mn&#39;</span><span class="p">,</span> <span class="s1">&#39;Mn&#39;</span><span class="p">,</span> <span class="s1">&#39;MnX&#39;</span><span class="p">,</span> <span class="s1">&#39;MnX&#39;</span><span class="p">,</span> <span class="s1">&#39;Si&#39;</span><span class="p">,</span> <span class="s1">&#39;Si&#39;</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">get_formula</span><span class="p">(),</span> <span class="s1">&#39;Mn4N4Si2</span><span class="si">{Mn0.80X0.20}</span><span class="s1">2&#39;</span><span class="p">)</span>

        <span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">get_pymatgen</span><span class="p">()</span>
        <span class="c1"># check the partial occupancies</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">([</span><span class="n">s</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">b</span><span class="o">.</span><span class="n">species_and_occu</span><span class="p">],</span> <span class="p">[{</span>
            <span class="s1">&#39;Mn&#39;</span><span class="p">:</span> <span class="mf">1.0</span>
        <span class="p">},</span> <span class="p">{</span>
            <span class="s1">&#39;Mn&#39;</span><span class="p">:</span> <span class="mf">1.0</span>
        <span class="p">},</span> <span class="p">{</span>
            <span class="s1">&#39;Mn&#39;</span><span class="p">:</span> <span class="mf">1.0</span>
        <span class="p">},</span> <span class="p">{</span>
            <span class="s1">&#39;Mn&#39;</span><span class="p">:</span> <span class="mf">1.0</span>
        <span class="p">},</span> <span class="p">{</span>
            <span class="s1">&#39;Mn&#39;</span><span class="p">:</span> <span class="mf">0.8</span>
        <span class="p">},</span> <span class="p">{</span>
            <span class="s1">&#39;Mn&#39;</span><span class="p">:</span> <span class="mf">0.8</span>
        <span class="p">},</span> <span class="p">{</span>
            <span class="s1">&#39;Si&#39;</span><span class="p">:</span> <span class="mf">1.0</span>
        <span class="p">},</span> <span class="p">{</span>
            <span class="s1">&#39;Si&#39;</span><span class="p">:</span> <span class="mf">1.0</span>
        <span class="p">},</span> <span class="p">{</span>
            <span class="s1">&#39;N&#39;</span><span class="p">:</span> <span class="mf">1.0</span>
        <span class="p">},</span> <span class="p">{</span>
            <span class="s1">&#39;N&#39;</span><span class="p">:</span> <span class="mf">1.0</span>
        <span class="p">},</span> <span class="p">{</span>
            <span class="s1">&#39;N&#39;</span><span class="p">:</span> <span class="mf">1.0</span>
        <span class="p">},</span> <span class="p">{</span>
            <span class="s1">&#39;N&#39;</span><span class="p">:</span> <span class="mf">1.0</span>
        <span class="p">}])</span>

        <span class="c1"># back to StructureData</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">StructureData</span><span class="p">(</span><span class="n">pymatgen</span><span class="o">=</span><span class="n">b</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">cell</span><span class="p">,</span> <span class="p">[[</span><span class="mf">4.</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mf">2.</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">16.</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">get_symbols_set</span><span class="p">(),</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;Mn&#39;</span><span class="p">,</span> <span class="s1">&#39;Si&#39;</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">get_site_kindnames</span><span class="p">(),</span>
                          <span class="p">[</span><span class="s1">&#39;Mn&#39;</span><span class="p">,</span> <span class="s1">&#39;Mn&#39;</span><span class="p">,</span> <span class="s1">&#39;Mn&#39;</span><span class="p">,</span> <span class="s1">&#39;Mn&#39;</span><span class="p">,</span> <span class="s1">&#39;MnX&#39;</span><span class="p">,</span> <span class="s1">&#39;MnX&#39;</span><span class="p">,</span> <span class="s1">&#39;Si&#39;</span><span class="p">,</span> <span class="s1">&#39;Si&#39;</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">get_formula</span><span class="p">(),</span> <span class="s1">&#39;Mn4N4Si2</span><span class="si">{Mn0.80X0.20}</span><span class="s1">2&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">([</span><span class="n">s</span><span class="o">.</span><span class="n">position</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">c</span><span class="o">.</span><span class="n">sites</span><span class="p">],</span>
                          <span class="p">[(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">13.5</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">2.6</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">5.5</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">11.</span><span class="p">),</span> <span class="p">(</span><span class="mf">2.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">12.</span><span class="p">),</span>
                           <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">2.2</span><span class="p">,</span> <span class="mf">4.</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">2.2</span><span class="p">,</span> <span class="mf">12.</span><span class="p">),</span> <span class="p">(</span><span class="mf">2.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">4.</span><span class="p">),</span> <span class="p">(</span><span class="mf">2.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">15.</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">2.2</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">),</span>
                           <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">2.2</span><span class="p">,</span> <span class="mf">7.</span><span class="p">),</span> <span class="p">(</span><span class="mf">2.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">9.5</span><span class="p">)])</span></div>

<div class="viewcode-block" id="TestPymatgenFromStructureData.test_partial_occ_and_spin"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestPymatgenFromStructureData.test_partial_occ_and_spin">[docs]</a>    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skipIf</span><span class="p">(</span><span class="ow">not</span> <span class="n">has_pymatgen</span><span class="p">(),</span> <span class="s2">&quot;Unable to import pymatgen&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_partial_occ_and_spin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tests StructureData -&gt; pymatgen, with partial occupancies and spins.</span>
<span class="sd">        This should raise a ValueError.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">StructureData</span><span class="p">(</span><span class="n">cell</span><span class="o">=</span><span class="p">[[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">]])</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;Fe&#39;</span><span class="p">,</span> <span class="s1">&#39;Al&#39;</span><span class="p">),</span> <span class="n">weights</span><span class="o">=</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;FeAl1&#39;</span><span class="p">)</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;Fe&#39;</span><span class="p">,</span> <span class="s1">&#39;Al&#39;</span><span class="p">),</span> <span class="n">weights</span><span class="o">=</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;FeAl2&#39;</span><span class="p">)</span>

        <span class="c1"># a few checks on the structure kinds and symbols</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">get_symbols_set</span><span class="p">(),</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;Fe&#39;</span><span class="p">,</span> <span class="s1">&#39;Al&#39;</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">get_site_kindnames</span><span class="p">(),</span> <span class="p">[</span><span class="s1">&#39;FeAl1&#39;</span><span class="p">,</span> <span class="s1">&#39;FeAl2&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">get_formula</span><span class="p">(),</span> <span class="s1">&#39;</span><span class="si">{Al0.20Fe0.80}</span><span class="s1">2&#39;</span><span class="p">)</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="n">a</span><span class="o">.</span><span class="n">get_pymatgen</span><span class="p">(</span><span class="n">add_spin</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># same, with vacancies</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">StructureData</span><span class="p">(</span><span class="n">cell</span><span class="o">=</span><span class="p">[[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">]])</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Fe&#39;</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;FeX1&#39;</span><span class="p">)</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Fe&#39;</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;FeX2&#39;</span><span class="p">)</span>

        <span class="c1"># a few checks on the structure kinds and symbols</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">get_symbols_set</span><span class="p">(),</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;Fe&#39;</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">get_site_kindnames</span><span class="p">(),</span> <span class="p">[</span><span class="s1">&#39;FeX1&#39;</span><span class="p">,</span> <span class="s1">&#39;FeX2&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">get_formula</span><span class="p">(),</span> <span class="s1">&#39;</span><span class="si">{Fe0.80X0.20}</span><span class="s1">2&#39;</span><span class="p">)</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="n">a</span><span class="o">.</span><span class="n">get_pymatgen</span><span class="p">(</span><span class="n">add_spin</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="TestArrayData"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestArrayData">[docs]</a><span class="k">class</span> <span class="nc">TestArrayData</span><span class="p">(</span><span class="n">AiidaTestCase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Tests the ArrayData objects.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="TestArrayData.test_creation"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestArrayData.test_creation">[docs]</a>    <span class="k">def</span> <span class="nf">test_creation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check the methods to add, remove, modify, and get arrays and</span>
<span class="sd">        array shapes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">numpy</span>

        <span class="c1"># Create a node with two arrays</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">ArrayData</span><span class="p">()</span>
        <span class="n">first</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">n</span><span class="o">.</span><span class="n">set_array</span><span class="p">(</span><span class="s1">&#39;first&#39;</span><span class="p">,</span> <span class="n">first</span><span class="p">)</span>

        <span class="n">second</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">n</span><span class="o">.</span><span class="n">set_array</span><span class="p">(</span><span class="s1">&#39;second&#39;</span><span class="p">,</span> <span class="n">second</span><span class="p">)</span>

        <span class="n">third</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
        <span class="n">n</span><span class="o">.</span><span class="n">set_array</span><span class="p">(</span><span class="s1">&#39;third&#39;</span><span class="p">,</span> <span class="n">third</span><span class="p">)</span>

        <span class="c1"># Check if the arrays are there</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="s1">&#39;first&#39;</span><span class="p">,</span> <span class="s1">&#39;second&#39;</span><span class="p">,</span> <span class="s1">&#39;third&#39;</span><span class="p">]),</span> <span class="nb">set</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">get_arraynames</span><span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEquals</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">first</span> <span class="o">-</span> <span class="n">n</span><span class="o">.</span><span class="n">get_array</span><span class="p">(</span><span class="s1">&#39;first&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEquals</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">second</span> <span class="o">-</span> <span class="n">n</span><span class="o">.</span><span class="n">get_array</span><span class="p">(</span><span class="s1">&#39;second&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEquals</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">third</span> <span class="o">-</span> <span class="n">n</span><span class="o">.</span><span class="n">get_array</span><span class="p">(</span><span class="s1">&#39;third&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">first</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">n</span><span class="o">.</span><span class="n">get_shape</span><span class="p">(</span><span class="s1">&#39;first&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">second</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">n</span><span class="o">.</span><span class="n">get_shape</span><span class="p">(</span><span class="s1">&#39;second&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">third</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">n</span><span class="o">.</span><span class="n">get_shape</span><span class="p">(</span><span class="s1">&#39;third&#39;</span><span class="p">))</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">KeyError</span><span class="p">):</span>
            <span class="n">n</span><span class="o">.</span><span class="n">get_array</span><span class="p">(</span><span class="s1">&#39;nonexistent_array&#39;</span><span class="p">)</span>

        <span class="c1"># Delete an array, and try to delete a non-existing one</span>
        <span class="n">n</span><span class="o">.</span><span class="n">delete_array</span><span class="p">(</span><span class="s1">&#39;third&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">KeyError</span><span class="p">):</span>
            <span class="n">n</span><span class="o">.</span><span class="n">delete_array</span><span class="p">(</span><span class="s1">&#39;nonexistent_array&#39;</span><span class="p">)</span>

        <span class="c1"># Overwrite an array</span>
        <span class="n">first</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
        <span class="n">n</span><span class="o">.</span><span class="n">set_array</span><span class="p">(</span><span class="s1">&#39;first&#39;</span><span class="p">,</span> <span class="n">first</span><span class="p">)</span>

        <span class="c1"># Check if the arrays are there, and if I am getting the new one</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="s1">&#39;first&#39;</span><span class="p">,</span> <span class="s1">&#39;second&#39;</span><span class="p">]),</span> <span class="nb">set</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">get_arraynames</span><span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEquals</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">first</span> <span class="o">-</span> <span class="n">n</span><span class="o">.</span><span class="n">get_array</span><span class="p">(</span><span class="s1">&#39;first&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEquals</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">second</span> <span class="o">-</span> <span class="n">n</span><span class="o">.</span><span class="n">get_array</span><span class="p">(</span><span class="s1">&#39;second&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">first</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">n</span><span class="o">.</span><span class="n">get_shape</span><span class="p">(</span><span class="s1">&#39;first&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">second</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">n</span><span class="o">.</span><span class="n">get_shape</span><span class="p">(</span><span class="s1">&#39;second&#39;</span><span class="p">))</span>

        <span class="n">n</span><span class="o">.</span><span class="n">store</span><span class="p">()</span>

        <span class="c1"># Same checks, after storing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="s1">&#39;first&#39;</span><span class="p">,</span> <span class="s1">&#39;second&#39;</span><span class="p">]),</span> <span class="nb">set</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">get_arraynames</span><span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEquals</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">first</span> <span class="o">-</span> <span class="n">n</span><span class="o">.</span><span class="n">get_array</span><span class="p">(</span><span class="s1">&#39;first&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEquals</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">second</span> <span class="o">-</span> <span class="n">n</span><span class="o">.</span><span class="n">get_array</span><span class="p">(</span><span class="s1">&#39;second&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">first</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">n</span><span class="o">.</span><span class="n">get_shape</span><span class="p">(</span><span class="s1">&#39;first&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">second</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">n</span><span class="o">.</span><span class="n">get_shape</span><span class="p">(</span><span class="s1">&#39;second&#39;</span><span class="p">))</span>

        <span class="c1"># Same checks, again (this is checking the caching features)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="s1">&#39;first&#39;</span><span class="p">,</span> <span class="s1">&#39;second&#39;</span><span class="p">]),</span> <span class="nb">set</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">get_arraynames</span><span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEquals</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">first</span> <span class="o">-</span> <span class="n">n</span><span class="o">.</span><span class="n">get_array</span><span class="p">(</span><span class="s1">&#39;first&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEquals</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">second</span> <span class="o">-</span> <span class="n">n</span><span class="o">.</span><span class="n">get_array</span><span class="p">(</span><span class="s1">&#39;second&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">first</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">n</span><span class="o">.</span><span class="n">get_shape</span><span class="p">(</span><span class="s1">&#39;first&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">second</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">n</span><span class="o">.</span><span class="n">get_shape</span><span class="p">(</span><span class="s1">&#39;second&#39;</span><span class="p">))</span>

        <span class="c1"># Same checks, after reloading</span>
        <span class="n">n2</span> <span class="o">=</span> <span class="n">load_node</span><span class="p">(</span><span class="n">uuid</span><span class="o">=</span><span class="n">n</span><span class="o">.</span><span class="n">uuid</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="s1">&#39;first&#39;</span><span class="p">,</span> <span class="s1">&#39;second&#39;</span><span class="p">]),</span> <span class="nb">set</span><span class="p">(</span><span class="n">n2</span><span class="o">.</span><span class="n">get_arraynames</span><span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEquals</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">first</span> <span class="o">-</span> <span class="n">n2</span><span class="o">.</span><span class="n">get_array</span><span class="p">(</span><span class="s1">&#39;first&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEquals</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">second</span> <span class="o">-</span> <span class="n">n2</span><span class="o">.</span><span class="n">get_array</span><span class="p">(</span><span class="s1">&#39;second&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">first</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">n2</span><span class="o">.</span><span class="n">get_shape</span><span class="p">(</span><span class="s1">&#39;first&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">second</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">n2</span><span class="o">.</span><span class="n">get_shape</span><span class="p">(</span><span class="s1">&#39;second&#39;</span><span class="p">))</span>

        <span class="c1"># Same checks, after reloading with UUID</span>
        <span class="n">n2</span> <span class="o">=</span> <span class="n">load_node</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">uuid</span><span class="p">,</span> <span class="n">sub_classes</span><span class="o">=</span><span class="p">(</span><span class="n">ArrayData</span><span class="p">,))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="s1">&#39;first&#39;</span><span class="p">,</span> <span class="s1">&#39;second&#39;</span><span class="p">]),</span> <span class="nb">set</span><span class="p">(</span><span class="n">n2</span><span class="o">.</span><span class="n">get_arraynames</span><span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEquals</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">first</span> <span class="o">-</span> <span class="n">n2</span><span class="o">.</span><span class="n">get_array</span><span class="p">(</span><span class="s1">&#39;first&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEquals</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">second</span> <span class="o">-</span> <span class="n">n2</span><span class="o">.</span><span class="n">get_array</span><span class="p">(</span><span class="s1">&#39;second&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">first</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">n2</span><span class="o">.</span><span class="n">get_shape</span><span class="p">(</span><span class="s1">&#39;first&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">second</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">n2</span><span class="o">.</span><span class="n">get_shape</span><span class="p">(</span><span class="s1">&#39;second&#39;</span><span class="p">))</span>

        <span class="c1"># Check that I cannot modify the node after storing</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">ModificationNotAllowed</span><span class="p">):</span>
            <span class="n">n</span><span class="o">.</span><span class="n">delete_array</span><span class="p">(</span><span class="s1">&#39;first&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">ModificationNotAllowed</span><span class="p">):</span>
            <span class="n">n</span><span class="o">.</span><span class="n">set_array</span><span class="p">(</span><span class="s1">&#39;second&#39;</span><span class="p">,</span> <span class="n">first</span><span class="p">)</span>

        <span class="c1"># Again same checks, to verify that the attempts to delete/overwrite</span>
        <span class="c1"># arrays did not damage the node content</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="s1">&#39;first&#39;</span><span class="p">,</span> <span class="s1">&#39;second&#39;</span><span class="p">]),</span> <span class="nb">set</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">get_arraynames</span><span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEquals</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">first</span> <span class="o">-</span> <span class="n">n</span><span class="o">.</span><span class="n">get_array</span><span class="p">(</span><span class="s1">&#39;first&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEquals</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">second</span> <span class="o">-</span> <span class="n">n</span><span class="o">.</span><span class="n">get_array</span><span class="p">(</span><span class="s1">&#39;second&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">first</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">n</span><span class="o">.</span><span class="n">get_shape</span><span class="p">(</span><span class="s1">&#39;first&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">second</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">n</span><span class="o">.</span><span class="n">get_shape</span><span class="p">(</span><span class="s1">&#39;second&#39;</span><span class="p">))</span></div>

<div class="viewcode-block" id="TestArrayData.test_iteration"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestArrayData.test_iteration">[docs]</a>    <span class="k">def</span> <span class="nf">test_iteration</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check the functionality of the get_iterarrays() iterator</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">numpy</span>

        <span class="c1"># Create a node with two arrays</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">ArrayData</span><span class="p">()</span>
        <span class="n">first</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">n</span><span class="o">.</span><span class="n">set_array</span><span class="p">(</span><span class="s1">&#39;first&#39;</span><span class="p">,</span> <span class="n">first</span><span class="p">)</span>

        <span class="n">second</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">n</span><span class="o">.</span><span class="n">set_array</span><span class="p">(</span><span class="s1">&#39;second&#39;</span><span class="p">,</span> <span class="n">second</span><span class="p">)</span>

        <span class="n">third</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
        <span class="n">n</span><span class="o">.</span><span class="n">set_array</span><span class="p">(</span><span class="s1">&#39;third&#39;</span><span class="p">,</span> <span class="n">third</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">array</span> <span class="ow">in</span> <span class="n">n</span><span class="o">.</span><span class="n">get_iterarrays</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;first&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEquals</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">first</span> <span class="o">-</span> <span class="n">array</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mf">0.</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;second&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEquals</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">second</span> <span class="o">-</span> <span class="n">array</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mf">0.</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;third&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEquals</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">third</span> <span class="o">-</span> <span class="n">array</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mf">0.</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="TestTrajectoryData"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestTrajectoryData">[docs]</a><span class="k">class</span> <span class="nc">TestTrajectoryData</span><span class="p">(</span><span class="n">AiidaTestCase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Tests the TrajectoryData objects.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="TestTrajectoryData.test_creation"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestTrajectoryData.test_creation">[docs]</a>    <span class="k">def</span> <span class="nf">test_creation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check the methods to set and retrieve a trajectory.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">numpy</span>

        <span class="c1"># Create a node with two arrays</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">TrajectoryData</span><span class="p">()</span>

        <span class="c1"># I create sample data</span>
        <span class="n">stepids</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">60</span><span class="p">,</span> <span class="mi">70</span><span class="p">])</span>
        <span class="n">times</span> <span class="o">=</span> <span class="n">stepids</span> <span class="o">*</span> <span class="mf">0.01</span>
        <span class="n">cells</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[[</span>
            <span class="mf">2.</span><span class="p">,</span>
            <span class="mf">0.</span><span class="p">,</span>
            <span class="mf">0.</span><span class="p">,</span>
        <span class="p">],</span> <span class="p">[</span>
            <span class="mf">0.</span><span class="p">,</span>
            <span class="mf">2.</span><span class="p">,</span>
            <span class="mf">0.</span><span class="p">,</span>
        <span class="p">],</span> <span class="p">[</span>
            <span class="mf">0.</span><span class="p">,</span>
            <span class="mf">0.</span><span class="p">,</span>
            <span class="mf">2.</span><span class="p">,</span>
        <span class="p">]],</span> <span class="p">[[</span>
            <span class="mf">3.</span><span class="p">,</span>
            <span class="mf">0.</span><span class="p">,</span>
            <span class="mf">0.</span><span class="p">,</span>
        <span class="p">],</span> <span class="p">[</span>
            <span class="mf">0.</span><span class="p">,</span>
            <span class="mf">3.</span><span class="p">,</span>
            <span class="mf">0.</span><span class="p">,</span>
        <span class="p">],</span> <span class="p">[</span>
            <span class="mf">0.</span><span class="p">,</span>
            <span class="mf">0.</span><span class="p">,</span>
            <span class="mf">3.</span><span class="p">,</span>
        <span class="p">]]])</span>
        <span class="n">symbols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">]</span>
        <span class="n">positions</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">]],</span> <span class="p">[[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span>
                                                                                    <span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">]]])</span>
        <span class="n">velocities</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">]],</span> <span class="p">[[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span>
                                                                               <span class="p">[</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">]]])</span>

        <span class="c1"># I set the node</span>
        <span class="n">n</span><span class="o">.</span><span class="n">set_trajectory</span><span class="p">(</span>
            <span class="n">stepids</span><span class="o">=</span><span class="n">stepids</span><span class="p">,</span> <span class="n">cells</span><span class="o">=</span><span class="n">cells</span><span class="p">,</span> <span class="n">symbols</span><span class="o">=</span><span class="n">symbols</span><span class="p">,</span> <span class="n">positions</span><span class="o">=</span><span class="n">positions</span><span class="p">,</span> <span class="n">times</span><span class="o">=</span><span class="n">times</span><span class="p">,</span> <span class="n">velocities</span><span class="o">=</span><span class="n">velocities</span><span class="p">)</span>

        <span class="c1"># Generic checks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">numsites</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">numsteps</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">stepids</span> <span class="o">-</span> <span class="n">n</span><span class="o">.</span><span class="n">get_stepids</span><span class="p">())</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">times</span> <span class="o">-</span> <span class="n">n</span><span class="o">.</span><span class="n">get_times</span><span class="p">())</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">cells</span> <span class="o">-</span> <span class="n">n</span><span class="o">.</span><span class="n">get_cells</span><span class="p">())</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">symbols</span><span class="p">,</span> <span class="n">n</span><span class="o">.</span><span class="n">symbols</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">positions</span> <span class="o">-</span> <span class="n">n</span><span class="o">.</span><span class="n">get_positions</span><span class="p">())</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">velocities</span> <span class="o">-</span> <span class="n">n</span><span class="o">.</span><span class="n">get_velocities</span><span class="p">())</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="mf">0.</span><span class="p">)</span>

        <span class="c1"># get_step_data function check</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">get_step_data</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">stepids</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">times</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">cells</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">symbols</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">-</span> <span class="n">positions</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">-</span> <span class="n">velocities</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="mf">0.</span><span class="p">)</span>

        <span class="c1"># Step 70 has index 1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="o">.</span><span class="n">get_index_from_stepid</span><span class="p">(</span><span class="mi">70</span><span class="p">))</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="c1"># Step 66 does not exist</span>
            <span class="n">n</span><span class="o">.</span><span class="n">get_index_from_stepid</span><span class="p">(</span><span class="mi">66</span><span class="p">)</span>

        <span class="c1">########################################################</span>
        <span class="c1"># I set the node, this time without times or velocities (the same node)</span>
        <span class="n">n</span><span class="o">.</span><span class="n">set_trajectory</span><span class="p">(</span><span class="n">stepids</span><span class="o">=</span><span class="n">stepids</span><span class="p">,</span> <span class="n">cells</span><span class="o">=</span><span class="n">cells</span><span class="p">,</span> <span class="n">symbols</span><span class="o">=</span><span class="n">symbols</span><span class="p">,</span> <span class="n">positions</span><span class="o">=</span><span class="n">positions</span><span class="p">)</span>
        <span class="c1"># Generic checks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">numsites</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">numsteps</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">stepids</span> <span class="o">-</span> <span class="n">n</span><span class="o">.</span><span class="n">get_stepids</span><span class="p">())</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">get_times</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">cells</span> <span class="o">-</span> <span class="n">n</span><span class="o">.</span><span class="n">get_cells</span><span class="p">())</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">symbols</span><span class="p">,</span> <span class="n">n</span><span class="o">.</span><span class="n">symbols</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">positions</span> <span class="o">-</span> <span class="n">n</span><span class="o">.</span><span class="n">get_positions</span><span class="p">())</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">get_velocities</span><span class="p">())</span>

        <span class="c1"># Same thing, but for a new node</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">TrajectoryData</span><span class="p">()</span>
        <span class="n">n</span><span class="o">.</span><span class="n">set_trajectory</span><span class="p">(</span><span class="n">stepids</span><span class="o">=</span><span class="n">stepids</span><span class="p">,</span> <span class="n">cells</span><span class="o">=</span><span class="n">cells</span><span class="p">,</span> <span class="n">symbols</span><span class="o">=</span><span class="n">symbols</span><span class="p">,</span> <span class="n">positions</span><span class="o">=</span><span class="n">positions</span><span class="p">)</span>
        <span class="c1"># Generic checks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">numsites</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">numsteps</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">stepids</span> <span class="o">-</span> <span class="n">n</span><span class="o">.</span><span class="n">get_stepids</span><span class="p">())</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">get_times</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">cells</span> <span class="o">-</span> <span class="n">n</span><span class="o">.</span><span class="n">get_cells</span><span class="p">())</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">symbols</span><span class="p">,</span> <span class="n">n</span><span class="o">.</span><span class="n">symbols</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">positions</span> <span class="o">-</span> <span class="n">n</span><span class="o">.</span><span class="n">get_positions</span><span class="p">())</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">get_velocities</span><span class="p">())</span>

        <span class="c1">########################################################</span>
        <span class="c1"># I set the node, this time without velocities (the same node)</span>
        <span class="n">n</span><span class="o">.</span><span class="n">set_trajectory</span><span class="p">(</span><span class="n">stepids</span><span class="o">=</span><span class="n">stepids</span><span class="p">,</span> <span class="n">cells</span><span class="o">=</span><span class="n">cells</span><span class="p">,</span> <span class="n">symbols</span><span class="o">=</span><span class="n">symbols</span><span class="p">,</span> <span class="n">positions</span><span class="o">=</span><span class="n">positions</span><span class="p">,</span> <span class="n">times</span><span class="o">=</span><span class="n">times</span><span class="p">)</span>
        <span class="c1"># Generic checks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">numsites</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">numsteps</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">stepids</span> <span class="o">-</span> <span class="n">n</span><span class="o">.</span><span class="n">get_stepids</span><span class="p">())</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">times</span> <span class="o">-</span> <span class="n">n</span><span class="o">.</span><span class="n">get_times</span><span class="p">())</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">cells</span> <span class="o">-</span> <span class="n">n</span><span class="o">.</span><span class="n">get_cells</span><span class="p">())</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">symbols</span><span class="p">,</span> <span class="n">n</span><span class="o">.</span><span class="n">symbols</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">positions</span> <span class="o">-</span> <span class="n">n</span><span class="o">.</span><span class="n">get_positions</span><span class="p">())</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">get_velocities</span><span class="p">())</span>

        <span class="c1"># Same thing, but for a new node</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">TrajectoryData</span><span class="p">()</span>
        <span class="n">n</span><span class="o">.</span><span class="n">set_trajectory</span><span class="p">(</span><span class="n">stepids</span><span class="o">=</span><span class="n">stepids</span><span class="p">,</span> <span class="n">cells</span><span class="o">=</span><span class="n">cells</span><span class="p">,</span> <span class="n">symbols</span><span class="o">=</span><span class="n">symbols</span><span class="p">,</span> <span class="n">positions</span><span class="o">=</span><span class="n">positions</span><span class="p">,</span> <span class="n">times</span><span class="o">=</span><span class="n">times</span><span class="p">)</span>
        <span class="c1"># Generic checks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">numsites</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">numsteps</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">stepids</span> <span class="o">-</span> <span class="n">n</span><span class="o">.</span><span class="n">get_stepids</span><span class="p">())</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">times</span> <span class="o">-</span> <span class="n">n</span><span class="o">.</span><span class="n">get_times</span><span class="p">())</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">cells</span> <span class="o">-</span> <span class="n">n</span><span class="o">.</span><span class="n">get_cells</span><span class="p">())</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">symbols</span><span class="p">,</span> <span class="n">n</span><span class="o">.</span><span class="n">symbols</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">positions</span> <span class="o">-</span> <span class="n">n</span><span class="o">.</span><span class="n">get_positions</span><span class="p">())</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">get_velocities</span><span class="p">())</span>

        <span class="n">n</span><span class="o">.</span><span class="n">store</span><span class="p">()</span>

        <span class="c1"># Again same checks, but after storing</span>
        <span class="c1"># Generic checks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">numsites</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">numsteps</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">stepids</span> <span class="o">-</span> <span class="n">n</span><span class="o">.</span><span class="n">get_stepids</span><span class="p">())</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">times</span> <span class="o">-</span> <span class="n">n</span><span class="o">.</span><span class="n">get_times</span><span class="p">())</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">cells</span> <span class="o">-</span> <span class="n">n</span><span class="o">.</span><span class="n">get_cells</span><span class="p">())</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">symbols</span><span class="p">,</span> <span class="n">n</span><span class="o">.</span><span class="n">symbols</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">positions</span> <span class="o">-</span> <span class="n">n</span><span class="o">.</span><span class="n">get_positions</span><span class="p">())</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">get_velocities</span><span class="p">())</span>

        <span class="c1"># get_step_data function check</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">get_step_data</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">stepids</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">times</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">cells</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">symbols</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">-</span> <span class="n">positions</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>

        <span class="c1"># Step 70 has index 1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="o">.</span><span class="n">get_index_from_stepid</span><span class="p">(</span><span class="mi">70</span><span class="p">))</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="c1"># Step 66 does not exist</span>
            <span class="n">n</span><span class="o">.</span><span class="n">get_index_from_stepid</span><span class="p">(</span><span class="mi">66</span><span class="p">)</span>

        <span class="c1">##############################################################</span>
        <span class="c1"># Again, but after reloading from uuid</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">load_node</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">uuid</span><span class="p">,</span> <span class="n">sub_classes</span><span class="o">=</span><span class="p">(</span><span class="n">TrajectoryData</span><span class="p">,))</span>
        <span class="c1"># Generic checks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">numsites</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">numsteps</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">stepids</span> <span class="o">-</span> <span class="n">n</span><span class="o">.</span><span class="n">get_stepids</span><span class="p">())</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">times</span> <span class="o">-</span> <span class="n">n</span><span class="o">.</span><span class="n">get_times</span><span class="p">())</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">cells</span> <span class="o">-</span> <span class="n">n</span><span class="o">.</span><span class="n">get_cells</span><span class="p">())</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">symbols</span><span class="p">,</span> <span class="n">n</span><span class="o">.</span><span class="n">symbols</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">positions</span> <span class="o">-</span> <span class="n">n</span><span class="o">.</span><span class="n">get_positions</span><span class="p">())</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">get_velocities</span><span class="p">())</span>

        <span class="c1"># get_step_data function check</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">get_step_data</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">stepids</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">times</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">cells</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">symbols</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">-</span> <span class="n">positions</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>

        <span class="c1"># Step 70 has index 1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="o">.</span><span class="n">get_index_from_stepid</span><span class="p">(</span><span class="mi">70</span><span class="p">))</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="c1"># Step 66 does not exist</span>
            <span class="n">n</span><span class="o">.</span><span class="n">get_index_from_stepid</span><span class="p">(</span><span class="mi">66</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestTrajectoryData.test_conversion_to_structure"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestTrajectoryData.test_conversion_to_structure">[docs]</a>    <span class="k">def</span> <span class="nf">test_conversion_to_structure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check the methods to export a given time step to a StructureData node.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">numpy</span>

        <span class="c1"># Create a node with two arrays</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">TrajectoryData</span><span class="p">()</span>

        <span class="c1"># I create sample data</span>
        <span class="n">stepids</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">60</span><span class="p">,</span> <span class="mi">70</span><span class="p">])</span>
        <span class="n">times</span> <span class="o">=</span> <span class="n">stepids</span> <span class="o">*</span> <span class="mf">0.01</span>
        <span class="n">cells</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[[</span>
            <span class="mf">2.</span><span class="p">,</span>
            <span class="mf">0.</span><span class="p">,</span>
            <span class="mf">0.</span><span class="p">,</span>
        <span class="p">],</span> <span class="p">[</span>
            <span class="mf">0.</span><span class="p">,</span>
            <span class="mf">2.</span><span class="p">,</span>
            <span class="mf">0.</span><span class="p">,</span>
        <span class="p">],</span> <span class="p">[</span>
            <span class="mf">0.</span><span class="p">,</span>
            <span class="mf">0.</span><span class="p">,</span>
            <span class="mf">2.</span><span class="p">,</span>
        <span class="p">]],</span> <span class="p">[[</span>
            <span class="mf">3.</span><span class="p">,</span>
            <span class="mf">0.</span><span class="p">,</span>
            <span class="mf">0.</span><span class="p">,</span>
        <span class="p">],</span> <span class="p">[</span>
            <span class="mf">0.</span><span class="p">,</span>
            <span class="mf">3.</span><span class="p">,</span>
            <span class="mf">0.</span><span class="p">,</span>
        <span class="p">],</span> <span class="p">[</span>
            <span class="mf">0.</span><span class="p">,</span>
            <span class="mf">0.</span><span class="p">,</span>
            <span class="mf">3.</span><span class="p">,</span>
        <span class="p">]]])</span>
        <span class="n">symbols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">]</span>
        <span class="n">positions</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">]],</span> <span class="p">[[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span>
                                                                                    <span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">]]])</span>
        <span class="n">velocities</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">]],</span> <span class="p">[[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span>
                                                                               <span class="p">[</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">]]])</span>

        <span class="c1"># I set the node</span>
        <span class="n">n</span><span class="o">.</span><span class="n">set_trajectory</span><span class="p">(</span>
            <span class="n">stepids</span><span class="o">=</span><span class="n">stepids</span><span class="p">,</span> <span class="n">cells</span><span class="o">=</span><span class="n">cells</span><span class="p">,</span> <span class="n">symbols</span><span class="o">=</span><span class="n">symbols</span><span class="p">,</span> <span class="n">positions</span><span class="o">=</span><span class="n">positions</span><span class="p">,</span> <span class="n">times</span><span class="o">=</span><span class="n">times</span><span class="p">,</span> <span class="n">velocities</span><span class="o">=</span><span class="n">velocities</span><span class="p">)</span>

        <span class="n">from_step</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">get_step_structure</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">from_get_structure</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">get_structure</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">struc</span> <span class="ow">in</span> <span class="p">[</span><span class="n">from_step</span><span class="p">,</span> <span class="n">from_get_structure</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">struc</span><span class="o">.</span><span class="n">sites</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>  <span class="c1"># 3 sites</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">struc</span><span class="o">.</span><span class="n">cell</span><span class="p">)</span> <span class="o">-</span> <span class="n">cells</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">newpos</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">s</span><span class="o">.</span><span class="n">position</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">struc</span><span class="o">.</span><span class="n">sites</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">newpos</span> <span class="o">-</span> <span class="n">positions</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">newkinds</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">kind_name</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">struc</span><span class="o">.</span><span class="n">sites</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">newkinds</span><span class="p">,</span> <span class="n">symbols</span><span class="p">)</span>

            <span class="c1"># Weird assignments (nobody should ever do this, but it is possible in</span>
            <span class="c1"># principle and we want to check</span>
            <span class="n">k1</span> <span class="o">=</span> <span class="n">Kind</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Cu&#39;</span><span class="p">)</span>
            <span class="n">k2</span> <span class="o">=</span> <span class="n">Kind</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;He&#39;</span><span class="p">)</span>
            <span class="n">k3</span> <span class="o">=</span> <span class="n">Kind</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Os&#39;</span><span class="p">,</span> <span class="n">mass</span><span class="o">=</span><span class="mf">100.</span><span class="p">)</span>
            <span class="n">k4</span> <span class="o">=</span> <span class="n">Kind</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Ge&#39;</span><span class="p">,</span> <span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Ge&#39;</span><span class="p">)</span>

            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
                <span class="c1"># Not enough kinds</span>
                <span class="n">struc</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">get_step_structure</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">custom_kinds</span><span class="o">=</span><span class="p">[</span><span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">])</span>

            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
                <span class="c1"># Too many kinds</span>
                <span class="n">struc</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">get_step_structure</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">custom_kinds</span><span class="o">=</span><span class="p">[</span><span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">,</span> <span class="n">k3</span><span class="p">,</span> <span class="n">k4</span><span class="p">])</span>

            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
                <span class="c1"># Wrong kinds</span>
                <span class="n">struc</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">get_step_structure</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">custom_kinds</span><span class="o">=</span><span class="p">[</span><span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">,</span> <span class="n">k4</span><span class="p">])</span>

            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
                <span class="c1"># Two kinds with the same name</span>
                <span class="n">struc</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">get_step_structure</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">custom_kinds</span><span class="o">=</span><span class="p">[</span><span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">,</span> <span class="n">k3</span><span class="p">,</span> <span class="n">k3</span><span class="p">])</span>

            <span class="c1"># Correct kinds</span>
            <span class="n">struc</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">get_step_structure</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">custom_kinds</span><span class="o">=</span><span class="p">[</span><span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">,</span> <span class="n">k3</span><span class="p">])</span>

            <span class="c1"># Checks</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">struc</span><span class="o">.</span><span class="n">sites</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>  <span class="c1"># 3 sites</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">struc</span><span class="o">.</span><span class="n">cell</span><span class="p">)</span> <span class="o">-</span> <span class="n">cells</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">newpos</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">s</span><span class="o">.</span><span class="n">position</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">struc</span><span class="o">.</span><span class="n">sites</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">newpos</span> <span class="o">-</span> <span class="n">positions</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">newkinds</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">kind_name</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">struc</span><span class="o">.</span><span class="n">sites</span><span class="p">]</span>
            <span class="c1"># Kinds are in the same order as given in the custm_kinds list</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">newkinds</span><span class="p">,</span> <span class="n">symbols</span><span class="p">)</span>
            <span class="n">newatomtypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">struc</span><span class="o">.</span><span class="n">get_kind</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">kind_name</span><span class="p">)</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">struc</span><span class="o">.</span><span class="n">sites</span><span class="p">]</span>
            <span class="c1"># Atoms remain in the same order as given in the positions list</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">newatomtypes</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;He&#39;</span><span class="p">,</span> <span class="s1">&#39;Os&#39;</span><span class="p">,</span> <span class="s1">&#39;Cu&#39;</span><span class="p">])</span>
            <span class="c1"># Check the mass of the kind of the second atom (&#39;O&#39; _&gt; symbol Os, mass 100)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">struc</span><span class="o">.</span><span class="n">get_kind</span><span class="p">(</span><span class="n">struc</span><span class="o">.</span><span class="n">sites</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">kind_name</span><span class="p">)</span><span class="o">.</span><span class="n">mass</span><span class="p">,</span> <span class="mf">100.</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestTrajectoryData.test_conversion_from_structurelist"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestTrajectoryData.test_conversion_from_structurelist">[docs]</a>    <span class="k">def</span> <span class="nf">test_conversion_from_structurelist</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check the method to create a TrajectoryData from list of AiiDA</span>
<span class="sd">        structures.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cells</span> <span class="o">=</span> <span class="p">[[[</span>
            <span class="mf">2.</span><span class="p">,</span>
            <span class="mf">0.</span><span class="p">,</span>
            <span class="mf">0.</span><span class="p">,</span>
        <span class="p">],</span> <span class="p">[</span>
            <span class="mf">0.</span><span class="p">,</span>
            <span class="mf">2.</span><span class="p">,</span>
            <span class="mf">0.</span><span class="p">,</span>
        <span class="p">],</span> <span class="p">[</span>
            <span class="mf">0.</span><span class="p">,</span>
            <span class="mf">0.</span><span class="p">,</span>
            <span class="mf">2.</span><span class="p">,</span>
        <span class="p">]],</span> <span class="p">[[</span>
            <span class="mf">3.</span><span class="p">,</span>
            <span class="mf">0.</span><span class="p">,</span>
            <span class="mf">0.</span><span class="p">,</span>
        <span class="p">],</span> <span class="p">[</span>
            <span class="mf">0.</span><span class="p">,</span>
            <span class="mf">3.</span><span class="p">,</span>
            <span class="mf">0.</span><span class="p">,</span>
        <span class="p">],</span> <span class="p">[</span>
            <span class="mf">0.</span><span class="p">,</span>
            <span class="mf">0.</span><span class="p">,</span>
            <span class="mf">3.</span><span class="p">,</span>
        <span class="p">]]]</span>
        <span class="n">symbols</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">]]</span>
        <span class="n">positions</span> <span class="o">=</span> <span class="p">[[[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">]],</span> <span class="p">[[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.75</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">],</span>
                                                                        <span class="p">[</span><span class="mf">1.25</span><span class="p">,</span> <span class="mf">1.25</span><span class="p">,</span> <span class="mf">1.25</span><span class="p">]]]</span>
        <span class="n">structurelist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
            <span class="n">struct</span> <span class="o">=</span> <span class="n">StructureData</span><span class="p">(</span><span class="n">cell</span><span class="o">=</span><span class="n">cells</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">symbol</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">symbols</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
                <span class="n">struct</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">symbols</span><span class="o">=</span><span class="n">symbol</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="n">positions</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
            <span class="n">structurelist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">struct</span><span class="p">)</span>

        <span class="n">td</span> <span class="o">=</span> <span class="n">TrajectoryData</span><span class="p">(</span><span class="n">structurelist</span><span class="o">=</span><span class="n">structurelist</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">td</span><span class="o">.</span><span class="n">get_cells</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">cells</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">td</span><span class="o">.</span><span class="n">symbols</span><span class="p">,</span> <span class="n">symbols</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">td</span><span class="o">.</span><span class="n">get_positions</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">positions</span><span class="p">)</span>

        <span class="n">symbols</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">]]</span>
        <span class="n">structurelist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
            <span class="n">struct</span> <span class="o">=</span> <span class="n">StructureData</span><span class="p">(</span><span class="n">cell</span><span class="o">=</span><span class="n">cells</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">symbol</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">symbols</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
                <span class="n">struct</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">symbols</span><span class="o">=</span><span class="n">symbol</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="n">positions</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
            <span class="n">structurelist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">struct</span><span class="p">)</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="n">td</span> <span class="o">=</span> <span class="n">TrajectoryData</span><span class="p">(</span><span class="n">structurelist</span><span class="o">=</span><span class="n">structurelist</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestTrajectoryData.test_export_to_file"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestTrajectoryData.test_export_to_file">[docs]</a>    <span class="k">def</span> <span class="nf">test_export_to_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Export the band structure on a file, check if it is working</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">numpy</span>
        <span class="kn">import</span> <span class="nn">os</span>
        <span class="kn">from</span> <span class="nn">aiida.orm.nodes.data.cif</span> <span class="k">import</span> <span class="n">has_pycifrw</span>

        <span class="n">n</span> <span class="o">=</span> <span class="n">TrajectoryData</span><span class="p">()</span>

        <span class="c1"># I create sample data</span>
        <span class="n">stepids</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">60</span><span class="p">,</span> <span class="mi">70</span><span class="p">])</span>
        <span class="n">times</span> <span class="o">=</span> <span class="n">stepids</span> <span class="o">*</span> <span class="mf">0.01</span>
        <span class="n">cells</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[[</span>
            <span class="mf">2.</span><span class="p">,</span>
            <span class="mf">0.</span><span class="p">,</span>
            <span class="mf">0.</span><span class="p">,</span>
        <span class="p">],</span> <span class="p">[</span>
            <span class="mf">0.</span><span class="p">,</span>
            <span class="mf">2.</span><span class="p">,</span>
            <span class="mf">0.</span><span class="p">,</span>
        <span class="p">],</span> <span class="p">[</span>
            <span class="mf">0.</span><span class="p">,</span>
            <span class="mf">0.</span><span class="p">,</span>
            <span class="mf">2.</span><span class="p">,</span>
        <span class="p">]],</span> <span class="p">[[</span>
            <span class="mf">3.</span><span class="p">,</span>
            <span class="mf">0.</span><span class="p">,</span>
            <span class="mf">0.</span><span class="p">,</span>
        <span class="p">],</span> <span class="p">[</span>
            <span class="mf">0.</span><span class="p">,</span>
            <span class="mf">3.</span><span class="p">,</span>
            <span class="mf">0.</span><span class="p">,</span>
        <span class="p">],</span> <span class="p">[</span>
            <span class="mf">0.</span><span class="p">,</span>
            <span class="mf">0.</span><span class="p">,</span>
            <span class="mf">3.</span><span class="p">,</span>
        <span class="p">]]])</span>
        <span class="n">symbols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">]</span>
        <span class="n">positions</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">]],</span> <span class="p">[[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span>
                                                                                    <span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">]]])</span>
        <span class="n">velocities</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">]],</span> <span class="p">[[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span>
                                                                               <span class="p">[</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">]]])</span>

        <span class="c1"># I set the node</span>
        <span class="n">n</span><span class="o">.</span><span class="n">set_trajectory</span><span class="p">(</span>
            <span class="n">stepids</span><span class="o">=</span><span class="n">stepids</span><span class="p">,</span> <span class="n">cells</span><span class="o">=</span><span class="n">cells</span><span class="p">,</span> <span class="n">symbols</span><span class="o">=</span><span class="n">symbols</span><span class="p">,</span> <span class="n">positions</span><span class="o">=</span><span class="n">positions</span><span class="p">,</span> <span class="n">times</span><span class="o">=</span><span class="n">times</span><span class="p">,</span> <span class="n">velocities</span><span class="o">=</span><span class="n">velocities</span><span class="p">)</span>

        <span class="c1"># define a cell</span>
        <span class="n">alat</span> <span class="o">=</span> <span class="mf">4.</span>
        <span class="n">cell</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
            <span class="p">[</span><span class="n">alat</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span>
            <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="n">alat</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span>
            <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">alat</span><span class="p">],</span>
        <span class="p">])</span>

        <span class="c1"># It is not obvious how to check that the bands are correct.</span>
        <span class="c1"># I just check, for a few formats, that the file is correctly</span>
        <span class="c1"># created, at this stage</span>
        <span class="c1">## I use this to get a file. I then close it and ask the .export() function</span>
        <span class="c1">## to create it again. I have to remember to delete everything at the end.</span>
        <span class="n">handle</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkstemp</span><span class="p">()</span>
        <span class="n">os</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">has_pycifrw</span><span class="p">():</span>
            <span class="n">formats_to_test</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;cif&#39;</span><span class="p">,</span> <span class="s1">&#39;xsf&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">formats_to_test</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;xsf&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="nb">format</span> <span class="ow">in</span> <span class="n">formats_to_test</span><span class="p">:</span>
            <span class="n">files_created</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># In case there is an exception</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">files_created</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">export</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">fileformat</span><span class="o">=</span><span class="nb">format</span><span class="p">)</span>
                <span class="k">with</span> <span class="n">io</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fhandle</span><span class="p">:</span>
                    <span class="n">filedata</span> <span class="o">=</span> <span class="n">fhandle</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files_created</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file</span><span class="p">):</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">file</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="TestKpointsData"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestKpointsData">[docs]</a><span class="k">class</span> <span class="nc">TestKpointsData</span><span class="p">(</span><span class="n">AiidaTestCase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Tests the KpointsData objects.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="TestKpointsData.test_set_kpoints_path_legacy"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestKpointsData.test_set_kpoints_path_legacy">[docs]</a>    <span class="k">def</span> <span class="nf">test_set_kpoints_path_legacy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Regression test for the deprecated KpointsData.set_kpoints_path method.</span>
<span class="sd">        For certain formats of a direct kpoint list, it is not necessary to have defined a cell.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">numpy</span>
        <span class="kn">from</span> <span class="nn">aiida.orm.nodes.data.array.kpoints</span> <span class="k">import</span> <span class="n">KpointsData</span>

        <span class="c1"># Create a node with two arrays</span>
        <span class="n">kpoints_01</span> <span class="o">=</span> <span class="n">KpointsData</span><span class="p">()</span>
        <span class="n">kpoints_02</span> <span class="o">=</span> <span class="n">KpointsData</span><span class="p">()</span>
        <span class="n">kpoints_03</span> <span class="o">=</span> <span class="n">KpointsData</span><span class="p">()</span>
        <span class="n">kpoints_04</span> <span class="o">=</span> <span class="n">KpointsData</span><span class="p">()</span>

        <span class="c1"># The various allowed formats</span>
        <span class="n">format_01</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">)]</span>
        <span class="n">format_02</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="mi">30</span><span class="p">)]</span>
        <span class="n">format_03</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))]</span>
        <span class="n">format_04</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">30</span><span class="p">)]</span>

        <span class="c1"># Without a cell defined, the first two should fail, the last two should work</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="n">kpoints_01</span><span class="o">.</span><span class="n">set_kpoints_path</span><span class="p">(</span><span class="n">format_01</span><span class="p">)</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="n">kpoints_02</span><span class="o">.</span><span class="n">set_kpoints_path</span><span class="p">(</span><span class="n">format_02</span><span class="p">)</span>

        <span class="n">kpoints_03</span><span class="o">.</span><span class="n">set_kpoints_path</span><span class="p">(</span><span class="n">format_03</span><span class="p">)</span>
        <span class="n">kpoints_04</span><span class="o">.</span><span class="n">set_kpoints_path</span><span class="p">(</span><span class="n">format_04</span><span class="p">)</span>

        <span class="c1"># Define a cell and settings it enable the usage of formats 1 and 2</span>
        <span class="n">alat</span> <span class="o">=</span> <span class="mf">4.</span>
        <span class="n">cell</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
            <span class="p">[</span><span class="n">alat</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span>
            <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="n">alat</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span>
            <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">alat</span><span class="p">],</span>
        <span class="p">])</span>

        <span class="n">kpoints_01</span><span class="o">.</span><span class="n">set_cell</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span>
        <span class="n">kpoints_02</span><span class="o">.</span><span class="n">set_cell</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span>

        <span class="n">kpoints_01</span><span class="o">.</span><span class="n">set_kpoints_path</span><span class="p">(</span><span class="n">format_01</span><span class="p">)</span>
        <span class="n">kpoints_02</span><span class="o">.</span><span class="n">set_kpoints_path</span><span class="p">(</span><span class="n">format_02</span><span class="p">)</span>
        <span class="n">kpoints_03</span><span class="o">.</span><span class="n">set_kpoints_path</span><span class="p">(</span><span class="n">format_03</span><span class="p">)</span>
        <span class="n">kpoints_04</span><span class="o">.</span><span class="n">set_kpoints_path</span><span class="p">(</span><span class="n">format_04</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestKpointsData.test_mesh"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestKpointsData.test_mesh">[docs]</a>    <span class="k">def</span> <span class="nf">test_mesh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check the methods to set and retrieve a mesh.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Create a node with two arrays</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">KpointsData</span><span class="p">()</span>

        <span class="c1"># check whether the mesh can be set properly</span>
        <span class="n">input_mesh</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
        <span class="n">k</span><span class="o">.</span><span class="n">set_kpoints_mesh</span><span class="p">(</span><span class="n">input_mesh</span><span class="p">)</span>
        <span class="n">mesh</span><span class="p">,</span> <span class="n">offset</span> <span class="o">=</span> <span class="n">k</span><span class="o">.</span><span class="n">get_kpoints_mesh</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">input_mesh</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">])</span>  <span class="c1"># must be a tuple of three 0 by default</span>

        <span class="c1"># a too long list should fail</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="n">k</span><span class="o">.</span><span class="n">set_kpoints_mesh</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>

        <span class="c1"># now try to put explicitely an offset</span>
        <span class="n">input_offset</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]</span>
        <span class="n">k</span><span class="o">.</span><span class="n">set_kpoints_mesh</span><span class="p">(</span><span class="n">input_mesh</span><span class="p">,</span> <span class="n">input_offset</span><span class="p">)</span>
        <span class="n">mesh</span><span class="p">,</span> <span class="n">offset</span> <span class="o">=</span> <span class="n">k</span><span class="o">.</span><span class="n">get_kpoints_mesh</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">input_mesh</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">input_offset</span><span class="p">))</span>

        <span class="c1"># verify the same but after storing</span>
        <span class="n">k</span><span class="o">.</span><span class="n">store</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">input_mesh</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">input_offset</span><span class="p">))</span>

        <span class="c1"># cannot modify it after storage</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">ModificationNotAllowed</span><span class="p">):</span>
            <span class="n">k</span><span class="o">.</span><span class="n">set_kpoints_mesh</span><span class="p">(</span><span class="n">input_mesh</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestKpointsData.test_list"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestKpointsData.test_list">[docs]</a>    <span class="k">def</span> <span class="nf">test_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test the method to set and retrieve a kpoint list.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">numpy</span>

        <span class="n">k</span> <span class="o">=</span> <span class="n">KpointsData</span><span class="p">()</span>

        <span class="n">input_klist</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
            <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">),</span>
        <span class="p">])</span>

        <span class="c1"># set kpoints list</span>
        <span class="n">k</span><span class="o">.</span><span class="n">set_kpoints</span><span class="p">(</span><span class="n">input_klist</span><span class="p">)</span>
        <span class="n">klist</span> <span class="o">=</span> <span class="n">k</span><span class="o">.</span><span class="n">get_kpoints</span><span class="p">()</span>

        <span class="c1"># try to get the same</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">input_klist</span><span class="p">,</span> <span class="n">klist</span><span class="p">))</span>

        <span class="c1"># if no cell is set, cannot convert into cartesian</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">AttributeError</span><span class="p">):</span>
            <span class="n">_</span> <span class="o">=</span> <span class="n">k</span><span class="o">.</span><span class="n">get_kpoints</span><span class="p">(</span><span class="n">cartesian</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># try to set also weights</span>
        <span class="c1"># should fail if the weights length do not match kpoints</span>
        <span class="n">input_weights</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="n">k</span><span class="o">.</span><span class="n">set_kpoints</span><span class="p">(</span><span class="n">input_klist</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">input_weights</span><span class="p">)</span>

        <span class="c1"># try a right one</span>
        <span class="n">input_weights</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">k</span><span class="o">.</span><span class="n">set_kpoints</span><span class="p">(</span><span class="n">input_klist</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">input_weights</span><span class="p">)</span>
        <span class="n">klist</span><span class="p">,</span> <span class="n">weights</span> <span class="o">=</span> <span class="n">k</span><span class="o">.</span><span class="n">get_kpoints</span><span class="p">(</span><span class="n">also_weights</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">input_weights</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">klist</span><span class="p">,</span> <span class="n">input_klist</span><span class="p">))</span>

        <span class="c1"># verify the same, but after storing</span>
        <span class="n">k</span><span class="o">.</span><span class="n">store</span><span class="p">()</span>
        <span class="n">klist</span><span class="p">,</span> <span class="n">weights</span> <span class="o">=</span> <span class="n">k</span><span class="o">.</span><span class="n">get_kpoints</span><span class="p">(</span><span class="n">also_weights</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">input_weights</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">klist</span><span class="p">,</span> <span class="n">input_klist</span><span class="p">))</span>

        <span class="c1"># cannot modify it after storage</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">ModificationNotAllowed</span><span class="p">):</span>
            <span class="n">k</span><span class="o">.</span><span class="n">set_kpoints</span><span class="p">(</span><span class="n">input_klist</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestKpointsData.test_kpoints_to_cartesian"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestKpointsData.test_kpoints_to_cartesian">[docs]</a>    <span class="k">def</span> <span class="nf">test_kpoints_to_cartesian</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test how the list of kpoints is converted to cartesian coordinates</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">numpy</span>

        <span class="n">k</span> <span class="o">=</span> <span class="n">KpointsData</span><span class="p">()</span>

        <span class="n">input_klist</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
            <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">),</span>
        <span class="p">])</span>

        <span class="c1"># define a cell</span>
        <span class="n">alat</span> <span class="o">=</span> <span class="mf">4.</span>
        <span class="n">cell</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
            <span class="p">[</span><span class="n">alat</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span>
            <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="n">alat</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span>
            <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">alat</span><span class="p">],</span>
        <span class="p">])</span>

        <span class="n">k</span><span class="o">.</span><span class="n">set_cell</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span>

        <span class="c1"># set kpoints list</span>
        <span class="n">k</span><span class="o">.</span><span class="n">set_kpoints</span><span class="p">(</span><span class="n">input_klist</span><span class="p">)</span>

        <span class="c1"># verify that it is not the same of the input</span>
        <span class="c1"># (at least I check that there something has been done)</span>
        <span class="n">klist</span> <span class="o">=</span> <span class="n">k</span><span class="o">.</span><span class="n">get_kpoints</span><span class="p">(</span><span class="n">cartesian</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">klist</span><span class="p">,</span> <span class="n">input_klist</span><span class="p">))</span>

        <span class="c1"># put the kpoints in cartesian and get them back, they should be equal</span>
        <span class="c1"># internally it is doing two matrix transforms</span>
        <span class="n">k</span><span class="o">.</span><span class="n">set_kpoints</span><span class="p">(</span><span class="n">input_klist</span><span class="p">,</span> <span class="n">cartesian</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">klist</span> <span class="o">=</span> <span class="n">k</span><span class="o">.</span><span class="n">get_kpoints</span><span class="p">(</span><span class="n">cartesian</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">klist</span><span class="p">,</span> <span class="n">input_klist</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-16</span><span class="p">))</span></div>

<div class="viewcode-block" id="TestKpointsData.test_path"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestKpointsData.test_path">[docs]</a>    <span class="k">def</span> <span class="nf">test_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test the methods to generate automatically a list of kpoints</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">numpy</span>

        <span class="n">k</span> <span class="o">=</span> <span class="n">KpointsData</span><span class="p">()</span>

        <span class="c1"># shouldn&#39;t get anything wiothout having set the cell</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="n">k</span><span class="o">.</span><span class="n">set_kpoints_path</span><span class="p">()</span>

        <span class="c1"># define a cell</span>
        <span class="n">alat</span> <span class="o">=</span> <span class="mf">4.</span>
        <span class="n">cell</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
            <span class="p">[</span><span class="n">alat</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span>
            <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="n">alat</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span>
            <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">alat</span><span class="p">],</span>
        <span class="p">])</span>

        <span class="n">k</span><span class="o">.</span><span class="n">set_cell</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span>
        <span class="n">k</span><span class="o">.</span><span class="n">set_kpoints_path</span><span class="p">()</span>
        <span class="c1"># something should be retrieved</span>
        <span class="n">klist</span> <span class="o">=</span> <span class="n">k</span><span class="o">.</span><span class="n">get_kpoints</span><span class="p">()</span>

        <span class="c1"># test the various formats for specifying the path</span>
        <span class="n">k</span><span class="o">.</span><span class="n">set_kpoints_path</span><span class="p">([</span>
            <span class="p">(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">),</span>
        <span class="p">])</span>
        <span class="n">k</span><span class="o">.</span><span class="n">set_kpoints_path</span><span class="p">([</span>
            <span class="p">(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span>
        <span class="p">])</span>
        <span class="n">k</span><span class="o">.</span><span class="n">set_kpoints_path</span><span class="p">([</span>
            <span class="p">(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">)),</span>
        <span class="p">])</span>
        <span class="n">k</span><span class="o">.</span><span class="n">set_kpoints_path</span><span class="p">([</span>
            <span class="p">(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">),</span> <span class="mi">30</span><span class="p">),</span>
        <span class="p">])</span>

        <span class="c1"># at least 2 points per segment</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="n">k</span><span class="o">.</span><span class="n">set_kpoints_path</span><span class="p">([</span>
                <span class="p">(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="p">])</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="n">k</span><span class="o">.</span><span class="n">set_kpoints_path</span><span class="p">([</span>
                <span class="p">(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">),</span> <span class="mi">1</span><span class="p">),</span>
            <span class="p">])</span>

        <span class="c1"># try to set points with a spacing</span>
        <span class="n">k</span><span class="o">.</span><span class="n">set_kpoints_path</span><span class="p">(</span><span class="n">kpoint_distance</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>

        <span class="c1"># try to modify after storage</span>
        <span class="n">k</span><span class="o">.</span><span class="n">store</span><span class="p">()</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">ModificationNotAllowed</span><span class="p">):</span>
            <span class="n">k</span><span class="o">.</span><span class="n">set_kpoints_path</span><span class="p">()</span></div>

<div class="viewcode-block" id="TestKpointsData.test_path_wrapper_legacy"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestKpointsData.test_path_wrapper_legacy">[docs]</a>    <span class="k">def</span> <span class="nf">test_path_wrapper_legacy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This is a clone of the test_path test but instead it goes through the new wrapper</span>
<span class="sd">        calling the deprecated legacy implementation. This tests that the wrapper maintains</span>
<span class="sd">        the same behavior of the old implementation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">numpy</span>
        <span class="kn">from</span> <span class="nn">aiida.tools.data.array.kpoints</span> <span class="k">import</span> <span class="n">get_explicit_kpoints_path</span>

        <span class="c1"># Shouldn&#39;t get anything without having set the cell</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">AttributeError</span><span class="p">):</span>
            <span class="n">get_explicit_kpoints_path</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

        <span class="c1"># Define a cell</span>
        <span class="n">alat</span> <span class="o">=</span> <span class="mf">4.</span>
        <span class="n">cell</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
            <span class="p">[</span><span class="n">alat</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span>
            <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="n">alat</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span>
            <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">alat</span><span class="p">],</span>
        <span class="p">])</span>

        <span class="n">structure</span> <span class="o">=</span> <span class="n">StructureData</span><span class="p">(</span><span class="n">cell</span><span class="o">=</span><span class="n">cell</span><span class="p">)</span>

        <span class="c1"># test the various formats for specifying the path</span>
        <span class="n">get_explicit_kpoints_path</span><span class="p">(</span>
            <span class="n">structure</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;legacy&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="p">[</span>
                <span class="p">(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">),</span>
            <span class="p">])</span>
        <span class="n">get_explicit_kpoints_path</span><span class="p">(</span>
            <span class="n">structure</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;legacy&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="p">[</span>
                <span class="p">(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span>
            <span class="p">])</span>
        <span class="n">get_explicit_kpoints_path</span><span class="p">(</span>
            <span class="n">structure</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;legacy&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="p">[</span>
                <span class="p">(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">)),</span>
            <span class="p">])</span>
        <span class="n">get_explicit_kpoints_path</span><span class="p">(</span>
            <span class="n">structure</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;legacy&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="p">[</span>
                <span class="p">(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">),</span> <span class="mi">30</span><span class="p">),</span>
            <span class="p">])</span>

        <span class="c1"># at least 2 points per segment</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="n">get_explicit_kpoints_path</span><span class="p">(</span>
                <span class="n">structure</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;legacy&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="p">[</span>
                    <span class="p">(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                <span class="p">])</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="n">get_explicit_kpoints_path</span><span class="p">(</span>
                <span class="n">structure</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;legacy&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="p">[</span>
                    <span class="p">(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">),</span> <span class="mi">1</span><span class="p">),</span>
                <span class="p">])</span>

        <span class="c1"># try to set points with a spacing</span>
        <span class="n">get_explicit_kpoints_path</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;legacy&#39;</span><span class="p">,</span> <span class="n">kpoint_distance</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestKpointsData.test_tetra_x"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestKpointsData.test_tetra_x">[docs]</a>    <span class="k">def</span> <span class="nf">test_tetra_x</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        testing tetragonal cells with axis along X</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">numpy</span>
        <span class="kn">from</span> <span class="nn">aiida.plugins</span> <span class="k">import</span> <span class="n">DataFactory</span>
        <span class="n">alat</span> <span class="o">=</span> <span class="mf">1.5</span>
        <span class="n">cell_x</span> <span class="o">=</span> <span class="p">[[</span><span class="n">alat</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span>
        <span class="n">K</span> <span class="o">=</span> <span class="n">DataFactory</span><span class="p">(</span><span class="s1">&#39;array.kpoints&#39;</span><span class="p">)</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">K</span><span class="p">()</span>
        <span class="n">k</span><span class="o">.</span><span class="n">set_cell</span><span class="p">(</span><span class="n">cell_x</span><span class="p">)</span>
        <span class="n">points</span> <span class="o">=</span> <span class="n">k</span><span class="o">.</span><span class="n">get_special_points</span><span class="p">(</span><span class="n">cartesian</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;Z&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">alat</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;Z&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="mf">0.</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestKpointsData.test_tetra_z"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestKpointsData.test_tetra_z">[docs]</a>    <span class="k">def</span> <span class="nf">test_tetra_z</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        testing tetragonal cells with axis along X</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">numpy</span>
        <span class="kn">from</span> <span class="nn">aiida.plugins</span> <span class="k">import</span> <span class="n">DataFactory</span>
        <span class="n">alat</span> <span class="o">=</span> <span class="mf">1.5</span>
        <span class="n">cell_x</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">alat</span><span class="p">]]</span>
        <span class="n">K</span> <span class="o">=</span> <span class="n">DataFactory</span><span class="p">(</span><span class="s1">&#39;array.kpoints&#39;</span><span class="p">)</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">K</span><span class="p">()</span>
        <span class="n">k</span><span class="o">.</span><span class="n">set_cell</span><span class="p">(</span><span class="n">cell_x</span><span class="p">)</span>
        <span class="n">points</span> <span class="o">=</span> <span class="n">k</span><span class="o">.</span><span class="n">get_special_points</span><span class="p">(</span><span class="n">cartesian</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;Z&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">alat</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;Z&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="mf">0.</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestKpointsData.test_tetra_z_wrapper_legacy"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestKpointsData.test_tetra_z_wrapper_legacy">[docs]</a>    <span class="k">def</span> <span class="nf">test_tetra_z_wrapper_legacy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This is a clone of the test_tetra_z test but instead it goes through the new wrapper</span>
<span class="sd">        calling the deprecated legacy implementation. This tests that the wrapper maintains</span>
<span class="sd">        the same behavior of the old implementation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">numpy</span>
        <span class="kn">from</span> <span class="nn">aiida.tools.data.array.kpoints</span> <span class="k">import</span> <span class="n">get_kpoints_path</span>

        <span class="n">alat</span> <span class="o">=</span> <span class="mf">1.5</span>
        <span class="n">cell_x</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">alat</span><span class="p">]]</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">StructureData</span><span class="p">(</span><span class="n">cell</span><span class="o">=</span><span class="n">cell_x</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">get_kpoints_path</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;legacy&#39;</span><span class="p">,</span> <span class="n">cartesian</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;parameters&#39;</span><span class="p">],</span> <span class="n">Dict</span><span class="p">)</span>

        <span class="n">point_coords</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;parameters&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dict</span><span class="o">.</span><span class="n">point_coords</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;parameters&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dict</span><span class="o">.</span><span class="n">path</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">point_coords</span><span class="p">[</span><span class="s1">&#39;Z&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">alat</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">point_coords</span><span class="p">[</span><span class="s1">&#39;Z&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="mf">0.</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="TestSpglibTupleConversion"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestSpglibTupleConversion">[docs]</a><span class="k">class</span> <span class="nc">TestSpglibTupleConversion</span><span class="p">(</span><span class="n">AiidaTestCase</span><span class="p">):</span>

<div class="viewcode-block" id="TestSpglibTupleConversion.test_simple_to_aiida"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestSpglibTupleConversion.test_simple_to_aiida">[docs]</a>    <span class="k">def</span> <span class="nf">test_simple_to_aiida</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test conversion of a simple tuple to an AiiDA structure</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
        <span class="kn">from</span> <span class="nn">aiida.tools</span> <span class="k">import</span> <span class="n">spglib_tuple_to_structure</span>

        <span class="n">cell</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">4.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">4.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">4.</span><span class="p">]])</span>

        <span class="n">relcoords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.09493671</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.59493671</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.59493671</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span>
                              <span class="p">[</span><span class="mf">0.59493671</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.09493671</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]])</span>

        <span class="n">abscoords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cell</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">relcoords</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

        <span class="n">numbers</span> <span class="o">=</span> <span class="p">[</span><span class="mi">56</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span>

        <span class="n">struc</span> <span class="o">=</span> <span class="n">spglib_tuple_to_structure</span><span class="p">((</span><span class="n">cell</span><span class="p">,</span> <span class="n">relcoords</span><span class="p">,</span> <span class="n">numbers</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">struc</span><span class="o">.</span><span class="n">cell</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cell</span><span class="p">))),</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">site</span><span class="o">.</span><span class="n">position</span> <span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="n">struc</span><span class="o">.</span><span class="n">sites</span><span class="p">])</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">abscoords</span><span class="p">))),</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([</span><span class="n">site</span><span class="o">.</span><span class="n">kind_name</span> <span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="n">struc</span><span class="o">.</span><span class="n">sites</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;Ba&#39;</span><span class="p">,</span> <span class="s1">&#39;Ti&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestSpglibTupleConversion.test_complex1_to_aiida"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestSpglibTupleConversion.test_complex1_to_aiida">[docs]</a>    <span class="k">def</span> <span class="nf">test_complex1_to_aiida</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test conversion of a  tuple to an AiiDA structure when passing also information on the kinds</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
        <span class="kn">from</span> <span class="nn">aiida.tools</span> <span class="k">import</span> <span class="n">spglib_tuple_to_structure</span>

        <span class="n">cell</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">4.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">4.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">4.</span><span class="p">]])</span>

        <span class="n">relcoords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.09493671</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.59493671</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.59493671</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span>
                              <span class="p">[</span><span class="mf">0.59493671</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.09493671</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.09493671</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span>
                              <span class="p">[</span><span class="mf">0.09493671</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.09493671</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.09493671</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]])</span>

        <span class="n">abscoords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cell</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">relcoords</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

        <span class="n">numbers</span> <span class="o">=</span> <span class="p">[</span><span class="mi">56</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">56000</span><span class="p">,</span> <span class="mi">200000</span><span class="p">,</span> <span class="mi">200001</span><span class="p">,</span> <span class="mi">56001</span><span class="p">]</span>

        <span class="n">kind_info</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Ba&#39;</span><span class="p">:</span> <span class="mi">56</span><span class="p">,</span> <span class="s1">&#39;Ba2&#39;</span><span class="p">:</span> <span class="mi">56000</span><span class="p">,</span> <span class="s1">&#39;Ba3&#39;</span><span class="p">:</span> <span class="mi">56001</span><span class="p">,</span> <span class="s1">&#39;BaTi&#39;</span><span class="p">:</span> <span class="mi">200000</span><span class="p">,</span> <span class="s1">&#39;BaTi2&#39;</span><span class="p">:</span> <span class="mi">200001</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="s1">&#39;Ti&#39;</span><span class="p">:</span> <span class="mi">22</span><span class="p">}</span>

        <span class="n">kind_info_wrong</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Ba&#39;</span><span class="p">:</span> <span class="mi">56</span><span class="p">,</span> <span class="s1">&#39;Ba2&#39;</span><span class="p">:</span> <span class="mi">56000</span><span class="p">,</span> <span class="s1">&#39;Ba3&#39;</span><span class="p">:</span> <span class="mi">56002</span><span class="p">,</span> <span class="s1">&#39;BaTi&#39;</span><span class="p">:</span> <span class="mi">200000</span><span class="p">,</span> <span class="s1">&#39;BaTi2&#39;</span><span class="p">:</span> <span class="mi">200001</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="s1">&#39;Ti&#39;</span><span class="p">:</span> <span class="mi">22</span><span class="p">}</span>

        <span class="n">kinds</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">Kind</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Ba&#39;</span><span class="p">,</span> <span class="n">symbols</span><span class="o">=</span><span class="s2">&quot;Ba&quot;</span><span class="p">),</span>
            <span class="n">Kind</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Ti&#39;</span><span class="p">,</span> <span class="n">symbols</span><span class="o">=</span><span class="s2">&quot;Ti&quot;</span><span class="p">),</span>
            <span class="n">Kind</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="n">symbols</span><span class="o">=</span><span class="s2">&quot;O&quot;</span><span class="p">),</span>
            <span class="n">Kind</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Ba2&#39;</span><span class="p">,</span> <span class="n">symbols</span><span class="o">=</span><span class="s2">&quot;Ba&quot;</span><span class="p">,</span> <span class="n">mass</span><span class="o">=</span><span class="mf">100.</span><span class="p">),</span>
            <span class="n">Kind</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;BaTi&#39;</span><span class="p">,</span> <span class="n">symbols</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Ba&quot;</span><span class="p">,</span> <span class="s2">&quot;Ti&quot;</span><span class="p">),</span> <span class="n">weights</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">mass</span><span class="o">=</span><span class="mf">100.</span><span class="p">),</span>
            <span class="n">Kind</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;BaTi2&#39;</span><span class="p">,</span> <span class="n">symbols</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Ba&quot;</span><span class="p">,</span> <span class="s2">&quot;Ti&quot;</span><span class="p">),</span> <span class="n">weights</span><span class="o">=</span><span class="p">(</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">),</span> <span class="n">mass</span><span class="o">=</span><span class="mf">100.</span><span class="p">),</span>
            <span class="n">Kind</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Ba3&#39;</span><span class="p">,</span> <span class="n">symbols</span><span class="o">=</span><span class="s2">&quot;Ba&quot;</span><span class="p">,</span> <span class="n">mass</span><span class="o">=</span><span class="mf">100.</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="n">kinds_wrong</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">Kind</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Ba&#39;</span><span class="p">,</span> <span class="n">symbols</span><span class="o">=</span><span class="s2">&quot;Ba&quot;</span><span class="p">),</span>
            <span class="n">Kind</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Ti&#39;</span><span class="p">,</span> <span class="n">symbols</span><span class="o">=</span><span class="s2">&quot;Ti&quot;</span><span class="p">),</span>
            <span class="n">Kind</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="n">symbols</span><span class="o">=</span><span class="s2">&quot;O&quot;</span><span class="p">),</span>
            <span class="n">Kind</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Ba2&#39;</span><span class="p">,</span> <span class="n">symbols</span><span class="o">=</span><span class="s2">&quot;Ba&quot;</span><span class="p">,</span> <span class="n">mass</span><span class="o">=</span><span class="mf">100.</span><span class="p">),</span>
            <span class="n">Kind</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;BaTi&#39;</span><span class="p">,</span> <span class="n">symbols</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Ba&quot;</span><span class="p">,</span> <span class="s2">&quot;Ti&quot;</span><span class="p">),</span> <span class="n">weights</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">mass</span><span class="o">=</span><span class="mf">100.</span><span class="p">),</span>
            <span class="n">Kind</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;BaTi2&#39;</span><span class="p">,</span> <span class="n">symbols</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Ba&quot;</span><span class="p">,</span> <span class="s2">&quot;Ti&quot;</span><span class="p">),</span> <span class="n">weights</span><span class="o">=</span><span class="p">(</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">),</span> <span class="n">mass</span><span class="o">=</span><span class="mf">100.</span><span class="p">),</span>
            <span class="n">Kind</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Ba4&#39;</span><span class="p">,</span> <span class="n">symbols</span><span class="o">=</span><span class="s2">&quot;Ba&quot;</span><span class="p">,</span> <span class="n">mass</span><span class="o">=</span><span class="mf">100.</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="c1"># Must specify also kind_info and kinds</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="n">struc</span> <span class="o">=</span> <span class="n">spglib_tuple_to_structure</span><span class="p">((</span><span class="n">cell</span><span class="p">,</span> <span class="n">relcoords</span><span class="p">,</span> <span class="n">numbers</span><span class="p">),)</span>

        <span class="c1"># There is no kind_info for one of the numbers</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="n">struc</span> <span class="o">=</span> <span class="n">spglib_tuple_to_structure</span><span class="p">((</span><span class="n">cell</span><span class="p">,</span> <span class="n">relcoords</span><span class="p">,</span> <span class="n">numbers</span><span class="p">),</span> <span class="n">kind_info</span><span class="o">=</span><span class="n">kind_info_wrong</span><span class="p">,</span> <span class="n">kinds</span><span class="o">=</span><span class="n">kinds</span><span class="p">)</span>

        <span class="c1"># There is no kind in the kinds for one of the labels</span>
        <span class="c1"># specified in kind_info</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="n">struc</span> <span class="o">=</span> <span class="n">spglib_tuple_to_structure</span><span class="p">((</span><span class="n">cell</span><span class="p">,</span> <span class="n">relcoords</span><span class="p">,</span> <span class="n">numbers</span><span class="p">),</span> <span class="n">kind_info</span><span class="o">=</span><span class="n">kind_info</span><span class="p">,</span> <span class="n">kinds</span><span class="o">=</span><span class="n">kinds_wrong</span><span class="p">)</span>

        <span class="n">struc</span> <span class="o">=</span> <span class="n">spglib_tuple_to_structure</span><span class="p">((</span><span class="n">cell</span><span class="p">,</span> <span class="n">relcoords</span><span class="p">,</span> <span class="n">numbers</span><span class="p">),</span> <span class="n">kind_info</span><span class="o">=</span><span class="n">kind_info</span><span class="p">,</span> <span class="n">kinds</span><span class="o">=</span><span class="n">kinds</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">struc</span><span class="o">.</span><span class="n">cell</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cell</span><span class="p">))),</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">site</span><span class="o">.</span><span class="n">position</span> <span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="n">struc</span><span class="o">.</span><span class="n">sites</span><span class="p">])</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">abscoords</span><span class="p">))),</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([</span><span class="n">site</span><span class="o">.</span><span class="n">kind_name</span> <span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="n">struc</span><span class="o">.</span><span class="n">sites</span><span class="p">],</span>
                         <span class="p">[</span><span class="s1">&#39;Ba&#39;</span><span class="p">,</span> <span class="s1">&#39;Ti&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="s1">&#39;Ba2&#39;</span><span class="p">,</span> <span class="s1">&#39;BaTi&#39;</span><span class="p">,</span> <span class="s1">&#39;BaTi2&#39;</span><span class="p">,</span> <span class="s1">&#39;Ba3&#39;</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestSpglibTupleConversion.test_from_aiida"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestSpglibTupleConversion.test_from_aiida">[docs]</a>    <span class="k">def</span> <span class="nf">test_from_aiida</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test conversion of an AiiDA structure to a spglib tuple</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
        <span class="kn">from</span> <span class="nn">aiida.tools</span> <span class="k">import</span> <span class="n">structure_to_spglib_tuple</span>

        <span class="n">cell</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">4.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">4.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">4.</span><span class="p">]])</span>

        <span class="n">struc</span> <span class="o">=</span> <span class="n">StructureData</span><span class="p">(</span><span class="n">cell</span><span class="o">=</span><span class="n">cell</span><span class="p">)</span>
        <span class="n">struc</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Ba&#39;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="n">struc</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Ti&#39;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
        <span class="n">struc</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">))</span>
        <span class="n">struc</span><span class="o">.</span><span class="n">append_kind</span><span class="p">(</span><span class="n">Kind</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Ba2&#39;</span><span class="p">,</span> <span class="n">symbols</span><span class="o">=</span><span class="s2">&quot;Ba&quot;</span><span class="p">,</span> <span class="n">mass</span><span class="o">=</span><span class="mf">100.</span><span class="p">))</span>
        <span class="n">struc</span><span class="o">.</span><span class="n">append_site</span><span class="p">(</span><span class="n">Site</span><span class="p">(</span><span class="n">kind_name</span><span class="o">=</span><span class="s1">&#39;Ba2&#39;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]))</span>
        <span class="n">struc</span><span class="o">.</span><span class="n">append_kind</span><span class="p">(</span><span class="n">Kind</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Test&#39;</span><span class="p">,</span> <span class="n">symbols</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Ba&quot;</span><span class="p">,</span> <span class="s2">&quot;Ti&quot;</span><span class="p">],</span> <span class="n">weights</span><span class="o">=</span><span class="p">[</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">],</span> <span class="n">mass</span><span class="o">=</span><span class="mf">120.</span><span class="p">))</span>
        <span class="n">struc</span><span class="o">.</span><span class="n">append_site</span><span class="p">(</span><span class="n">Site</span><span class="p">(</span><span class="n">kind_name</span><span class="o">=</span><span class="s1">&#39;Test&#39;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">]))</span>

        <span class="n">struc_tuple</span><span class="p">,</span> <span class="n">kind_info</span><span class="p">,</span> <span class="n">kinds</span> <span class="o">=</span> <span class="n">structure_to_spglib_tuple</span><span class="p">(</span><span class="n">struc</span><span class="p">)</span>

        <span class="n">abscoords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">_</span><span class="o">.</span><span class="n">position</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">struc</span><span class="o">.</span><span class="n">sites</span><span class="p">])</span>
        <span class="n">struc_relpos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">cell</span><span class="o">.</span><span class="n">T</span><span class="p">),</span> <span class="n">abscoords</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">struc</span><span class="o">.</span><span class="n">cell</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">struc_tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">]))),</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">struc_tuple</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="n">struc_relpos</span><span class="p">)),</span> <span class="mf">0.</span><span class="p">)</span>

        <span class="n">expected_kind_info</span> <span class="o">=</span> <span class="p">[</span><span class="n">kind_info</span><span class="p">[</span><span class="n">site</span><span class="o">.</span><span class="n">kind_name</span><span class="p">]</span> <span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="n">struc</span><span class="o">.</span><span class="n">sites</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">struc_tuple</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">expected_kind_info</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestSpglibTupleConversion.test_aiida_roundtrip"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestSpglibTupleConversion.test_aiida_roundtrip">[docs]</a>    <span class="k">def</span> <span class="nf">test_aiida_roundtrip</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert an AiiDA structure to a tuple and go back to see if we get the same results</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
        <span class="kn">from</span> <span class="nn">aiida.tools</span> <span class="k">import</span> <span class="n">structure_to_spglib_tuple</span><span class="p">,</span> <span class="n">spglib_tuple_to_structure</span>

        <span class="n">cell</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">4.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">4.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">4.</span><span class="p">]])</span>

        <span class="n">struc</span> <span class="o">=</span> <span class="n">StructureData</span><span class="p">(</span><span class="n">cell</span><span class="o">=</span><span class="n">cell</span><span class="p">)</span>
        <span class="n">struc</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Ba&#39;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="n">struc</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Ti&#39;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
        <span class="n">struc</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">))</span>
        <span class="n">struc</span><span class="o">.</span><span class="n">append_kind</span><span class="p">(</span><span class="n">Kind</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Ba2&#39;</span><span class="p">,</span> <span class="n">symbols</span><span class="o">=</span><span class="s2">&quot;Ba&quot;</span><span class="p">,</span> <span class="n">mass</span><span class="o">=</span><span class="mf">100.</span><span class="p">))</span>
        <span class="n">struc</span><span class="o">.</span><span class="n">append_site</span><span class="p">(</span><span class="n">Site</span><span class="p">(</span><span class="n">kind_name</span><span class="o">=</span><span class="s1">&#39;Ba2&#39;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]))</span>
        <span class="n">struc</span><span class="o">.</span><span class="n">append_kind</span><span class="p">(</span><span class="n">Kind</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Test&#39;</span><span class="p">,</span> <span class="n">symbols</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Ba&quot;</span><span class="p">,</span> <span class="s2">&quot;Ti&quot;</span><span class="p">],</span> <span class="n">weights</span><span class="o">=</span><span class="p">[</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">],</span> <span class="n">mass</span><span class="o">=</span><span class="mf">120.</span><span class="p">))</span>
        <span class="n">struc</span><span class="o">.</span><span class="n">append_site</span><span class="p">(</span><span class="n">Site</span><span class="p">(</span><span class="n">kind_name</span><span class="o">=</span><span class="s1">&#39;Test&#39;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">]))</span>

        <span class="n">struc_tuple</span><span class="p">,</span> <span class="n">kind_info</span><span class="p">,</span> <span class="n">kinds</span> <span class="o">=</span> <span class="n">structure_to_spglib_tuple</span><span class="p">(</span><span class="n">struc</span><span class="p">)</span>
        <span class="n">roundtrip_struc</span> <span class="o">=</span> <span class="n">spglib_tuple_to_structure</span><span class="p">(</span><span class="n">struc_tuple</span><span class="p">,</span> <span class="n">kind_info</span><span class="p">,</span> <span class="n">kinds</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">struc</span><span class="o">.</span><span class="n">cell</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">roundtrip_struc</span><span class="o">.</span><span class="n">cell</span><span class="p">))),</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">struc</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;kinds&#39;</span><span class="p">),</span> <span class="n">roundtrip_struc</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;kinds&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([</span><span class="n">_</span><span class="o">.</span><span class="n">kind_name</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">struc</span><span class="o">.</span><span class="n">sites</span><span class="p">],</span> <span class="p">[</span><span class="n">_</span><span class="o">.</span><span class="n">kind_name</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">roundtrip_struc</span><span class="o">.</span><span class="n">sites</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">_</span><span class="o">.</span><span class="n">position</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">struc</span><span class="o">.</span><span class="n">sites</span><span class="p">])</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">_</span><span class="o">.</span><span class="n">position</span>
                                                                            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">roundtrip_struc</span><span class="o">.</span><span class="n">sites</span><span class="p">]))),</span> <span class="mf">0.</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="TestSeekpathExplicitPath"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestSeekpathExplicitPath">[docs]</a><span class="k">class</span> <span class="nc">TestSeekpathExplicitPath</span><span class="p">(</span><span class="n">AiidaTestCase</span><span class="p">):</span>

<div class="viewcode-block" id="TestSeekpathExplicitPath.test_simple"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestSeekpathExplicitPath.test_simple">[docs]</a>    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skipIf</span><span class="p">(</span><span class="ow">not</span> <span class="n">has_seekpath</span><span class="p">(),</span> <span class="s2">&quot;No seekpath available&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_simple</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
        <span class="kn">from</span> <span class="nn">aiida.plugins</span> <span class="k">import</span> <span class="n">DataFactory</span>

        <span class="kn">from</span> <span class="nn">aiida.tools</span> <span class="k">import</span> <span class="n">get_explicit_kpoints_path</span>

        <span class="n">structure</span> <span class="o">=</span> <span class="n">DataFactory</span><span class="p">(</span><span class="s1">&#39;structure&#39;</span><span class="p">)(</span><span class="n">cell</span><span class="o">=</span><span class="p">[[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">]])</span>
        <span class="n">structure</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Ba&#39;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">structure</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Ti&#39;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
        <span class="n">structure</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">structure</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
        <span class="n">structure</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>

        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;with_time_reversal&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;reference_distance&#39;</span><span class="p">:</span> <span class="mf">0.025</span><span class="p">,</span> <span class="s1">&#39;recipe&#39;</span><span class="p">:</span> <span class="s1">&#39;hpkot&#39;</span><span class="p">,</span> <span class="s1">&#39;threshold&#39;</span><span class="p">:</span> <span class="mf">1.e-7</span><span class="p">}</span>

        <span class="n">return_value</span> <span class="o">=</span> <span class="n">get_explicit_kpoints_path</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;seekpath&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span>
        <span class="n">retdict</span> <span class="o">=</span> <span class="n">return_value</span><span class="p">[</span><span class="s1">&#39;parameters&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_dict</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">retdict</span><span class="p">[</span><span class="s1">&#39;has_inversion_symmetry&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">retdict</span><span class="p">[</span><span class="s1">&#39;augmented_path&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">retdict</span><span class="p">[</span><span class="s1">&#39;volume_original_wrt_prim&#39;</span><span class="p">],</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">to_list_of_lists</span><span class="p">(</span><span class="n">retdict</span><span class="p">[</span><span class="s1">&#39;explicit_segments&#39;</span><span class="p">]),</span>
            <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">31</span><span class="p">],</span> <span class="p">[</span><span class="mi">30</span><span class="p">,</span> <span class="mi">61</span><span class="p">],</span> <span class="p">[</span><span class="mi">60</span><span class="p">,</span> <span class="mi">104</span><span class="p">],</span> <span class="p">[</span><span class="mi">103</span><span class="p">,</span> <span class="mi">123</span><span class="p">],</span> <span class="p">[</span><span class="mi">122</span><span class="p">,</span> <span class="mi">153</span><span class="p">],</span> <span class="p">[</span><span class="mi">152</span><span class="p">,</span> <span class="mi">183</span><span class="p">],</span> <span class="p">[</span><span class="mi">182</span><span class="p">,</span> <span class="mi">226</span><span class="p">],</span> <span class="p">[</span><span class="mi">226</span><span class="p">,</span> <span class="mi">246</span><span class="p">],</span> <span class="p">[</span><span class="mi">246</span><span class="p">,</span> <span class="mi">266</span><span class="p">]])</span>

        <span class="n">ret_k</span> <span class="o">=</span> <span class="n">return_value</span><span class="p">[</span><span class="s1">&#39;explicit_kpoints&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">to_list_of_lists</span><span class="p">(</span><span class="n">ret_k</span><span class="o">.</span><span class="n">labels</span><span class="p">),</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;GAMMA&#39;</span><span class="p">],</span> <span class="p">[</span><span class="mi">30</span><span class="p">,</span> <span class="s1">&#39;X&#39;</span><span class="p">],</span> <span class="p">[</span><span class="mi">60</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">],</span> <span class="p">[</span><span class="mi">103</span><span class="p">,</span> <span class="s1">&#39;GAMMA&#39;</span><span class="p">],</span> <span class="p">[</span><span class="mi">122</span><span class="p">,</span> <span class="s1">&#39;Z&#39;</span><span class="p">],</span> <span class="p">[</span><span class="mi">152</span><span class="p">,</span> <span class="s1">&#39;R&#39;</span><span class="p">],</span>
                                             <span class="p">[</span><span class="mi">182</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">],</span> <span class="p">[</span><span class="mi">225</span><span class="p">,</span> <span class="s1">&#39;Z&#39;</span><span class="p">],</span> <span class="p">[</span><span class="mi">226</span><span class="p">,</span> <span class="s1">&#39;X&#39;</span><span class="p">],</span> <span class="p">[</span><span class="mi">245</span><span class="p">,</span> <span class="s1">&#39;R&#39;</span><span class="p">],</span> <span class="p">[</span><span class="mi">246</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">],</span> <span class="p">[</span><span class="mi">265</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">]])</span>
        <span class="n">kpts</span> <span class="o">=</span> <span class="n">ret_k</span><span class="o">.</span><span class="n">get_kpoints</span><span class="p">(</span><span class="n">cartesian</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">highsympoints_relcoords</span> <span class="o">=</span> <span class="p">[</span><span class="n">kpts</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">ret_k</span><span class="o">.</span><span class="n">labels</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
                        <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span>  <span class="c1"># Gamma</span>
                        <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span>  <span class="c1"># X</span>
                        <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span>  <span class="c1"># M</span>
                        <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span>  <span class="c1"># Gamma</span>
                        <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span>  <span class="c1"># Z</span>
                        <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span>  <span class="c1"># R</span>
                        <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span>  <span class="c1"># A</span>
                        <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span>  <span class="c1"># Z</span>
                        <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span>  <span class="c1"># X</span>
                        <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span>  <span class="c1"># R</span>
                        <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span>  <span class="c1"># M</span>
                        <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span>  <span class="c1"># A</span>
                    <span class="p">])</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">highsympoints_relcoords</span><span class="p">))),</span>
            <span class="mf">0.</span><span class="p">)</span>

        <span class="n">ret_prims</span> <span class="o">=</span> <span class="n">return_value</span><span class="p">[</span><span class="s1">&#39;primitive_structure&#39;</span><span class="p">]</span>
        <span class="n">ret_convs</span> <span class="o">=</span> <span class="n">return_value</span><span class="p">[</span><span class="s1">&#39;conv_structure&#39;</span><span class="p">]</span>
        <span class="c1"># The primitive structure should be the same as the one I input</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">structure</span><span class="o">.</span><span class="n">cell</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ret_prims</span><span class="o">.</span><span class="n">cell</span><span class="p">))),</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([</span><span class="n">_</span><span class="o">.</span><span class="n">kind_name</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">structure</span><span class="o">.</span><span class="n">sites</span><span class="p">],</span> <span class="p">[</span><span class="n">_</span><span class="o">.</span><span class="n">kind_name</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">ret_prims</span><span class="o">.</span><span class="n">sites</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">_</span><span class="o">.</span><span class="n">position</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">structure</span><span class="o">.</span><span class="n">sites</span><span class="p">])</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">_</span><span class="o">.</span><span class="n">position</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">ret_prims</span><span class="o">.</span><span class="n">sites</span><span class="p">]))),</span>
            <span class="mf">0.</span><span class="p">)</span>

        <span class="c1"># Also the conventional structure should be the same as the one I input</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">structure</span><span class="o">.</span><span class="n">cell</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ret_convs</span><span class="o">.</span><span class="n">cell</span><span class="p">))),</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([</span><span class="n">_</span><span class="o">.</span><span class="n">kind_name</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">structure</span><span class="o">.</span><span class="n">sites</span><span class="p">],</span> <span class="p">[</span><span class="n">_</span><span class="o">.</span><span class="n">kind_name</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">ret_convs</span><span class="o">.</span><span class="n">sites</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">_</span><span class="o">.</span><span class="n">position</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">structure</span><span class="o">.</span><span class="n">sites</span><span class="p">])</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">_</span><span class="o">.</span><span class="n">position</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">ret_convs</span><span class="o">.</span><span class="n">sites</span><span class="p">]))),</span>
            <span class="mf">0.</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="TestSeekpathPath"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestSeekpathPath">[docs]</a><span class="k">class</span> <span class="nc">TestSeekpathPath</span><span class="p">(</span><span class="n">AiidaTestCase</span><span class="p">):</span>

<div class="viewcode-block" id="TestSeekpathPath.test_simple"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestSeekpathPath.test_simple">[docs]</a>    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skipIf</span><span class="p">(</span><span class="ow">not</span> <span class="n">has_seekpath</span><span class="p">(),</span> <span class="s2">&quot;No seekpath available&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_simple</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
        <span class="kn">from</span> <span class="nn">aiida.plugins</span> <span class="k">import</span> <span class="n">DataFactory</span>
        <span class="kn">from</span> <span class="nn">aiida.tools</span> <span class="k">import</span> <span class="n">get_kpoints_path</span>

        <span class="n">structure</span> <span class="o">=</span> <span class="n">DataFactory</span><span class="p">(</span><span class="s1">&#39;structure&#39;</span><span class="p">)(</span><span class="n">cell</span><span class="o">=</span><span class="p">[[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">]])</span>
        <span class="n">structure</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Ba&#39;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">structure</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;Ti&#39;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
        <span class="n">structure</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">structure</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
        <span class="n">structure</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">symbols</span><span class="o">=</span><span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>

        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;with_time_reversal&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;recipe&#39;</span><span class="p">:</span> <span class="s1">&#39;hpkot&#39;</span><span class="p">,</span> <span class="s1">&#39;threshold&#39;</span><span class="p">:</span> <span class="mf">1.e-7</span><span class="p">}</span>

        <span class="n">return_value</span> <span class="o">=</span> <span class="n">get_kpoints_path</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;seekpath&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span>
        <span class="n">retdict</span> <span class="o">=</span> <span class="n">return_value</span><span class="p">[</span><span class="s1">&#39;parameters&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_dict</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">retdict</span><span class="p">[</span><span class="s1">&#39;has_inversion_symmetry&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">retdict</span><span class="p">[</span><span class="s1">&#39;augmented_path&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">retdict</span><span class="p">[</span><span class="s1">&#39;volume_original_wrt_prim&#39;</span><span class="p">],</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">retdict</span><span class="p">[</span><span class="s1">&#39;volume_original_wrt_conv&#39;</span><span class="p">],</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">retdict</span><span class="p">[</span><span class="s1">&#39;bravais_lattice&#39;</span><span class="p">],</span> <span class="s1">&#39;tP&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">retdict</span><span class="p">[</span><span class="s1">&#39;bravais_lattice_extended&#39;</span><span class="p">],</span> <span class="s1">&#39;tP1&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">to_list_of_lists</span><span class="p">(</span><span class="n">retdict</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]),</span> <span class="p">[[</span><span class="s1">&#39;GAMMA&#39;</span><span class="p">,</span> <span class="s1">&#39;X&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="s1">&#39;GAMMA&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;GAMMA&#39;</span><span class="p">,</span> <span class="s1">&#39;Z&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span> <span class="s1">&#39;R&#39;</span><span class="p">],</span>
                                                <span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;Z&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;R&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">]])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">retdict</span><span class="p">[</span><span class="s1">&#39;point_coords&#39;</span><span class="p">],</span> <span class="p">{</span>
                <span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span>
                <span class="s1">&#39;M&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
                <span class="s1">&#39;R&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span>
                <span class="s1">&#39;X&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
                <span class="s1">&#39;Z&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span>
                <span class="s1">&#39;GAMMA&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
            <span class="p">})</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">retdict</span><span class="p">[</span><span class="s1">&#39;inverse_primitive_transformation_matrix&#39;</span><span class="p">])</span> <span class="o">-</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]))),</span> <span class="mf">0.</span><span class="p">)</span>

        <span class="n">ret_prims</span> <span class="o">=</span> <span class="n">return_value</span><span class="p">[</span><span class="s1">&#39;primitive_structure&#39;</span><span class="p">]</span>
        <span class="n">ret_convs</span> <span class="o">=</span> <span class="n">return_value</span><span class="p">[</span><span class="s1">&#39;conv_structure&#39;</span><span class="p">]</span>
        <span class="c1"># The primitive structure should be the same as the one I input</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">structure</span><span class="o">.</span><span class="n">cell</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ret_prims</span><span class="o">.</span><span class="n">cell</span><span class="p">))),</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([</span><span class="n">_</span><span class="o">.</span><span class="n">kind_name</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">structure</span><span class="o">.</span><span class="n">sites</span><span class="p">],</span> <span class="p">[</span><span class="n">_</span><span class="o">.</span><span class="n">kind_name</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">ret_prims</span><span class="o">.</span><span class="n">sites</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">_</span><span class="o">.</span><span class="n">position</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">structure</span><span class="o">.</span><span class="n">sites</span><span class="p">])</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">_</span><span class="o">.</span><span class="n">position</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">ret_prims</span><span class="o">.</span><span class="n">sites</span><span class="p">]))),</span>
            <span class="mf">0.</span><span class="p">)</span>

        <span class="c1"># Also the conventional structure should be the same as the one I input</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">structure</span><span class="o">.</span><span class="n">cell</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ret_convs</span><span class="o">.</span><span class="n">cell</span><span class="p">))),</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([</span><span class="n">_</span><span class="o">.</span><span class="n">kind_name</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">structure</span><span class="o">.</span><span class="n">sites</span><span class="p">],</span> <span class="p">[</span><span class="n">_</span><span class="o">.</span><span class="n">kind_name</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">ret_convs</span><span class="o">.</span><span class="n">sites</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">_</span><span class="o">.</span><span class="n">position</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">structure</span><span class="o">.</span><span class="n">sites</span><span class="p">])</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">_</span><span class="o">.</span><span class="n">position</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">ret_convs</span><span class="o">.</span><span class="n">sites</span><span class="p">]))),</span>
            <span class="mf">0.</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="TestBandsData"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestBandsData">[docs]</a><span class="k">class</span> <span class="nc">TestBandsData</span><span class="p">(</span><span class="n">AiidaTestCase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Tests the BandsData objects.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="TestBandsData.test_band"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestBandsData.test_band">[docs]</a>    <span class="k">def</span> <span class="nf">test_band</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check the methods to set and retrieve a mesh.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">numpy</span>

        <span class="c1"># define a cell</span>
        <span class="n">alat</span> <span class="o">=</span> <span class="mf">4.</span>
        <span class="n">cell</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
            <span class="p">[</span><span class="n">alat</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span>
            <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="n">alat</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span>
            <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">alat</span><span class="p">],</span>
        <span class="p">])</span>

        <span class="n">k</span> <span class="o">=</span> <span class="n">KpointsData</span><span class="p">()</span>
        <span class="n">k</span><span class="o">.</span><span class="n">set_cell</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span>
        <span class="n">k</span><span class="o">.</span><span class="n">set_kpoints_path</span><span class="p">()</span>

        <span class="n">b</span> <span class="o">=</span> <span class="n">BandsData</span><span class="p">()</span>
        <span class="n">b</span><span class="o">.</span><span class="n">set_kpointsdata</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">cell</span><span class="p">,</span> <span class="n">k</span><span class="o">.</span><span class="n">cell</span><span class="p">))</span>

        <span class="n">input_bands</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">numpy</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">get_kpoints</span><span class="p">()</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])])</span>
        <span class="n">input_occupations</span> <span class="o">=</span> <span class="n">input_bands</span>

        <span class="n">b</span><span class="o">.</span><span class="n">set_bands</span><span class="p">(</span><span class="n">input_bands</span><span class="p">,</span> <span class="n">occupations</span><span class="o">=</span><span class="n">input_occupations</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;ev&#39;</span><span class="p">)</span>
        <span class="n">b</span><span class="o">.</span><span class="n">set_bands</span><span class="p">(</span><span class="n">input_bands</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;ev&#39;</span><span class="p">)</span>
        <span class="n">b</span><span class="o">.</span><span class="n">set_bands</span><span class="p">(</span><span class="n">input_bands</span><span class="p">,</span> <span class="n">occupations</span><span class="o">=</span><span class="n">input_occupations</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span>
            <span class="n">b</span><span class="o">.</span><span class="n">set_bands</span><span class="p">(</span><span class="n">occupations</span><span class="o">=</span><span class="n">input_occupations</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;ev&#39;</span><span class="p">)</span>

        <span class="n">b</span><span class="o">.</span><span class="n">set_bands</span><span class="p">(</span><span class="n">input_bands</span><span class="p">,</span> <span class="n">occupations</span><span class="o">=</span><span class="n">input_occupations</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;ev&#39;</span><span class="p">)</span>
        <span class="n">bands</span><span class="p">,</span> <span class="n">occupations</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">get_bands</span><span class="p">(</span><span class="n">also_occupations</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">bands</span><span class="p">,</span> <span class="n">input_bands</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">occupations</span><span class="p">,</span> <span class="n">input_occupations</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">units</span> <span class="o">==</span> <span class="s1">&#39;ev&#39;</span><span class="p">)</span>

        <span class="n">b</span><span class="o">.</span><span class="n">store</span><span class="p">()</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">ModificationNotAllowed</span><span class="p">):</span>
            <span class="n">b</span><span class="o">.</span><span class="n">set_bands</span><span class="p">(</span><span class="n">bands</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestBandsData.test_export_to_file"><a class="viewcode-back" href="../../../../apidoc/aiida.backends.tests.html#aiida.backends.tests.test_dataclasses.TestBandsData.test_export_to_file">[docs]</a>    <span class="k">def</span> <span class="nf">test_export_to_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Export the band structure on a file, check if it is working</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">numpy</span>
        <span class="kn">from</span> <span class="nn">aiida.orm</span> <span class="k">import</span> <span class="n">BandsData</span><span class="p">,</span> <span class="n">KpointsData</span>

        <span class="c1"># define a cell</span>
        <span class="n">alat</span> <span class="o">=</span> <span class="mf">4.</span>
        <span class="n">cell</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
            <span class="p">[</span><span class="n">alat</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span>
            <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="n">alat</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span>
            <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">alat</span><span class="p">],</span>
        <span class="p">])</span>

        <span class="n">k</span> <span class="o">=</span> <span class="n">KpointsData</span><span class="p">()</span>
        <span class="n">k</span><span class="o">.</span><span class="n">set_cell</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span>
        <span class="n">k</span><span class="o">.</span><span class="n">set_kpoints_path</span><span class="p">()</span>

        <span class="n">b</span> <span class="o">=</span> <span class="n">BandsData</span><span class="p">()</span>
        <span class="n">b</span><span class="o">.</span><span class="n">set_kpointsdata</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>

        <span class="c1"># 4 bands with linearly increasing energies, it does not make sense</span>
        <span class="c1"># but is good for testing</span>
        <span class="n">input_bands</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">numpy</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">get_kpoints</span><span class="p">()</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])])</span>

        <span class="n">b</span><span class="o">.</span><span class="n">set_bands</span><span class="p">(</span><span class="n">input_bands</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;eV&#39;</span><span class="p">)</span>

        <span class="c1"># It is not obvious how to check that the bands are correct.</span>
        <span class="c1"># I just check, for a few formats, that the file is correctly</span>
        <span class="c1"># created, at this stage</span>
        <span class="c1"># I use this to get a file. I then close it and ask the .export() function</span>
        <span class="c1"># to create it again. I have to remember to delete everything at the end.</span>
        <span class="n">handle</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkstemp</span><span class="p">()</span>
        <span class="n">os</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

        <span class="k">for</span> <span class="nb">format</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;agr&#39;</span><span class="p">,</span> <span class="s1">&#39;agr_batch&#39;</span><span class="p">,</span> <span class="s1">&#39;json&#39;</span><span class="p">,</span> <span class="s1">&#39;mpl_singlefile&#39;</span><span class="p">,</span> <span class="s1">&#39;dat_blocks&#39;</span><span class="p">,</span> <span class="s1">&#39;dat_multicolumn&#39;</span><span class="p">]:</span>
            <span class="n">files_created</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># In case there is an exception</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">files_created</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">export</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">fileformat</span><span class="o">=</span><span class="nb">format</span><span class="p">)</span>
                <span class="k">with</span> <span class="n">io</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fhandle</span><span class="p">:</span>
                    <span class="n">filedata</span> <span class="o">=</span> <span class="n">fhandle</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files_created</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file</span><span class="p">):</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">file</span><span class="p">)</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, ECOLE POLYTECHNIQUE FEDERALE DE LAUSANNE (Theory and Simulation of Materials (THEOS) and National Centre for Computational Design and Discovery of Novel Materials (NCCR MARVEL)), Switzerland and ROBERT BOSCH LLC, USA. All rights reserved

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>