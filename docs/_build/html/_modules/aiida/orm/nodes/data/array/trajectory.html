

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>aiida.orm.nodes.data.array.trajectory &mdash; AiiDA 1.0.0b2 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../../../" src="../../../../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../../../../_static/language_data.js"></script>
        <script type="text/javascript" src="../../../../../../_static/contentui.js"></script>
    
    <script type="text/javascript" src="../../../../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../../_static/contentui.css" type="text/css" />
    <link rel="index" title="Index" href="../../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../../../index.html" class="icon icon-home"> AiiDA
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Installation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../install/quick_installation.html">Quick installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../install/prerequisites.html">Prerequisites</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../install/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../install/updating_installation.html">Updating AiiDA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../install/troubleshooting.html">Troubleshooting</a></li>
</ul>
<p class="caption"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../get_started/index.html">First things first</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../get_started/daemon.html">Setup the daemon</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../get_started/computers.html">Setup a computer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../get_started/codes.html">Setup a code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../get_started/plugins.html">Plugins</a></li>
</ul>
<p class="caption"><span class="caption-text">Concepts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../concepts/provenance.html">Provenance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../concepts/processes.html">Processes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../concepts/calculations.html">Calculations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../concepts/workflows.html">Workflows</a></li>
</ul>
<p class="caption"><span class="caption-text">Working with</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../working/processes.html">Processes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../working/functions.html">Calculation and work functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../working/calculations.html">Calculations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../working/workflows.html">Workflows</a></li>
</ul>
<p class="caption"><span class="caption-text">Working with AiiDA</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../working_with_aiida/index.html">Command line interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../working_with_aiida/index.html#scripting">Scripting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../working_with_aiida/index.html#data-types">Data types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../working_with_aiida/index.html#groups">Groups</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../working_with_aiida/index.html#schedulers">Schedulers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../working_with_aiida/index.html#querying-data">Querying data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../working_with_aiida/index.html#caching">Caching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../working_with_aiida/index.html#result-manager">Result manager</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../working_with_aiida/index.html#backups">Backups</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../working_with_aiida/index.html#troubleshooting">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../working_with_aiida/index.html#rest-api">REST API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../working_with_aiida/index.html#cookbook">Cookbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../import_export/index.html">Import and Export</a></li>
</ul>
<p class="caption"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../developer_guide/index.html">AiiDA design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../developer_guide/index.html#aiida-core">AiiDA core</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../developer_guide/index.html#aiida-plugins">AiiDA plugins</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../tutorial/index.html">StructureData</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../tutorial/index.html#pseudopotentials">Pseudopotentials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../tutorial/index.html#plugin-development">Plugin development</a></li>
</ul>
<p class="caption"><span class="caption-text">API reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="`aiida package &lt;https://aiida-core.readthedocs.io/en/latest/apidoc/aiida.html&gt;`_">`aiida package &lt;https://aiida-core.readthedocs.io/en/latest/apidoc/aiida.html&gt;`_</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../../index.html">AiiDA</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../../../../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../../../../../aiida.html">aiida</a> &raquo;</li>
        
      <li>aiida.orm.nodes.data.array.trajectory</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for aiida.orm.nodes.data.array.trajectory</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1">###########################################################################</span>
<span class="c1"># Copyright (c), The AiiDA team. All rights reserved.                     #</span>
<span class="c1"># This file is part of the AiiDA code.                                    #</span>
<span class="c1">#                                                                         #</span>
<span class="c1"># The code is hosted on GitHub at https://github.com/aiidateam/aiida_core #</span>
<span class="c1"># For further information on the license, see the LICENSE.txt file        #</span>
<span class="c1"># For further information please visit http://www.aiida.net               #</span>
<span class="c1">###########################################################################</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">AiiDA class to deal with crystal structure trajectories.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">division</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">absolute_import</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">print_function</span>

<span class="kn">import</span> <span class="nn">collections</span>
<span class="kn">import</span> <span class="nn">six</span>
<span class="kn">from</span> <span class="nn">six.moves</span> <span class="k">import</span> <span class="nb">range</span><span class="p">,</span> <span class="nb">zip</span>

<span class="kn">from</span> <span class="nn">.array</span> <span class="k">import</span> <span class="n">ArrayData</span>


<div class="viewcode-block" id="TrajectoryData"><a class="viewcode-back" href="../../../../../../developer_guide/core/orm_overview.html#aiida.orm.TrajectoryData">[docs]</a><span class="k">class</span> <span class="nc">TrajectoryData</span><span class="p">(</span><span class="n">ArrayData</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Stores a trajectory (a sequence of crystal structures with timestamps, and</span>
<span class="sd">    possibly with velocities).</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="TrajectoryData.__init__"><a class="viewcode-back" href="../../../../../../apidoc/aiida.orm.nodes.data.array.html#aiida.orm.TrajectoryData.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">structurelist</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TrajectoryData</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">structurelist</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_structurelist</span><span class="p">(</span><span class="n">structurelist</span><span class="p">)</span></div>

<div class="viewcode-block" id="TrajectoryData._internal_validate"><a class="viewcode-back" href="../../../../../../developer_guide/core/orm_overview.html#aiida.orm.TrajectoryData._internal_validate">[docs]</a>    <span class="k">def</span> <span class="nf">_internal_validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stepids</span><span class="p">,</span> <span class="n">cells</span><span class="p">,</span> <span class="n">symbols</span><span class="p">,</span> <span class="n">positions</span><span class="p">,</span> <span class="n">times</span><span class="p">,</span> <span class="n">velocities</span><span class="p">):</span>  <span class="c1"># pylint: disable=too-many-arguments,too-many-locals,no-self-use,too-many-branches</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Internal function to validate the type and shape of the arrays. See</span>
<span class="sd">        the documentation of py:meth:`.set_trajectory` for a description of the</span>
<span class="sd">        valid shape and type of the parameters.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">numpy</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">symbols</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">Iterable</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;TrajectoryData.symbols must be of type list&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">symbols</span><span class="p">]):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;TrajectoryData.symbols must be a 1d list of strings&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">or</span> <span class="n">positions</span><span class="o">.</span><span class="n">dtype</span> <span class="o">!=</span> <span class="nb">float</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;TrajectoryData.positions must be a numpy array of floats&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">stepids</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">stepids</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">or</span> <span class="n">stepids</span><span class="o">.</span><span class="n">dtype</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;TrajectoryData.stepids must be a numpy array of integers&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cells</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cells</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">or</span> <span class="n">cells</span><span class="o">.</span><span class="n">dtype</span> <span class="o">!=</span> <span class="nb">float</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;TrajectoryData.cells must be a numpy array of floats&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">times</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">or</span> <span class="n">times</span><span class="o">.</span><span class="n">dtype</span> <span class="o">!=</span> <span class="nb">float</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;TrajectoryData.times must be a numpy array of floats&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">velocities</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">velocities</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">or</span> <span class="n">velocities</span><span class="o">.</span><span class="n">dtype</span> <span class="o">!=</span> <span class="nb">float</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;TrajectoryData.velocities must be a numpy array of floats, or None&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">stepids</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">numsteps</span> <span class="o">=</span> <span class="n">stepids</span><span class="o">.</span><span class="n">size</span>
            <span class="k">if</span> <span class="n">stepids</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="p">(</span><span class="n">numsteps</span><span class="p">,):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;TrajectoryData.stepids must be a 1d array&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">numsteps</span> <span class="o">=</span> <span class="n">positions</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">cells</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">cells</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="p">(</span><span class="n">numsteps</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;TrajectoryData.cells must have shape (s,3,3), with s=number of steps&quot;</span><span class="p">)</span>
        <span class="n">numatoms</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">symbols</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">positions</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="p">(</span><span class="n">numsteps</span><span class="p">,</span> <span class="n">numatoms</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;TrajectoryData.positions must have shape (s,n,3), &quot;</span>
                             <span class="s2">&quot;with s=number of steps and n=number of symbols&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">times</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">times</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="p">(</span><span class="n">numsteps</span><span class="p">,):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;TrajectoryData.times must have shape (s,), with s=number of steps&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">velocities</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">velocities</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="p">(</span><span class="n">numsteps</span><span class="p">,</span> <span class="n">numatoms</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;TrajectoryData.velocities, if not None, must &quot;</span>
                                 <span class="s2">&quot;have shape (s,n,3), &quot;</span>
                                 <span class="s2">&quot;with s=number of steps and n=number of symbols&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TrajectoryData.set_trajectory"><a class="viewcode-back" href="../../../../../../developer_guide/core/orm_overview.html#aiida.orm.TrajectoryData.set_trajectory">[docs]</a>    <span class="k">def</span> <span class="nf">set_trajectory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">symbols</span><span class="p">,</span> <span class="n">positions</span><span class="p">,</span> <span class="n">stepids</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cells</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">times</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">velocities</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>  <span class="c1"># pylint: disable=too-many-arguments</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Store the whole trajectory, after checking that types and dimensions</span>
<span class="sd">        are correct.</span>

<span class="sd">        Parameters ``stepids``, ``cells`` and ``velocities`` are optional</span>
<span class="sd">        variables. If nothing is passed for ``cells`` or ``velocities``</span>
<span class="sd">        nothing will be stored. However, if no input is given for ``stepids``</span>
<span class="sd">        a consecutive sequence [0,1,2,...,len(positions)-1] will be assumed.</span>


<span class="sd">        :param symbols: string list with dimension ``n``, where ``n`` is the</span>
<span class="sd">                      number of atoms (i.e., sites) in the structure.</span>
<span class="sd">                      The same list is used for each step. Normally, the string</span>
<span class="sd">                      should be a valid chemical symbol, but actually any unique</span>
<span class="sd">                      string works and can be used as the name of the atomic kind</span>
<span class="sd">                      (see also the :py:meth:`.get_step_structure()` method).</span>
<span class="sd">        :param positions: float array with dimension :math:`s \times n \times 3`,</span>
<span class="sd">                      where ``s`` is the</span>
<span class="sd">                      length of the ``stepids`` array and ``n`` is the length</span>
<span class="sd">                      of the ``symbols`` array. Units are angstrom.</span>
<span class="sd">                      In particular,</span>
<span class="sd">                      ``positions[i,j,k]`` is the ``k``-th component of the</span>
<span class="sd">                      ``j``-th atom (or site) in the structure at the time step</span>
<span class="sd">                      with index ``i`` (identified</span>
<span class="sd">                      by step number ``step[i]`` and with timestamp ``times[i]``).</span>
<span class="sd">        :param stepids: integer array with dimension ``s``, where ``s`` is the</span>
<span class="sd">                      number of steps. Typically represents an internal counter</span>
<span class="sd">                      within the code. For instance, if you want to store a</span>
<span class="sd">                      trajectory with one step every 10, starting from step 65,</span>
<span class="sd">                      the array will be ``[65,75,85,...]``.</span>
<span class="sd">                      No checks are done on duplicate elements</span>
<span class="sd">                      or on the ordering, but anyway this array should be</span>
<span class="sd">                      sorted in ascending order, without duplicate elements.</span>
<span class="sd">                      (If not specified, stepids will be set to ``numpy.arange(s)``</span>
<span class="sd">                      by default) It is internally stored as an array named &#39;steps&#39;.</span>
<span class="sd">        :param cells: if specified float array with dimension</span>
<span class="sd">                      :math:`s \times 3 \times 3`, where ``s`` is the</span>
<span class="sd">                      length of the ``stepids`` array. Units are angstrom.</span>
<span class="sd">                      In particular, ``cells[i,j,k]`` is the ``k``-th component</span>
<span class="sd">                      of the ``j``-th cell vector at the time step with index</span>
<span class="sd">                      ``i`` (identified by step number ``stepid[i]`` and with</span>
<span class="sd">                      timestamp ``times[i]``).</span>
<span class="sd">        :param times: if specified, float array with dimension ``s``, where</span>
<span class="sd">                      ``s`` is the length of the ``stepids`` array. Contains the</span>
<span class="sd">                      timestamp of each step in picoseconds (ps).</span>
<span class="sd">        :param velocities: if specified, must be a float array with the same</span>
<span class="sd">                      dimensions of the ``positions`` array.</span>
<span class="sd">                      The array contains the velocities in the atoms.</span>

<span class="sd">        .. todo :: Choose suitable units for velocities</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="kn">import</span> <span class="nn">numpy</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_internal_validate</span><span class="p">(</span><span class="n">stepids</span><span class="p">,</span> <span class="n">cells</span><span class="p">,</span> <span class="n">symbols</span><span class="p">,</span> <span class="n">positions</span><span class="p">,</span> <span class="n">times</span><span class="p">,</span> <span class="n">velocities</span><span class="p">)</span>
        <span class="c1"># set symbols as attribute for easier querying</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s1">&#39;symbols&#39;</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">symbols</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_array</span><span class="p">(</span><span class="s1">&#39;positions&#39;</span><span class="p">,</span> <span class="n">positions</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">stepids</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># use input stepids</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_array</span><span class="p">(</span><span class="s1">&#39;steps&#39;</span><span class="p">,</span> <span class="n">stepids</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># use consecutive sequence if not given</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_array</span><span class="p">(</span><span class="s1">&#39;steps&#39;</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">positions</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="k">if</span> <span class="n">cells</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_array</span><span class="p">(</span><span class="s1">&#39;cells&#39;</span><span class="p">,</span> <span class="n">cells</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Delete cells array, if it was present</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">delete_array</span><span class="p">(</span><span class="s1">&#39;cells&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">if</span> <span class="n">times</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_array</span><span class="p">(</span><span class="s1">&#39;times&#39;</span><span class="p">,</span> <span class="n">times</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Delete times array, if it was present</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">delete_array</span><span class="p">(</span><span class="s1">&#39;times&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">if</span> <span class="n">velocities</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_array</span><span class="p">(</span><span class="s1">&#39;velocities&#39;</span><span class="p">,</span> <span class="n">velocities</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Delete velocities array, if it was present</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">delete_array</span><span class="p">(</span><span class="s1">&#39;velocities&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">pass</span></div>

<div class="viewcode-block" id="TrajectoryData.set_structurelist"><a class="viewcode-back" href="../../../../../../developer_guide/core/orm_overview.html#aiida.orm.TrajectoryData.set_structurelist">[docs]</a>    <span class="k">def</span> <span class="nf">set_structurelist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">structurelist</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create trajectory from the list of</span>
<span class="sd">        :py:class:`aiida.orm.nodes.data.structure.StructureData` instances.</span>

<span class="sd">        :param structurelist: a list of</span>
<span class="sd">            :py:class:`aiida.orm.nodes.data.structure.StructureData` instances.</span>

<span class="sd">        :raises ValueError: if symbol lists of supplied structures are</span>
<span class="sd">            different</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">numpy</span>

        <span class="n">stepids</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">structurelist</span><span class="p">))</span>
        <span class="n">cells</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">cell</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">structurelist</span><span class="p">])</span>
        <span class="n">symbols_first</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">kind_name</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">structurelist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sites</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">symbols_now</span> <span class="ow">in</span> <span class="p">[[</span><span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">kind_name</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">structurelist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">sites</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">stepids</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">symbols_first</span> <span class="o">!=</span> <span class="n">symbols_now</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Symbol lists have to be the same for all of the supplied structures&quot;</span><span class="p">)</span>
        <span class="n">symbols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">symbols_first</span><span class="p">)</span>
        <span class="n">positions</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">position</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">x</span><span class="o">.</span><span class="n">sites</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">structurelist</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_trajectory</span><span class="p">(</span><span class="n">stepids</span><span class="o">=</span><span class="n">stepids</span><span class="p">,</span> <span class="n">cells</span><span class="o">=</span><span class="n">cells</span><span class="p">,</span> <span class="n">symbols</span><span class="o">=</span><span class="n">symbols</span><span class="p">,</span> <span class="n">positions</span><span class="o">=</span><span class="n">positions</span><span class="p">)</span></div>

<div class="viewcode-block" id="TrajectoryData._validate"><a class="viewcode-back" href="../../../../../../developer_guide/core/orm_overview.html#aiida.orm.TrajectoryData._validate">[docs]</a>    <span class="k">def</span> <span class="nf">_validate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Verify that the required arrays are present and that their type and</span>
<span class="sd">        dimension are correct.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># check dimensions, types</span>
        <span class="kn">from</span> <span class="nn">aiida.common.exceptions</span> <span class="k">import</span> <span class="n">ValidationError</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_internal_validate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_stepids</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cells</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_positions</span><span class="p">(),</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">get_times</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_velocities</span><span class="p">())</span>
        <span class="c1"># Should catch TypeErrors, ValueErrors, and KeyErrors for missing arrays</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exception</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;The TrajectoryData did not validate. &quot;</span>
                                  <span class="s2">&quot;Error: </span><span class="si">{}</span><span class="s2"> with message </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">exception</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">exception</span><span class="p">))</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">numsteps</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the number of stored steps, or zero if nothing has been stored yet.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_shape</span><span class="p">(</span><span class="s1">&#39;steps&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">):</span>
            <span class="k">return</span> <span class="mi">0</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">numsites</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the number of stored sites, or zero if nothing has been stored yet.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">symbols</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">):</span>
            <span class="k">return</span> <span class="mi">0</span>

<div class="viewcode-block" id="TrajectoryData.get_stepids"><a class="viewcode-back" href="../../../../../../developer_guide/core/orm_overview.html#aiida.orm.TrajectoryData.get_stepids">[docs]</a>    <span class="k">def</span> <span class="nf">get_stepids</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the array of steps, if it has already been set.</span>

<span class="sd">        .. versionadded:: 0.7</span>
<span class="sd">           Renamed from get_steps</span>

<span class="sd">        :raises KeyError: if the trajectory has not been set yet.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_array</span><span class="p">(</span><span class="s1">&#39;steps&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TrajectoryData.get_times"><a class="viewcode-back" href="../../../../../../developer_guide/core/orm_overview.html#aiida.orm.TrajectoryData.get_times">[docs]</a>    <span class="k">def</span> <span class="nf">get_times</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the array of times (in ps), if it has already been set.</span>

<span class="sd">        :raises KeyError: if the trajectory has not been set yet.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_array</span><span class="p">(</span><span class="s1">&#39;times&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="TrajectoryData.get_cells"><a class="viewcode-back" href="../../../../../../developer_guide/core/orm_overview.html#aiida.orm.TrajectoryData.get_cells">[docs]</a>    <span class="k">def</span> <span class="nf">get_cells</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the array of cells, if it has already been set.</span>

<span class="sd">        :raises KeyError: if the trajectory has not been set yet.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_array</span><span class="p">(</span><span class="s1">&#39;cells&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">symbols</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the array of symbols, if it has already been set.</span>

<span class="sd">        :raises KeyError: if the trajectory has not been set yet.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;symbols&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="TrajectoryData.get_positions"><a class="viewcode-back" href="../../../../../../developer_guide/core/orm_overview.html#aiida.orm.TrajectoryData.get_positions">[docs]</a>    <span class="k">def</span> <span class="nf">get_positions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the array of positions, if it has already been set.</span>

<span class="sd">        :raises KeyError: if the trajectory has not been set yet.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_array</span><span class="p">(</span><span class="s1">&#39;positions&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TrajectoryData.get_velocities"><a class="viewcode-back" href="../../../../../../developer_guide/core/orm_overview.html#aiida.orm.TrajectoryData.get_velocities">[docs]</a>    <span class="k">def</span> <span class="nf">get_velocities</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the array of velocities, if it has already been set.</span>

<span class="sd">        .. note :: This function (differently from all other ``get_*``</span>
<span class="sd">          functions, will not raise an exception if the velocities are not</span>
<span class="sd">          set, but rather return ``None`` (both if no trajectory was not set yet,</span>
<span class="sd">          and if it the trajectory was set but no velocities were specified).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_array</span><span class="p">(</span><span class="s1">&#39;velocities&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="TrajectoryData.get_index_from_stepid"><a class="viewcode-back" href="../../../../../../developer_guide/core/orm_overview.html#aiida.orm.TrajectoryData.get_index_from_stepid">[docs]</a>    <span class="k">def</span> <span class="nf">get_index_from_stepid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stepid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given a value for the stepid (i.e., a value among those of the ``steps``</span>
<span class="sd">        array), return the array index of that stepid, that can be used in other</span>
<span class="sd">        methods such as :py:meth:`.get_step_data` or</span>
<span class="sd">        :py:meth:`.get_step_structure`.</span>

<span class="sd">        .. versionadded:: 0.7</span>
<span class="sd">           Renamed from get_step_index</span>

<span class="sd">        .. note:: Note that this function returns the first index found</span>
<span class="sd">            (i.e. if multiple steps are present with the same value,</span>
<span class="sd">            only the index of the first one is returned).</span>

<span class="sd">        :raises ValueError: if no step with the given value is found.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">numpy</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_stepids</span><span class="p">()</span> <span class="o">==</span> <span class="n">stepid</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> not among the stepids&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">stepid</span><span class="p">))</span></div>

<div class="viewcode-block" id="TrajectoryData.get_step_data"><a class="viewcode-back" href="../../../../../../developer_guide/core/orm_overview.html#aiida.orm.TrajectoryData.get_step_data">[docs]</a>    <span class="k">def</span> <span class="nf">get_step_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a tuple with all information concerning</span>
<span class="sd">        the stepid with given index (0 is the first step, 1 the second step</span>
<span class="sd">        and so on). If you know only the step value, use the</span>
<span class="sd">        :py:meth:`.get_index_from_stepid`  method to get the</span>
<span class="sd">        corresponding index.</span>

<span class="sd">        If no velocities were specified, None is returned as the last element.</span>

<span class="sd">        :return: A tuple in the format</span>
<span class="sd">          ``(stepid, time, cell, symbols, positions, velocities)``,</span>
<span class="sd">          where ``stepid`` is an integer, ``time`` is a float, ``cell`` is a</span>
<span class="sd">          :math:`3 \times 3` matrix, ``symbols`` is an array of length ``n``,</span>
<span class="sd">          positions is a :math:`n \times 3` array, and velocities is either</span>
<span class="sd">          ``None`` or a :math:`n \times 3` array</span>

<span class="sd">        :param index: The index of the step that you want to retrieve, from</span>
<span class="sd">           0 to ``self.numsteps - 1``.</span>
<span class="sd">        :raises IndexError: if you require an index beyond the limits.</span>
<span class="sd">        :raises KeyError: if you did not store the trajectory yet.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">index</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">numsteps</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s2">&quot;You have only </span><span class="si">{}</span><span class="s2"> steps, but you are looking beyond&quot;</span>
                             <span class="s2">&quot; (index=</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">numsteps</span><span class="p">,</span> <span class="n">index</span><span class="p">))</span>

        <span class="n">vel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_velocities</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">vel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">vel</span> <span class="o">=</span> <span class="n">vel</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
        <span class="n">time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_times</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">time</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">time</span> <span class="o">=</span> <span class="n">time</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="n">cells</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cells</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">cells</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cell</span> <span class="o">=</span> <span class="n">cells</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_stepids</span><span class="p">()[</span><span class="n">index</span><span class="p">],</span> <span class="n">time</span><span class="p">,</span> <span class="n">cell</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_positions</span><span class="p">()[</span><span class="n">index</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span> <span class="n">vel</span><span class="p">)</span></div>

<div class="viewcode-block" id="TrajectoryData.get_step_structure"><a class="viewcode-back" href="../../../../../../developer_guide/core/orm_overview.html#aiida.orm.TrajectoryData.get_step_structure">[docs]</a>    <span class="k">def</span> <span class="nf">get_step_structure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">custom_kinds</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return an AiiDA :py:class:`aiida.orm.nodes.data.structure.StructureData` node</span>
<span class="sd">        (not stored yet!) with the coordinates of the given step, identified by</span>
<span class="sd">        its index. If you know only the step value, use the</span>
<span class="sd">        :py:meth:`.get_index_from_stepid` method to get the corresponding index.</span>

<span class="sd">        .. note:: The periodic boundary conditions are always set to True.</span>

<span class="sd">        .. versionadded:: 0.7</span>
<span class="sd">           Renamed from step_to_structure</span>

<span class="sd">        :param index: The index of the step that you want to retrieve, from</span>
<span class="sd">           0 to ``self.numsteps- 1``.</span>
<span class="sd">        :param custom_kinds: (Optional) If passed must be a list of</span>
<span class="sd">          :py:class:`aiida.orm.nodes.data.structure.Kind` objects. There must be one</span>
<span class="sd">          kind object for each different string in the ``symbols`` array, with</span>
<span class="sd">          ``kind.name`` set to this string.</span>
<span class="sd">          If this parameter is omitted, the automatic kind generation of AiiDA</span>
<span class="sd">          :py:class:`aiida.orm.nodes.data.structure.StructureData` nodes is used,</span>
<span class="sd">          meaning that the strings in the ``symbols`` array must be valid</span>
<span class="sd">          chemical symbols.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">aiida.orm.nodes.data.structure</span> <span class="k">import</span> <span class="n">StructureData</span><span class="p">,</span> <span class="n">Kind</span><span class="p">,</span> <span class="n">Site</span>

        <span class="c1"># ignore step, time, and velocities</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">cell</span><span class="p">,</span> <span class="n">symbols</span><span class="p">,</span> <span class="n">positions</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_step_data</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">custom_kinds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">kind_names</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">custom_kinds</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">Kind</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Each element of the custom_kinds list must &quot;</span>
                                    <span class="s2">&quot;be a aiida.orm.nodes.data.structure.Kind object&quot;</span><span class="p">)</span>
                <span class="n">kind_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">kind_names</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">kind_names</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Multiple kinds with the same name passed as custom_kinds&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">kind_names</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">set</span><span class="p">(</span><span class="n">symbols</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;If you pass custom_kinds, you have to &quot;</span>
                                 <span class="s2">&quot;pass one Kind object for each symbol &quot;</span>
                                 <span class="s2">&quot;that is present in the trajectory. You &quot;</span>
                                 <span class="s2">&quot;passed </span><span class="si">{}</span><span class="s2">, but the symbols are </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">kind_names</span><span class="p">),</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">symbols</span><span class="p">)))</span>

        <span class="n">struc</span> <span class="o">=</span> <span class="n">StructureData</span><span class="p">(</span><span class="n">cell</span><span class="o">=</span><span class="n">cell</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">custom_kinds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">_k</span> <span class="ow">in</span> <span class="n">custom_kinds</span><span class="p">:</span>
                <span class="n">struc</span><span class="o">.</span><span class="n">append_kind</span><span class="p">(</span><span class="n">_k</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">_s</span><span class="p">,</span> <span class="n">_p</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">symbols</span><span class="p">,</span> <span class="n">positions</span><span class="p">):</span>
                <span class="n">struc</span><span class="o">.</span><span class="n">append_site</span><span class="p">(</span><span class="n">Site</span><span class="p">(</span><span class="n">kind_name</span><span class="o">=</span><span class="n">_s</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="n">_p</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">_s</span><span class="p">,</span> <span class="n">_p</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">symbols</span><span class="p">,</span> <span class="n">positions</span><span class="p">):</span>
                <span class="c1"># Automatic species generation</span>
                <span class="n">struc</span><span class="o">.</span><span class="n">append_atom</span><span class="p">(</span><span class="n">symbols</span><span class="o">=</span><span class="n">_s</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="n">_p</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">struc</span></div>

<div class="viewcode-block" id="TrajectoryData._prepare_xsf"><a class="viewcode-back" href="../../../../../../developer_guide/core/orm_overview.html#aiida.orm.TrajectoryData._prepare_xsf">[docs]</a>    <span class="k">def</span> <span class="nf">_prepare_xsf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">main_file_name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>  <span class="c1"># pylint: disable=unused-argument</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write the given trajectory to a string of format XSF (for XCrySDen).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">aiida.common.constants</span> <span class="k">import</span> <span class="n">elements</span>
        <span class="n">_atomic_numbers</span> <span class="o">=</span> <span class="p">{</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;symbol&#39;</span><span class="p">]:</span> <span class="n">num</span> <span class="k">for</span> <span class="n">num</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">elements</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

        <span class="n">indices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">numsteps</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="n">return_string</span> <span class="o">=</span> <span class="s2">&quot;ANIMSTEPS </span><span class="si">{}</span><span class="se">\n</span><span class="s2">CRYSTAL</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">indices</span><span class="p">))</span>
        <span class="c1"># Do the checks once and for all here:</span>
        <span class="n">structure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_step_structure</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">structure</span><span class="o">.</span><span class="n">is_alloy</span> <span class="ow">or</span> <span class="n">structure</span><span class="o">.</span><span class="n">has_vacancies</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;XSF for alloys or systems with vacancies not implemented.&quot;</span><span class="p">)</span>
        <span class="n">cells</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cells</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">cells</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No cell parameters have been supplied for TrajectoryData&quot;</span><span class="p">)</span>
        <span class="n">positions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_positions</span><span class="p">()</span>
        <span class="n">symbols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span>
        <span class="n">atomic_numbers_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">_atomic_numbers</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">symbols</span><span class="p">]</span>
        <span class="n">nat</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">symbols</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
            <span class="n">return_string</span> <span class="o">+=</span> <span class="s2">&quot;PRIMVEC </span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">cell_vector</span> <span class="ow">in</span> <span class="n">cells</span><span class="p">[</span><span class="n">idx</span><span class="p">]:</span>
                <span class="n">return_string</span> <span class="o">+=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;</span><span class="si">{:18.5f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cell_vector</span><span class="p">])</span>
                <span class="n">return_string</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">return_string</span> <span class="o">+=</span> <span class="s2">&quot;PRIMCOORD </span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">return_string</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> 1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nat</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">atn</span><span class="p">,</span> <span class="n">pos</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">atomic_numbers_list</span><span class="p">,</span> <span class="n">positions</span><span class="p">[</span><span class="n">idx</span><span class="p">]):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">return_string</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> </span><span class="si">{:18.10f}</span><span class="s2"> </span><span class="si">{:18.10f}</span><span class="s2"> </span><span class="si">{:18.10f}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">atn</span><span class="p">,</span> <span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pos</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">atn</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>
                    <span class="k">raise</span>
        <span class="k">return</span> <span class="n">return_string</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">),</span> <span class="p">{}</span></div>

<div class="viewcode-block" id="TrajectoryData._prepare_cif"><a class="viewcode-back" href="../../../../../../developer_guide/core/orm_overview.html#aiida.orm.TrajectoryData._prepare_cif">[docs]</a>    <span class="k">def</span> <span class="nf">_prepare_cif</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trajectory_index</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">main_file_name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>  <span class="c1"># pylint: disable=unused-argument</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write the given trajectory to a string of format CIF.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">aiida.orm.nodes.data.cif</span> \
            <span class="kn">import</span> <span class="nn">ase_loops</span><span class="o">,</span> <span class="nn">cif_from_ase</span><span class="o">,</span> <span class="nn">pycifrw_from_cif</span>
        <span class="kn">from</span> <span class="nn">aiida.common.utils</span> <span class="k">import</span> <span class="n">Capturing</span>

        <span class="n">cif</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">numsteps</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">trajectory_index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">trajectory_index</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
            <span class="n">structure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_step_structure</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
            <span class="n">ciffile</span> <span class="o">=</span> <span class="n">pycifrw_from_cif</span><span class="p">(</span><span class="n">cif_from_ase</span><span class="p">(</span><span class="n">structure</span><span class="o">.</span><span class="n">get_ase</span><span class="p">()),</span> <span class="n">ase_loops</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">Capturing</span><span class="p">():</span>
                <span class="n">cif</span> <span class="o">=</span> <span class="n">cif</span> <span class="o">+</span> <span class="n">ciffile</span><span class="o">.</span><span class="n">WriteOut</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">cif</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">),</span> <span class="p">{}</span></div>

<div class="viewcode-block" id="TrajectoryData._get_aiida_structure"><a class="viewcode-back" href="../../../../../../developer_guide/core/orm_overview.html#aiida.orm.TrajectoryData._get_aiida_structure">[docs]</a>    <span class="k">def</span> <span class="nf">_get_aiida_structure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates :py:class:`aiida.orm.nodes.data.structure.StructureData`.</span>

<span class="sd">        :param converter: specify the converter. Default &#39;ase&#39;.</span>
<span class="sd">        :param store: If True, intermediate calculation gets stored in the</span>
<span class="sd">            AiiDA database for record. Default False.</span>
<span class="sd">        :return: :py:class:`aiida.orm.nodes.data.structure.StructureData` node.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">warnings</span>
        <span class="kn">from</span> <span class="nn">aiida.common.warnings</span> <span class="k">import</span> <span class="n">AiidaDeprecationWarning</span> <span class="k">as</span> <span class="ne">DeprecationWarning</span>  <span class="c1"># pylint: disable=redefined-builtin</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>  <span class="c1"># pylint: disable=no-member</span>
            <span class="s1">&#39;This method has been deprecated and will be renamed to get_structure() in AiiDA v1.0&#39;</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_structure</span><span class="p">(</span><span class="n">store</span><span class="o">=</span><span class="n">store</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="TrajectoryData.get_structure"><a class="viewcode-back" href="../../../../../../developer_guide/core/orm_overview.html#aiida.orm.TrajectoryData.get_structure">[docs]</a>    <span class="k">def</span> <span class="nf">get_structure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates :py:class:`aiida.orm.nodes.data.structure.StructureData`.</span>

<span class="sd">        .. versionadded:: 1.0</span>
<span class="sd">           Renamed from _get_aiida_structure</span>

<span class="sd">        :param converter: specify the converter. Default &#39;ase&#39;.</span>
<span class="sd">        :param store: If True, intermediate calculation gets stored in the</span>
<span class="sd">            AiiDA database for record. Default False.</span>
<span class="sd">        :return: :py:class:`aiida.orm.nodes.data.structure.StructureData` node.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">aiida.orm.nodes.data.dict</span> <span class="k">import</span> <span class="n">Dict</span>
        <span class="kn">from</span> <span class="nn">aiida.tools.data.array.trajectory</span> <span class="k">import</span> <span class="n">_get_aiida_structure_inline</span>

        <span class="n">param</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">(</span><span class="nb">dict</span><span class="o">=</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">ret_dict</span> <span class="o">=</span> <span class="n">_get_aiida_structure_inline</span><span class="p">(</span><span class="n">trajectory</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">param</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;store_provenance&#39;</span><span class="p">:</span> <span class="n">store</span><span class="p">})</span>  <span class="c1"># pylint: disable=unexpected-keyword-arg</span>
        <span class="k">return</span> <span class="n">ret_dict</span><span class="p">[</span><span class="s1">&#39;structure&#39;</span><span class="p">]</span></div>

<div class="viewcode-block" id="TrajectoryData._get_cif"><a class="viewcode-back" href="../../../../../../developer_guide/core/orm_overview.html#aiida.orm.TrajectoryData._get_cif">[docs]</a>    <span class="k">def</span> <span class="nf">_get_cif</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates :py:class:`aiida.orm.nodes.data.cif.CifData`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">warnings</span>
        <span class="kn">from</span> <span class="nn">aiida.common.warnings</span> <span class="k">import</span> <span class="n">AiidaDeprecationWarning</span> <span class="k">as</span> <span class="ne">DeprecationWarning</span>  <span class="c1"># pylint: disable=redefined-builtin</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>  <span class="c1"># pylint: disable=no-member</span>
            <span class="s1">&#39;This method has been deprecated and will be renamed to get_cif() in AiiDA v1.0&#39;</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cif</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="TrajectoryData.get_cif"><a class="viewcode-back" href="../../../../../../developer_guide/core/orm_overview.html#aiida.orm.TrajectoryData.get_cif">[docs]</a>    <span class="k">def</span> <span class="nf">get_cif</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates :py:class:`aiida.orm.nodes.data.cif.CifData`</span>

<span class="sd">        .. versionadded:: 1.0</span>
<span class="sd">           Renamed from _get_cif</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">struct</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_structure</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">cif</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">get_cif</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cif</span></div>

<div class="viewcode-block" id="TrajectoryData._parse_xyz_pos"><a class="viewcode-back" href="../../../../../../developer_guide/core/orm_overview.html#aiida.orm.TrajectoryData._parse_xyz_pos">[docs]</a>    <span class="k">def</span> <span class="nf">_parse_xyz_pos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputstring</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load positions from a XYZ file.</span>

<span class="sd">        .. note:: The steps and symbols must be set manually before calling this</span>
<span class="sd">            import function as a consistency measure. Even though the symbols</span>
<span class="sd">            and steps could be extracted from the XYZ file, the data present in</span>
<span class="sd">            the XYZ file may or may not be correct and the same logic would have</span>
<span class="sd">            to be present in the XYZ-velocities function. It was therefore</span>
<span class="sd">            decided not to implement it at all but require it to be set</span>
<span class="sd">            explicitly.</span>

<span class="sd">        Usage::</span>

<span class="sd">            from aiida.orm.nodes.data.array.trajectory import TrajectoryData</span>

<span class="sd">            t = TrajectoryData()</span>
<span class="sd">            # get sites and number of timesteps</span>
<span class="sd">            t.set_array(&#39;steps&#39;, arange(ntimesteps))</span>
<span class="sd">            t.set_array(&#39;symbols&#39;, array([site.kind for site in s.sites]))</span>
<span class="sd">            t.importfile(&#39;some-calc/AIIDA-PROJECT-pos-1.xyz&#39;, &#39;xyz_pos&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="kn">from</span> <span class="nn">aiida.common.exceptions</span> <span class="k">import</span> <span class="n">ValidationError</span>
        <span class="kn">from</span> <span class="nn">aiida.tools.data.structure</span> <span class="k">import</span> <span class="n">xyz_parser_iterator</span>
        <span class="kn">from</span> <span class="nn">numpy</span> <span class="k">import</span> <span class="n">array</span>

        <span class="n">numsteps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">numsteps</span>
        <span class="k">if</span> <span class="n">numsteps</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;steps must be set before importing positional data&quot;</span><span class="p">)</span>

        <span class="n">numsites</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">numsites</span>
        <span class="k">if</span> <span class="n">numsites</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;symbols must be set before importing positional data&quot;</span><span class="p">)</span>

        <span class="n">positions</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span>
            <span class="p">[[</span><span class="nb">list</span><span class="p">(</span><span class="n">position</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">position</span> <span class="ow">in</span> <span class="n">atoms</span><span class="p">]</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">atoms</span> <span class="ow">in</span> <span class="n">xyz_parser_iterator</span><span class="p">(</span><span class="n">inputstring</span><span class="p">)])</span>

        <span class="k">if</span> <span class="n">positions</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="p">(</span><span class="n">numsteps</span><span class="p">,</span> <span class="n">numsites</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;TrajectoryData.positions must have shape (s,n,3), &quot;</span>
                             <span class="s2">&quot;with s=number of steps=</span><span class="si">{}</span><span class="s2"> and &quot;</span>
                             <span class="s2">&quot;n=number of symbols=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">numsteps</span><span class="p">,</span> <span class="n">numsites</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_array</span><span class="p">(</span><span class="s1">&#39;positions&#39;</span><span class="p">,</span> <span class="n">positions</span><span class="p">)</span></div>

<div class="viewcode-block" id="TrajectoryData._parse_xyz_vel"><a class="viewcode-back" href="../../../../../../developer_guide/core/orm_overview.html#aiida.orm.TrajectoryData._parse_xyz_vel">[docs]</a>    <span class="k">def</span> <span class="nf">_parse_xyz_vel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputstring</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load velocities from a XYZ file.</span>

<span class="sd">        .. note:: The steps and symbols must be set manually before calling this</span>
<span class="sd">            import function as a consistency measure. See also comment for</span>
<span class="sd">            :py:meth:`._parse_xyz_pos`</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="kn">from</span> <span class="nn">aiida.common.exceptions</span> <span class="k">import</span> <span class="n">ValidationError</span>
        <span class="kn">from</span> <span class="nn">aiida.tools.data.structure</span> <span class="k">import</span> <span class="n">xyz_parser_iterator</span>
        <span class="kn">from</span> <span class="nn">numpy</span> <span class="k">import</span> <span class="n">array</span>

        <span class="n">numsteps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">numsteps</span>
        <span class="k">if</span> <span class="n">numsteps</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;steps must be set before importing positional data&quot;</span><span class="p">)</span>

        <span class="n">numsites</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">numsites</span>
        <span class="k">if</span> <span class="n">numsites</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;symbols must be set before importing positional data&quot;</span><span class="p">)</span>

        <span class="n">velocities</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span>
            <span class="p">[[</span><span class="nb">list</span><span class="p">(</span><span class="n">velocity</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">velocity</span> <span class="ow">in</span> <span class="n">atoms</span><span class="p">]</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">atoms</span> <span class="ow">in</span> <span class="n">xyz_parser_iterator</span><span class="p">(</span><span class="n">inputstring</span><span class="p">)])</span>

        <span class="k">if</span> <span class="n">velocities</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="p">(</span><span class="n">numsteps</span><span class="p">,</span> <span class="n">numsites</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;TrajectoryData.positions must have shape (s,n,3), &quot;</span>
                             <span class="s2">&quot;with s=number of steps=</span><span class="si">{}</span><span class="s2"> and &quot;</span>
                             <span class="s2">&quot;n=number of symbols=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">numsteps</span><span class="p">,</span> <span class="n">numsites</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_array</span><span class="p">(</span><span class="s1">&#39;velocities&#39;</span><span class="p">,</span> <span class="n">velocities</span><span class="p">)</span></div>

<div class="viewcode-block" id="TrajectoryData.show_mpl_pos"><a class="viewcode-back" href="../../../../../../developer_guide/core/orm_overview.html#aiida.orm.TrajectoryData.show_mpl_pos">[docs]</a>    <span class="k">def</span> <span class="nf">show_mpl_pos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>  <span class="c1"># pylint: disable=too-many-locals</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Shows the positions as a function of time, separate for XYZ coordinates</span>

<span class="sd">        :param int stepsize: The stepsize for the trajectory, set higher than 1 to</span>
<span class="sd">            reduce number of points</span>
<span class="sd">        :param int mintime: Time to start from</span>
<span class="sd">        :param int maxtime: Maximum time</span>
<span class="sd">        :param list elements:</span>
<span class="sd">            A list of atomic symbols that should be displayed.</span>
<span class="sd">            If not specified, all atoms are displayed.</span>
<span class="sd">        :param list indices:</span>
<span class="sd">            A list of indices of that atoms that can be displayed.</span>
<span class="sd">            If not specified, all atoms of the correct species are displayed.</span>
<span class="sd">        :param bool dont_block: If True, interpreter is not blocked when figure is displayed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">ase.data</span> <span class="k">import</span> <span class="n">atomic_numbers</span>
        <span class="kn">from</span> <span class="nn">aiida.common.exceptions</span> <span class="k">import</span> <span class="n">InputValidationError</span>

        <span class="c1"># Reading the arrays I need:</span>
        <span class="n">positions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_positions</span><span class="p">()</span>
        <span class="n">times</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_times</span><span class="p">()</span>
        <span class="n">symbols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span>

        <span class="c1"># Try to get the units.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">positions_unit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;units|positions&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">positions_unit</span> <span class="o">=</span> <span class="s1">&#39;A&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">times_unit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;units|times&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">times_unit</span> <span class="o">=</span> <span class="s1">&#39;ps&#39;</span>

        <span class="c1"># Getting the keyword input</span>
        <span class="n">stepsize</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;stepsize&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">maxtime</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;maxtime&#39;</span><span class="p">,</span> <span class="n">times</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">mintime</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;mintime&#39;</span><span class="p">,</span> <span class="n">times</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">element_list</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;elements&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">index_list</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;indices&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">dont_block</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;dont_block&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;label&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">()</span>
        <span class="c1"># Choosing the color scheme</span>

        <span class="n">colors</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;colors&#39;</span><span class="p">,</span> <span class="s1">&#39;jmol&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">colors</span> <span class="o">==</span> <span class="s1">&#39;jmol&#39;</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">ase.data.colors</span> <span class="k">import</span> <span class="n">jmol_colors</span> <span class="k">as</span> <span class="n">colors</span>
        <span class="k">elif</span> <span class="n">colors</span> <span class="o">==</span> <span class="s1">&#39;cpk&#39;</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">ase.data.colors</span> <span class="k">import</span> <span class="n">cpk_colors</span> <span class="k">as</span> <span class="n">colors</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InputValidationError</span><span class="p">(</span><span class="s2">&quot;Unknown color spec </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">colors</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InputValidationError</span><span class="p">(</span><span class="s2">&quot;Unrecognized keyword </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>

        <span class="k">if</span> <span class="n">element_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># If not all elements are allowed</span>
            <span class="n">allowed_elements</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">symbols</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># A subset of elements are allowed</span>
            <span class="n">allowed_elements</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">element_list</span><span class="p">)</span>
        <span class="n">color_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">s</span><span class="p">:</span> <span class="n">colors</span><span class="p">[</span><span class="n">atomic_numbers</span><span class="p">[</span><span class="n">s</span><span class="p">]]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">symbols</span><span class="p">)}</span>
        <span class="c1"># Here I am trying to find out the atoms to show</span>
        <span class="k">if</span> <span class="n">index_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># If not index_list was provided, I will see if an element_list</span>
            <span class="c1"># was given to me</span>
            <span class="n">indices_to_show</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">sym</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">symbols</span><span class="p">)</span> <span class="k">if</span> <span class="n">sym</span> <span class="ow">in</span> <span class="n">allowed_elements</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">indices_to_show</span> <span class="o">=</span> <span class="n">index_list</span>
            <span class="c1"># I refrain from checking if indices are ok, will crash if not...</span>

        <span class="c1"># The color_list is a list of colors (RGB) that I will</span>
        <span class="c1"># pass, so the different species give different colors in the plot</span>
        <span class="n">color_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">color_dict</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">symbols</span><span class="p">]</span>

        <span class="c1"># Reducing array size based on stepsize variable</span>
        <span class="n">_times</span> <span class="o">=</span> <span class="n">times</span><span class="p">[::</span><span class="n">stepsize</span><span class="p">]</span>
        <span class="n">_positions</span> <span class="o">=</span> <span class="n">positions</span><span class="p">[::</span><span class="n">stepsize</span><span class="p">]</span>

        <span class="c1"># Calling</span>
        <span class="n">plot_positions_XYZ</span><span class="p">(</span>
            <span class="n">_times</span><span class="p">,</span>
            <span class="n">_positions</span><span class="p">,</span>
            <span class="n">indices_to_show</span><span class="p">,</span>
            <span class="n">color_list</span><span class="p">,</span>
            <span class="n">label</span><span class="p">,</span>
            <span class="n">positions_unit</span><span class="p">,</span>
            <span class="n">times_unit</span><span class="p">,</span>
            <span class="n">dont_block</span><span class="p">,</span>
            <span class="n">mintime</span><span class="p">,</span>
            <span class="n">maxtime</span><span class="p">,</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="TrajectoryData.show_mpl_heatmap"><a class="viewcode-back" href="../../../../../../developer_guide/core/orm_overview.html#aiida.orm.TrajectoryData.show_mpl_heatmap">[docs]</a>    <span class="k">def</span> <span class="nf">show_mpl_heatmap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>  <span class="c1"># pylint: disable=invalid-name,too-many-arguments,too-many-locals,too-many-statements,too-many-branches</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Show a heatmap of the trajectory with matplotlib.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
        <span class="kn">from</span> <span class="nn">scipy</span> <span class="k">import</span> <span class="n">stats</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">mayavi</span> <span class="k">import</span> <span class="n">mlab</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s2">&quot;Unable to import the mayavi package, that is required to&quot;</span>
                              <span class="s2">&quot;use the plotting feature you requested. &quot;</span>
                              <span class="s2">&quot;Please install it first and then call this command again &quot;</span>
                              <span class="s2">&quot;(note that the installation of mayavi is quite complicated &quot;</span>
                              <span class="s2">&quot;and requires that you already installed the python numpy &quot;</span>
                              <span class="s2">&quot;package, as well as the vtk package&quot;</span><span class="p">)</span>
        <span class="kn">from</span> <span class="nn">ase.data.colors</span> <span class="k">import</span> <span class="n">jmol_colors</span>
        <span class="kn">from</span> <span class="nn">ase.data</span> <span class="k">import</span> <span class="n">atomic_numbers</span>

        <span class="c1"># pylint: disable=invalid-name</span>

        <span class="k">def</span> <span class="nf">collapse_into_unit_cell</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">cell</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Applies linear transformation to coordinate system based on crystal</span>
<span class="sd">            lattice, vectors. The inverse of that inverse transformation matrix with the</span>
<span class="sd">            point given results in the point being given as a multiples of lattice vectors</span>
<span class="sd">            Than take the integer of the rows to find how many times you have to shift</span>
<span class="sd">            the point back&quot;&quot;&quot;</span>
            <span class="n">invcell</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">I</span>
            <span class="c1"># point in crystal coordinates</span>
            <span class="n">points_in_crystal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">invcell</span><span class="p">,</span> <span class="n">point</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
            <span class="c1">#point collapsed into unit cell</span>
            <span class="n">points_in_unit_cell</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="o">%</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">points_in_crystal</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cell</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">points_in_unit_cell</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="n">elements</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;elements&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">mintime</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;mintime&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">maxtime</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;maxtime&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">stepsize</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;stepsize&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="mi">1</span>
        <span class="n">contours</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;contours&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>
        <span class="n">sampling_stepsize</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;sampling_stepsize&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">)</span>

        <span class="n">times</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_times</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">mintime</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">minindex</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">minindex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">times</span> <span class="o">&gt;</span> <span class="n">mintime</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">maxtime</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">maxindex</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">times</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">maxindex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">times</span> <span class="o">&lt;</span> <span class="n">maxtime</span><span class="p">)</span>
        <span class="n">positions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_positions</span><span class="p">()[</span><span class="n">minindex</span><span class="p">:</span><span class="n">maxindex</span><span class="p">:</span><span class="n">stepsize</span><span class="p">]</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;units|positions&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;bohr&#39;</span><span class="p">,</span> <span class="s1">&#39;atomic&#39;</span><span class="p">):</span>
                <span class="kn">from</span> <span class="nn">aiida.common.constants</span> <span class="k">import</span> <span class="n">bohr_to_ang</span>
                <span class="n">positions</span> <span class="o">*=</span> <span class="n">bohr_to_ang</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="n">symbols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span>
        <span class="k">if</span> <span class="n">elements</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">elements</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">symbols</span><span class="p">)</span>

        <span class="n">cells</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cells</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">cells</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No cell parameters have been supplied for TrajectoryData&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cell</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cells</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">storage_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">s</span><span class="p">:</span> <span class="p">{}</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">elements</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">ele</span> <span class="ow">in</span> <span class="n">elements</span><span class="p">:</span>
            <span class="n">storage_dict</span><span class="p">[</span><span class="n">ele</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])]</span>
        <span class="k">for</span> <span class="n">iat</span><span class="p">,</span> <span class="n">ele</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">symbols</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">ele</span> <span class="ow">in</span> <span class="n">elements</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">idim</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                    <span class="n">storage_dict</span><span class="p">[</span><span class="n">ele</span><span class="p">][</span><span class="n">idim</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">storage_dict</span><span class="p">[</span><span class="n">ele</span><span class="p">][</span><span class="n">idim</span><span class="p">],</span>
                                                              <span class="n">positions</span><span class="p">[:,</span> <span class="n">iat</span><span class="p">,</span> <span class="n">idim</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()))</span>

        <span class="k">for</span> <span class="n">ele</span> <span class="ow">in</span> <span class="n">elements</span><span class="p">:</span>
            <span class="n">storage_dict</span><span class="p">[</span><span class="n">ele</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">storage_dict</span><span class="p">[</span><span class="n">ele</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
            <span class="n">storage_dict</span><span class="p">[</span><span class="n">ele</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">collapse_into_unit_cell</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">cell</span><span class="p">)</span> <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">storage_dict</span><span class="p">[</span><span class="n">ele</span><span class="p">]])</span><span class="o">.</span><span class="n">T</span>

        <span class="n">white</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">mlab</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">bgcolor</span><span class="o">=</span><span class="n">white</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">1080</span><span class="p">,</span> <span class="mi">720</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">i1</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cell</span><span class="p">):</span>
            <span class="n">i2</span> <span class="o">=</span> <span class="p">(</span><span class="n">i1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">3</span>
            <span class="n">i3</span> <span class="o">=</span> <span class="p">(</span><span class="n">i1</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">%</span> <span class="mi">3</span>
            <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">cell</span><span class="p">[</span><span class="n">i2</span><span class="p">]]:</span>
                <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">cell</span><span class="p">[</span><span class="n">i3</span><span class="p">]]:</span>
                    <span class="n">p1</span> <span class="o">=</span> <span class="n">b</span> <span class="o">+</span> <span class="n">c</span>
                    <span class="n">p2</span> <span class="o">=</span> <span class="n">p1</span> <span class="o">+</span> <span class="n">a</span>
                    <span class="n">mlab</span><span class="o">.</span><span class="n">plot3d</span><span class="p">([</span><span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p2</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="p">[</span><span class="n">p1</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">p2</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span> <span class="n">tube_radius</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">ele</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">storage_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">kde</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">gaussian_kde</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">bw_method</span><span class="o">=</span><span class="mf">0.15</span><span class="p">)</span>

            <span class="n">_x</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
            <span class="n">_y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
            <span class="n">_z</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:]</span>
            <span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">zmin</span> <span class="o">=</span> <span class="n">_x</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">_y</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">_z</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
            <span class="n">xmax</span><span class="p">,</span> <span class="n">ymax</span><span class="p">,</span> <span class="n">zmax</span> <span class="o">=</span> <span class="n">_x</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">_y</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">_z</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

            <span class="n">_xi</span><span class="p">,</span> <span class="n">_yi</span><span class="p">,</span> <span class="n">_zi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mgrid</span><span class="p">[</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">:</span><span class="mi">60</span><span class="n">j</span><span class="p">,</span> <span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">:</span><span class="mi">30</span><span class="n">j</span><span class="p">,</span> <span class="n">zmin</span><span class="p">:</span><span class="n">zmax</span><span class="p">:</span><span class="mi">30</span><span class="n">j</span><span class="p">]</span>  <span class="c1"># pylint: disable=invalid-slice-index</span>
            <span class="n">coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">item</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="p">[</span><span class="n">_xi</span><span class="p">,</span> <span class="n">_yi</span><span class="p">,</span> <span class="n">_zi</span><span class="p">]])</span>
            <span class="n">density</span> <span class="o">=</span> <span class="n">kde</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">_xi</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

            <span class="c1"># Plot scatter with mayavi</span>
            <span class="c1">#~ figure = mlab.figure(&#39;DensityPlot&#39;)</span>
            <span class="n">grid</span> <span class="o">=</span> <span class="n">mlab</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">scalar_field</span><span class="p">(</span><span class="n">_xi</span><span class="p">,</span> <span class="n">_yi</span><span class="p">,</span> <span class="n">_zi</span><span class="p">,</span> <span class="n">density</span><span class="p">)</span>
            <span class="c1">#~ min = density.min()</span>
            <span class="n">maxdens</span> <span class="o">=</span> <span class="n">density</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
            <span class="c1">#~ mlab.pipeline.volume(grid, vmin=min, vmax=min + .5*(max-min))</span>
            <span class="n">surf</span> <span class="o">=</span> <span class="n">mlab</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">iso_surface</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">colormap</span><span class="o">=</span><span class="s1">&#39;cool&#39;</span><span class="p">,</span> <span class="n">contours</span><span class="o">=</span><span class="p">(</span><span class="n">maxdens</span> <span class="o">*</span> <span class="n">contours</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
            <span class="n">lut</span> <span class="o">=</span> <span class="n">surf</span><span class="o">.</span><span class="n">module_manager</span><span class="o">.</span><span class="n">scalar_lut_manager</span><span class="o">.</span><span class="n">lut</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">to_array</span><span class="p">()</span>

            <span class="c1"># The lut is a 255x4 array, with the columns representing RGBA</span>
            <span class="c1"># (red, green, blue, alpha) coded with integers going from 0 to 255.</span>

            <span class="c1"># We modify the alpha channel to add a transparency gradient</span>
            <span class="n">lut</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">256</span><span class="p">)</span>
            <span class="n">lut</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">255</span> <span class="o">*</span> <span class="n">jmol_colors</span><span class="p">[</span><span class="n">atomic_numbers</span><span class="p">[</span><span class="n">ele</span><span class="p">]]</span>
            <span class="c1"># and finally we put this LUT back in the surface object. We could have</span>
            <span class="c1"># added any 255*4 array rather than modifying an existing LUT.</span>
            <span class="n">surf</span><span class="o">.</span><span class="n">module_manager</span><span class="o">.</span><span class="n">scalar_lut_manager</span><span class="o">.</span><span class="n">lut</span><span class="o">.</span><span class="n">table</span> <span class="o">=</span> <span class="n">lut</span>

            <span class="k">if</span> <span class="n">sampling_stepsize</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">mlab</span><span class="o">.</span><span class="n">points3d</span><span class="p">(</span>
                    <span class="n">_x</span><span class="p">[::</span><span class="n">sampling_stepsize</span><span class="p">],</span>
                    <span class="n">_y</span><span class="p">[::</span><span class="n">sampling_stepsize</span><span class="p">],</span>
                    <span class="n">_z</span><span class="p">[::</span><span class="n">sampling_stepsize</span><span class="p">],</span>
                    <span class="n">color</span><span class="o">=</span><span class="nb">tuple</span><span class="p">(</span><span class="n">jmol_colors</span><span class="p">[</span><span class="n">atomic_numbers</span><span class="p">[</span><span class="n">ele</span><span class="p">]]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()),</span>
                    <span class="n">scale_mode</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span>
                    <span class="n">scale_factor</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
                    <span class="n">opacity</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

        <span class="n">mlab</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">azimuth</span><span class="o">=</span><span class="mi">155</span><span class="p">,</span> <span class="n">elevation</span><span class="o">=</span><span class="mi">70</span><span class="p">,</span> <span class="n">distance</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span>
        <span class="n">mlab</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="plot_positions_XYZ"><a class="viewcode-back" href="../../../../../../developer_guide/core/orm_overview.html#aiida.orm.plot_positions_XYZ">[docs]</a><span class="k">def</span> <span class="nf">plot_positions_XYZ</span><span class="p">(</span>  <span class="c1"># pylint: disable=too-many-arguments,too-many-locals,invalid-name</span>
        <span class="n">times</span><span class="p">,</span>
        <span class="n">positions</span><span class="p">,</span>
        <span class="n">indices_to_show</span><span class="p">,</span>
        <span class="n">color_list</span><span class="p">,</span>
        <span class="n">label</span><span class="p">,</span>
        <span class="n">positions_unit</span><span class="o">=</span><span class="s1">&#39;A&#39;</span><span class="p">,</span>
        <span class="n">times_unit</span><span class="o">=</span><span class="s1">&#39;ps&#39;</span><span class="p">,</span>
        <span class="n">dont_block</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">mintime</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">maxtime</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">label_sparsity</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot with matplotlib the positions of the coordinates of the atoms</span>
<span class="sd">    over time for a trajectory</span>

<span class="sd">    :param times: array of times</span>
<span class="sd">    :param positions: array of positions</span>
<span class="sd">    :param indices_to_show: list of indices of to show (0, 1, 2 for X, Y, Z)</span>
<span class="sd">    :param color_list: list of valid color specifications for matplotlib</span>
<span class="sd">    :param label: label for this plot to put in the title</span>
<span class="sd">    :param positions_unit: label for the units of positions (for the x label)</span>
<span class="sd">    :param times_unit: label for the units of times (for the y label)</span>
<span class="sd">    :param dont_block: passed to plt.show() as ``block=not dont_block``</span>
<span class="sd">    :param mintime: if specified, cut the time axis at the specified min value</span>
<span class="sd">    :param maxtime: if specified, cut the time axis at the specified max value</span>
<span class="sd">    :param label_sparsity: how often to put a label with the pair (t, coord)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">matplotlib</span> <span class="k">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
    <span class="kn">from</span> <span class="nn">matplotlib.gridspec</span> <span class="k">import</span> <span class="n">GridSpec</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

    <span class="n">tlim</span> <span class="o">=</span> <span class="p">[</span><span class="n">times</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">times</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
    <span class="n">index_range</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">times</span><span class="p">)]</span>
    <span class="k">if</span> <span class="n">mintime</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">tlim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">mintime</span>
        <span class="n">index_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">times</span> <span class="o">&gt;</span> <span class="n">mintime</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">maxtime</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">tlim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">maxtime</span>
        <span class="n">index_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">times</span> <span class="o">&lt;</span> <span class="n">maxtime</span><span class="p">)</span>

    <span class="n">trajectories</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">positions</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>  <span class="c1"># only used in enumerate() below</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Trajectory of </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">nr_of_axes</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">gridspec</span> <span class="o">=</span> <span class="n">GridSpec</span><span class="p">(</span><span class="n">nr_of_axes</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>

    <span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gridspec</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;X Position $\left[</span><span class="si">{}</span><span class="s1">\right]$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">positions_unit</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="o">*</span><span class="n">tlim</span><span class="p">)</span>
    <span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gridspec</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Y Position $\left[</span><span class="si">{}</span><span class="s1">\right]$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">positions_unit</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="o">*</span><span class="n">tlim</span><span class="p">)</span>
    <span class="n">ax3</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gridspec</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Z Position $\left[</span><span class="si">{}</span><span class="s1">\right]$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">positions_unit</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time [</span><span class="si">{}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">times_unit</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="o">*</span><span class="n">tlim</span><span class="p">)</span>
    <span class="n">sparse_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">*</span><span class="n">index_range</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">label_sparsity</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">traj</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">trajectories</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">index</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">indices_to_show</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">color_list</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="n">_x</span><span class="p">,</span> <span class="n">_y</span><span class="p">,</span> <span class="n">_z</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">traj</span><span class="p">))</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">_x</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">_y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
        <span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">_z</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sparse_indices</span><span class="p">:</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">times</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">_x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">times</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">_x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
            <span class="n">ax3</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">times</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">_x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">axes</span> <span class="ow">in</span> <span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span><span class="p">:</span>
        <span class="n">yticks</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">get_major_ticks</span><span class="p">()</span>
        <span class="n">yticks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">label1</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">block</span><span class="o">=</span><span class="ow">not</span> <span class="n">dont_block</span><span class="p">)</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, ECOLE POLYTECHNIQUE FEDERALE DE LAUSANNE (Theory and Simulation of Materials (THEOS) and National Centre for Computational Design and Discovery of Novel Materials (NCCR MARVEL)), Switzerland and ROBERT BOSCH LLC, USA. All rights reserved

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>