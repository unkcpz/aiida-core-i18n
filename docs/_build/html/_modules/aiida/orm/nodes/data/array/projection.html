

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>aiida.orm.nodes.data.array.projection &mdash; AiiDA 1.0.0b2 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../../../" src="../../../../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../../../../_static/language_data.js"></script>
        <script type="text/javascript" src="../../../../../../_static/contentui.js"></script>
    
    <script type="text/javascript" src="../../../../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../../_static/contentui.css" type="text/css" />
    <link rel="index" title="Index" href="../../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../../../index.html" class="icon icon-home"> AiiDA
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Installation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../install/quick_installation.html">Quick installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../install/prerequisites.html">Prerequisites</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../install/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../install/updating_installation.html">Updating AiiDA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../install/troubleshooting.html">Troubleshooting</a></li>
</ul>
<p class="caption"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../get_started/index.html">First things first</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../get_started/daemon.html">Setup the daemon</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../get_started/computers.html">Setup a computer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../get_started/codes.html">Setup a code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../get_started/plugins.html">Plugins</a></li>
</ul>
<p class="caption"><span class="caption-text">Concepts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../concepts/provenance.html">Provenance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../concepts/processes.html">Processes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../concepts/calculations.html">Calculations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../concepts/workflows.html">Workflows</a></li>
</ul>
<p class="caption"><span class="caption-text">Working with</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../working/processes.html">Processes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../working/functions.html">Calculation and work functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../working/calculations.html">Calculations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../working/workflows.html">Workflows</a></li>
</ul>
<p class="caption"><span class="caption-text">Working with AiiDA</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../working_with_aiida/index.html">Command line interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../working_with_aiida/index.html#scripting">Scripting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../working_with_aiida/index.html#data-types">Data types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../working_with_aiida/index.html#groups">Groups</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../working_with_aiida/index.html#schedulers">Schedulers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../working_with_aiida/index.html#querying-data">Querying data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../working_with_aiida/index.html#caching">Caching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../working_with_aiida/index.html#result-manager">Result manager</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../working_with_aiida/index.html#backups">Backups</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../working_with_aiida/index.html#troubleshooting">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../working_with_aiida/index.html#rest-api">REST API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../working_with_aiida/index.html#cookbook">Cookbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../import_export/index.html">Import and Export</a></li>
</ul>
<p class="caption"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../developer_guide/index.html">AiiDA design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../developer_guide/index.html#aiida-core">AiiDA core</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../developer_guide/index.html#aiida-plugins">AiiDA plugins</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../tutorial/index.html">StructureData</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../tutorial/index.html#pseudopotentials">Pseudopotentials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../tutorial/index.html#plugin-development">Plugin development</a></li>
</ul>
<p class="caption"><span class="caption-text">API reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="`aiida package &lt;https://aiida-core.readthedocs.io/en/latest/apidoc/aiida.html&gt;`_">`aiida package &lt;https://aiida-core.readthedocs.io/en/latest/apidoc/aiida.html&gt;`_</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../../index.html">AiiDA</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../../../../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../../../../../aiida.html">aiida</a> &raquo;</li>
        
      <li>aiida.orm.nodes.data.array.projection</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for aiida.orm.nodes.data.array.projection</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1">###########################################################################</span>
<span class="c1"># Copyright (c), The AiiDA team. All rights reserved.                     #</span>
<span class="c1"># This file is part of the AiiDA code.                                    #</span>
<span class="c1">#                                                                         #</span>
<span class="c1"># The code is hosted on GitHub at https://github.com/aiidateam/aiida_core #</span>
<span class="c1"># For further information on the license, see the LICENSE.txt file        #</span>
<span class="c1"># For further information please visit http://www.aiida.net               #</span>
<span class="c1">###########################################################################</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">division</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">print_function</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">absolute_import</span>

<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">six</span>
<span class="kn">from</span> <span class="nn">six.moves</span> <span class="k">import</span> <span class="nb">range</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">aiida.common</span> <span class="k">import</span> <span class="n">exceptions</span>

<span class="kn">from</span> <span class="nn">..orbital</span> <span class="k">import</span> <span class="n">OrbitalData</span>
<span class="kn">from</span> <span class="nn">.array</span> <span class="k">import</span> <span class="n">ArrayData</span>
<span class="kn">from</span> <span class="nn">.bands</span> <span class="k">import</span> <span class="n">BandsData</span>


<div class="viewcode-block" id="ProjectionData"><a class="viewcode-back" href="../../../../../../developer_guide/core/orm_overview.html#aiida.orm.ProjectionData">[docs]</a><span class="k">class</span> <span class="nc">ProjectionData</span><span class="p">(</span><span class="n">OrbitalData</span><span class="p">,</span> <span class="n">ArrayData</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A class to handle arrays of projected wavefunction data. That is projections</span>
<span class="sd">    of a orbitals, usually an atomic-hydrogen orbital, onto a</span>
<span class="sd">    given bloch wavefunction, the bloch wavefunction being indexed by</span>
<span class="sd">    s, n, and k. E.g. the elements are the projections described as</span>
<span class="sd">    &lt; orbital | Bloch wavefunction (s,n,k) &gt;</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="ProjectionData._check_projections_bands"><a class="viewcode-back" href="../../../../../../developer_guide/core/orm_overview.html#aiida.orm.ProjectionData._check_projections_bands">[docs]</a>    <span class="k">def</span> <span class="nf">_check_projections_bands</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">projection_array</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks to make sure that a reference bandsdata is already set, and that</span>
<span class="sd">        projection_array is of the same shape of the bands data</span>

<span class="sd">        :param projwfc_arrays: nk x nb x nwfc array, to be</span>
<span class="sd">                               checked against bands</span>

<span class="sd">        :raise: AttributeError if energy is not already set</span>
<span class="sd">        :raise: AttributeError if input_array is not of same shape as</span>
<span class="sd">                dos_energy</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">shape_bands</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_reference_bandsdata</span><span class="p">())</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">exceptions</span><span class="o">.</span><span class="n">ValidationError</span><span class="p">(</span><span class="s1">&#39;Bands must be set first, then projwfc&#39;</span><span class="p">)</span>
        <span class="c1"># The [0:2] is so that each array, and not collection of arrays</span>
        <span class="c1"># is used to make the comparison</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">projection_array</span><span class="p">)</span> <span class="o">!=</span> <span class="n">shape_bands</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;These arrays are not the same shape as&#39;</span>
                                 <span class="s1">&#39; the bands&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="ProjectionData.set_reference_bandsdata"><a class="viewcode-back" href="../../../../../../developer_guide/core/orm_overview.html#aiida.orm.ProjectionData.set_reference_bandsdata">[docs]</a>    <span class="k">def</span> <span class="nf">set_reference_bandsdata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets a reference bandsdata, creates a uuid link between this data</span>
<span class="sd">        object and a bandsdata object, must be set before any projection arrays</span>

<span class="sd">        :param value: a BandsData instance, a uuid or a pk</span>
<span class="sd">        :raise: exceptions.NotExistent if there was no BandsData associated with uuid or pk</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">aiida.orm</span> <span class="k">import</span> <span class="n">load_node</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">BandsData</span><span class="p">):</span>
            <span class="n">uuid</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">uuid</span> 
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">pk</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="n">bands</span> <span class="o">=</span> <span class="n">load_node</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">pk</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">BandsData</span><span class="p">)</span>
                <span class="n">uuid</span> <span class="o">=</span> <span class="n">bands</span><span class="o">.</span><span class="n">uuid</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="n">uuid</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">bands</span> <span class="o">=</span> <span class="n">load_node</span><span class="p">(</span><span class="n">uuid</span><span class="o">=</span><span class="n">uuid</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">BandsData</span><span class="p">)</span>
                    <span class="n">uuid</span> <span class="o">=</span> <span class="n">bands</span><span class="o">.</span><span class="n">uuid</span>
                <span class="k">except</span> <span class="p">:</span>
                    <span class="k">raise</span> <span class="n">exceptions</span><span class="o">.</span><span class="n">NotExistent</span><span class="p">(</span><span class="s2">&quot;The value passed to &quot;</span>
                                      <span class="s2">&quot;set_reference_bandsdata was not &quot;</span>
                                      <span class="s2">&quot;associated to any bandsdata&quot;</span><span class="p">)</span>
                    
        <span class="bp">self</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s1">&#39;reference_bandsdata_uuid&#39;</span><span class="p">,</span> <span class="n">uuid</span><span class="p">)</span></div>

<div class="viewcode-block" id="ProjectionData.get_reference_bandsdata"><a class="viewcode-back" href="../../../../../../developer_guide/core/orm_overview.html#aiida.orm.ProjectionData.get_reference_bandsdata">[docs]</a>    <span class="k">def</span> <span class="nf">get_reference_bandsdata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the reference BandsData, using the set uuid via</span>
<span class="sd">        set_reference_bandsdata</span>

<span class="sd">        :return: a BandsData instance</span>
<span class="sd">        :raise AttributeError: if the bandsdata has not been set yet</span>
<span class="sd">        :raise exceptions.NotExistent: if the bandsdata uuid did not retrieve bandsdata</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">aiida.orm</span> <span class="k">import</span> <span class="n">load_node</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">uuid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;reference_bandsdata_uuid&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;BandsData has not been set for this instance&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1">#bands = load_node(uuid=uuid, type=BandsData)</span>
            <span class="n">bands</span> <span class="o">=</span> <span class="n">load_node</span><span class="p">(</span><span class="n">uuid</span><span class="o">=</span><span class="n">uuid</span><span class="p">)</span> <span class="c1">#TODO switch to above once type</span>
                                         <span class="c1"># has been implemented for load_node</span>
        <span class="k">except</span> <span class="n">exceptions</span><span class="o">.</span><span class="n">NotExistent</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">exceptions</span><span class="o">.</span><span class="n">NotExistent</span><span class="p">(</span><span class="s2">&quot;The bands referenced to this class have not been &quot;</span>
                              <span class="s2">&quot;found in this database.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">bands</span></div>

<div class="viewcode-block" id="ProjectionData._find_orbitals_and_indices"><a class="viewcode-back" href="../../../../../../developer_guide/core/orm_overview.html#aiida.orm.ProjectionData._find_orbitals_and_indices">[docs]</a>    <span class="k">def</span> <span class="nf">_find_orbitals_and_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Finds all the orbitals and their indicies associated with kwargs</span>
<span class="sd">        essential for retrieving the other indexed array parameters</span>

<span class="sd">        :param kwargs: kwargs that can call orbitals as in get_orbitals()</span>
<span class="sd">        :return: retrieve_indexes, list of indicicies of orbitals corresponding</span>
<span class="sd">                 to the kwargs</span>
<span class="sd">        :return: all_orbitals, list of orbitals to which the indexes correspond</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># index_and_orbitals = self._get_orbitals_and_index()</span>
        <span class="n">index_and_orbitals</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">selected_orbitals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_orbitals</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">selected_orb_dicts</span> <span class="o">=</span> <span class="p">[</span><span class="n">orb</span><span class="o">.</span><span class="n">get_orbital_dict</span><span class="p">()</span> <span class="k">for</span> <span class="n">orb</span>
                              <span class="ow">in</span> <span class="n">selected_orbitals</span><span class="p">]</span>
        <span class="n">all_orbitals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_orbitals</span><span class="p">()</span>
        <span class="n">all_orb_dicts</span> <span class="o">=</span> <span class="p">[</span><span class="n">orb</span><span class="o">.</span><span class="n">get_orbital_dict</span><span class="p">()</span> <span class="k">for</span> <span class="n">orb</span> <span class="ow">in</span> <span class="n">all_orbitals</span><span class="p">]</span>
        <span class="n">retrieve_indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_orb_dicts</span><span class="p">))</span>
                            <span class="k">if</span> <span class="n">all_orb_dicts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="n">selected_orb_dicts</span><span class="p">]</span>
        <span class="k">return</span>  <span class="n">retrieve_indices</span><span class="p">,</span> <span class="n">all_orbitals</span></div>

<div class="viewcode-block" id="ProjectionData.get_pdos"><a class="viewcode-back" href="../../../../../../developer_guide/core/orm_overview.html#aiida.orm.ProjectionData.get_pdos">[docs]</a>    <span class="k">def</span> <span class="nf">get_pdos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves all the pdos arrays corresponding to the input kwargs</span>

<span class="sd">        :param kwargs: inputs describing the orbitals associated with the pdos</span>
<span class="sd">                       arrays</span>
<span class="sd">        :return: a list of tuples containing the orbital, energy array and pdos</span>
<span class="sd">                 array associated with all orbitals that correspond to kwargs</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">retrieve_indices</span><span class="p">,</span> <span class="n">all_orbitals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_orbitals_and_indices</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">out_list</span> <span class="o">=</span> <span class="p">[(</span><span class="n">all_orbitals</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">get_array</span><span class="p">(</span><span class="s2">&quot;pdos_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_from_index_to_arrayname</span><span class="p">(</span><span class="n">i</span><span class="p">))),</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">get_array</span><span class="p">(</span><span class="s2">&quot;energy_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_from_index_to_arrayname</span><span class="p">(</span><span class="n">i</span><span class="p">)))</span> <span class="p">)</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">retrieve_indices</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">out_list</span></div>
    
<div class="viewcode-block" id="ProjectionData.get_projections"><a class="viewcode-back" href="../../../../../../developer_guide/core/orm_overview.html#aiida.orm.ProjectionData.get_projections">[docs]</a>    <span class="k">def</span> <span class="nf">get_projections</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves all the pdos arrays corresponding to the input kwargs</span>

<span class="sd">        :param kwargs: inputs describing the orbitals associated with the pdos</span>
<span class="sd">                       arrays</span>
<span class="sd">        :return: a list of tuples containing the orbital, and projection arrays</span>
<span class="sd">                 associated with all orbitals that correspond to kwargs</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">retrieve_indices</span><span class="p">,</span> <span class="n">all_orbitals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_orbitals_and_indices</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">out_list</span> <span class="o">=</span> <span class="p">[(</span><span class="n">all_orbitals</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">get_array</span><span class="p">(</span><span class="s2">&quot;proj_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_from_index_to_arrayname</span><span class="p">(</span><span class="n">i</span><span class="p">))))</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">retrieve_indices</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">out_list</span></div>

<div class="viewcode-block" id="ProjectionData._from_index_to_arrayname"><a class="viewcode-back" href="../../../../../../developer_guide/core/orm_overview.html#aiida.orm.ProjectionData._from_index_to_arrayname">[docs]</a>    <span class="k">def</span> <span class="nf">_from_index_to_arrayname</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Used internally to determine the array names.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;array_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="ProjectionData.set_projectiondata"><a class="viewcode-back" href="../../../../../../developer_guide/core/orm_overview.html#aiida.orm.ProjectionData.set_projectiondata">[docs]</a>    <span class="k">def</span> <span class="nf">set_projectiondata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">list_of_orbitals</span><span class="p">,</span> <span class="n">list_of_projections</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                             <span class="n">list_of_energy</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">list_of_pdos</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                             <span class="n">tags</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">bands_check</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Stores the projwfc_array using the projwfc_label, after validating both.</span>

<span class="sd">        :param list_of_orbitals: list of orbitals, of class orbital data.</span>
<span class="sd">                                 They should be the ones up on which the</span>
<span class="sd">                                 projection array corresponds with.</span>

<span class="sd">        :param list_of_projections: list of arrays of projections of a atomic</span>
<span class="sd">                              wavefunctions onto bloch wavefunctions. Since the</span>
<span class="sd">                              projection is for every bloch wavefunction which</span>
<span class="sd">                              can be specified by its spin (if used), band, and</span>
<span class="sd">                              kpoint the dimensions must be</span>
<span class="sd">                              nspin x nbands x nkpoints for the projwfc array.</span>
<span class="sd">                              Or nbands x nkpoints if spin is not used.</span>

<span class="sd">        :param energy_axis: list of energy axis for the list_of_pdos</span>

<span class="sd">        :param list_of_pdos: a list of projected density of states for the</span>
<span class="sd">                             atomic wavefunctions, units in states/eV</span>

<span class="sd">        :param tags: A list of tags, not supported currently.</span>

<span class="sd">        :param bands_check: if false, skips checks of whether the bands has</span>
<span class="sd">                            been already set, and whether the sizes match. For</span>
<span class="sd">                            use in parsers, where the BandsData has not yet</span>
<span class="sd">                            been stored and therefore get_reference_bandsdata</span>
<span class="sd">                            cannot be called</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">single_to_list</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Checks if the item is a list or tuple, and converts it to a list</span>
<span class="sd">            if it is not already a list or tuple</span>

<span class="sd">            :param item: an object which may or may not be a list or tuple</span>
<span class="sd">            :return: item_list: the input item unchanged if list or tuple and</span>
<span class="sd">                                [item] otherwise</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
                <span class="k">return</span> <span class="n">item</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[</span><span class="n">item</span><span class="p">]</span>
            
        <span class="k">def</span> <span class="nf">array_list_checker</span><span class="p">(</span><span class="n">array_list</span><span class="p">,</span> <span class="n">array_name</span><span class="p">,</span> <span class="n">orb_length</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Does basic checks over everything in the array_list. Makes sure that</span>
<span class="sd">            all the arrays are np.ndarray floats, that the length is same as</span>
<span class="sd">            required_length, raises exception using array_name if there is</span>
<span class="sd">            a failure</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">_</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">array_list</span><span class="p">]):</span>
                <span class="k">raise</span> <span class="n">exceptions</span><span class="o">.</span><span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> was not composed &quot;</span>
                                      <span class="s2">&quot;entirely of ndarrays&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">array_name</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">array_list</span><span class="p">)</span> <span class="o">!=</span> <span class="n">orb_length</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">exceptions</span><span class="o">.</span><span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> did not have the same length as the &quot;</span>
                                      <span class="s2">&quot;list of orbitals&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">array_name</span><span class="p">))</span>
        
        <span class="c1">##############</span>
        <span class="n">list_of_orbitals</span> <span class="o">=</span> <span class="n">single_to_list</span><span class="p">(</span><span class="n">list_of_orbitals</span><span class="p">)</span>
        <span class="n">list_of_orbitals</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">list_of_orbitals</span><span class="p">)</span>

        <span class="c1"># validates the input data</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">list_of_pdos</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">list_of_projections</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">exceptions</span><span class="o">.</span><span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Must set either pdos or projections&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="n">list_of_energy</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">list_of_pdos</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">exceptions</span><span class="o">.</span><span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;list_of_pdos and list_of_energy must always &quot;</span>
                                  <span class="s2">&quot;be set together&quot;</span><span class="p">)</span>

        <span class="n">orb_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_of_orbitals</span><span class="p">)</span>
        
        <span class="c1"># verifies and sets the orbital dicts</span>
        <span class="n">list_of_orbital_dicts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">list_of_orbitals</span><span class="p">)):</span>
            <span class="n">this_orbital</span> <span class="o">=</span> <span class="n">list_of_orbitals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">orbital_dict</span> <span class="o">=</span> <span class="n">this_orbital</span><span class="o">.</span><span class="n">get_orbital_dict</span><span class="p">()</span>
            <span class="n">OrbitalClass</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_orbital_class_from_orbital_dict</span><span class="p">(</span>
                           <span class="n">orbital_dict</span><span class="p">)</span>
            <span class="n">test_orbital</span> <span class="o">=</span> <span class="n">OrbitalClass</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">test_orbital</span><span class="o">.</span><span class="n">set_orbital_dict</span><span class="p">(</span><span class="n">orbital_dict</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">exceptions</span><span class="o">.</span><span class="n">ValidationError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The orbital with dict </span><span class="si">{}</span><span class="s2"> &quot;</span>
                                 <span class="s2">&quot;failed.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">orbital_dict</span><span class="p">))</span>
            <span class="n">list_of_orbital_dicts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">test_orbital</span><span class="o">.</span><span class="n">get_orbital_dict</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s1">&#39;orbital_dicts&#39;</span><span class="p">,</span> <span class="n">list_of_orbital_dicts</span><span class="p">)</span>

        <span class="c1"># verifies and sets the projections</span>
        <span class="k">if</span> <span class="n">list_of_projections</span><span class="p">:</span>
            <span class="n">list_of_projections</span> <span class="o">=</span> <span class="n">single_to_list</span><span class="p">(</span><span class="n">list_of_projections</span><span class="p">)</span>
            <span class="n">array_list_checker</span><span class="p">(</span><span class="n">list_of_projections</span><span class="p">,</span> <span class="s2">&quot;projections&quot;</span><span class="p">,</span> <span class="n">orb_length</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">list_of_projections</span><span class="p">)):</span>
                <span class="n">this_projection</span> <span class="o">=</span> <span class="n">list_of_projections</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">array_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_from_index_to_arrayname</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">bands_check</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_check_projections_bands</span><span class="p">(</span><span class="n">this_projection</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_array</span><span class="p">(</span><span class="s2">&quot;proj_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">array_name</span><span class="p">),</span> <span class="n">this_projection</span><span class="p">)</span>

        <span class="c1"># verifies and sets both pdos and energy</span>
        <span class="k">if</span> <span class="n">list_of_pdos</span><span class="p">:</span>
            <span class="n">list_of_pdos</span> <span class="o">=</span> <span class="n">single_to_list</span><span class="p">(</span><span class="n">list_of_pdos</span><span class="p">)</span>
            <span class="n">list_of_energy</span> <span class="o">=</span> <span class="n">single_to_list</span><span class="p">(</span><span class="n">list_of_energy</span><span class="p">)</span>
            <span class="n">array_list_checker</span><span class="p">(</span><span class="n">list_of_pdos</span><span class="p">,</span> <span class="s2">&quot;pdos&quot;</span><span class="p">,</span> <span class="n">orb_length</span><span class="p">)</span>
            <span class="n">array_list_checker</span><span class="p">(</span><span class="n">list_of_energy</span><span class="p">,</span> <span class="s2">&quot;energy&quot;</span><span class="p">,</span> <span class="n">orb_length</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">list_of_pdos</span><span class="p">)):</span>
                <span class="n">this_pdos</span> <span class="o">=</span> <span class="n">list_of_pdos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">this_energy</span> <span class="o">=</span> <span class="n">list_of_energy</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">array_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_from_index_to_arrayname</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">bands_check</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_check_projections_bands</span><span class="p">(</span><span class="n">this_projection</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_array</span><span class="p">(</span><span class="s2">&quot;pdos_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">array_name</span><span class="p">),</span> <span class="n">this_pdos</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_array</span><span class="p">(</span><span class="s2">&quot;energy_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">array_name</span><span class="p">),</span> <span class="n">this_energy</span><span class="p">)</span>

        <span class="c1"># verifies and sets the tags</span>
        <span class="k">if</span> <span class="n">tags</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_of_orbitals</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="n">exceptions</span><span class="o">.</span><span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;must set as many tags as projections&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">exceptions</span><span class="o">.</span><span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;tags must be a list&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">_</span><span class="p">,</span><span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">tags</span><span class="p">]):</span>
                <span class="k">raise</span> <span class="n">exceptions</span><span class="o">.</span><span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Tags must set a list of strings&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s1">&#39;tags&#39;</span><span class="p">,</span> <span class="n">tags</span><span class="p">)</span></div>

<div class="viewcode-block" id="ProjectionData.set_orbitals"><a class="viewcode-back" href="../../../../../../developer_guide/core/orm_overview.html#aiida.orm.ProjectionData.set_orbitals">[docs]</a>    <span class="k">def</span> <span class="nf">set_orbitals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method is inherited from OrbitalData, but is blocked here.</span>
<span class="sd">        If used will raise a NotImplementedError</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;You cannot set orbitals using this class!&quot;</span>
                                  <span class="s2">&quot; This class is for setting orbitals and &quot;</span>
                                  <span class="s2">&quot; projections only!&quot;</span><span class="p">)</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, ECOLE POLYTECHNIQUE FEDERALE DE LAUSANNE (Theory and Simulation of Materials (THEOS) and National Centre for Computational Design and Discovery of Novel Materials (NCCR MARVEL)), Switzerland and ROBERT BOSCH LLC, USA. All rights reserved

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>