

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>aiida.orm.utils.loaders &mdash; AiiDA 1.0.0b2 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../../_static/language_data.js"></script>
        <script type="text/javascript" src="../../../../_static/contentui.js"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/contentui.css" type="text/css" />
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../index.html" class="icon icon-home"> AiiDA
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Installation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../install/quick_installation.html">Quick installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../install/prerequisites.html">Prerequisites</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../install/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../install/updating_installation.html">Updating AiiDA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../install/troubleshooting.html">Troubleshooting</a></li>
</ul>
<p class="caption"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../get_started/index.html">First things first</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../get_started/daemon.html">Setup the daemon</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../get_started/computers.html">Setup a computer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../get_started/codes.html">Setup a code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../get_started/plugins.html">Plugins</a></li>
</ul>
<p class="caption"><span class="caption-text">Concepts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../concepts/provenance.html">Provenance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../concepts/processes.html">Processes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../concepts/calculations.html">Calculations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../concepts/workflows.html">Workflows</a></li>
</ul>
<p class="caption"><span class="caption-text">Working with</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../working/processes.html">Processes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working/functions.html">Calculation and work functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working/calculations.html">Calculations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working/workflows.html">Workflows</a></li>
</ul>
<p class="caption"><span class="caption-text">Working with AiiDA</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../working_with_aiida/index.html">Command line interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working_with_aiida/index.html#scripting">Scripting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working_with_aiida/index.html#data-types">Data types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working_with_aiida/index.html#groups">Groups</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working_with_aiida/index.html#schedulers">Schedulers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working_with_aiida/index.html#querying-data">Querying data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working_with_aiida/index.html#caching">Caching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working_with_aiida/index.html#result-manager">Result manager</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working_with_aiida/index.html#backups">Backups</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working_with_aiida/index.html#troubleshooting">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working_with_aiida/index.html#rest-api">REST API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working_with_aiida/index.html#cookbook">Cookbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../import_export/index.html">Import and Export</a></li>
</ul>
<p class="caption"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../developer_guide/index.html">AiiDA design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../developer_guide/index.html#aiida-core">AiiDA core</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../developer_guide/index.html#aiida-plugins">AiiDA plugins</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../tutorial/index.html">StructureData</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tutorial/index.html#pseudopotentials">Pseudopotentials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tutorial/index.html#plugin-development">Plugin development</a></li>
</ul>
<p class="caption"><span class="caption-text">API reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="`aiida package &lt;https://aiida-core.readthedocs.io/en/latest/apidoc/aiida.html&gt;`_">`aiida package &lt;https://aiida-core.readthedocs.io/en/latest/apidoc/aiida.html&gt;`_</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">AiiDA</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../../../aiida.html">aiida</a> &raquo;</li>
        
          <li><a href="../utils.html">aiida.orm.utils</a> &raquo;</li>
        
      <li>aiida.orm.utils.loaders</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for aiida.orm.utils.loaders</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1">###########################################################################</span>
<span class="c1"># Copyright (c), The AiiDA team. All rights reserved.                     #</span>
<span class="c1"># This file is part of the AiiDA code.                                    #</span>
<span class="c1">#                                                                         #</span>
<span class="c1"># The code is hosted on GitHub at https://github.com/aiidateam/aiida_core #</span>
<span class="c1"># For further information on the license, see the LICENSE.txt file        #</span>
<span class="c1"># For further information please visit http://www.aiida.net               #</span>
<span class="c1">###########################################################################</span>
<span class="sd">&quot;&quot;&quot;Module with `OrmEntityLoader` and its sub classes that simplify loading entities through their identifiers.&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">division</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">print_function</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">absolute_import</span>

<span class="kn">from</span> <span class="nn">abc</span> <span class="k">import</span> <span class="n">ABCMeta</span>
<span class="kn">from</span> <span class="nn">enum</span> <span class="k">import</span> <span class="n">Enum</span>

<span class="kn">import</span> <span class="nn">six</span>

<span class="kn">from</span> <span class="nn">aiida.common.exceptions</span> <span class="k">import</span> <span class="n">MultipleObjectsError</span><span class="p">,</span> <span class="n">NotExistent</span>
<span class="kn">from</span> <span class="nn">aiida.common.lang</span> <span class="k">import</span> <span class="n">abstractclassmethod</span><span class="p">,</span> <span class="n">classproperty</span>
<span class="kn">from</span> <span class="nn">aiida.orm.querybuilder</span> <span class="k">import</span> <span class="n">QueryBuilder</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;get_loader&#39;</span><span class="p">,</span> <span class="s1">&#39;OrmEntityLoader&#39;</span><span class="p">,</span> <span class="s1">&#39;CalculationEntityLoader&#39;</span><span class="p">,</span> <span class="s1">&#39;CodeEntityLoader&#39;</span><span class="p">,</span> <span class="s1">&#39;ComputerEntityLoader&#39;</span><span class="p">,</span>
           <span class="s1">&#39;GroupEntityLoader&#39;</span><span class="p">,</span> <span class="s1">&#39;NodeEntityLoader&#39;</span><span class="p">)</span>


<div class="viewcode-block" id="get_loader"><a class="viewcode-back" href="../../../../apidoc/aiida.orm.utils.html#aiida.orm.utils.loaders.get_loader">[docs]</a><span class="k">def</span> <span class="nf">get_loader</span><span class="p">(</span><span class="n">orm_class</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return the correct OrmEntityLoader for the given orm class.</span>

<span class="sd">    :param orm_class: the orm class</span>
<span class="sd">    :returns: a subclass of OrmEntityLoader</span>
<span class="sd">    :raises ValueError: if no OrmEntityLoader subclass can be found for the given orm class</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">aiida.orm</span> <span class="k">import</span> <span class="n">Code</span><span class="p">,</span> <span class="n">Computer</span><span class="p">,</span> <span class="n">Group</span><span class="p">,</span> <span class="n">Node</span>

    <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">orm_class</span><span class="p">,</span> <span class="n">Code</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">CodeEntityLoader</span>

    <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">orm_class</span><span class="p">,</span> <span class="n">Computer</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">ComputerEntityLoader</span>

    <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">orm_class</span><span class="p">,</span> <span class="n">Group</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">GroupEntityLoader</span>

    <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">orm_class</span><span class="p">,</span> <span class="n">Node</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">NodeEntityLoader</span>

    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;no OrmEntityLoader available for </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">orm_class</span><span class="p">))</span></div>


<span class="k">class</span> <span class="nc">IdentifierType</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The enumeration that defines the three types of identifier that can be used to identify an orm entity.</span>
<span class="sd">    The ID is always an integer, the UUID a base 16 encoded integer with optional dashes and the LABEL can</span>
<span class="sd">    be any string based label or name, the format of which will vary per orm class</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># pylint: disable=invalid-name</span>

    <span class="n">ID</span> <span class="o">=</span> <span class="s1">&#39;ID&#39;</span>
    <span class="n">UUID</span> <span class="o">=</span> <span class="s1">&#39;UUID&#39;</span>
    <span class="n">LABEL</span> <span class="o">=</span> <span class="s1">&#39;LABEL&#39;</span>


<div class="viewcode-block" id="OrmEntityLoader"><a class="viewcode-back" href="../../../../apidoc/aiida.orm.utils.html#aiida.orm.utils.loaders.OrmEntityLoader">[docs]</a><span class="nd">@six</span><span class="o">.</span><span class="n">add_metaclass</span><span class="p">(</span><span class="n">ABCMeta</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">OrmEntityLoader</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base class for entity loaders.&quot;&quot;&quot;</span>

    <span class="c1"># pylint: disable=useless-object-inheritance</span>

    <span class="n">label_ambiguity_breaker</span> <span class="o">=</span> <span class="s1">&#39;!&#39;</span>

    <span class="nd">@classproperty</span>
    <span class="k">def</span> <span class="nf">orm_base_class</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the orm base class to which loaded entities should be mapped. Actual queries to load an entity</span>
<span class="sd">        may further narrow the query set by defining a more specific set of orm classes, as long as each of</span>
<span class="sd">        those is a strict sub class of the orm base class.</span>

<span class="sd">        :returns: the orm base class</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

<div class="viewcode-block" id="OrmEntityLoader._get_query_builder_label_identifier"><a class="viewcode-back" href="../../../../apidoc/aiida.orm.utils.html#aiida.orm.utils.loaders.OrmEntityLoader._get_query_builder_label_identifier">[docs]</a>    <span class="nd">@abstractclassmethod</span>
    <span class="k">def</span> <span class="nf">_get_query_builder_label_identifier</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">identifier</span><span class="p">,</span> <span class="n">classes</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the query builder instance that attempts to map the identifier onto an entity of the orm class,</span>
<span class="sd">        defined for this loader class, interpreting the identifier as a LABEL like identifier</span>

<span class="sd">        :param identifier: the LABEL identifier</span>
<span class="sd">        :param classes: a tuple of orm classes to which the identifier should be mapped</span>
<span class="sd">        :returns: the query builder instance</span>
<span class="sd">        :raises ValueError: if the identifier is invalid</span>
<span class="sd">        :raises aiida.common.NotExistent: if the orm base class does not support a LABEL like identifier</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

<div class="viewcode-block" id="OrmEntityLoader._get_query_builder_id_identifier"><a class="viewcode-back" href="../../../../apidoc/aiida.orm.utils.html#aiida.orm.utils.loaders.OrmEntityLoader._get_query_builder_id_identifier">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_get_query_builder_id_identifier</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">identifier</span><span class="p">,</span> <span class="n">classes</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the query builder instance that attempts to map the identifier onto an entity of the orm class,</span>
<span class="sd">        defined for this loader class, interpreting the identifier as an ID like identifier</span>

<span class="sd">        :param identifier: the ID identifier</span>
<span class="sd">        :param classes: a tuple of orm classes to which the identifier should be mapped</span>
<span class="sd">        :returns: the query builder instance</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">builder</span> <span class="o">=</span> <span class="n">QueryBuilder</span><span class="p">()</span>
        <span class="n">builder</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">cls</span><span class="o">=</span><span class="n">classes</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;entity&#39;</span><span class="p">,</span> <span class="n">project</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">])</span>
        <span class="n">builder</span><span class="o">.</span><span class="n">add_filter</span><span class="p">(</span><span class="s1">&#39;entity&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">identifier</span><span class="p">})</span>

        <span class="k">return</span> <span class="n">builder</span></div>

<div class="viewcode-block" id="OrmEntityLoader._get_query_builder_uuid_identifier"><a class="viewcode-back" href="../../../../apidoc/aiida.orm.utils.html#aiida.orm.utils.loaders.OrmEntityLoader._get_query_builder_uuid_identifier">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_get_query_builder_uuid_identifier</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">identifier</span><span class="p">,</span> <span class="n">classes</span><span class="p">,</span> <span class="n">query_with_dashes</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the query builder instance that attempts to map the identifier onto an entity of the orm class,</span>
<span class="sd">        defined for this loader class, interpreting the identifier as a UUID like identifier</span>

<span class="sd">        :param identifier: the UUID identifier</span>
<span class="sd">        :param classes: a tuple of orm classes to which the identifier should be mapped</span>
<span class="sd">        :returns: the query builder instance</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">uuid</span> <span class="k">import</span> <span class="n">UUID</span>

        <span class="n">uuid</span> <span class="o">=</span> <span class="n">identifier</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">query_with_dashes</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">dash_pos</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">]:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">uuid</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">dash_pos</span><span class="p">:</span>
                    <span class="n">uuid</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">-</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">uuid</span><span class="p">[:</span><span class="n">dash_pos</span><span class="p">],</span> <span class="n">uuid</span><span class="p">[</span><span class="n">dash_pos</span><span class="p">:])</span>

        <span class="n">builder</span> <span class="o">=</span> <span class="n">QueryBuilder</span><span class="p">()</span>
        <span class="n">builder</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">cls</span><span class="o">=</span><span class="n">classes</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;entity&#39;</span><span class="p">,</span> <span class="n">project</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">])</span>

        <span class="c1"># If a UUID can be constructed from the identifier, it is a full UUID and the query can use an equality operator</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">UUID</span><span class="p">(</span><span class="n">uuid</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">builder</span><span class="o">.</span><span class="n">add_filter</span><span class="p">(</span><span class="s1">&#39;entity&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;uuid&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;like&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">%&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">uuid</span><span class="p">)}})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">builder</span><span class="o">.</span><span class="n">add_filter</span><span class="p">(</span><span class="s1">&#39;entity&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;uuid&#39;</span><span class="p">:</span> <span class="n">uuid</span><span class="p">})</span>

        <span class="k">return</span> <span class="n">builder</span></div>

<div class="viewcode-block" id="OrmEntityLoader.get_query_builder"><a class="viewcode-back" href="../../../../apidoc/aiida.orm.utils.html#aiida.orm.utils.loaders.OrmEntityLoader.get_query_builder">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_query_builder</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">identifier</span><span class="p">,</span> <span class="n">identifier_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sub_classes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">query_with_dashes</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the query builder instance that attempts to map the identifier onto an entity of the orm class,</span>
<span class="sd">        defined for this loader class, inferring the identifier type if it is not defined.</span>

<span class="sd">        :param identifier: the identifier</span>
<span class="sd">        :param identifier_type: the type of the identifier</span>
<span class="sd">        :param sub_classes: an optional tuple of orm classes, that should each be strict sub classes of the</span>
<span class="sd">            base orm class of the loader, that will narrow the queryset</span>
<span class="sd">        :returns: the query builder instance and a dictionary of used query parameters</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">classes</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_query_classes</span><span class="p">(</span><span class="n">sub_classes</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">identifier_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">identifier</span><span class="p">,</span> <span class="n">identifier_type</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">infer_identifier_type</span><span class="p">(</span><span class="n">identifier</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">identifier_type</span> <span class="o">==</span> <span class="n">IdentifierType</span><span class="o">.</span><span class="n">ID</span><span class="p">:</span>
            <span class="n">builder</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_get_query_builder_id_identifier</span><span class="p">(</span><span class="n">identifier</span><span class="p">,</span> <span class="n">classes</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">identifier_type</span> <span class="o">==</span> <span class="n">IdentifierType</span><span class="o">.</span><span class="n">UUID</span><span class="p">:</span>
            <span class="n">builder</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_get_query_builder_uuid_identifier</span><span class="p">(</span><span class="n">identifier</span><span class="p">,</span> <span class="n">classes</span><span class="p">,</span> <span class="n">query_with_dashes</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">identifier_type</span> <span class="o">==</span> <span class="n">IdentifierType</span><span class="o">.</span><span class="n">LABEL</span><span class="p">:</span>
            <span class="n">builder</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_get_query_builder_label_identifier</span><span class="p">(</span><span class="n">identifier</span><span class="p">,</span> <span class="n">classes</span><span class="p">)</span>

        <span class="n">query_parameters</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;classes&#39;</span><span class="p">:</span> <span class="n">classes</span><span class="p">,</span>
            <span class="s1">&#39;identifier&#39;</span><span class="p">:</span> <span class="n">identifier</span><span class="p">,</span>
            <span class="s1">&#39;identifier_type&#39;</span><span class="p">:</span> <span class="n">identifier_type</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">builder</span><span class="p">,</span> <span class="n">query_parameters</span></div>

<div class="viewcode-block" id="OrmEntityLoader.load_entity"><a class="viewcode-back" href="../../../../apidoc/aiida.orm.utils.html#aiida.orm.utils.loaders.OrmEntityLoader.load_entity">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">load_entity</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">identifier</span><span class="p">,</span> <span class="n">identifier_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sub_classes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">query_with_dashes</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load an entity that uniquely corresponds to the provided identifier of the identifier type.</span>

<span class="sd">        :param identifier: the identifier</span>
<span class="sd">        :param identifier_type: the type of the identifier</span>
<span class="sd">        :param sub_classes: an optional tuple of orm classes, that should each be strict sub classes of the</span>
<span class="sd">            base orm class of the loader, that will narrow the queryset</span>
<span class="sd">        :returns: the loaded entity</span>
<span class="sd">        :raises aiida.common.MultipleObjectsError: if the identifier maps onto multiple entities</span>
<span class="sd">        :raises aiida.common.NotExistent: if the identifier maps onto not a single entity</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">builder</span><span class="p">,</span> <span class="n">query_parameters</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_query_builder</span><span class="p">(</span><span class="n">identifier</span><span class="p">,</span> <span class="n">identifier_type</span><span class="p">,</span> <span class="n">sub_classes</span><span class="p">,</span> <span class="n">query_with_dashes</span><span class="p">)</span>
        <span class="n">builder</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

        <span class="n">classes</span> <span class="o">=</span> <span class="s1">&#39; or &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">sub_class</span><span class="o">.</span><span class="vm">__name__</span> <span class="k">for</span> <span class="n">sub_class</span> <span class="ow">in</span> <span class="n">query_parameters</span><span class="p">[</span><span class="s1">&#39;classes&#39;</span><span class="p">]])</span>
        <span class="n">identifier</span> <span class="o">=</span> <span class="n">query_parameters</span><span class="p">[</span><span class="s1">&#39;identifier&#39;</span><span class="p">]</span>
        <span class="n">identifier_type</span> <span class="o">=</span> <span class="n">query_parameters</span><span class="p">[</span><span class="s1">&#39;identifier_type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">entity</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">one</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">except</span> <span class="n">MultipleObjectsError</span><span class="p">:</span>
            <span class="n">error</span> <span class="o">=</span> <span class="s1">&#39;multiple </span><span class="si">{}</span><span class="s1"> entries found with </span><span class="si">{}</span><span class="s1">&lt;</span><span class="si">{}</span><span class="s1">&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">classes</span><span class="p">,</span> <span class="n">identifier_type</span><span class="p">,</span> <span class="n">identifier</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">MultipleObjectsError</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">NotExistent</span> <span class="k">as</span> <span class="n">exception</span><span class="p">:</span>
            <span class="n">error</span> <span class="o">=</span> <span class="s1">&#39;no </span><span class="si">{}</span><span class="s1"> found with </span><span class="si">{}</span><span class="s1">&lt;</span><span class="si">{}</span><span class="s1">&gt;: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">classes</span><span class="p">,</span> <span class="n">identifier_type</span><span class="p">,</span> <span class="n">identifier</span><span class="p">,</span> <span class="n">exception</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">NotExistent</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">entity</span></div>

<div class="viewcode-block" id="OrmEntityLoader.get_query_classes"><a class="viewcode-back" href="../../../../apidoc/aiida.orm.utils.html#aiida.orm.utils.loaders.OrmEntityLoader.get_query_classes">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_query_classes</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">sub_classes</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the tuple of classes to be used for the entity query. If sub_classes is defined, each class will be</span>
<span class="sd">        validated by verifying that it is a sub class of the loader&#39;s orm base class.</span>
<span class="sd">        Validate a tuple of classes if a user passes in a specific one when attempting to load an entity. Each class</span>
<span class="sd">        should be a sub class of the entity loader&#39;s orm base class</span>

<span class="sd">        :param sub_classes: an optional tuple of orm classes, that should each be strict sub classes of the</span>
<span class="sd">            base orm class of the loader, that will narrow the queryset</span>
<span class="sd">        :returns: the tuple of orm classes to be used for the entity query</span>
<span class="sd">        :raises ValueError: if any of the classes are not a sub class of the entity loader&#39;s orm base class</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">sub_classes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">orm_base_class</span><span class="p">,)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sub_classes</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;sub_classes should be a tuple: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sub_classes</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">sub_class</span> <span class="ow">in</span> <span class="n">sub_classes</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">sub_class</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">orm_base_class</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> is not a sub class of the base orm class </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sub_class</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">orm_base_class</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">sub_classes</span></div>

<div class="viewcode-block" id="OrmEntityLoader.infer_identifier_type"><a class="viewcode-back" href="../../../../apidoc/aiida.orm.utils.html#aiida.orm.utils.loaders.OrmEntityLoader.infer_identifier_type">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">infer_identifier_type</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method will attempt to automatically distinguish which identifier type is implied for the given value, if</span>
<span class="sd">        the value itself has no type from which it can be inferred.</span>

<span class="sd">        The strategy is to first attempt to convert the value to an integer. If successful, it is assumed that the value</span>
<span class="sd">        represents an ID. If that fails, we attempt to interpret the value as a base 16 encoded integer, after having</span>
<span class="sd">        removed any dashes from the string. If that succeeds, it is most likely a UUID. If it seems to be neither an ID</span>
<span class="sd">        nor a UUID, it is assumed to be a LABEL like identifier.</span>

<span class="sd">        With this approach there is the possibility for ambiguity. Since it is allowed to pass a partial UUID, it is</span>
<span class="sd">        possible that the partial UUID is also a valid ID. Likewise, a LABEL identifier might also be a valid ID, or a</span>
<span class="sd">        valid (partial) UUID. Fortunately, these ambiguities can be solved though:</span>

<span class="sd">         * ID/UUID: can always be solved by passing a partial UUID with at least one dash</span>
<span class="sd">         * ID/LABEL: appending an exclamation point ! to the identifier, will force LABEL interpretation</span>
<span class="sd">         * UUID/LABEL: appending an exclamation point ! to the identifier, will force LABEL interpretation</span>

<span class="sd">        As one can see, the user will always be able to include at least one dash of the UUID identifier to prevent it</span>
<span class="sd">        from being interpreted as an ID. For the potential ambiguities in LABEL identifiers, we had to introduce a</span>
<span class="sd">        special marker to provide a surefire way of breaking any ambiguity that may arise. Adding an exclamation point</span>
<span class="sd">        will break the normal strategy and the identifier will directly be interpreted as a LABEL identifier.</span>

<span class="sd">        :param value: the value of the identifier</span>
<span class="sd">        :returns: the identifier and identifier type</span>
<span class="sd">        :raises ValueError: if the value is an invalid identifier</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">value</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;the value for the identifier cannot be empty&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

        <span class="c1"># If the final character of the value is the special marker, we enforce LABEL interpretation</span>
        <span class="k">if</span> <span class="n">value</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="bp">cls</span><span class="o">.</span><span class="n">label_ambiguity_breaker</span><span class="p">:</span>

            <span class="n">identifier</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">label_ambiguity_breaker</span><span class="p">)</span>
            <span class="n">identifier_type</span> <span class="o">=</span> <span class="n">IdentifierType</span><span class="o">.</span><span class="n">LABEL</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="c1"># If the value can be cast into an integer, interpret it as an ID</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">identifier</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="n">identifier_type</span> <span class="o">=</span> <span class="n">IdentifierType</span><span class="o">.</span><span class="n">ID</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>

                <span class="c1"># If the value is a valid base sixteen encoded integer, after dashes are removed, interpret it as a UUID</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span> <span class="mi">16</span><span class="p">)</span>
                    <span class="n">identifier</span> <span class="o">=</span> <span class="n">value</span>
                    <span class="n">identifier_type</span> <span class="o">=</span> <span class="n">IdentifierType</span><span class="o">.</span><span class="n">UUID</span>

                <span class="c1"># If that fails, interpret it as a LABEL</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="n">identifier</span> <span class="o">=</span> <span class="n">value</span>
                    <span class="n">identifier_type</span> <span class="o">=</span> <span class="n">IdentifierType</span><span class="o">.</span><span class="n">LABEL</span>

        <span class="k">return</span> <span class="n">identifier</span><span class="p">,</span> <span class="n">identifier_type</span></div></div>


<span class="k">class</span> <span class="nc">ProcessEntityLoader</span><span class="p">(</span><span class="n">OrmEntityLoader</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Loader for the `Process` entity and sub classes.&quot;&quot;&quot;</span>

    <span class="nd">@classproperty</span>
    <span class="k">def</span> <span class="nf">orm_base_class</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the orm base class to which loaded entities should be mapped. Actual queries to load an entity</span>
<span class="sd">        may further narrow the query set by defining a more specific set of orm classes, as long as each of</span>
<span class="sd">        those is a strict sub class of the orm base class.</span>

<span class="sd">        :returns: the orm base class</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">aiida.orm</span> <span class="k">import</span> <span class="n">ProcessNode</span>
        <span class="k">return</span> <span class="n">ProcessNode</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_get_query_builder_label_identifier</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">identifier</span><span class="p">,</span> <span class="n">classes</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the query builder instance that attempts to map the identifier onto an entity of the orm class,</span>
<span class="sd">        defined for this loader class, interpreting the identifier as a LABEL like identifier</span>

<span class="sd">        :param identifier: the LABEL identifier</span>
<span class="sd">        :param classes: a tuple of orm classes to which the identifier should be mapped</span>
<span class="sd">        :returns: the query builder instance that should retrieve the entity corresponding to the identifier</span>
<span class="sd">        :raises ValueError: if the identifier is invalid</span>
<span class="sd">        :raises aiida.common.NotExistent: if the orm base class does not support a LABEL like identifier</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">builder</span> <span class="o">=</span> <span class="n">QueryBuilder</span><span class="p">()</span>
        <span class="n">builder</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">cls</span><span class="o">=</span><span class="n">classes</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;process&#39;</span><span class="p">,</span> <span class="n">project</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">],</span> <span class="n">filters</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;==&#39;</span><span class="p">:</span> <span class="n">identifier</span><span class="p">}})</span>

        <span class="k">return</span> <span class="n">builder</span>


<div class="viewcode-block" id="CalculationEntityLoader"><a class="viewcode-back" href="../../../../apidoc/aiida.orm.utils.html#aiida.orm.utils.loaders.CalculationEntityLoader">[docs]</a><span class="k">class</span> <span class="nc">CalculationEntityLoader</span><span class="p">(</span><span class="n">OrmEntityLoader</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Loader for the `Calculation` entity and sub classes.&quot;&quot;&quot;</span>

    <span class="nd">@classproperty</span>
    <span class="k">def</span> <span class="nf">orm_base_class</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the orm base class to which loaded entities should be mapped. Actual queries to load an entity</span>
<span class="sd">        may further narrow the query set by defining a more specific set of orm classes, as long as each of</span>
<span class="sd">        those is a strict sub class of the orm base class.</span>

<span class="sd">        :returns: the orm base class</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">aiida.orm</span> <span class="k">import</span> <span class="n">CalculationNode</span>
        <span class="k">return</span> <span class="n">CalculationNode</span>

<div class="viewcode-block" id="CalculationEntityLoader._get_query_builder_label_identifier"><a class="viewcode-back" href="../../../../apidoc/aiida.orm.utils.html#aiida.orm.utils.loaders.CalculationEntityLoader._get_query_builder_label_identifier">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_get_query_builder_label_identifier</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">identifier</span><span class="p">,</span> <span class="n">classes</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the query builder instance that attempts to map the identifier onto an entity of the orm class,</span>
<span class="sd">        defined for this loader class, interpreting the identifier as a LABEL like identifier</span>

<span class="sd">        :param identifier: the LABEL identifier</span>
<span class="sd">        :param classes: a tuple of orm classes to which the identifier should be mapped</span>
<span class="sd">        :returns: the query builder instance that should retrieve the entity corresponding to the identifier</span>
<span class="sd">        :raises ValueError: if the identifier is invalid</span>
<span class="sd">        :raises aiida.common.NotExistent: if the orm base class does not support a LABEL like identifier</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">builder</span> <span class="o">=</span> <span class="n">QueryBuilder</span><span class="p">()</span>
        <span class="n">builder</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">cls</span><span class="o">=</span><span class="n">classes</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;calculation&#39;</span><span class="p">,</span> <span class="n">project</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">],</span> <span class="n">filters</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;==&#39;</span><span class="p">:</span> <span class="n">identifier</span><span class="p">}})</span>

        <span class="k">return</span> <span class="n">builder</span></div></div>


<span class="k">class</span> <span class="nc">WorkflowEntityLoader</span><span class="p">(</span><span class="n">OrmEntityLoader</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Loader for the `Workflow` entity and sub classes.&quot;&quot;&quot;</span>

    <span class="nd">@classproperty</span>
    <span class="k">def</span> <span class="nf">orm_base_class</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the orm base class to which loaded entities should be mapped. Actual queries to load an entity</span>
<span class="sd">        may further narrow the query set by defining a more specific set of orm classes, as long as each of</span>
<span class="sd">        those is a strict sub class of the orm base class.</span>

<span class="sd">        :returns: the orm base class</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">aiida.orm</span> <span class="k">import</span> <span class="n">WorkflowNode</span>
        <span class="k">return</span> <span class="n">WorkflowNode</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_get_query_builder_label_identifier</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">identifier</span><span class="p">,</span> <span class="n">classes</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the query builder instance that attempts to map the identifier onto an entity of the orm class,</span>
<span class="sd">        defined for this loader class, interpreting the identifier as a LABEL like identifier</span>

<span class="sd">        :param identifier: the LABEL identifier</span>
<span class="sd">        :param classes: a tuple of orm classes to which the identifier should be mapped</span>
<span class="sd">        :returns: the query builder instance that should retrieve the entity corresponding to the identifier</span>
<span class="sd">        :raises ValueError: if the identifier is invalid</span>
<span class="sd">        :raises aiida.common.NotExistent: if the orm base class does not support a LABEL like identifier</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">builder</span> <span class="o">=</span> <span class="n">QueryBuilder</span><span class="p">()</span>
        <span class="n">builder</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">cls</span><span class="o">=</span><span class="n">classes</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;workflow&#39;</span><span class="p">,</span> <span class="n">project</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">],</span> <span class="n">filters</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;==&#39;</span><span class="p">:</span> <span class="n">identifier</span><span class="p">}})</span>

        <span class="k">return</span> <span class="n">builder</span>


<div class="viewcode-block" id="CodeEntityLoader"><a class="viewcode-back" href="../../../../apidoc/aiida.orm.utils.html#aiida.orm.utils.loaders.CodeEntityLoader">[docs]</a><span class="k">class</span> <span class="nc">CodeEntityLoader</span><span class="p">(</span><span class="n">OrmEntityLoader</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Loader for the `Code` entity and sub classes.&quot;&quot;&quot;</span>

    <span class="nd">@classproperty</span>
    <span class="k">def</span> <span class="nf">orm_base_class</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the orm base class to which loaded entities should be mapped. Actual queries to load an entity</span>
<span class="sd">        may further narrow the query set by defining a more specific set of orm classes, as long as each of</span>
<span class="sd">        those is a strict sub class of the orm base class.</span>

<span class="sd">        :returns: the orm base class</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">aiida.orm</span> <span class="k">import</span> <span class="n">Code</span>
        <span class="k">return</span> <span class="n">Code</span>

<div class="viewcode-block" id="CodeEntityLoader._get_query_builder_label_identifier"><a class="viewcode-back" href="../../../../apidoc/aiida.orm.utils.html#aiida.orm.utils.loaders.CodeEntityLoader._get_query_builder_label_identifier">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_get_query_builder_label_identifier</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">identifier</span><span class="p">,</span> <span class="n">classes</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the query builder instance that attempts to map the identifier onto an entity of the orm class,</span>
<span class="sd">        defined for this loader class, interpreting the identifier as a LABEL like identifier</span>

<span class="sd">        :param identifier: the LABEL identifier</span>
<span class="sd">        :param classes: a tuple of orm classes to which the identifier should be mapped</span>
<span class="sd">        :returns: the query builder instance that should retrieve the entity corresponding to the identifier</span>
<span class="sd">        :raises ValueError: if the identifier is invalid</span>
<span class="sd">        :raises aiida.common.NotExistent: if the orm base class does not support a LABEL like identifier</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">aiida.orm</span> <span class="k">import</span> <span class="n">Computer</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">label</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">machinename</span> <span class="o">=</span> <span class="n">identifier</span><span class="o">.</span><span class="n">partition</span><span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;the identifier needs to be a string&#39;</span><span class="p">)</span>

        <span class="n">builder</span> <span class="o">=</span> <span class="n">QueryBuilder</span><span class="p">()</span>
        <span class="n">builder</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">cls</span><span class="o">=</span><span class="n">classes</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;code&#39;</span><span class="p">,</span> <span class="n">project</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">],</span> <span class="n">filters</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;==&#39;</span><span class="p">:</span> <span class="n">label</span><span class="p">}})</span>

        <span class="k">if</span> <span class="n">machinename</span><span class="p">:</span>
            <span class="n">builder</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Computer</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;==&#39;</span><span class="p">:</span> <span class="n">machinename</span><span class="p">}},</span> <span class="n">with_node</span><span class="o">=</span><span class="s1">&#39;code&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">builder</span></div></div>


<div class="viewcode-block" id="ComputerEntityLoader"><a class="viewcode-back" href="../../../../apidoc/aiida.orm.utils.html#aiida.orm.utils.loaders.ComputerEntityLoader">[docs]</a><span class="k">class</span> <span class="nc">ComputerEntityLoader</span><span class="p">(</span><span class="n">OrmEntityLoader</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Loader for the `Computer` entity and sub classes.&quot;&quot;&quot;</span>

    <span class="nd">@classproperty</span>
    <span class="k">def</span> <span class="nf">orm_base_class</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the orm base class to which loaded entities should be mapped. Actual queries to load an entity</span>
<span class="sd">        may further narrow the query set by defining a more specific set of orm classes, as long as each of</span>
<span class="sd">        those is a strict sub class of the orm base class.</span>

<span class="sd">        :returns: the orm base class</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">aiida.orm</span> <span class="k">import</span> <span class="n">Computer</span>
        <span class="k">return</span> <span class="n">Computer</span>

<div class="viewcode-block" id="ComputerEntityLoader._get_query_builder_label_identifier"><a class="viewcode-back" href="../../../../apidoc/aiida.orm.utils.html#aiida.orm.utils.loaders.ComputerEntityLoader._get_query_builder_label_identifier">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_get_query_builder_label_identifier</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">identifier</span><span class="p">,</span> <span class="n">classes</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the query builder instance that attempts to map the identifier onto an entity of the orm class,</span>
<span class="sd">        defined for this loader class, interpreting the identifier as a LABEL like identifier</span>

<span class="sd">        :param identifier: the LABEL identifier</span>
<span class="sd">        :param classes: a tuple of orm classes to which the identifier should be mapped</span>
<span class="sd">        :returns: the query builder instance that should retrieve the entity corresponding to the identifier</span>
<span class="sd">        :raises ValueError: if the identifier is invalid</span>
<span class="sd">        :raises aiida.common.NotExistent: if the orm base class does not support a LABEL like identifier</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">builder</span> <span class="o">=</span> <span class="n">QueryBuilder</span><span class="p">()</span>
        <span class="n">builder</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">cls</span><span class="o">=</span><span class="n">classes</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;computer&#39;</span><span class="p">,</span> <span class="n">project</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">],</span> <span class="n">filters</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;==&#39;</span><span class="p">:</span> <span class="n">identifier</span><span class="p">}})</span>

        <span class="k">return</span> <span class="n">builder</span></div></div>


<span class="k">class</span> <span class="nc">DataEntityLoader</span><span class="p">(</span><span class="n">OrmEntityLoader</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Loader for the `Data` entity and sub classes.&quot;&quot;&quot;</span>

    <span class="nd">@classproperty</span>
    <span class="k">def</span> <span class="nf">orm_base_class</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the orm base class to which loaded entities should be mapped. Actual queries to load an entity</span>
<span class="sd">        may further narrow the query set by defining a more specific set of orm classes, as long as each of</span>
<span class="sd">        those is a strict sub class of the orm base class.</span>

<span class="sd">        :returns: the orm base class</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">aiida.orm</span> <span class="k">import</span> <span class="n">Data</span>
        <span class="k">return</span> <span class="n">Data</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_get_query_builder_label_identifier</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">identifier</span><span class="p">,</span> <span class="n">classes</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the query builder instance that attempts to map the identifier onto an entity of the orm class,</span>
<span class="sd">        defined for this loader class, interpreting the identifier as a LABEL like identifier</span>

<span class="sd">        :param identifier: the LABEL identifier</span>
<span class="sd">        :param classes: a tuple of orm classes to which the identifier should be mapped</span>
<span class="sd">        :returns: the query builder instance that should retrieve the entity corresponding to the identifier</span>
<span class="sd">        :raises ValueError: if the identifier is invalid</span>
<span class="sd">        :raises aiida.common.NotExistent: if the orm base class does not support a LABEL like identifier</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">builder</span> <span class="o">=</span> <span class="n">QueryBuilder</span><span class="p">()</span>
        <span class="n">builder</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">cls</span><span class="o">=</span><span class="n">classes</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;calculation&#39;</span><span class="p">,</span> <span class="n">project</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">],</span> <span class="n">filters</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;==&#39;</span><span class="p">:</span> <span class="n">identifier</span><span class="p">}})</span>

        <span class="k">return</span> <span class="n">builder</span>


<div class="viewcode-block" id="GroupEntityLoader"><a class="viewcode-back" href="../../../../apidoc/aiida.orm.utils.html#aiida.orm.utils.loaders.GroupEntityLoader">[docs]</a><span class="k">class</span> <span class="nc">GroupEntityLoader</span><span class="p">(</span><span class="n">OrmEntityLoader</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Loader for the `Group` entity and sub classes.&quot;&quot;&quot;</span>

    <span class="nd">@classproperty</span>
    <span class="k">def</span> <span class="nf">orm_base_class</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the orm base class to which loaded entities should be mapped. Actual queries to load an entity</span>
<span class="sd">        may further narrow the query set by defining a more specific set of orm classes, as long as each of</span>
<span class="sd">        those is a strict sub class of the orm base class.</span>

<span class="sd">        :returns: the orm base class</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">aiida.orm.groups</span> <span class="k">import</span> <span class="n">Group</span>
        <span class="k">return</span> <span class="n">Group</span>

<div class="viewcode-block" id="GroupEntityLoader._get_query_builder_label_identifier"><a class="viewcode-back" href="../../../../apidoc/aiida.orm.utils.html#aiida.orm.utils.loaders.GroupEntityLoader._get_query_builder_label_identifier">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_get_query_builder_label_identifier</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">identifier</span><span class="p">,</span> <span class="n">classes</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the query builder instance that attempts to map the identifier onto an entity of the orm class,</span>
<span class="sd">        defined for this loader class, interpreting the identifier as a LABEL like identifier</span>

<span class="sd">        :param identifier: the LABEL identifier</span>
<span class="sd">        :param classes: a tuple of orm classes to which the identifier should be mapped</span>
<span class="sd">        :returns: the query builder instance that should retrieve the entity corresponding to the identifier</span>
<span class="sd">        :raises ValueError: if the identifier is invalid</span>
<span class="sd">        :raises aiida.common.NotExistent: if the orm base class does not support a LABEL like identifier</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">builder</span> <span class="o">=</span> <span class="n">QueryBuilder</span><span class="p">()</span>
        <span class="n">builder</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">cls</span><span class="o">=</span><span class="n">classes</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;group&#39;</span><span class="p">,</span> <span class="n">project</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">],</span> <span class="n">filters</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;==&#39;</span><span class="p">:</span> <span class="n">identifier</span><span class="p">}})</span>

        <span class="k">return</span> <span class="n">builder</span></div></div>


<div class="viewcode-block" id="NodeEntityLoader"><a class="viewcode-back" href="../../../../apidoc/aiida.orm.utils.html#aiida.orm.utils.loaders.NodeEntityLoader">[docs]</a><span class="k">class</span> <span class="nc">NodeEntityLoader</span><span class="p">(</span><span class="n">OrmEntityLoader</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Loader for the `Node` entity and sub classes.&quot;&quot;&quot;</span>

    <span class="nd">@classproperty</span>
    <span class="k">def</span> <span class="nf">orm_base_class</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the orm base class to which loaded entities should be mapped. Actual queries to load an entity</span>
<span class="sd">        may further narrow the query set by defining a more specific set of orm classes, as long as each of</span>
<span class="sd">        those is a strict sub class of the orm base class.</span>

<span class="sd">        :returns: the orm base class</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">aiida.orm</span> <span class="k">import</span> <span class="n">Node</span>
        <span class="k">return</span> <span class="n">Node</span>

<div class="viewcode-block" id="NodeEntityLoader._get_query_builder_label_identifier"><a class="viewcode-back" href="../../../../apidoc/aiida.orm.utils.html#aiida.orm.utils.loaders.NodeEntityLoader._get_query_builder_label_identifier">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_get_query_builder_label_identifier</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">identifier</span><span class="p">,</span> <span class="n">classes</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the query builder instance that attempts to map the identifier onto an entity of the orm class,</span>
<span class="sd">        defined for this loader class, interpreting the identifier as a LABEL like identifier</span>

<span class="sd">        :param identifier: the LABEL identifier</span>
<span class="sd">        :param classes: a tuple of orm classes to which the identifier should be mapped</span>
<span class="sd">        :returns: the query builder instance that should retrieve the entity corresponding to the identifier</span>
<span class="sd">        :raises ValueError: if the identifier is invalid</span>
<span class="sd">        :raises aiida.common.NotExistent: if the orm base class does not support a LABEL like identifier</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">builder</span> <span class="o">=</span> <span class="n">QueryBuilder</span><span class="p">()</span>
        <span class="n">builder</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">cls</span><span class="o">=</span><span class="n">classes</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;node&#39;</span><span class="p">,</span> <span class="n">project</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">],</span> <span class="n">filters</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;==&#39;</span><span class="p">:</span> <span class="n">identifier</span><span class="p">}})</span>

        <span class="k">return</span> <span class="n">builder</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, ECOLE POLYTECHNIQUE FEDERALE DE LAUSANNE (Theory and Simulation of Materials (THEOS) and National Centre for Computational Design and Discovery of Novel Materials (NCCR MARVEL)), Switzerland and ROBERT BOSCH LLC, USA. All rights reserved

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>