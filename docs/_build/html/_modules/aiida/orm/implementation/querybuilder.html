

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>aiida.orm.implementation.querybuilder &mdash; AiiDA 1.0.0b2 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../../_static/language_data.js"></script>
        <script type="text/javascript" src="../../../../_static/contentui.js"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/contentui.css" type="text/css" />
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../index.html" class="icon icon-home"> AiiDA
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Installation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../install/quick_installation.html">Quick installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../install/prerequisites.html">Prerequisites</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../install/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../install/updating_installation.html">Updating AiiDA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../install/troubleshooting.html">Troubleshooting</a></li>
</ul>
<p class="caption"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../get_started/index.html">First things first</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../get_started/daemon.html">Setup the daemon</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../get_started/computers.html">Setup a computer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../get_started/codes.html">Setup a code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../get_started/plugins.html">Plugins</a></li>
</ul>
<p class="caption"><span class="caption-text">Concepts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../concepts/provenance.html">Provenance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../concepts/processes.html">Processes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../concepts/calculations.html">Calculations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../concepts/workflows.html">Workflows</a></li>
</ul>
<p class="caption"><span class="caption-text">Working with</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../working/processes.html">Processes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working/functions.html">Calculation and work functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working/calculations.html">Calculations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working/workflows.html">Workflows</a></li>
</ul>
<p class="caption"><span class="caption-text">Working with AiiDA</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../working_with_aiida/index.html">Command line interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working_with_aiida/index.html#scripting">Scripting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working_with_aiida/index.html#data-types">Data types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working_with_aiida/index.html#groups">Groups</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working_with_aiida/index.html#schedulers">Schedulers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working_with_aiida/index.html#querying-data">Querying data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working_with_aiida/index.html#caching">Caching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working_with_aiida/index.html#result-manager">Result manager</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working_with_aiida/index.html#backups">Backups</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working_with_aiida/index.html#troubleshooting">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working_with_aiida/index.html#rest-api">REST API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working_with_aiida/index.html#cookbook">Cookbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../import_export/index.html">Import and Export</a></li>
</ul>
<p class="caption"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../developer_guide/index.html">AiiDA design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../developer_guide/index.html#aiida-core">AiiDA core</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../developer_guide/index.html#aiida-plugins">AiiDA plugins</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../tutorial/index.html">StructureData</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tutorial/index.html#pseudopotentials">Pseudopotentials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tutorial/index.html#plugin-development">Plugin development</a></li>
</ul>
<p class="caption"><span class="caption-text">API reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="`aiida package &lt;https://aiida-core.readthedocs.io/en/latest/apidoc/aiida.html&gt;`_">`aiida package &lt;https://aiida-core.readthedocs.io/en/latest/apidoc/aiida.html&gt;`_</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">AiiDA</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../../../aiida.html">aiida</a> &raquo;</li>
        
      <li>aiida.orm.implementation.querybuilder</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for aiida.orm.implementation.querybuilder</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1">###########################################################################</span>
<span class="c1"># Copyright (c), The AiiDA team. All rights reserved.                     #</span>
<span class="c1"># This file is part of the AiiDA code.                                    #</span>
<span class="c1">#                                                                         #</span>
<span class="c1"># The code is hosted on GitHub at https://github.com/aiidateam/aiida_core #</span>
<span class="c1"># For further information on the license, see the LICENSE.txt file        #</span>
<span class="c1"># For further information please visit http://www.aiida.net               #</span>
<span class="c1">###########################################################################</span>
<span class="sd">&quot;&quot;&quot;Backend query implementation classes&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">division</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">print_function</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">absolute_import</span>
<span class="kn">import</span> <span class="nn">abc</span>
<span class="kn">import</span> <span class="nn">six</span>

<span class="kn">from</span> <span class="nn">aiida.common</span> <span class="k">import</span> <span class="n">exceptions</span>
<span class="kn">from</span> <span class="nn">aiida.common.lang</span> <span class="k">import</span> <span class="n">abstractclassmethod</span><span class="p">,</span> <span class="n">type_check</span>
<span class="kn">from</span> <span class="nn">aiida.common.exceptions</span> <span class="k">import</span> <span class="n">InputValidationError</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;BackendQueryBuilder&#39;</span><span class="p">,)</span>


<div class="viewcode-block" id="BackendQueryBuilder"><a class="viewcode-back" href="../../../../apidoc/aiida.orm.implementation.html#aiida.orm.implementation.BackendQueryBuilder">[docs]</a><span class="nd">@six</span><span class="o">.</span><span class="n">add_metaclass</span><span class="p">(</span><span class="n">abc</span><span class="o">.</span><span class="n">ABCMeta</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">BackendQueryBuilder</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Backend query builder interface&quot;&quot;&quot;</span>

    <span class="c1"># pylint: disable=invalid-name,too-many-public-methods,useless-object-inheritance</span>

<div class="viewcode-block" id="BackendQueryBuilder.__init__"><a class="viewcode-back" href="../../../../apidoc/aiida.orm.implementation.html#aiida.orm.implementation.BackendQueryBuilder.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">backend</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param backend: the backend</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">backends</span>
        <span class="n">type_check</span><span class="p">(</span><span class="n">backend</span><span class="p">,</span> <span class="n">backends</span><span class="o">.</span><span class="n">Backend</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_backend</span> <span class="o">=</span> <span class="n">backend</span></div>

<div class="viewcode-block" id="BackendQueryBuilder.Node"><a class="viewcode-back" href="../../../../apidoc/aiida.orm.implementation.html#aiida.orm.implementation.BackendQueryBuilder.Node">[docs]</a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">Node</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Decorated as a property, returns the implementation for DbNode.</span>
<span class="sd">        It needs to return a subclass of sqlalchemy.Base, which means that for different ORM&#39;s</span>
<span class="sd">        a corresponding dummy-model  must be written.</span>
<span class="sd">        &quot;&quot;&quot;</span></div>

<div class="viewcode-block" id="BackendQueryBuilder.Link"><a class="viewcode-back" href="../../../../apidoc/aiida.orm.implementation.html#aiida.orm.implementation.BackendQueryBuilder.Link">[docs]</a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">Link</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A property, decorated with @property. Returns the implementation for the DbLink</span>
<span class="sd">        &quot;&quot;&quot;</span></div>

<div class="viewcode-block" id="BackendQueryBuilder.Computer"><a class="viewcode-back" href="../../../../apidoc/aiida.orm.implementation.html#aiida.orm.implementation.BackendQueryBuilder.Computer">[docs]</a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">Computer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A property, decorated with @property. Returns the implementation for the Computer</span>
<span class="sd">        &quot;&quot;&quot;</span></div>

<div class="viewcode-block" id="BackendQueryBuilder.User"><a class="viewcode-back" href="../../../../apidoc/aiida.orm.implementation.html#aiida.orm.implementation.BackendQueryBuilder.User">[docs]</a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">User</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A property, decorated with @property. Returns the implementation for the User</span>
<span class="sd">        &quot;&quot;&quot;</span></div>

<div class="viewcode-block" id="BackendQueryBuilder.Group"><a class="viewcode-back" href="../../../../apidoc/aiida.orm.implementation.html#aiida.orm.implementation.BackendQueryBuilder.Group">[docs]</a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">Group</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A property, decorated with @property. Returns the implementation for the Group</span>
<span class="sd">        &quot;&quot;&quot;</span></div>

<div class="viewcode-block" id="BackendQueryBuilder.AuthInfo"><a class="viewcode-back" href="../../../../apidoc/aiida.orm.implementation.html#aiida.orm.implementation.BackendQueryBuilder.AuthInfo">[docs]</a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">AuthInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A property, decorated with @property. Returns the implementation for the Group</span>
<span class="sd">        &quot;&quot;&quot;</span></div>

<div class="viewcode-block" id="BackendQueryBuilder.Comment"><a class="viewcode-back" href="../../../../apidoc/aiida.orm.implementation.html#aiida.orm.implementation.BackendQueryBuilder.Comment">[docs]</a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">Comment</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A property, decorated with @property. Returns the implementation for the Comment</span>
<span class="sd">        &quot;&quot;&quot;</span></div>

<div class="viewcode-block" id="BackendQueryBuilder.Log"><a class="viewcode-back" href="../../../../apidoc/aiida.orm.implementation.html#aiida.orm.implementation.BackendQueryBuilder.Log">[docs]</a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">Log</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A property, decorated with @property. Returns the implementation for the Log</span>
<span class="sd">        &quot;&quot;&quot;</span></div>

<div class="viewcode-block" id="BackendQueryBuilder.table_groups_nodes"><a class="viewcode-back" href="../../../../apidoc/aiida.orm.implementation.html#aiida.orm.implementation.BackendQueryBuilder.table_groups_nodes">[docs]</a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">table_groups_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A property, decorated with @property. Returns the implementation for the many-to-many</span>
<span class="sd">        relationship between group and nodes.</span>
<span class="sd">        &quot;&quot;&quot;</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">AiidaNode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A property, decorated with @property. Returns the implementation for the AiiDA-class for Node</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">aiida.orm</span> <span class="k">import</span> <span class="n">Node</span>
        <span class="k">return</span> <span class="n">Node</span>

<div class="viewcode-block" id="BackendQueryBuilder.get_session"><a class="viewcode-back" href="../../../../apidoc/aiida.orm.implementation.html#aiida.orm.implementation.BackendQueryBuilder.get_session">[docs]</a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">get_session</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :returns: a valid session, an instance of sqlalchemy.orm.session.Session</span>
<span class="sd">        &quot;&quot;&quot;</span></div>

<div class="viewcode-block" id="BackendQueryBuilder.modify_expansions"><a class="viewcode-back" href="../../../../apidoc/aiida.orm.implementation.html#aiida.orm.implementation.BackendQueryBuilder.modify_expansions">[docs]</a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">modify_expansions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alias</span><span class="p">,</span> <span class="n">expansions</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Modify names of projections if ** was specified.</span>
<span class="sd">        This is important for the schema having attributes in a different table.</span>
<span class="sd">        &quot;&quot;&quot;</span></div>

<div class="viewcode-block" id="BackendQueryBuilder.get_filter_expr_from_attributes"><a class="viewcode-back" href="../../../../apidoc/aiida.orm.implementation.html#aiida.orm.implementation.BackendQueryBuilder.get_filter_expr_from_attributes">[docs]</a>    <span class="nd">@abstractclassmethod</span>
    <span class="k">def</span> <span class="nf">get_filter_expr_from_attributes</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">operator</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">attr_key</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">column_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">alias</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>  <span class="c1"># pylint: disable=too-many-arguments</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns an valid SQLAlchemy expression.</span>

<span class="sd">        :param operator: The operator provided by the user (&#39;==&#39;,  &#39;&gt;&#39;, ...)</span>
<span class="sd">        :param value: The value to compare with, e.g. (5.0, &#39;foo&#39;, [&#39;a&#39;,&#39;b&#39;])</span>
<span class="sd">        :param str attr_key:</span>
<span class="sd">            The path to that attribute as a tuple of values.</span>
<span class="sd">            I.e. if that attribute I want to filter by is the 2nd element in a list stored under the</span>
<span class="sd">            key &#39;mylist&#39;, this is (&#39;mylist&#39;, &#39;2&#39;).</span>
<span class="sd">        :param column: Optional, an instance of sqlalchemy.orm.attributes.InstrumentedAttribute or</span>
<span class="sd">        :param str column_name: The name of the column, and the backend should get the InstrumentedAttribute.</span>
<span class="sd">        :param alias: The aliased class.</span>

<span class="sd">        :returns: An instance of sqlalchemy.sql.elements.BinaryExpression</span>
<span class="sd">        &quot;&quot;&quot;</span></div>

<div class="viewcode-block" id="BackendQueryBuilder.get_filter_expr_from_column"><a class="viewcode-back" href="../../../../apidoc/aiida.orm.implementation.html#aiida.orm.implementation.BackendQueryBuilder.get_filter_expr_from_column">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_filter_expr_from_column</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">operator</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">column</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A method that returns an valid SQLAlchemy expression.</span>

<span class="sd">        :param operator: The operator provided by the user (&#39;==&#39;,  &#39;&gt;&#39;, ...)</span>
<span class="sd">        :param value: The value to compare with, e.g. (5.0, &#39;foo&#39;, [&#39;a&#39;,&#39;b&#39;])</span>
<span class="sd">        :param column: an instance of sqlalchemy.orm.attributes.InstrumentedAttribute or</span>

<span class="sd">        :returns: An instance of sqlalchemy.sql.elements.BinaryExpression</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Label is used because it is what is returned for the</span>
        <span class="c1"># &#39;state&#39; column by the hybrid_column construct</span>

        <span class="c1"># Remove when https://github.com/PyCQA/pylint/issues/1931 is fixed</span>
        <span class="c1"># pylint: disable=no-name-in-module,import-error</span>
        <span class="kn">from</span> <span class="nn">sqlalchemy.sql.elements</span> <span class="k">import</span> <span class="n">Cast</span><span class="p">,</span> <span class="n">Label</span>
        <span class="kn">from</span> <span class="nn">sqlalchemy.orm.attributes</span> <span class="k">import</span> <span class="n">InstrumentedAttribute</span><span class="p">,</span> <span class="n">QueryableAttribute</span>
        <span class="kn">from</span> <span class="nn">sqlalchemy.sql.expression</span> <span class="k">import</span> <span class="n">ColumnClause</span>
        <span class="kn">from</span> <span class="nn">sqlalchemy.types</span> <span class="k">import</span> <span class="n">String</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="p">(</span><span class="n">Cast</span><span class="p">,</span> <span class="n">InstrumentedAttribute</span><span class="p">,</span> <span class="n">QueryableAttribute</span><span class="p">,</span> <span class="n">Label</span><span class="p">,</span> <span class="n">ColumnClause</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;column (</span><span class="si">{}</span><span class="s1">) </span><span class="si">{}</span><span class="s1"> is not a valid column&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">column</span><span class="p">),</span> <span class="n">column</span><span class="p">))</span>
        <span class="n">database_entity</span> <span class="o">=</span> <span class="n">column</span>
        <span class="k">if</span> <span class="n">operator</span> <span class="o">==</span> <span class="s1">&#39;==&#39;</span><span class="p">:</span>
            <span class="n">expr</span> <span class="o">=</span> <span class="n">database_entity</span> <span class="o">==</span> <span class="n">value</span>
        <span class="k">elif</span> <span class="n">operator</span> <span class="o">==</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">:</span>
            <span class="n">expr</span> <span class="o">=</span> <span class="n">database_entity</span> <span class="o">&gt;</span> <span class="n">value</span>
        <span class="k">elif</span> <span class="n">operator</span> <span class="o">==</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">:</span>
            <span class="n">expr</span> <span class="o">=</span> <span class="n">database_entity</span> <span class="o">&lt;</span> <span class="n">value</span>
        <span class="k">elif</span> <span class="n">operator</span> <span class="o">==</span> <span class="s1">&#39;&gt;=&#39;</span><span class="p">:</span>
            <span class="n">expr</span> <span class="o">=</span> <span class="n">database_entity</span> <span class="o">&gt;=</span> <span class="n">value</span>
        <span class="k">elif</span> <span class="n">operator</span> <span class="o">==</span> <span class="s1">&#39;&lt;=&#39;</span><span class="p">:</span>
            <span class="n">expr</span> <span class="o">=</span> <span class="n">database_entity</span> <span class="o">&lt;=</span> <span class="n">value</span>
        <span class="k">elif</span> <span class="n">operator</span> <span class="o">==</span> <span class="s1">&#39;like&#39;</span><span class="p">:</span>
            <span class="c1"># the like operator expects a string, so we cast to avoid problems</span>
            <span class="c1"># with fields like UUID, which don&#39;t support the like operator</span>
            <span class="n">expr</span> <span class="o">=</span> <span class="n">database_entity</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">String</span><span class="p">)</span><span class="o">.</span><span class="n">like</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">operator</span> <span class="o">==</span> <span class="s1">&#39;ilike&#39;</span><span class="p">:</span>
            <span class="n">expr</span> <span class="o">=</span> <span class="n">database_entity</span><span class="o">.</span><span class="n">ilike</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">operator</span> <span class="o">==</span> <span class="s1">&#39;in&#39;</span><span class="p">:</span>
            <span class="n">expr</span> <span class="o">=</span> <span class="n">database_entity</span><span class="o">.</span><span class="n">in_</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InputValidationError</span><span class="p">(</span><span class="s1">&#39;Unknown operator </span><span class="si">{}</span><span class="s1"> for filters on columns&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">operator</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">expr</span></div>

<div class="viewcode-block" id="BackendQueryBuilder.get_projectable_attribute"><a class="viewcode-back" href="../../../../apidoc/aiida.orm.implementation.html#aiida.orm.implementation.BackendQueryBuilder.get_projectable_attribute">[docs]</a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">get_projectable_attribute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alias</span><span class="p">,</span> <span class="n">column_name</span><span class="p">,</span> <span class="n">attrpath</span><span class="p">,</span> <span class="n">cast</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="BackendQueryBuilder.get_aiida_res"><a class="viewcode-back" href="../../../../apidoc/aiida.orm.implementation.html#aiida.orm.implementation.BackendQueryBuilder.get_aiida_res">[docs]</a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">get_aiida_res</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">res</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Some instance returned by ORM (django or SA) need to be converted</span>
<span class="sd">        to Aiida instances (eg nodes)</span>

<span class="sd">        :param key: the key that this entry would be returned with</span>
<span class="sd">        :param res: the result returned by the query</span>

<span class="sd">        :returns: an aiida-compatible instance</span>
<span class="sd">        &quot;&quot;&quot;</span></div>

<div class="viewcode-block" id="BackendQueryBuilder.yield_per"><a class="viewcode-back" href="../../../../apidoc/aiida.orm.implementation.html#aiida.orm.implementation.BackendQueryBuilder.yield_per">[docs]</a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">yield_per</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param int batch_size: Number of rows to yield per step</span>

<span class="sd">        Yields *count* rows at a time</span>

<span class="sd">        :returns: a generator</span>
<span class="sd">        &quot;&quot;&quot;</span></div>

<div class="viewcode-block" id="BackendQueryBuilder.count"><a class="viewcode-back" href="../../../../apidoc/aiida.orm.implementation.html#aiida.orm.implementation.BackendQueryBuilder.count">[docs]</a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :returns: the number of results</span>
<span class="sd">        &quot;&quot;&quot;</span></div>

<div class="viewcode-block" id="BackendQueryBuilder.first"><a class="viewcode-back" href="../../../../apidoc/aiida.orm.implementation.html#aiida.orm.implementation.BackendQueryBuilder.first">[docs]</a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">first</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Executes query in the backend asking for one instance.</span>

<span class="sd">        :returns: One row of aiida results</span>
<span class="sd">        &quot;&quot;&quot;</span></div>

<div class="viewcode-block" id="BackendQueryBuilder.iterall"><a class="viewcode-back" href="../../../../apidoc/aiida.orm.implementation.html#aiida.orm.implementation.BackendQueryBuilder.iterall">[docs]</a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">iterall</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">,</span> <span class="n">tag_to_index_dict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: An iterator over all the results of a list of lists.</span>
<span class="sd">        &quot;&quot;&quot;</span></div>

<div class="viewcode-block" id="BackendQueryBuilder.iterdict"><a class="viewcode-back" href="../../../../apidoc/aiida.orm.implementation.html#aiida.orm.implementation.BackendQueryBuilder.iterdict">[docs]</a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">iterdict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">,</span> <span class="n">tag_to_projected_entity_dict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :returns: An iterator over all the results of a list of dictionaries.</span>
<span class="sd">        &quot;&quot;&quot;</span></div>

<div class="viewcode-block" id="BackendQueryBuilder.get_column"><a class="viewcode-back" href="../../../../apidoc/aiida.orm.implementation.html#aiida.orm.implementation.BackendQueryBuilder.get_column">[docs]</a>    <span class="k">def</span> <span class="nf">get_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">colname</span><span class="p">,</span> <span class="n">alias</span><span class="p">):</span>  <span class="c1"># pylint: disable=no-self-use</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the column for a given projection.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">alias</span><span class="p">,</span> <span class="n">colname</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">exceptions</span><span class="o">.</span><span class="n">InputValidationError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> is not a column of </span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span>
                                                  <span class="s2">&quot;Valid columns are:</span><span class="se">\n</span><span class="s2">&quot;</span>
                                                  <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                                      <span class="n">colname</span><span class="p">,</span>
                                                      <span class="n">alias</span><span class="p">,</span>
                                                      <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">alias</span><span class="o">.</span><span class="n">_sa_class_manager</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>  <span class="c1"># pylint: disable=protected-access</span>
                                                  <span class="p">))</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, ECOLE POLYTECHNIQUE FEDERALE DE LAUSANNE (Theory and Simulation of Materials (THEOS) and National Centre for Computational Design and Discovery of Novel Materials (NCCR MARVEL)), Switzerland and ROBERT BOSCH LLC, USA. All rights reserved

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>