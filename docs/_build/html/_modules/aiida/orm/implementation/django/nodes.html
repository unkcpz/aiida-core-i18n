

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>aiida.orm.implementation.django.nodes &mdash; AiiDA 1.0.0b2 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../../" src="../../../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../../../_static/language_data.js"></script>
        <script type="text/javascript" src="../../../../../_static/contentui.js"></script>
    
    <script type="text/javascript" src="../../../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/contentui.css" type="text/css" />
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../../index.html" class="icon icon-home"> AiiDA
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Installation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../install/quick_installation.html">Quick installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../install/prerequisites.html">Prerequisites</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../install/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../install/updating_installation.html">Updating AiiDA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../install/troubleshooting.html">Troubleshooting</a></li>
</ul>
<p class="caption"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../get_started/index.html">First things first</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../get_started/daemon.html">Setup the daemon</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../get_started/computers.html">Setup a computer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../get_started/codes.html">Setup a code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../get_started/plugins.html">Plugins</a></li>
</ul>
<p class="caption"><span class="caption-text">Concepts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../concepts/provenance.html">Provenance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../concepts/processes.html">Processes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../concepts/calculations.html">Calculations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../concepts/workflows.html">Workflows</a></li>
</ul>
<p class="caption"><span class="caption-text">Working with</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../working/processes.html">Processes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../working/functions.html">Calculation and work functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../working/calculations.html">Calculations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../working/workflows.html">Workflows</a></li>
</ul>
<p class="caption"><span class="caption-text">Working with AiiDA</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../working_with_aiida/index.html">Command line interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../working_with_aiida/index.html#scripting">Scripting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../working_with_aiida/index.html#data-types">Data types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../working_with_aiida/index.html#groups">Groups</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../working_with_aiida/index.html#schedulers">Schedulers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../working_with_aiida/index.html#querying-data">Querying data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../working_with_aiida/index.html#caching">Caching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../working_with_aiida/index.html#result-manager">Result manager</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../working_with_aiida/index.html#backups">Backups</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../working_with_aiida/index.html#troubleshooting">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../working_with_aiida/index.html#rest-api">REST API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../working_with_aiida/index.html#cookbook">Cookbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../import_export/index.html">Import and Export</a></li>
</ul>
<p class="caption"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../developer_guide/index.html">AiiDA design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../developer_guide/index.html#aiida-core">AiiDA core</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../developer_guide/index.html#aiida-plugins">AiiDA plugins</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../tutorial/index.html">StructureData</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../tutorial/index.html#pseudopotentials">Pseudopotentials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../tutorial/index.html#plugin-development">Plugin development</a></li>
</ul>
<p class="caption"><span class="caption-text">API reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="`aiida package &lt;https://aiida-core.readthedocs.io/en/latest/apidoc/aiida.html&gt;`_">`aiida package &lt;https://aiida-core.readthedocs.io/en/latest/apidoc/aiida.html&gt;`_</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../index.html">AiiDA</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../../../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../../../../aiida.html">aiida</a> &raquo;</li>
        
      <li>aiida.orm.implementation.django.nodes</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for aiida.orm.implementation.django.nodes</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1">###########################################################################</span>
<span class="c1"># Copyright (c), The AiiDA team. All rights reserved.                     #</span>
<span class="c1"># This file is part of the AiiDA code.                                    #</span>
<span class="c1">#                                                                         #</span>
<span class="c1"># The code is hosted on GitHub at https://github.com/aiidateam/aiida_core #</span>
<span class="c1"># For further information on the license, see the LICENSE.txt file        #</span>
<span class="c1"># For further information please visit http://www.aiida.net               #</span>
<span class="c1">###########################################################################</span>
<span class="sd">&quot;&quot;&quot;Django implementation of the `BackendNode` and `BackendNodeCollection` classes.&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">division</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">print_function</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">absolute_import</span>

<span class="c1"># pylint: disable=import-error,no-name-in-module</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="k">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">django.core.exceptions</span> <span class="k">import</span> <span class="n">ObjectDoesNotExist</span>
<span class="kn">from</span> <span class="nn">django.db</span> <span class="k">import</span> <span class="n">transaction</span><span class="p">,</span> <span class="n">IntegrityError</span>

<span class="kn">from</span> <span class="nn">aiida.backends.djsite.db</span> <span class="k">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">aiida.common</span> <span class="k">import</span> <span class="n">exceptions</span>
<span class="kn">from</span> <span class="nn">aiida.common.lang</span> <span class="k">import</span> <span class="n">type_check</span>

<span class="kn">from</span> <span class="nn">..</span> <span class="k">import</span> <span class="n">BackendNode</span><span class="p">,</span> <span class="n">BackendNodeCollection</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">entities</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">utils</span>
<span class="kn">from</span> <span class="nn">.computers</span> <span class="k">import</span> <span class="n">DjangoComputer</span>
<span class="kn">from</span> <span class="nn">.users</span> <span class="k">import</span> <span class="n">DjangoUser</span>


<div class="viewcode-block" id="DjangoNode"><a class="viewcode-back" href="../../../../../apidoc/aiida.orm.implementation.django.html#aiida.orm.implementation.django.nodes.DjangoNode">[docs]</a><span class="k">class</span> <span class="nc">DjangoNode</span><span class="p">(</span><span class="n">entities</span><span class="o">.</span><span class="n">DjangoModelEntity</span><span class="p">[</span><span class="n">models</span><span class="o">.</span><span class="n">DbNode</span><span class="p">],</span> <span class="n">BackendNode</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Django Node backend entity&quot;&quot;&quot;</span>

    <span class="c1"># pylint: disable=too-many-public-methods</span>

    <span class="n">MODEL_CLASS</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DbNode</span>
    <span class="n">ATTRIBUTE_CLASS</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DbAttribute</span>
    <span class="n">EXTRA_CLASS</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DbExtra</span>
    <span class="n">LINK_CLASS</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DbLink</span>

<div class="viewcode-block" id="DjangoNode.__init__"><a class="viewcode-back" href="../../../../../apidoc/aiida.orm.implementation.django.html#aiida.orm.implementation.django.nodes.DjangoNode.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">backend</span><span class="p">,</span>
                 <span class="n">node_type</span><span class="p">,</span>
                 <span class="n">user</span><span class="p">,</span>
                 <span class="n">computer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">process_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">label</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                 <span class="n">description</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                 <span class="n">ctime</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">mtime</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Construct a new `BackendNode` instance wrapping a new `DbNode` instance.</span>

<span class="sd">        :param backend: the backend</span>
<span class="sd">        :param node_type: the node type string</span>
<span class="sd">        :param user: associated `BackendUser`</span>
<span class="sd">        :param computer: associated `BackendComputer`</span>
<span class="sd">        :param label: string label</span>
<span class="sd">        :param description: string description</span>
<span class="sd">        :param ctime: The creation time as datetime object</span>
<span class="sd">        :param mtime: The modification time as datetime object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># pylint: disable=too-many-arguments</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">DjangoNode</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">backend</span><span class="p">)</span>

        <span class="n">arguments</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;user&#39;</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">dbmodel</span><span class="p">,</span>
            <span class="s1">&#39;node_type&#39;</span><span class="p">:</span> <span class="n">node_type</span><span class="p">,</span>
            <span class="s1">&#39;process_type&#39;</span><span class="p">:</span> <span class="n">process_type</span><span class="p">,</span>
            <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="n">label</span><span class="p">,</span>
            <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="n">description</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">type_check</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">DjangoUser</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">computer</span><span class="p">:</span>
            <span class="n">type_check</span><span class="p">(</span><span class="n">computer</span><span class="p">,</span> <span class="n">DjangoComputer</span><span class="p">,</span> <span class="s1">&#39;computer is of type </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">computer</span><span class="p">)))</span>
            <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;dbcomputer&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">computer</span><span class="o">.</span><span class="n">dbmodel</span>

        <span class="k">if</span> <span class="n">ctime</span><span class="p">:</span>
            <span class="n">type_check</span><span class="p">(</span><span class="n">ctime</span><span class="p">,</span> <span class="n">datetime</span><span class="p">,</span> <span class="s1">&#39;the given ctime is of type </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">ctime</span><span class="p">)))</span>
            <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;ctime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ctime</span>

        <span class="k">if</span> <span class="n">mtime</span><span class="p">:</span>
            <span class="n">type_check</span><span class="p">(</span><span class="n">mtime</span><span class="p">,</span> <span class="n">datetime</span><span class="p">,</span> <span class="s1">&#39;the given mtime is of type </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">mtime</span><span class="p">)))</span>
            <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;mtime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mtime</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_dbmodel</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">ModelWrapper</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">DbNode</span><span class="p">(</span><span class="o">**</span><span class="n">arguments</span><span class="p">))</span></div>

<div class="viewcode-block" id="DjangoNode.clone"><a class="viewcode-back" href="../../../../../apidoc/aiida.orm.implementation.django.html#aiida.orm.implementation.django.nodes.DjangoNode.clone">[docs]</a>    <span class="k">def</span> <span class="nf">clone</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return an unstored clone of ourselves.</span>

<span class="sd">        :return: an unstored `BackendNode` with the exact same attributes and extras as self</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">arguments</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;node_type&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbmodel</span><span class="o">.</span><span class="n">node_type</span><span class="p">,</span>
            <span class="s1">&#39;process_type&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbmodel</span><span class="o">.</span><span class="n">process_type</span><span class="p">,</span>
            <span class="s1">&#39;user&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbmodel</span><span class="o">.</span><span class="n">user</span><span class="p">,</span>
            <span class="s1">&#39;dbcomputer&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbmodel</span><span class="o">.</span><span class="n">dbcomputer</span><span class="p">,</span>
            <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbmodel</span><span class="o">.</span><span class="n">label</span><span class="p">,</span>
            <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbmodel</span><span class="o">.</span><span class="n">description</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">clone</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span>  <span class="c1"># pylint: disable=no-value-for-parameter</span>
        <span class="n">clone</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>
        <span class="n">clone</span><span class="o">.</span><span class="n">_dbmodel</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">ModelWrapper</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">DbNode</span><span class="p">(</span><span class="o">**</span><span class="n">arguments</span><span class="p">))</span>  <span class="c1"># pylint: disable=protected-access</span>
        <span class="k">return</span> <span class="n">clone</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">computer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the computer of this node.</span>

<span class="sd">        :return: the computer or None</span>
<span class="sd">        :rtype: `BackendComputer` or None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">computers</span><span class="o">.</span><span class="n">from_dbmodel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dbmodel</span><span class="o">.</span><span class="n">dbcomputer</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@computer</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">computer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">computer</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the computer of this node.</span>

<span class="sd">        :param computer: a `BackendComputer`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">type_check</span><span class="p">(</span><span class="n">computer</span><span class="p">,</span> <span class="n">DjangoComputer</span><span class="p">,</span> <span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">computer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">computer</span> <span class="o">=</span> <span class="n">computer</span><span class="o">.</span><span class="n">dbmodel</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_dbmodel</span><span class="o">.</span><span class="n">dbcomputer</span> <span class="o">=</span> <span class="n">computer</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">user</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the user of this node.</span>

<span class="sd">        :return: the user</span>
<span class="sd">        :rtype: `BackendUser`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">from_dbmodel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dbmodel</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>

    <span class="nd">@user</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the user of this node.</span>

<span class="sd">        :param user: a `BackendUser`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">type_check</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">DjangoUser</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dbmodel</span><span class="o">.</span><span class="n">user</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">dbmodel</span>

<div class="viewcode-block" id="DjangoNode.get_attribute"><a class="viewcode-back" href="../../../../../apidoc/aiida.orm.implementation.django.html#aiida.orm.implementation.django.nodes.DjangoNode.get_attribute">[docs]</a>    <span class="k">def</span> <span class="nf">get_attribute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return an attribute.</span>

<span class="sd">        :param key: name of the attribute</span>
<span class="sd">        :return: the value of the attribute</span>
<span class="sd">        :raises AttributeError: if the attribute does not exist</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ATTRIBUTE_CLASS</span><span class="o">.</span><span class="n">get_value_for_node</span><span class="p">(</span><span class="n">dbnode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dbmodel</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;Attribute `</span><span class="si">{}</span><span class="s1">` does not exist&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">))</span></div>

<div class="viewcode-block" id="DjangoNode.get_attributes"><a class="viewcode-back" href="../../../../../apidoc/aiida.orm.implementation.django.html#aiida.orm.implementation.django.nodes.DjangoNode.get_attributes">[docs]</a>    <span class="k">def</span> <span class="nf">get_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keys</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a set of attributes.</span>

<span class="sd">        :param keys: names of the attributes</span>
<span class="sd">        :return: the values of the attributes</span>
<span class="sd">        :raises AttributeError: if at least one attribute does not exist</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

<div class="viewcode-block" id="DjangoNode.set_attribute"><a class="viewcode-back" href="../../../../../apidoc/aiida.orm.implementation.django.html#aiida.orm.implementation.django.nodes.DjangoNode.set_attribute">[docs]</a>    <span class="k">def</span> <span class="nf">set_attribute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set an attribute to the given value.</span>

<span class="sd">        :param key: name of the attribute</span>
<span class="sd">        :param value: value of the attribute</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ATTRIBUTE_CLASS</span><span class="o">.</span><span class="n">set_value_for_node</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dbmodel</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_increment_version_number</span><span class="p">()</span></div>

<div class="viewcode-block" id="DjangoNode.set_attributes"><a class="viewcode-back" href="../../../../../apidoc/aiida.orm.implementation.django.html#aiida.orm.implementation.django.nodes.DjangoNode.set_attributes">[docs]</a>    <span class="k">def</span> <span class="nf">set_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attributes</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set attributes.</span>

<span class="sd">        .. note:: This will override any existing attributes that are present in the new dictionary.</span>

<span class="sd">        :param attributes: the new attributes to set</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">attributes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ATTRIBUTE_CLASS</span><span class="o">.</span><span class="n">set_value_for_node</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dbmodel</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_increment_version_number</span><span class="p">()</span></div>

<div class="viewcode-block" id="DjangoNode.reset_attributes"><a class="viewcode-back" href="../../../../../apidoc/aiida.orm.implementation.django.html#aiida.orm.implementation.django.nodes.DjangoNode.reset_attributes">[docs]</a>    <span class="k">def</span> <span class="nf">reset_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attributes</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reset the attributes.</span>

<span class="sd">        .. note:: This will completely reset any existing attributes and replace them with the new dictionary.</span>

<span class="sd">        :param attributes: the new attributes to set</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ATTRIBUTE_CLASS</span><span class="o">.</span><span class="n">reset_values_for_node</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dbmodel</span><span class="p">,</span> <span class="n">attributes</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_increment_version_number</span><span class="p">()</span></div>

<div class="viewcode-block" id="DjangoNode.delete_attribute"><a class="viewcode-back" href="../../../../../apidoc/aiida.orm.implementation.django.html#aiida.orm.implementation.django.nodes.DjangoNode.delete_attribute">[docs]</a>    <span class="k">def</span> <span class="nf">delete_attribute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Delete an attribute.</span>

<span class="sd">        :param key: name of the attribute</span>
<span class="sd">        :raises AttributeError: if the attribute does not exist</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ATTRIBUTE_CLASS</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dbmodel</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;Attribute `</span><span class="si">{}</span><span class="s1">` does not exist&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ATTRIBUTE_CLASS</span><span class="o">.</span><span class="n">del_value_for_node</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dbmodel</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span></div>

<div class="viewcode-block" id="DjangoNode.delete_attributes"><a class="viewcode-back" href="../../../../../apidoc/aiida.orm.implementation.django.html#aiida.orm.implementation.django.nodes.DjangoNode.delete_attributes">[docs]</a>    <span class="k">def</span> <span class="nf">delete_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keys</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Delete multiple attributes.</span>

<span class="sd">        .. note:: The implementation should guarantee that all the keys that are to be deleted actually exist or the</span>
<span class="sd">            entire operation should be canceled without any change and an ``AttributeError`` should be raised.</span>

<span class="sd">        :param keys: names of the attributes to delete</span>
<span class="sd">        :raises AttributeError: if at least on of the attribute does not exist</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

<div class="viewcode-block" id="DjangoNode.clear_attributes"><a class="viewcode-back" href="../../../../../apidoc/aiida.orm.implementation.django.html#aiida.orm.implementation.django.nodes.DjangoNode.clear_attributes">[docs]</a>    <span class="k">def</span> <span class="nf">clear_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Delete all attributes.&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

<div class="viewcode-block" id="DjangoNode.attributes_items"><a class="viewcode-back" href="../../../../../apidoc/aiida.orm.implementation.django.html#aiida.orm.implementation.django.nodes.DjangoNode.attributes_items">[docs]</a>    <span class="k">def</span> <span class="nf">attributes_items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return an iterator over the attribute items.</span>

<span class="sd">        :return: an iterator with attribute key value pairs</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbmodel</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">yield</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span></div>

<div class="viewcode-block" id="DjangoNode.attributes_keys"><a class="viewcode-back" href="../../../../../apidoc/aiida.orm.implementation.django.html#aiida.orm.implementation.django.nodes.DjangoNode.attributes_keys">[docs]</a>    <span class="k">def</span> <span class="nf">attributes_keys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return an iterator over the attribute keys.</span>

<span class="sd">        :return: an iterator with attribute keys</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbmodel</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">yield</span> <span class="n">key</span></div>

<div class="viewcode-block" id="DjangoNode.get_extra"><a class="viewcode-back" href="../../../../../apidoc/aiida.orm.implementation.django.html#aiida.orm.implementation.django.nodes.DjangoNode.get_extra">[docs]</a>    <span class="k">def</span> <span class="nf">get_extra</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return an extra.</span>

<span class="sd">        :param key: name of the extra</span>
<span class="sd">        :return: the value of the extra</span>
<span class="sd">        :raises AttributeError: if the extra does not exist</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">EXTRA_CLASS</span><span class="o">.</span><span class="n">get_value_for_node</span><span class="p">(</span><span class="n">dbnode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dbmodel</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;Extra `</span><span class="si">{}</span><span class="s1">` does not exist&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">))</span></div>

<div class="viewcode-block" id="DjangoNode.get_extras"><a class="viewcode-back" href="../../../../../apidoc/aiida.orm.implementation.django.html#aiida.orm.implementation.django.nodes.DjangoNode.get_extras">[docs]</a>    <span class="k">def</span> <span class="nf">get_extras</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keys</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a set of extras.</span>

<span class="sd">        :param keys: names of the extras</span>
<span class="sd">        :return: the values of the extras</span>
<span class="sd">        :raises AttributeError: if at least one extra does not exist</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

<div class="viewcode-block" id="DjangoNode.set_extra"><a class="viewcode-back" href="../../../../../apidoc/aiida.orm.implementation.django.html#aiida.orm.implementation.django.nodes.DjangoNode.set_extra">[docs]</a>    <span class="k">def</span> <span class="nf">set_extra</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">increase_version</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set an extra to the given value.</span>

<span class="sd">        :param key: name of the extra</span>
<span class="sd">        :param value: value of the extra</span>
<span class="sd">        :param increase_version: boolean, if True will increase the node version upon successfully setting the extra</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EXTRA_CLASS</span><span class="o">.</span><span class="n">set_value_for_node</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dbmodel</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">increase_version</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_increment_version_number</span><span class="p">()</span></div>

<div class="viewcode-block" id="DjangoNode.set_extras"><a class="viewcode-back" href="../../../../../apidoc/aiida.orm.implementation.django.html#aiida.orm.implementation.django.nodes.DjangoNode.set_extras">[docs]</a>    <span class="k">def</span> <span class="nf">set_extras</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extras</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set extras.</span>

<span class="sd">        .. note:: This will override any existing extras that are present in the new dictionary.</span>

<span class="sd">        :param extras: the new extras to set</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">extras</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">EXTRA_CLASS</span><span class="o">.</span><span class="n">set_value_for_node</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dbmodel</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_increment_version_number</span><span class="p">()</span></div>

<div class="viewcode-block" id="DjangoNode.reset_extras"><a class="viewcode-back" href="../../../../../apidoc/aiida.orm.implementation.django.html#aiida.orm.implementation.django.nodes.DjangoNode.reset_extras">[docs]</a>    <span class="k">def</span> <span class="nf">reset_extras</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extras</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reset the extras.</span>

<span class="sd">        .. note:: This will completely reset any existing extras and replace them with the new dictionary.</span>

<span class="sd">        :param extras: the new extras to set</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

<div class="viewcode-block" id="DjangoNode.delete_extra"><a class="viewcode-back" href="../../../../../apidoc/aiida.orm.implementation.django.html#aiida.orm.implementation.django.nodes.DjangoNode.delete_extra">[docs]</a>    <span class="k">def</span> <span class="nf">delete_extra</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Delete an extra.</span>

<span class="sd">        :param key: name of the extra</span>
<span class="sd">        :raises AttributeError: if the extra does not exist</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">EXTRA_CLASS</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dbmodel</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;Extra `</span><span class="si">{}</span><span class="s1">` does not exist&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">EXTRA_CLASS</span><span class="o">.</span><span class="n">del_value_for_node</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dbmodel</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span></div>

<div class="viewcode-block" id="DjangoNode.delete_extras"><a class="viewcode-back" href="../../../../../apidoc/aiida.orm.implementation.django.html#aiida.orm.implementation.django.nodes.DjangoNode.delete_extras">[docs]</a>    <span class="k">def</span> <span class="nf">delete_extras</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keys</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Delete multiple extras.</span>

<span class="sd">        .. note:: The implementation should guarantee that all the keys that are to be deleted actually exist or the</span>
<span class="sd">            entire operation should be canceled without any change and an ``AttributeError`` should be raised.</span>

<span class="sd">        :param keys: names of the extras to delete</span>
<span class="sd">        :raises AttributeError: if at least on of the extra does not exist</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

<div class="viewcode-block" id="DjangoNode.clear_extras"><a class="viewcode-back" href="../../../../../apidoc/aiida.orm.implementation.django.html#aiida.orm.implementation.django.nodes.DjangoNode.clear_extras">[docs]</a>    <span class="k">def</span> <span class="nf">clear_extras</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Delete all extras.&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

<div class="viewcode-block" id="DjangoNode.extras_items"><a class="viewcode-back" href="../../../../../apidoc/aiida.orm.implementation.django.html#aiida.orm.implementation.django.nodes.DjangoNode.extras_items">[docs]</a>    <span class="k">def</span> <span class="nf">extras_items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return an iterator over the extra items.</span>

<span class="sd">        :return: an iterator with extra key value pairs</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbmodel</span><span class="o">.</span><span class="n">extras</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">yield</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span></div>

<div class="viewcode-block" id="DjangoNode.extras_keys"><a class="viewcode-back" href="../../../../../apidoc/aiida.orm.implementation.django.html#aiida.orm.implementation.django.nodes.DjangoNode.extras_keys">[docs]</a>    <span class="k">def</span> <span class="nf">extras_keys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return an iterator over the extras keys.</span>

<span class="sd">        :return: an iterator with extras keys</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbmodel</span><span class="o">.</span><span class="n">extras</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">yield</span> <span class="n">key</span></div>

<div class="viewcode-block" id="DjangoNode.add_incoming"><a class="viewcode-back" href="../../../../../apidoc/aiida.orm.implementation.django.html#aiida.orm.implementation.django.nodes.DjangoNode.add_incoming">[docs]</a>    <span class="k">def</span> <span class="nf">add_incoming</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">link_type</span><span class="p">,</span> <span class="n">link_label</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add a link of the given type from a given node to ourself.</span>

<span class="sd">        :param source: the node from which the link is coming</span>
<span class="sd">        :param link_type: the link type</span>
<span class="sd">        :param link_label: the link label</span>
<span class="sd">        :return: True if the proposed link is allowed, False otherwise</span>
<span class="sd">        :raise aiida.common.ModificationNotAllowed: if either source or target node is not stored</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">type_check</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">DjangoNode</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_stored</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">exceptions</span><span class="o">.</span><span class="n">ModificationNotAllowed</span><span class="p">(</span><span class="s1">&#39;node has to be stored when adding an incoming link&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">source</span><span class="o">.</span><span class="n">is_stored</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">exceptions</span><span class="o">.</span><span class="n">ModificationNotAllowed</span><span class="p">(</span><span class="s1">&#39;source node has to be stored when adding a link from it&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_add_link</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">link_type</span><span class="p">,</span> <span class="n">link_label</span><span class="p">)</span></div>

<div class="viewcode-block" id="DjangoNode._add_link"><a class="viewcode-back" href="../../../../../apidoc/aiida.orm.implementation.django.html#aiida.orm.implementation.django.nodes.DjangoNode._add_link">[docs]</a>    <span class="k">def</span> <span class="nf">_add_link</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">link_type</span><span class="p">,</span> <span class="n">link_label</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add a link of the given type from a given node to ourself.</span>

<span class="sd">        :param source: the node from which the link is coming</span>
<span class="sd">        :param link_type: the link type</span>
<span class="sd">        :param link_label: the link label</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">savepoint_id</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Transactions are needed here for Postgresql:</span>
            <span class="c1"># https://docs.djangoproject.com/en/1.5/topics/db/transactions/#handling-exceptions-within-postgresql-transactions</span>
            <span class="n">savepoint_id</span> <span class="o">=</span> <span class="n">transaction</span><span class="o">.</span><span class="n">savepoint</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">LINK_CLASS</span><span class="p">(</span><span class="n">input_id</span><span class="o">=</span><span class="n">source</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">output_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">link_label</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">link_type</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="n">transaction</span><span class="o">.</span><span class="n">savepoint_commit</span><span class="p">(</span><span class="n">savepoint_id</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">IntegrityError</span> <span class="k">as</span> <span class="n">exception</span><span class="p">:</span>
            <span class="n">transaction</span><span class="o">.</span><span class="n">savepoint_rollback</span><span class="p">(</span><span class="n">savepoint_id</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">exceptions</span><span class="o">.</span><span class="n">UniquenessError</span><span class="p">(</span><span class="s1">&#39;failed to create the link: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">exception</span><span class="p">))</span></div>

<div class="viewcode-block" id="DjangoNode.store"><a class="viewcode-back" href="../../../../../apidoc/aiida.orm.implementation.django.html#aiida.orm.implementation.django.nodes.DjangoNode.store">[docs]</a>    <span class="k">def</span> <span class="nf">store</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attributes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">links</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">with_transaction</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Store the node in the database.</span>

<span class="sd">        :param attributes: optional attributes to set before storing, will override any existing attributes</span>
<span class="sd">        :param links: optional links to add before storing</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">aiida.common.lang</span> <span class="k">import</span> <span class="n">EmptyContextManager</span>
        <span class="kn">from</span> <span class="nn">aiida.backends.djsite.db.models</span> <span class="k">import</span> <span class="n">suppress_auto_now</span>

        <span class="k">with</span> <span class="n">transaction</span><span class="o">.</span><span class="n">atomic</span><span class="p">()</span> <span class="k">if</span> <span class="n">with_transaction</span> <span class="k">else</span> <span class="n">EmptyContextManager</span><span class="p">():</span>
            <span class="k">with</span> <span class="n">suppress_auto_now</span><span class="p">([(</span><span class="n">models</span><span class="o">.</span><span class="n">DbNode</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;mtime&#39;</span><span class="p">])])</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtime</span> <span class="k">else</span> <span class="n">EmptyContextManager</span><span class="p">():</span>
                <span class="c1"># We need to save the node model instance itself first such that it has a pk</span>
                <span class="c1"># that can be used in the foreign keys that will be needed for setting the</span>
                <span class="c1"># attributes and links</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dbmodel</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

                <span class="k">if</span> <span class="n">attributes</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ATTRIBUTE_CLASS</span><span class="o">.</span><span class="n">reset_values_for_node</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dbmodel</span><span class="p">,</span> <span class="n">attributes</span><span class="p">,</span> <span class="n">with_transaction</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">links</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">link_triple</span> <span class="ow">in</span> <span class="n">links</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_add_link</span><span class="p">(</span><span class="o">*</span><span class="n">link_triple</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="DjangoNode._increment_version_number"><a class="viewcode-back" href="../../../../../apidoc/aiida.orm.implementation.django.html#aiida.orm.implementation.django.nodes.DjangoNode._increment_version_number">[docs]</a>    <span class="k">def</span> <span class="nf">_increment_version_number</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Increment the node version number of this node by one directly in the database.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dbmodel</span><span class="o">.</span><span class="n">nodeversion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dbmodel</span><span class="o">.</span><span class="n">save</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="DjangoNodeCollection"><a class="viewcode-back" href="../../../../../apidoc/aiida.orm.implementation.django.html#aiida.orm.implementation.django.nodes.DjangoNodeCollection">[docs]</a><span class="k">class</span> <span class="nc">DjangoNodeCollection</span><span class="p">(</span><span class="n">BackendNodeCollection</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;The collection of Node entries.&quot;&quot;&quot;</span>

    <span class="n">ENTITY_CLASS</span> <span class="o">=</span> <span class="n">DjangoNode</span>

<div class="viewcode-block" id="DjangoNodeCollection.delete"><a class="viewcode-back" href="../../../../../apidoc/aiida.orm.implementation.django.html#aiida.orm.implementation.django.nodes.DjangoNodeCollection.delete">[docs]</a>    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pk</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Remove a Node entry from the collection with the given id</span>

<span class="sd">        :param pk: id of the node to delete</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">models</span><span class="o">.</span><span class="n">DbNode</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>  <span class="c1"># pylint: disable=no-member</span>
        <span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">exceptions</span><span class="o">.</span><span class="n">NotExistent</span><span class="p">(</span><span class="s2">&quot;Node with pk &#39;</span><span class="si">{}</span><span class="s2">&#39; not found&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pk</span><span class="p">))</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, ECOLE POLYTECHNIQUE FEDERALE DE LAUSANNE (Theory and Simulation of Materials (THEOS) and National Centre for Computational Design and Discovery of Novel Materials (NCCR MARVEL)), Switzerland and ROBERT BOSCH LLC, USA. All rights reserved

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>