

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>aiida.common.files &mdash; AiiDA 1.0.0b2 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../_static/language_data.js"></script>
        <script type="text/javascript" src="../../../_static/contentui.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/contentui.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> AiiDA
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Installation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../install/quick_installation.html">Quick installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../install/prerequisites.html">Prerequisites</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../install/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../install/updating_installation.html">Updating AiiDA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../install/troubleshooting.html">Troubleshooting</a></li>
</ul>
<p class="caption"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../get_started/index.html">First things first</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../get_started/daemon.html">Setup the daemon</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../get_started/computers.html">Setup a computer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../get_started/codes.html">Setup a code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../get_started/plugins.html">Plugins</a></li>
</ul>
<p class="caption"><span class="caption-text">Concepts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../concepts/provenance.html">Provenance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../concepts/processes.html">Processes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../concepts/calculations.html">Calculations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../concepts/workflows.html">Workflows</a></li>
</ul>
<p class="caption"><span class="caption-text">Working with</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../working/processes.html">Processes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../working/functions.html">Calculation and work functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../working/calculations.html">Calculations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../working/workflows.html">Workflows</a></li>
</ul>
<p class="caption"><span class="caption-text">Working with AiiDA</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../working_with_aiida/index.html">Command line interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../working_with_aiida/index.html#scripting">Scripting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../working_with_aiida/index.html#data-types">Data types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../working_with_aiida/index.html#groups">Groups</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../working_with_aiida/index.html#schedulers">Schedulers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../working_with_aiida/index.html#querying-data">Querying data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../working_with_aiida/index.html#caching">Caching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../working_with_aiida/index.html#result-manager">Result manager</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../working_with_aiida/index.html#backups">Backups</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../working_with_aiida/index.html#troubleshooting">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../working_with_aiida/index.html#rest-api">REST API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../working_with_aiida/index.html#cookbook">Cookbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../import_export/index.html">Import and Export</a></li>
</ul>
<p class="caption"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../developer_guide/index.html">AiiDA design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developer_guide/index.html#aiida-core">AiiDA core</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developer_guide/index.html#aiida-plugins">AiiDA plugins</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorial/index.html">StructureData</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorial/index.html#pseudopotentials">Pseudopotentials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorial/index.html#plugin-development">Plugin development</a></li>
</ul>
<p class="caption"><span class="caption-text">API reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="`aiida package &lt;https://aiida-core.readthedocs.io/en/latest/apidoc/aiida.html&gt;`_">`aiida package &lt;https://aiida-core.readthedocs.io/en/latest/apidoc/aiida.html&gt;`_</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">AiiDA</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../../aiida.html">aiida</a> &raquo;</li>
        
      <li>aiida.common.files</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for aiida.common.files</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1">###########################################################################</span>
<span class="c1"># Copyright (c), The AiiDA team. All rights reserved.                     #</span>
<span class="c1"># This file is part of the AiiDA code.                                    #</span>
<span class="c1">#                                                                         #</span>
<span class="c1"># The code is hosted on GitHub at https://github.com/aiidateam/aiida_core #</span>
<span class="c1"># For further information on the license, see the LICENSE.txt file        #</span>
<span class="c1"># For further information please visit http://www.aiida.net               #</span>
<span class="c1">###########################################################################</span>
<span class="sd">&quot;&quot;&quot;Utility functions to operate on filesystem files.&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">division</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">print_function</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">absolute_import</span>

<span class="kn">import</span> <span class="nn">hashlib</span>
<span class="kn">import</span> <span class="nn">io</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>


<div class="viewcode-block" id="md5_from_filelike"><a class="viewcode-back" href="../../../apidoc/aiida.common.html#aiida.common.files.md5_from_filelike">[docs]</a><span class="k">def</span> <span class="nf">md5_from_filelike</span><span class="p">(</span><span class="n">filelike</span><span class="p">,</span> <span class="n">block_size_factor</span><span class="o">=</span><span class="mi">128</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Create the hexdigested md5 checksum of the contents from a filelike object.</span>

<span class="sd">    :param filelike: the filelike object for whose contents to generate the md5 checksum</span>
<span class="sd">    :param block_size_factor: the file is read at chunks of size ``block_size_factor * md5.block_size``, where</span>
<span class="sd">        ``md5.block_size`` is the block_size used internally by the hashlib module.</span>
<span class="sd">    :returns: a string with the hexdigest md5.</span>
<span class="sd">    :raises: no checks are done on the filelike object, so it may raise IOError if it cannot be read from.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">md5</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">()</span>

    <span class="c1"># I read 128 bytes at a time until it returns the empty string b&#39;&#39;</span>
    <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="nb">iter</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">filelike</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">block_size_factor</span> <span class="o">*</span> <span class="n">md5</span><span class="o">.</span><span class="n">block_size</span><span class="p">),</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="n">md5</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">md5</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span></div>


<div class="viewcode-block" id="md5_file"><a class="viewcode-back" href="../../../apidoc/aiida.common.html#aiida.common.files.md5_file">[docs]</a><span class="k">def</span> <span class="nf">md5_file</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">block_size_factor</span><span class="o">=</span><span class="mi">128</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Create the hexdigested md5 checksum of the contents from</span>

<span class="sd">    :param filepath: the filepath of the file for which we want the md5sum</span>
<span class="sd">    :param block_size_factor: the file is read at chunks of size ``block_size_factor * md5.block_size``, where</span>
<span class="sd">        ``md5.block_size`` is the block_size used internally by the hashlib module.</span>
<span class="sd">    :returns: a string with the hexdigest md5.</span>
<span class="sd">    :raises: No checks are done on the file, so if it doesn&#39;t exists it may</span>
<span class="sd">        raise IOError.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">io</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="k">as</span> <span class="n">handle</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">md5_from_filelike</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">block_size_factor</span><span class="o">=</span><span class="n">block_size_factor</span><span class="p">)</span></div>


<div class="viewcode-block" id="sha1_file"><a class="viewcode-back" href="../../../apidoc/aiida.common.html#aiida.common.files.sha1_file">[docs]</a><span class="k">def</span> <span class="nf">sha1_file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">block_size_factor</span><span class="o">=</span><span class="mi">128</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Open a file and return its sha1sum (hexdigested).</span>

<span class="sd">    :param filename: the filename of the file for which we want the sha1sum</span>
<span class="sd">    :param block_size_factor: the file is read at chunks of size</span>
<span class="sd">        ``block_size_factor * sha1.block_size``,</span>
<span class="sd">        where ``sha1.block_size`` is the block_size used internally by the</span>
<span class="sd">        hashlib module.</span>

<span class="sd">    :returns: a string with the hexdigest sha1.</span>

<span class="sd">    :raises: No checks are done on the file, so if it doesn&#39;t exists it may</span>
<span class="sd">        raise IOError.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sha1</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha1</span><span class="p">()</span>
    <span class="k">with</span> <span class="n">io</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="k">as</span> <span class="n">fhandle</span><span class="p">:</span>
        <span class="c1"># I read 128 bytes at a time until it returns the empty string b&#39;&#39;</span>
        <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="nb">iter</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">fhandle</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">block_size_factor</span> <span class="o">*</span> <span class="n">sha1</span><span class="o">.</span><span class="n">block_size</span><span class="p">),</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
            <span class="n">sha1</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sha1</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span></div>


<div class="viewcode-block" id="get_mode_string"><a class="viewcode-back" href="../../../apidoc/aiida.common.html#aiida.common.files.get_mode_string">[docs]</a><span class="k">def</span> <span class="nf">get_mode_string</span><span class="p">(</span><span class="n">mode</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert a file&#39;s mode to a string of the form &#39;-rwxrwxrwx&#39;.</span>
<span class="sd">    Taken (simplified) from cpython 3.3 stat module: https://hg.python.org/cpython/file/3.3/Lib/stat.py</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># pylint: disable=invalid-name,unused-variable,too-many-locals</span>

    <span class="c1"># Constants used as S_IFMT() for various file types</span>
    <span class="c1"># (not all are implemented on all systems)</span>

    <span class="n">S_IFDIR</span> <span class="o">=</span> <span class="mo">0o040000</span>  <span class="c1"># directory</span>
    <span class="n">S_IFCHR</span> <span class="o">=</span> <span class="mo">0o020000</span>  <span class="c1"># character device</span>
    <span class="n">S_IFBLK</span> <span class="o">=</span> <span class="mo">0o060000</span>  <span class="c1"># block device</span>
    <span class="n">S_IFREG</span> <span class="o">=</span> <span class="mo">0o100000</span>  <span class="c1"># regular file</span>
    <span class="n">S_IFIFO</span> <span class="o">=</span> <span class="mo">0o010000</span>  <span class="c1"># fifo (named pipe)</span>
    <span class="n">S_IFLNK</span> <span class="o">=</span> <span class="mo">0o120000</span>  <span class="c1"># symbolic link</span>
    <span class="n">S_IFSOCK</span> <span class="o">=</span> <span class="mo">0o140000</span>  <span class="c1"># socket file</span>

    <span class="c1"># Names for permission bits</span>

    <span class="n">S_ISUID</span> <span class="o">=</span> <span class="mo">0o4000</span>  <span class="c1"># set UID bit</span>
    <span class="n">S_ISGID</span> <span class="o">=</span> <span class="mo">0o2000</span>  <span class="c1"># set GID bit</span>
    <span class="n">S_ENFMT</span> <span class="o">=</span> <span class="n">S_ISGID</span>  <span class="c1"># file locking enforcement</span>
    <span class="n">S_ISVTX</span> <span class="o">=</span> <span class="mo">0o1000</span>  <span class="c1"># sticky bit</span>
    <span class="n">S_IREAD</span> <span class="o">=</span> <span class="mo">0o0400</span>  <span class="c1"># Unix V7 synonym for S_IRUSR</span>
    <span class="n">S_IWRITE</span> <span class="o">=</span> <span class="mo">0o0200</span>  <span class="c1"># Unix V7 synonym for S_IWUSR</span>
    <span class="n">S_IEXEC</span> <span class="o">=</span> <span class="mo">0o0100</span>  <span class="c1"># Unix V7 synonym for S_IXUSR</span>
    <span class="n">S_IRWXU</span> <span class="o">=</span> <span class="mo">0o0700</span>  <span class="c1"># mask for owner permissions</span>
    <span class="n">S_IRUSR</span> <span class="o">=</span> <span class="mo">0o0400</span>  <span class="c1"># read by owner</span>
    <span class="n">S_IWUSR</span> <span class="o">=</span> <span class="mo">0o0200</span>  <span class="c1"># write by owner</span>
    <span class="n">S_IXUSR</span> <span class="o">=</span> <span class="mo">0o0100</span>  <span class="c1"># execute by owner</span>
    <span class="n">S_IRWXG</span> <span class="o">=</span> <span class="mo">0o0070</span>  <span class="c1"># mask for group permissions</span>
    <span class="n">S_IRGRP</span> <span class="o">=</span> <span class="mo">0o0040</span>  <span class="c1"># read by group</span>
    <span class="n">S_IWGRP</span> <span class="o">=</span> <span class="mo">0o0020</span>  <span class="c1"># write by group</span>
    <span class="n">S_IXGRP</span> <span class="o">=</span> <span class="mo">0o0010</span>  <span class="c1"># execute by group</span>
    <span class="n">S_IRWXO</span> <span class="o">=</span> <span class="mo">0o0007</span>  <span class="c1"># mask for others (not in group) permissions</span>
    <span class="n">S_IROTH</span> <span class="o">=</span> <span class="mo">0o0004</span>  <span class="c1"># read by others</span>
    <span class="n">S_IWOTH</span> <span class="o">=</span> <span class="mo">0o0002</span>  <span class="c1"># write by others</span>
    <span class="n">S_IXOTH</span> <span class="o">=</span> <span class="mo">0o0001</span>  <span class="c1"># execute by others</span>

    <span class="c1"># yapf:disable</span>
    <span class="n">_filemode_table</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">((</span><span class="n">S_IFLNK</span><span class="p">,</span> <span class="s1">&#39;l&#39;</span><span class="p">),</span>
         <span class="p">(</span><span class="n">S_IFREG</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">),</span>
         <span class="p">(</span><span class="n">S_IFBLK</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">),</span>
         <span class="p">(</span><span class="n">S_IFDIR</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">),</span>
         <span class="p">(</span><span class="n">S_IFCHR</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">),</span>
         <span class="p">(</span><span class="n">S_IFIFO</span><span class="p">,</span> <span class="s1">&#39;p&#39;</span><span class="p">)),</span>

        <span class="p">((</span><span class="n">S_IRUSR</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">),),</span>
        <span class="p">((</span><span class="n">S_IWUSR</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">),),</span>
        <span class="p">((</span><span class="n">S_IXUSR</span> <span class="o">|</span> <span class="n">S_ISUID</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">),</span>
         <span class="p">(</span><span class="n">S_ISUID</span><span class="p">,</span> <span class="s1">&#39;S&#39;</span><span class="p">),</span>
         <span class="p">(</span><span class="n">S_IXUSR</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">)),</span>

        <span class="p">((</span><span class="n">S_IRGRP</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">),),</span>
        <span class="p">((</span><span class="n">S_IWGRP</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">),),</span>
        <span class="p">((</span><span class="n">S_IXGRP</span> <span class="o">|</span> <span class="n">S_ISGID</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">),</span>
         <span class="p">(</span><span class="n">S_ISGID</span><span class="p">,</span> <span class="s1">&#39;S&#39;</span><span class="p">),</span>
         <span class="p">(</span><span class="n">S_IXGRP</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">)),</span>

        <span class="p">((</span><span class="n">S_IROTH</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">),),</span>
        <span class="p">((</span><span class="n">S_IWOTH</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">),),</span>
        <span class="p">((</span><span class="n">S_IXOTH</span> <span class="o">|</span> <span class="n">S_ISVTX</span><span class="p">,</span> <span class="s1">&#39;t&#39;</span><span class="p">),</span>
         <span class="p">(</span><span class="n">S_ISVTX</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">),</span>
         <span class="p">(</span><span class="n">S_IXOTH</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">))</span>
    <span class="p">)</span>
    <span class="c1"># yapf:enable</span>

    <span class="n">perm</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">_filemode_table</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">bit</span><span class="p">,</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">table</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">mode</span> <span class="o">&amp;</span> <span class="n">bit</span> <span class="o">==</span> <span class="n">bit</span><span class="p">:</span>
                <span class="n">perm</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">char</span><span class="p">)</span>
                <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">perm</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">perm</span><span class="p">)</span></div>


<span class="c1"># NOTE: this function is taken from shutil.which in python 3.5</span>
<span class="c1"># When we upgrade to python3 only, this function will not be needed anumore</span>
<div class="viewcode-block" id="which"><a class="viewcode-back" href="../../../apidoc/aiida.common.html#aiida.common.files.which">[docs]</a><span class="k">def</span> <span class="nf">which</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">F_OK</span> <span class="o">|</span> <span class="n">os</span><span class="o">.</span><span class="n">X_OK</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Given a command, mode, and a PATH string, return the path which</span>
<span class="sd">    conforms to the given mode on the PATH, or None if there is no such</span>
<span class="sd">    file.</span>

<span class="sd">    `mode` defaults to os.F_OK | os.X_OK. `path` defaults to the result</span>
<span class="sd">    of os.environ.get(&quot;PATH&quot;), or can be overridden with a custom search</span>
<span class="sd">    path.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># pylint: disable=too-many-branches</span>

    <span class="c1"># Check that a given file can be accessed with the correct mode.</span>
    <span class="c1"># Additionally check that `file` is not a directory, as on Windows</span>
    <span class="c1"># directories pass the os.access check.</span>
    <span class="k">def</span> <span class="nf">_access_check</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

    <span class="c1"># If we&#39;re given a path with a directory part, look it up directly rather</span>
    <span class="c1"># than referring to PATH directories. This includes checking relative to the</span>
    <span class="c1"># current directory, e.g. ./script</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">cmd</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">_access_check</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">mode</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">cmd</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;PATH&quot;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">defpath</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">pathsep</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s2">&quot;win32&quot;</span><span class="p">:</span>
        <span class="c1"># The current directory takes precedence on Windows.</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">curdir</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
            <span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">curdir</span><span class="p">)</span>

        <span class="c1"># PATHEXT is necessary to check on Windows.</span>
        <span class="n">pathext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;PATHEXT&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">pathsep</span><span class="p">)</span>
        <span class="c1"># See if the given file matches any of the expected path extensions.</span>
        <span class="c1"># This will allow us to short circuit when given &quot;python.exe&quot;.</span>
        <span class="c1"># If it does match, only test that one, otherwise we have to try</span>
        <span class="c1"># others.</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">cmd</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">ext</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span> <span class="k">for</span> <span class="n">ext</span> <span class="ow">in</span> <span class="n">pathext</span><span class="p">):</span>
            <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">cmd</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">cmd</span> <span class="o">+</span> <span class="n">ext</span> <span class="k">for</span> <span class="n">ext</span> <span class="ow">in</span> <span class="n">pathext</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># On other platforms you don&#39;t have things like PATHEXT to tell you</span>
        <span class="c1"># what file suffixes are executable, so just pass on cmd as-is.</span>
        <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">cmd</span><span class="p">]</span>

    <span class="n">seen</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">directory</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
        <span class="n">normdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normcase</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">normdir</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">seen</span><span class="p">:</span>
            <span class="n">seen</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">normdir</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">thefile</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">thefile</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">_access_check</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">mode</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">name</span>
    <span class="k">return</span> <span class="kc">None</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, ECOLE POLYTECHNIQUE FEDERALE DE LAUSANNE (Theory and Simulation of Materials (THEOS) and National Centre for Computational Design and Discovery of Novel Materials (NCCR MARVEL)), Switzerland and ROBERT BOSCH LLC, USA. All rights reserved

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>