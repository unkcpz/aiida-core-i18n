

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>aiida.common.escaping &mdash; AiiDA 1.0.0b2 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../_static/language_data.js"></script>
        <script type="text/javascript" src="../../../_static/contentui.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/contentui.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> AiiDA
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Installation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../install/quick_installation.html">Quick installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../install/prerequisites.html">Prerequisites</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../install/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../install/updating_installation.html">Updating AiiDA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../install/troubleshooting.html">Troubleshooting</a></li>
</ul>
<p class="caption"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../get_started/index.html">First things first</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../get_started/daemon.html">Setup the daemon</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../get_started/computers.html">Setup a computer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../get_started/codes.html">Setup a code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../get_started/plugins.html">Plugins</a></li>
</ul>
<p class="caption"><span class="caption-text">Concepts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../concepts/provenance.html">Provenance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../concepts/processes.html">Processes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../concepts/calculations.html">Calculations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../concepts/workflows.html">Workflows</a></li>
</ul>
<p class="caption"><span class="caption-text">Working with</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../working/processes.html">Processes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../working/functions.html">Calculation and work functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../working/calculations.html">Calculations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../working/workflows.html">Workflows</a></li>
</ul>
<p class="caption"><span class="caption-text">Working with AiiDA</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../working_with_aiida/index.html">Command line interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../working_with_aiida/index.html#scripting">Scripting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../working_with_aiida/index.html#data-types">Data types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../working_with_aiida/index.html#groups">Groups</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../working_with_aiida/index.html#schedulers">Schedulers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../working_with_aiida/index.html#querying-data">Querying data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../working_with_aiida/index.html#caching">Caching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../working_with_aiida/index.html#result-manager">Result manager</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../working_with_aiida/index.html#backups">Backups</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../working_with_aiida/index.html#troubleshooting">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../working_with_aiida/index.html#rest-api">REST API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../working_with_aiida/index.html#cookbook">Cookbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../import_export/index.html">Import and Export</a></li>
</ul>
<p class="caption"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../developer_guide/index.html">AiiDA design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developer_guide/index.html#aiida-core">AiiDA core</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developer_guide/index.html#aiida-plugins">AiiDA plugins</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorial/index.html">StructureData</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorial/index.html#pseudopotentials">Pseudopotentials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorial/index.html#plugin-development">Plugin development</a></li>
</ul>
<p class="caption"><span class="caption-text">API reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="`aiida package &lt;https://aiida-core.readthedocs.io/en/latest/apidoc/aiida.html&gt;`_">`aiida package &lt;https://aiida-core.readthedocs.io/en/latest/apidoc/aiida.html&gt;`_</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">AiiDA</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../../aiida.html">aiida</a> &raquo;</li>
        
      <li>aiida.common.escaping</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for aiida.common.escaping</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1">###########################################################################</span>
<span class="c1"># Copyright (c), The AiiDA team. All rights reserved.                     #</span>
<span class="c1"># This file is part of the AiiDA code.                                    #</span>
<span class="c1">#                                                                         #</span>
<span class="c1"># The code is hosted on GitHub at https://github.com/aiidateam/aiida_core #</span>
<span class="c1"># For further information on the license, see the LICENSE.txt file        #</span>
<span class="c1"># For further information please visit http://www.aiida.net               #</span>
<span class="c1">###########################################################################</span>
<span class="sd">&quot;&quot;&quot;Miscellaneous functions for escaping strings.&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">division</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">print_function</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">absolute_import</span>
<span class="kn">import</span> <span class="nn">re</span>


<div class="viewcode-block" id="escape_for_bash"><a class="viewcode-back" href="../../../apidoc/aiida.common.html#aiida.common.escaping.escape_for_bash">[docs]</a><span class="k">def</span> <span class="nf">escape_for_bash</span><span class="p">(</span><span class="n">str_to_escape</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function takes any string and escapes it in a way that</span>
<span class="sd">    bash will interpret it as a single string.</span>

<span class="sd">    Explanation:</span>

<span class="sd">    At the end, in the return statement, the string is put within single</span>
<span class="sd">    quotes. Therefore, the only thing that I have to escape in bash is the</span>
<span class="sd">    single quote character. To do this, I substitute every single</span>
<span class="sd">    quote &#39; with &#39;&quot;&#39;&quot;&#39; which means:</span>

<span class="sd">    First single quote: exit from the enclosing single quotes</span>

<span class="sd">    Second, third and fourth character: &quot;&#39;&quot; is a single quote character,</span>
<span class="sd">    escaped by double quotes</span>

<span class="sd">    Last single quote: reopen the single quote to continue the string</span>

<span class="sd">    Finally, note that for python I have to enclose the string &#39;&quot;&#39;&quot;&#39;</span>
<span class="sd">    within triple quotes to make it work, getting finally: the complicated</span>
<span class="sd">    string found below.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">escaped_quotes</span> <span class="o">=</span> <span class="n">str_to_escape</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;&quot;&#39;&quot;&#39;&quot;&#39;&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="s2">&quot;&#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">escaped_quotes</span><span class="p">)</span></div>


<span class="c1"># Mapping of &quot;SQL&quot; tokens into corresponding regex expressions</span>
<span class="n">SQL_TO_REGEX_TOKENS</span> <span class="o">=</span> <span class="p">[</span>  <span class="c1"># Remember in the strings below we have to escape backslashes as well for python...</span>
    <span class="c1"># so &#39;\\\\&#39; is actually a string with two backslashes, &#39;\\&#39; a string with a single backslash, ...</span>
    <span class="p">(</span><span class="s1">&#39;</span><span class="se">\\\\</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">)),</span>  <span class="c1"># Double slash should be interpreted as a literal single backslash by regex</span>
    <span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">%&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="s1">&#39;%&#39;</span><span class="p">)),</span>  <span class="c1"># literal &#39;\%&#39; should be interpreted as literal % by regex</span>
    <span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">_&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)),</span>  <span class="c1"># literal &#39;\_&#39; should be interpreted as literal _ by regex</span>
    <span class="p">(</span><span class="s1">&#39;%&#39;</span><span class="p">,</span> <span class="s1">&#39;.*&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">),</span>
<span class="p">]</span>


<div class="viewcode-block" id="escape_for_sql_like"><a class="viewcode-back" href="../../../apidoc/aiida.common.html#aiida.common.escaping.escape_for_sql_like">[docs]</a><span class="k">def</span> <span class="nf">escape_for_sql_like</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function that escapes % or _ symbols provided by user</span>

<span class="sd">    SQL LIKE syntax summary:</span>

<span class="sd">    - ``%`` -&gt; match any number of characters</span>
<span class="sd">    - ``_`` -&gt; match exactly one character</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">string</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;%&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">%&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">_&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="get_regex_pattern_from_sql"><a class="viewcode-back" href="../../../apidoc/aiida.common.html#aiida.common.escaping.get_regex_pattern_from_sql">[docs]</a><span class="k">def</span> <span class="nf">get_regex_pattern_from_sql</span><span class="p">(</span><span class="n">sql_pattern</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert a string providing a pattern to match in SQL</span>
<span class="sd">    syntax into a string performing the same match as a regex.</span>

<span class="sd">    SQL LIKE syntax summary:</span>

<span class="sd">    - ``%`` -&gt; match any number of characters</span>
<span class="sd">    - ``_`` -&gt; match exactly one character</span>

<span class="sd">    Moreover, ``\`` is the escape character (by default), so:</span>

<span class="sd">    - ``\\`` -&gt; single backslash</span>
<span class="sd">    - ``\%`` -&gt; literal % symbol</span>
<span class="sd">    - ``\_`` -&gt; literal _ symbol</span>

<span class="sd">    and moreover the string should begin at the beginning of the line</span>
<span class="sd">    and end at the end of the line.</span>

<span class="sd">    :param sql_pattern: the string with the pattern in SQL syntax</span>
<span class="sd">    :return: a string with the pattern in regex syntax</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">tokenizer</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">tokens_to_apply</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Recursive function that tokenizes a string using the provided tokens</span>

<span class="sd">        :param string: the string to tokenize</span>
<span class="sd">        :param tokens_to_apply: the list of tokens still to process (in order: the first will be processed first)</span>
<span class="sd">        :return: a tokenized and escaped string for regex</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">tokens_to_apply</span><span class="p">:</span>
            <span class="c1"># We still have tokens to process</span>
            <span class="c1"># find the first occurrence of the first token passed in the list</span>
            <span class="c1"># note that the order of the tokens list is important, e.g. we need</span>
            <span class="c1"># to match first \% and then %</span>
            <span class="n">first</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">rest</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">partition</span><span class="p">(</span><span class="n">tokens_to_apply</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

            <span class="c1"># There is indeed a separator:</span>
            <span class="k">if</span> <span class="n">sep</span><span class="p">:</span>
                <span class="c1"># at least one token was found; therefore I have to map tokens[sep]</span>
                <span class="c1"># to the corresponding regex expression (via the dictionary substitution)</span>
                <span class="c1"># Moreover, the &#39;rest&#39; is not empty so I apply recursively `tokenizer`,</span>
                <span class="c1"># with ALL tokens passed (there could be more occurrences of tokens_to_apply[0])</span>
                <span class="c1"># Instead, for the first part, we know that we found the FIRST occurrence of tokens_to_apply[0]</span>
                <span class="c1"># so I pass the list without the first element</span>
                <span class="k">return</span> <span class="n">tokenizer</span><span class="p">(</span>
                    <span class="n">first</span><span class="p">,</span> <span class="n">tokens_to_apply</span><span class="o">=</span><span class="n">tokens_to_apply</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">+</span> <span class="nb">dict</span><span class="p">(</span><span class="n">SQL_TO_REGEX_TOKENS</span><span class="p">)[</span><span class="n">sep</span><span class="p">]</span> <span class="o">+</span> <span class="n">tokenizer</span><span class="p">(</span>
                        <span class="n">rest</span><span class="p">,</span> <span class="n">tokens_to_apply</span><span class="o">=</span><span class="n">tokens_to_apply</span><span class="p">)</span>
            <span class="c1"># Here sep is empty: it means also rest is empty, and we just</span>
            <span class="c1"># return (recursively) the tokenizer on the first part, avoiding</span>
            <span class="c1"># infinite loops</span>
            <span class="k">return</span> <span class="n">tokenizer</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="n">tokens_to_apply</span><span class="o">=</span><span class="n">tokens_to_apply</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="c1"># There is no more token to process: we now have</span>
        <span class="c1"># a string that we know we want to consider literally, so</span>
        <span class="c1"># we just make sure it&#39;s escaped for a regex to avoid</span>
        <span class="c1"># that the user passed in weird characters that are valid</span>
        <span class="c1"># regex symbols like $ ^ [ ] etc</span>
        <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>

    <span class="k">return</span> <span class="s2">&quot;^</span><span class="si">{}</span><span class="s2">$&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tokenizer</span><span class="p">(</span><span class="n">sql_pattern</span><span class="p">,</span> <span class="n">tokens_to_apply</span><span class="o">=</span><span class="p">[</span><span class="n">token_pair</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">token_pair</span> <span class="ow">in</span> <span class="n">SQL_TO_REGEX_TOKENS</span><span class="p">]))</span></div>


<div class="viewcode-block" id="sql_string_match"><a class="viewcode-back" href="../../../apidoc/aiida.common.html#aiida.common.escaping.sql_string_match">[docs]</a><span class="k">def</span> <span class="nf">sql_string_match</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">pattern</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check if the string matches the provided pattern,</span>
<span class="sd">    specified using SQL syntax.</span>

<span class="sd">    See documentation of :py:func:`~aiida.common.escaping.get_regex_pattern_from_sql`</span>
<span class="sd">    for an explanation of the syntax.</span>

<span class="sd">    :param string: the string to check</span>
<span class="sd">    :param pattern: the SQL pattern</span>
<span class="sd">    :return: True if the string matches, False otherwise</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">get_regex_pattern_from_sql</span><span class="p">(</span><span class="n">pattern</span><span class="p">),</span> <span class="n">string</span><span class="p">))</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, ECOLE POLYTECHNIQUE FEDERALE DE LAUSANNE (Theory and Simulation of Materials (THEOS) and National Centre for Computational Design and Discovery of Novel Materials (NCCR MARVEL)), Switzerland and ROBERT BOSCH LLC, USA. All rights reserved

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>