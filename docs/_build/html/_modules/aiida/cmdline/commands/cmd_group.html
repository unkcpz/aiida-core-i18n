

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>aiida.cmdline.commands.cmd_group &mdash; AiiDA 1.0.0b2 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../../_static/language_data.js"></script>
        <script type="text/javascript" src="../../../../_static/contentui.js"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/contentui.css" type="text/css" />
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../index.html" class="icon icon-home"> AiiDA
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Installation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../install/quick_installation.html">Quick installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../install/prerequisites.html">Prerequisites</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../install/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../install/updating_installation.html">Updating AiiDA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../install/troubleshooting.html">Troubleshooting</a></li>
</ul>
<p class="caption"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../get_started/index.html">First things first</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../get_started/daemon.html">Setup the daemon</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../get_started/computers.html">Setup a computer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../get_started/codes.html">Setup a code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../get_started/plugins.html">Plugins</a></li>
</ul>
<p class="caption"><span class="caption-text">Concepts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../concepts/provenance.html">Provenance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../concepts/processes.html">Processes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../concepts/calculations.html">Calculations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../concepts/workflows.html">Workflows</a></li>
</ul>
<p class="caption"><span class="caption-text">Working with</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../working/processes.html">Processes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working/functions.html">Calculation and work functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working/calculations.html">Calculations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working/workflows.html">Workflows</a></li>
</ul>
<p class="caption"><span class="caption-text">Working with AiiDA</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../working_with_aiida/index.html">Command line interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working_with_aiida/index.html#scripting">Scripting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working_with_aiida/index.html#data-types">Data types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working_with_aiida/index.html#groups">Groups</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working_with_aiida/index.html#schedulers">Schedulers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working_with_aiida/index.html#querying-data">Querying data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working_with_aiida/index.html#caching">Caching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working_with_aiida/index.html#result-manager">Result manager</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working_with_aiida/index.html#backups">Backups</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working_with_aiida/index.html#troubleshooting">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working_with_aiida/index.html#rest-api">REST API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working_with_aiida/index.html#cookbook">Cookbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../import_export/index.html">Import and Export</a></li>
</ul>
<p class="caption"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../developer_guide/index.html">AiiDA design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../developer_guide/index.html#aiida-core">AiiDA core</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../developer_guide/index.html#aiida-plugins">AiiDA plugins</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../tutorial/index.html">StructureData</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tutorial/index.html#pseudopotentials">Pseudopotentials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tutorial/index.html#plugin-development">Plugin development</a></li>
</ul>
<p class="caption"><span class="caption-text">API reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="`aiida package &lt;https://aiida-core.readthedocs.io/en/latest/apidoc/aiida.html&gt;`_">`aiida package &lt;https://aiida-core.readthedocs.io/en/latest/apidoc/aiida.html&gt;`_</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">AiiDA</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../../../aiida.html">aiida</a> &raquo;</li>
        
      <li>aiida.cmdline.commands.cmd_group</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for aiida.cmdline.commands.cmd_group</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1">###########################################################################</span>
<span class="c1"># Copyright (c), The AiiDA team. All rights reserved.                     #</span>
<span class="c1"># This file is part of the AiiDA code.                                    #</span>
<span class="c1">#                                                                         #</span>
<span class="c1"># The code is hosted on GitHub at https://github.com/aiidateam/aiida_core #</span>
<span class="c1"># For further information on the license, see the LICENSE.txt file        #</span>
<span class="c1"># For further information please visit http://www.aiida.net               #</span>
<span class="c1">###########################################################################</span>
<span class="sd">&quot;&quot;&quot;`verdi group` commands&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">division</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">print_function</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">absolute_import</span>

<span class="kn">import</span> <span class="nn">click</span>

<span class="kn">from</span> <span class="nn">aiida.common.exceptions</span> <span class="k">import</span> <span class="n">UniquenessError</span>
<span class="kn">from</span> <span class="nn">aiida.cmdline.commands.cmd_verdi</span> <span class="k">import</span> <span class="n">verdi</span>
<span class="kn">from</span> <span class="nn">aiida.cmdline.params</span> <span class="k">import</span> <span class="n">options</span><span class="p">,</span> <span class="n">arguments</span><span class="p">,</span> <span class="n">types</span>
<span class="kn">from</span> <span class="nn">aiida.cmdline.utils</span> <span class="k">import</span> <span class="n">echo</span>
<span class="kn">from</span> <span class="nn">aiida.cmdline.utils.decorators</span> <span class="k">import</span> <span class="n">with_dbenv</span>


<span class="nd">@verdi</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;group&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">verdi_group</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Create, inspect and manage groups.&quot;&quot;&quot;</span>


<span class="nd">@verdi_group</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;add-nodes&#39;</span><span class="p">)</span>
<span class="nd">@options</span><span class="o">.</span><span class="n">GROUP</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nd">@options</span><span class="o">.</span><span class="n">FORCE</span><span class="p">()</span>
<span class="nd">@arguments</span><span class="o">.</span><span class="n">NODES</span><span class="p">()</span>
<span class="nd">@with_dbenv</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">group_add_nodes</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">force</span><span class="p">,</span> <span class="n">nodes</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Add NODES to the given GROUP.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">force</span><span class="p">:</span>
        <span class="n">click</span><span class="o">.</span><span class="n">confirm</span><span class="p">(</span><span class="s1">&#39;Do you really want to add </span><span class="si">{}</span><span class="s1"> nodes to Group&lt;</span><span class="si">{}</span><span class="s1">&gt;?&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">nodes</span><span class="p">),</span> <span class="n">group</span><span class="o">.</span><span class="n">label</span><span class="p">),</span> <span class="n">abort</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">group</span><span class="o">.</span><span class="n">add_nodes</span><span class="p">(</span><span class="n">nodes</span><span class="p">)</span>


<span class="nd">@verdi_group</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;remove-nodes&#39;</span><span class="p">)</span>
<span class="nd">@options</span><span class="o">.</span><span class="n">GROUP</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nd">@arguments</span><span class="o">.</span><span class="n">NODES</span><span class="p">()</span>
<span class="nd">@options</span><span class="o">.</span><span class="n">GROUP_CLEAR</span><span class="p">()</span>
<span class="nd">@options</span><span class="o">.</span><span class="n">FORCE</span><span class="p">()</span>
<span class="nd">@with_dbenv</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">group_remove_nodes</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">clear</span><span class="p">,</span> <span class="n">force</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Remove NODES from the given GROUP.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">clear</span><span class="p">:</span>
        <span class="n">message</span> <span class="o">=</span> <span class="s1">&#39;Do you really want to remove ALL the nodes from Group&lt;</span><span class="si">{}</span><span class="s1">&gt;?&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">group</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">message</span> <span class="o">=</span> <span class="s1">&#39;Do you really want to remove </span><span class="si">{}</span><span class="s1"> nodes from Group&lt;</span><span class="si">{}</span><span class="s1">&gt;?&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">nodes</span><span class="p">),</span> <span class="n">group</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">force</span><span class="p">:</span>
        <span class="n">click</span><span class="o">.</span><span class="n">confirm</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">abort</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">clear</span><span class="p">:</span>
        <span class="n">group</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">group</span><span class="o">.</span><span class="n">remove_nodes</span><span class="p">(</span><span class="n">nodes</span><span class="p">)</span>


<span class="nd">@verdi_group</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;delete&#39;</span><span class="p">)</span>
<span class="nd">@arguments</span><span class="o">.</span><span class="n">GROUP</span><span class="p">()</span>
<span class="nd">@options</span><span class="o">.</span><span class="n">GROUP_CLEAR</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s1">&#39;Remove all nodes before deleting the group itself.&#39;</span><span class="p">)</span>
<span class="nd">@options</span><span class="o">.</span><span class="n">FORCE</span><span class="p">()</span>
<span class="nd">@with_dbenv</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">group_delete</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">clear</span><span class="p">,</span> <span class="n">force</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Delete a GROUP.</span>

<span class="sd">    Note that a group that contains nodes cannot be deleted if it contains any nodes. If you still want to delete the</span>
<span class="sd">    group, use the `-c/--clear` flag to remove the contents before deletion. Note that in any case, the nodes themselves</span>
<span class="sd">    will not actually be deleted from the database.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">aiida</span> <span class="k">import</span> <span class="n">orm</span>

    <span class="n">label</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">label</span>

    <span class="k">if</span> <span class="n">group</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">clear</span><span class="p">:</span>
        <span class="n">echo</span><span class="o">.</span><span class="n">echo_critical</span><span class="p">(</span>
            <span class="p">(</span><span class="s1">&#39;Group&lt;</span><span class="si">{}</span><span class="s1">&gt; contains </span><span class="si">{}</span><span class="s1"> nodes. Pass `--clear` if you want to empty it before deleting the group&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">label</span><span class="p">,</span> <span class="n">group</span><span class="o">.</span><span class="n">count</span><span class="p">())))</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">force</span><span class="p">:</span>
        <span class="n">click</span><span class="o">.</span><span class="n">confirm</span><span class="p">(</span><span class="s1">&#39;Are you sure to delete Group&lt;</span><span class="si">{}</span><span class="s1">&gt;?&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">),</span> <span class="n">abort</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">clear</span><span class="p">:</span>
        <span class="n">group</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

    <span class="n">orm</span><span class="o">.</span><span class="n">Group</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">group</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span>
    <span class="n">echo</span><span class="o">.</span><span class="n">echo_success</span><span class="p">(</span><span class="s1">&#39;Group&lt;</span><span class="si">{}</span><span class="s1">&gt; deleted.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">))</span>


<span class="nd">@verdi_group</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;relabel&#39;</span><span class="p">)</span>
<span class="nd">@arguments</span><span class="o">.</span><span class="n">GROUP</span><span class="p">()</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">argument</span><span class="p">(</span><span class="s1">&#39;label&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">click</span><span class="o">.</span><span class="n">STRING</span><span class="p">)</span>
<span class="nd">@with_dbenv</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">group_relabel</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">label</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Change the label of the given GROUP to LABEL.&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">group</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">label</span>
    <span class="k">except</span> <span class="n">UniquenessError</span> <span class="k">as</span> <span class="n">exception</span><span class="p">:</span>
        <span class="n">echo</span><span class="o">.</span><span class="n">echo_critical</span><span class="p">(</span><span class="s1">&#39;Error: </span><span class="si">{}</span><span class="s1">.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">exception</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">echo</span><span class="o">.</span><span class="n">echo_success</span><span class="p">(</span><span class="s1">&#39;Label changed to </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">))</span>


<span class="nd">@verdi_group</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;description&#39;</span><span class="p">)</span>
<span class="nd">@arguments</span><span class="o">.</span><span class="n">GROUP</span><span class="p">()</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">argument</span><span class="p">(</span><span class="s1">&#39;description&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">click</span><span class="o">.</span><span class="n">STRING</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="nd">@with_dbenv</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">group_description</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">description</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Change the description of the given GROUP to DESCRIPTION.</span>

<span class="sd">    If no DESCRIPTION is defined, the current description will simply be echoed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">description</span><span class="p">:</span>
        <span class="n">group</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">description</span>
        <span class="n">echo</span><span class="o">.</span><span class="n">echo_success</span><span class="p">(</span><span class="s1">&#39;Changed the description of Group&lt;</span><span class="si">{}</span><span class="s1">&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">group</span><span class="o">.</span><span class="n">label</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">echo</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="n">group</span><span class="o">.</span><span class="n">description</span><span class="p">)</span>


<span class="nd">@verdi_group</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;show&#39;</span><span class="p">)</span>
<span class="nd">@options</span><span class="o">.</span><span class="n">RAW</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s2">&quot;Show only a space-separated list of PKs of the calculations in the group&quot;</span><span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
    <span class="s1">&#39;-u&#39;</span><span class="p">,</span>
    <span class="s1">&#39;--uuid&#39;</span><span class="p">,</span>
    <span class="n">is_flag</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Show UUIDs together with PKs. Note: if the --raw option is also passed, PKs are not printed, but oly UUIDs.&quot;</span><span class="p">)</span>
<span class="nd">@arguments</span><span class="o">.</span><span class="n">GROUP</span><span class="p">()</span>
<span class="nd">@with_dbenv</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">group_show</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">raw</span><span class="p">,</span> <span class="n">uuid</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Show information on a given group. Pass the GROUP as a parameter.&quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">tabulate</span> <span class="k">import</span> <span class="n">tabulate</span>

    <span class="kn">from</span> <span class="nn">aiida.common.utils</span> <span class="k">import</span> <span class="n">str_timedelta</span>
    <span class="kn">from</span> <span class="nn">aiida.common</span> <span class="k">import</span> <span class="n">timezone</span>

    <span class="k">if</span> <span class="n">raw</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">uuid</span><span class="p">:</span>
            <span class="n">echo</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">_</span><span class="o">.</span><span class="n">uuid</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">group</span><span class="o">.</span><span class="n">nodes</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">echo</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">_</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">group</span><span class="o">.</span><span class="n">nodes</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">type_string</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">type_string</span>
        <span class="n">desc</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">description</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

        <span class="n">table</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">table</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s1">&#39;Group label&#39;</span><span class="p">,</span> <span class="n">group</span><span class="o">.</span><span class="n">label</span><span class="p">])</span>
        <span class="n">table</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s1">&#39;Group type_string&#39;</span><span class="p">,</span> <span class="n">type_string</span><span class="p">])</span>
        <span class="n">table</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s1">&#39;Group description&#39;</span><span class="p">,</span> <span class="n">desc</span> <span class="k">if</span> <span class="n">desc</span> <span class="k">else</span> <span class="s1">&#39;&lt;no description&gt;&#39;</span><span class="p">])</span>
        <span class="n">echo</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="n">tabulate</span><span class="p">(</span><span class="n">table</span><span class="p">))</span>

        <span class="n">table</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">header</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">uuid</span><span class="p">:</span>
            <span class="n">header</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;UUID&#39;</span><span class="p">)</span>
        <span class="n">header</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;PK&#39;</span><span class="p">,</span> <span class="s1">&#39;Type&#39;</span><span class="p">,</span> <span class="s1">&#39;Created&#39;</span><span class="p">])</span>
        <span class="n">echo</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="s1">&#39;# Nodes:&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">group</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
            <span class="n">row</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="n">uuid</span><span class="p">:</span>
                <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">uuid</span><span class="p">)</span>
            <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span>
            <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">node_type</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">str_timedelta</span><span class="p">(</span><span class="n">now</span> <span class="o">-</span> <span class="n">node</span><span class="o">.</span><span class="n">ctime</span><span class="p">,</span> <span class="n">short</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">negative_to_zero</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
            <span class="n">table</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
        <span class="n">echo</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="n">tabulate</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">header</span><span class="p">))</span>


<div class="viewcode-block" id="valid_group_type_strings"><a class="viewcode-back" href="../../../../apidoc/aiida.cmdline.commands.html#aiida.cmdline.commands.cmd_group.valid_group_type_strings">[docs]</a><span class="nd">@with_dbenv</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">valid_group_type_strings</span><span class="p">():</span>
    <span class="kn">from</span> <span class="nn">aiida.orm</span> <span class="k">import</span> <span class="n">GroupTypeString</span>
    <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">GroupTypeString</span><span class="p">)</span></div>


<div class="viewcode-block" id="user_defined_group"><a class="viewcode-back" href="../../../../apidoc/aiida.cmdline.commands.html#aiida.cmdline.commands.cmd_group.user_defined_group">[docs]</a><span class="nd">@with_dbenv</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">user_defined_group</span><span class="p">():</span>
    <span class="kn">from</span> <span class="nn">aiida.orm</span> <span class="k">import</span> <span class="n">GroupTypeString</span>
    <span class="k">return</span> <span class="n">GroupTypeString</span><span class="o">.</span><span class="n">USER</span><span class="o">.</span><span class="n">value</span></div>


<span class="nd">@verdi_group</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;list&#39;</span><span class="p">)</span>
<span class="nd">@options</span><span class="o">.</span><span class="n">ALL_USERS</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s1">&#39;Show groups for all users, rather than only for the current user&#39;</span><span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
    <span class="s1">&#39;-u&#39;</span><span class="p">,</span>
    <span class="s1">&#39;--user&#39;</span><span class="p">,</span>
    <span class="s1">&#39;user_email&#39;</span><span class="p">,</span>
    <span class="nb">type</span><span class="o">=</span><span class="n">click</span><span class="o">.</span><span class="n">STRING</span><span class="p">,</span>
    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Add a filter to show only groups belonging to a specific user&quot;</span><span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s1">&#39;-a&#39;</span><span class="p">,</span> <span class="s1">&#39;--all-types&#39;</span><span class="p">,</span> <span class="n">is_flag</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Show groups of all types&quot;</span><span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
    <span class="s1">&#39;-t&#39;</span><span class="p">,</span>
    <span class="s1">&#39;--type&#39;</span><span class="p">,</span>
    <span class="s1">&#39;group_type&#39;</span><span class="p">,</span>
    <span class="nb">type</span><span class="o">=</span><span class="n">types</span><span class="o">.</span><span class="n">LazyChoice</span><span class="p">(</span><span class="n">valid_group_type_strings</span><span class="p">),</span>
    <span class="n">default</span><span class="o">=</span><span class="n">user_defined_group</span><span class="p">,</span>
    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Show groups of a specific type, instead of user-defined groups. Start with semicolumn if you want to &quot;</span>
    <span class="s2">&quot;specify aiida-internal type&quot;</span><span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
    <span class="s1">&#39;-d&#39;</span><span class="p">,</span> <span class="s1">&#39;--with-description&#39;</span><span class="p">,</span> <span class="s1">&#39;with_description&#39;</span><span class="p">,</span> <span class="n">is_flag</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Show also the group description&quot;</span><span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s1">&#39;-C&#39;</span><span class="p">,</span> <span class="s1">&#39;--count&#39;</span><span class="p">,</span> <span class="n">is_flag</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Show also the number of nodes in the group&quot;</span><span class="p">)</span>
<span class="nd">@options</span><span class="o">.</span><span class="n">PAST_DAYS</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s2">&quot;add a filter to show only groups created in the past N days&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
    <span class="s1">&#39;-s&#39;</span><span class="p">,</span>
    <span class="s1">&#39;--startswith&#39;</span><span class="p">,</span>
    <span class="nb">type</span><span class="o">=</span><span class="n">click</span><span class="o">.</span><span class="n">STRING</span><span class="p">,</span>
    <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;add a filter to show only groups for which the name begins with STRING&quot;</span><span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
    <span class="s1">&#39;-e&#39;</span><span class="p">,</span>
    <span class="s1">&#39;--endswith&#39;</span><span class="p">,</span>
    <span class="nb">type</span><span class="o">=</span><span class="n">click</span><span class="o">.</span><span class="n">STRING</span><span class="p">,</span>
    <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;add a filter to show only groups for which the name ends with STRING&quot;</span><span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
    <span class="s1">&#39;-c&#39;</span><span class="p">,</span>
    <span class="s1">&#39;--contains&#39;</span><span class="p">,</span>
    <span class="nb">type</span><span class="o">=</span><span class="n">click</span><span class="o">.</span><span class="n">STRING</span><span class="p">,</span>
    <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;add a filter to show only groups for which the name contains STRING&quot;</span><span class="p">)</span>
<span class="nd">@options</span><span class="o">.</span><span class="n">NODE</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s2">&quot;Show only the groups that contain the node&quot;</span><span class="p">)</span>
<span class="nd">@with_dbenv</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">group_list</span><span class="p">(</span><span class="n">all_users</span><span class="p">,</span> <span class="n">user_email</span><span class="p">,</span> <span class="n">all_types</span><span class="p">,</span> <span class="n">group_type</span><span class="p">,</span> <span class="n">with_description</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">past_days</span><span class="p">,</span> <span class="n">startswith</span><span class="p">,</span> <span class="n">endswith</span><span class="p">,</span>
               <span class="n">contains</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Show a list of groups.&quot;&quot;&quot;</span>
    <span class="c1"># pylint: disable=too-many-branches,too-many-arguments, too-many-locals</span>
    <span class="kn">import</span> <span class="nn">datetime</span>
    <span class="kn">from</span> <span class="nn">aiida.common.escaping</span> <span class="k">import</span> <span class="n">escape_for_sql_like</span>
    <span class="kn">from</span> <span class="nn">aiida.common</span> <span class="k">import</span> <span class="n">timezone</span>
    <span class="kn">from</span> <span class="nn">aiida.orm</span> <span class="k">import</span> <span class="n">Group</span>
    <span class="kn">from</span> <span class="nn">aiida.orm</span> <span class="k">import</span> <span class="n">QueryBuilder</span>
    <span class="kn">from</span> <span class="nn">aiida.orm</span> <span class="k">import</span> <span class="n">User</span>
    <span class="kn">from</span> <span class="nn">aiida</span> <span class="k">import</span> <span class="n">orm</span>
    <span class="kn">from</span> <span class="nn">tabulate</span> <span class="k">import</span> <span class="n">tabulate</span>

    <span class="n">query</span> <span class="o">=</span> <span class="n">QueryBuilder</span><span class="p">()</span>
    <span class="n">filters</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Specify group types</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">all_types</span><span class="p">:</span>
        <span class="n">filters</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;type_string&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;==&#39;</span><span class="p">:</span> <span class="n">group_type</span><span class="p">}}</span>

    <span class="c1"># Creation time</span>
    <span class="k">if</span> <span class="n">past_days</span><span class="p">:</span>
        <span class="n">filters</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;&gt;&#39;</span><span class="p">:</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">past_days</span><span class="p">)}</span>

    <span class="c1"># Query for specific group names</span>
    <span class="n">filters</span><span class="p">[</span><span class="s1">&#39;or&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">startswith</span><span class="p">:</span>
        <span class="n">filters</span><span class="p">[</span><span class="s1">&#39;or&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;like&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">%&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">escape_for_sql_like</span><span class="p">(</span><span class="n">startswith</span><span class="p">))}})</span>
    <span class="k">if</span> <span class="n">endswith</span><span class="p">:</span>
        <span class="n">filters</span><span class="p">[</span><span class="s1">&#39;or&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;like&#39;</span><span class="p">:</span> <span class="s1">&#39;%</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">escape_for_sql_like</span><span class="p">(</span><span class="n">endswith</span><span class="p">))}})</span>
    <span class="k">if</span> <span class="n">contains</span><span class="p">:</span>
        <span class="n">filters</span><span class="p">[</span><span class="s1">&#39;or&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;like&#39;</span><span class="p">:</span> <span class="s1">&#39;%</span><span class="si">{}</span><span class="s1">%&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">escape_for_sql_like</span><span class="p">(</span><span class="n">contains</span><span class="p">))}})</span>

    <span class="n">query</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Group</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="n">filters</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;group&#39;</span><span class="p">,</span> <span class="n">project</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">)</span>

    <span class="c1"># Query groups that belong to specific user</span>
    <span class="k">if</span> <span class="n">user_email</span><span class="p">:</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">user_email</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># By default: only groups of this user</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">orm</span><span class="o">.</span><span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_default</span><span class="p">()</span><span class="o">.</span><span class="n">email</span>

    <span class="c1"># Query groups that belong to all users</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">all_users</span><span class="p">:</span>
        <span class="n">query</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;email&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;==&#39;</span><span class="p">:</span> <span class="n">user</span><span class="p">}},</span> <span class="n">with_group</span><span class="o">=</span><span class="s1">&#39;group&#39;</span><span class="p">)</span>

    <span class="c1"># Query groups that contain a particular node</span>
    <span class="k">if</span> <span class="n">node</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">aiida.orm</span> <span class="k">import</span> <span class="n">Node</span>
        <span class="n">query</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Node</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;==&#39;</span><span class="p">:</span> <span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="p">}},</span> <span class="n">with_group</span><span class="o">=</span><span class="s1">&#39;group&#39;</span><span class="p">)</span>

    <span class="n">query</span><span class="o">.</span><span class="n">order_by</span><span class="p">({</span><span class="n">Group</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;asc&#39;</span><span class="p">}})</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

    <span class="n">projection_lambdas</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;pk&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">group</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">group</span><span class="o">.</span><span class="n">pk</span><span class="p">),</span>
        <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">group</span><span class="p">:</span> <span class="n">group</span><span class="o">.</span><span class="n">label</span><span class="p">,</span>
        <span class="s1">&#39;type_string&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">group</span><span class="p">:</span> <span class="n">group</span><span class="o">.</span><span class="n">type_string</span><span class="p">,</span>
        <span class="s1">&#39;count&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">group</span><span class="p">:</span> <span class="n">group</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span>
        <span class="s1">&#39;user&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">group</span><span class="p">:</span> <span class="n">group</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span>
        <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">group</span><span class="p">:</span> <span class="n">group</span><span class="o">.</span><span class="n">description</span>
    <span class="p">}</span>

    <span class="n">table</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">projection_header</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;PK&#39;</span><span class="p">,</span> <span class="s1">&#39;Label&#39;</span><span class="p">,</span> <span class="s1">&#39;Type string&#39;</span><span class="p">,</span> <span class="s1">&#39;User&#39;</span><span class="p">]</span>
    <span class="n">projection_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;pk&#39;</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">,</span> <span class="s1">&#39;type_string&#39;</span><span class="p">,</span> <span class="s1">&#39;user&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">with_description</span><span class="p">:</span>
        <span class="n">projection_header</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Description&#39;</span><span class="p">)</span>
        <span class="n">projection_fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;description&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">count</span><span class="p">:</span>
        <span class="n">projection_header</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Node count&#39;</span><span class="p">)</span>
        <span class="n">projection_fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
        <span class="n">table</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">projection_lambdas</span><span class="p">[</span><span class="n">field</span><span class="p">](</span><span class="n">group</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">projection_fields</span><span class="p">])</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">all_types</span><span class="p">:</span>
        <span class="n">echo</span><span class="o">.</span><span class="n">echo_info</span><span class="p">(</span><span class="s2">&quot;If you want to see the groups of all types, please add -a/--all-types option&quot;</span><span class="p">)</span>
    <span class="n">echo</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="n">tabulate</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">projection_header</span><span class="p">))</span>


<span class="nd">@verdi_group</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;create&#39;</span><span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">argument</span><span class="p">(</span><span class="s1">&#39;group_label&#39;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">click</span><span class="o">.</span><span class="n">STRING</span><span class="p">)</span>
<span class="nd">@with_dbenv</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">group_create</span><span class="p">(</span><span class="n">group_label</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Create a new empty group with the name GROUP_NAME.&quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">aiida</span> <span class="k">import</span> <span class="n">orm</span>
    <span class="kn">from</span> <span class="nn">aiida.orm</span> <span class="k">import</span> <span class="n">GroupTypeString</span>

    <span class="n">group</span><span class="p">,</span> <span class="n">created</span> <span class="o">=</span> <span class="n">orm</span><span class="o">.</span><span class="n">Group</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_or_create</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">group_label</span><span class="p">,</span> <span class="n">type_string</span><span class="o">=</span><span class="n">GroupTypeString</span><span class="o">.</span><span class="n">USER</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">created</span><span class="p">:</span>
        <span class="n">echo</span><span class="o">.</span><span class="n">echo_success</span><span class="p">(</span><span class="s2">&quot;Group created with PK = </span><span class="si">{}</span><span class="s2"> and name &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">group</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">group</span><span class="o">.</span><span class="n">label</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">echo</span><span class="o">.</span><span class="n">echo_info</span><span class="p">(</span><span class="s2">&quot;Group &#39;</span><span class="si">{}</span><span class="s2">&#39; already exists, PK = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">group</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="n">group</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>


<span class="nd">@verdi_group</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;copy&#39;</span><span class="p">)</span>
<span class="nd">@arguments</span><span class="o">.</span><span class="n">GROUP</span><span class="p">(</span><span class="s1">&#39;source_group&#39;</span><span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">argument</span><span class="p">(</span><span class="s1">&#39;destination_group&#39;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">click</span><span class="o">.</span><span class="n">STRING</span><span class="p">)</span>
<span class="nd">@with_dbenv</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">group_copy</span><span class="p">(</span><span class="n">source_group</span><span class="p">,</span> <span class="n">destination_group</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Add all nodes that belong to source group to the destination group (which may or may not exist).&quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">aiida</span> <span class="k">import</span> <span class="n">orm</span>

    <span class="n">dest_group</span><span class="p">,</span> <span class="n">created</span> <span class="o">=</span> <span class="n">orm</span><span class="o">.</span><span class="n">Group</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_or_create</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">destination_group</span><span class="p">,</span> <span class="n">type_string</span><span class="o">=</span><span class="n">source_group</span><span class="o">.</span><span class="n">type_string</span><span class="p">)</span>

    <span class="c1"># Issue warning if destination group is not empty and get user confirmation to continue</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">created</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">dest_group</span><span class="o">.</span><span class="n">is_empty</span><span class="p">:</span>
        <span class="n">echo</span><span class="o">.</span><span class="n">echo_warning</span><span class="p">(</span><span class="s1">&#39;Destination group&lt;</span><span class="si">{}</span><span class="s1">&gt; already exists and is not empty.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dest_group</span><span class="o">.</span><span class="n">label</span><span class="p">))</span>
        <span class="n">click</span><span class="o">.</span><span class="n">confirm</span><span class="p">(</span><span class="s1">&#39;Do you wish to continue anyway?&#39;</span><span class="p">,</span> <span class="n">abort</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Copy nodes</span>
    <span class="n">dest_group</span><span class="o">.</span><span class="n">add_nodes</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">source_group</span><span class="o">.</span><span class="n">nodes</span><span class="p">))</span>
    <span class="n">echo</span><span class="o">.</span><span class="n">echo_success</span><span class="p">(</span><span class="s1">&#39;Nodes copied from group&lt;</span><span class="si">{}</span><span class="s1">&gt; to group&lt;</span><span class="si">{}</span><span class="s1">&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">source_group</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="n">dest_group</span><span class="o">.</span><span class="n">label</span><span class="p">))</span>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, ECOLE POLYTECHNIQUE FEDERALE DE LAUSANNE (Theory and Simulation of Materials (THEOS) and National Centre for Computational Design and Discovery of Novel Materials (NCCR MARVEL)), Switzerland and ROBERT BOSCH LLC, USA. All rights reserved

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>