

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>aiida.manage.external.postgres &mdash; AiiDA 1.0.0b2 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../../_static/language_data.js"></script>
        <script type="text/javascript" src="../../../../_static/contentui.js"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/contentui.css" type="text/css" />
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../index.html" class="icon icon-home"> AiiDA
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Installation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../install/quick_installation.html">Quick installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../install/prerequisites.html">Prerequisites</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../install/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../install/updating_installation.html">Updating AiiDA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../install/troubleshooting.html">Troubleshooting</a></li>
</ul>
<p class="caption"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../get_started/index.html">First things first</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../get_started/daemon.html">Setup the daemon</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../get_started/computers.html">Setup a computer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../get_started/codes.html">Setup a code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../get_started/plugins.html">Plugins</a></li>
</ul>
<p class="caption"><span class="caption-text">Concepts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../concepts/provenance.html">Provenance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../concepts/processes.html">Processes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../concepts/calculations.html">Calculations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../concepts/workflows.html">Workflows</a></li>
</ul>
<p class="caption"><span class="caption-text">Working with</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../working/processes.html">Processes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working/functions.html">Calculation and work functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working/calculations.html">Calculations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working/workflows.html">Workflows</a></li>
</ul>
<p class="caption"><span class="caption-text">Working with AiiDA</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../working_with_aiida/index.html">Command line interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working_with_aiida/index.html#scripting">Scripting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working_with_aiida/index.html#data-types">Data types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working_with_aiida/index.html#groups">Groups</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working_with_aiida/index.html#schedulers">Schedulers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working_with_aiida/index.html#querying-data">Querying data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working_with_aiida/index.html#caching">Caching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working_with_aiida/index.html#result-manager">Result manager</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working_with_aiida/index.html#backups">Backups</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working_with_aiida/index.html#troubleshooting">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working_with_aiida/index.html#rest-api">REST API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working_with_aiida/index.html#cookbook">Cookbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../import_export/index.html">Import and Export</a></li>
</ul>
<p class="caption"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../developer_guide/index.html">AiiDA design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../developer_guide/index.html#aiida-core">AiiDA core</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../developer_guide/index.html#aiida-plugins">AiiDA plugins</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../tutorial/index.html">StructureData</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tutorial/index.html#pseudopotentials">Pseudopotentials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tutorial/index.html#plugin-development">Plugin development</a></li>
</ul>
<p class="caption"><span class="caption-text">API reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="`aiida package &lt;https://aiida-core.readthedocs.io/en/latest/apidoc/aiida.html&gt;`_">`aiida package &lt;https://aiida-core.readthedocs.io/en/latest/apidoc/aiida.html&gt;`_</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">AiiDA</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../../../aiida.html">aiida</a> &raquo;</li>
        
      <li>aiida.manage.external.postgres</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for aiida.manage.external.postgres</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1">###########################################################################</span>
<span class="c1"># Copyright (c), The AiiDA team. All rights reserved.                     #</span>
<span class="c1"># This file is part of the AiiDA code.                                    #</span>
<span class="c1">#                                                                         #</span>
<span class="c1"># The code is hosted on GitHub at https://github.com/aiidateam/aiida_core #</span>
<span class="c1"># For further information on the license, see the LICENSE.txt file        #</span>
<span class="c1"># For further information please visit http://www.aiida.net               #</span>
<span class="c1">###########################################################################</span>
<span class="sd">&quot;&quot;&quot;Provides an API for postgres database maintenance tasks.</span>

<span class="sd">This API creates and drops postgres users and databases used by the</span>
<span class="sd">``verdi quicksetup`` commandline tool. It allows convenient access to this</span>
<span class="sd">functionality from within python without knowing details about how postgres is</span>
<span class="sd">installed by default on various systems. If the postgres setup is not the</span>
<span class="sd">default installation, additional information needs to be provided.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">division</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">print_function</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">absolute_import</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Postgres&#39;</span><span class="p">,</span> <span class="s1">&#39;PostgresConnectionMode&#39;</span><span class="p">,</span> <span class="s1">&#39;DEFAULT_DBINFO&#39;</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">click</span>

<span class="kn">from</span> <span class="nn">aiida.cmdline.utils</span> <span class="k">import</span> <span class="n">echo</span>
<span class="kn">from</span> <span class="nn">.pgsu</span> <span class="k">import</span> <span class="n">PGSU</span><span class="p">,</span> <span class="n">PostgresConnectionMode</span><span class="p">,</span> <span class="n">DEFAULT_DBINFO</span>

<span class="n">_CREATE_USER_COMMAND</span> <span class="o">=</span> <span class="s1">&#39;CREATE USER &quot;</span><span class="si">{}</span><span class="s1">&quot; WITH PASSWORD </span><span class="se">\&#39;</span><span class="si">{}</span><span class="se">\&#39;</span><span class="s1">&#39;</span>
<span class="n">_DROP_USER_COMMAND</span> <span class="o">=</span> <span class="s1">&#39;DROP USER &quot;</span><span class="si">{}</span><span class="s1">&quot;&#39;</span>
<span class="n">_CREATE_DB_COMMAND</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;CREATE DATABASE &quot;</span><span class="si">{}</span><span class="s1">&quot; OWNER &quot;</span><span class="si">{}</span><span class="s1">&quot; ENCODING </span><span class="se">\&#39;</span><span class="s1">UTF8</span><span class="se">\&#39;</span><span class="s1"> &#39;</span>
                      <span class="s1">&#39;LC_COLLATE=</span><span class="se">\&#39;</span><span class="s1">en_US.UTF-8</span><span class="se">\&#39;</span><span class="s1"> LC_CTYPE=</span><span class="se">\&#39;</span><span class="s1">en_US.UTF-8</span><span class="se">\&#39;</span><span class="s1"> &#39;</span>
                      <span class="s1">&#39;TEMPLATE=template0&#39;</span><span class="p">)</span>
<span class="n">_DROP_DB_COMMAND</span> <span class="o">=</span> <span class="s1">&#39;DROP DATABASE &quot;</span><span class="si">{}</span><span class="s1">&quot;&#39;</span>
<span class="n">_GRANT_PRIV_COMMAND</span> <span class="o">=</span> <span class="s1">&#39;GRANT ALL PRIVILEGES ON DATABASE &quot;</span><span class="si">{}</span><span class="s1">&quot; TO &quot;</span><span class="si">{}</span><span class="s1">&quot;&#39;</span>
<span class="n">_GET_USERS_COMMAND</span> <span class="o">=</span> <span class="s2">&quot;SELECT usename FROM pg_user WHERE usename=&#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span>
<span class="n">_CHECK_DB_EXISTS_COMMAND</span> <span class="o">=</span> <span class="s2">&quot;SELECT datname FROM pg_database WHERE datname=&#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span>
<span class="n">_COPY_DB_COMMAND</span> <span class="o">=</span> <span class="s1">&#39;CREATE DATABASE &quot;</span><span class="si">{}</span><span class="s1">&quot; WITH TEMPLATE &quot;</span><span class="si">{}</span><span class="s1">&quot; OWNER &quot;</span><span class="si">{}</span><span class="s1">&quot;&#39;</span>


<div class="viewcode-block" id="Postgres"><a class="viewcode-back" href="../../../../apidoc/aiida.manage.external.html#aiida.manage.external.postgres.Postgres">[docs]</a><span class="k">class</span> <span class="nc">Postgres</span><span class="p">(</span><span class="n">PGSU</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adds convenience functions to pgsu.Postgres.</span>

<span class="sd">    Provides conenience functions for</span>
<span class="sd">      * creating/dropping users</span>
<span class="sd">      * creating/dropping databases</span>

<span class="sd">    etc. See pgsu.Postgres for implementation details.</span>

<span class="sd">    Example::</span>

<span class="sd">        postgres = Postgres()</span>
<span class="sd">        postgres.create_dbuser(&#39;username&#39;, &#39;password&#39;)</span>
<span class="sd">        if not postgres.db_exists(&#39;dbname&#39;):</span>
<span class="sd">            postgres.create_db(&#39;username&#39;, &#39;dbname&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Postgres.from_profile"><a class="viewcode-back" href="../../../../apidoc/aiida.manage.external.html#aiida.manage.external.postgres.Postgres.from_profile">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_profile</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">profile</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create Postgres instance with dbinfo from AiiDA profile data.</span>

<span class="sd">        Note: This only uses host and port from the profile, since the others are not going to be relevant for the</span>
<span class="sd">          database superuser.</span>

<span class="sd">        :param profile: AiiDA profile instance</span>
<span class="sd">        :param kwargs: keyword arguments forwarded to Postgres constructor</span>

<span class="sd">        :returns: Postgres instance pre-populated with data from AiiDA profile</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dbinfo</span> <span class="o">=</span> <span class="n">DEFAULT_DBINFO</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="n">get</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">dictionary</span><span class="o">.</span><span class="n">get</span>
        <span class="n">dbinfo</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="nb">dict</span><span class="p">(</span>
                <span class="n">host</span><span class="o">=</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;AIIDADB_HOST&#39;</span><span class="p">,</span> <span class="n">DEFAULT_DBINFO</span><span class="p">[</span><span class="s1">&#39;host&#39;</span><span class="p">]),</span>
                <span class="n">port</span><span class="o">=</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;AIIDADB_PORT&#39;</span><span class="p">,</span> <span class="n">DEFAULT_DBINFO</span><span class="p">[</span><span class="s1">&#39;port&#39;</span><span class="p">]),</span>
            <span class="p">))</span>
        <span class="k">return</span> <span class="n">Postgres</span><span class="p">(</span><span class="n">dbinfo</span><span class="o">=</span><span class="n">dbinfo</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="Postgres.check_db_name"><a class="viewcode-back" href="../../../../apidoc/aiida.manage.external.html#aiida.manage.external.postgres.Postgres.check_db_name">[docs]</a>    <span class="k">def</span> <span class="nf">check_db_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dbname</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Looks up if a database with the name exists, prompts for using or creating a differently named one.&quot;&quot;&quot;</span>
        <span class="n">create</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">while</span> <span class="n">create</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_exists</span><span class="p">(</span><span class="n">dbname</span><span class="p">):</span>
            <span class="n">echo</span><span class="o">.</span><span class="n">echo_info</span><span class="p">(</span><span class="s1">&#39;database </span><span class="si">{}</span><span class="s1"> already exists!&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dbname</span><span class="p">))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">click</span><span class="o">.</span><span class="n">confirm</span><span class="p">(</span><span class="s1">&#39;Use it (make sure it is not used by another profile)?&#39;</span><span class="p">):</span>
                <span class="n">dbname</span> <span class="o">=</span> <span class="n">click</span><span class="o">.</span><span class="n">prompt</span><span class="p">(</span><span class="s1">&#39;new name&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">dbname</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">create</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="n">dbname</span><span class="p">,</span> <span class="n">create</span></div>

<div class="viewcode-block" id="Postgres.create_dbuser"><a class="viewcode-back" href="../../../../apidoc/aiida.manage.external.html#aiida.manage.external.postgres.Postgres.create_dbuser">[docs]</a>    <span class="k">def</span> <span class="nf">create_dbuser</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dbuser</span><span class="p">,</span> <span class="n">dbpass</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a database user in postgres</span>

<span class="sd">        :param dbuser: (str), Name of the user to be created.</span>
<span class="sd">        :param dbpass: (str), Password the user should be given.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">_CREATE_USER_COMMAND</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dbuser</span><span class="p">,</span> <span class="n">dbpass</span><span class="p">))</span></div>

<div class="viewcode-block" id="Postgres.drop_dbuser"><a class="viewcode-back" href="../../../../apidoc/aiida.manage.external.html#aiida.manage.external.postgres.Postgres.drop_dbuser">[docs]</a>    <span class="k">def</span> <span class="nf">drop_dbuser</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dbuser</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Drop a database user in postgres</span>

<span class="sd">        :param dbuser: (str), Name of the user to be dropped.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">_DROP_USER_COMMAND</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dbuser</span><span class="p">))</span></div>

<div class="viewcode-block" id="Postgres.dbuser_exists"><a class="viewcode-back" href="../../../../apidoc/aiida.manage.external.html#aiida.manage.external.postgres.Postgres.dbuser_exists">[docs]</a>    <span class="k">def</span> <span class="nf">dbuser_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dbuser</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find out if postgres user with name dbuser exists</span>

<span class="sd">        :param dbuser: (str) database user to check for</span>
<span class="sd">        :return: (bool) True if user exists, False otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">_GET_USERS_COMMAND</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dbuser</span><span class="p">)))</span></div>

<div class="viewcode-block" id="Postgres.create_db"><a class="viewcode-back" href="../../../../apidoc/aiida.manage.external.html#aiida.manage.external.postgres.Postgres.create_db">[docs]</a>    <span class="k">def</span> <span class="nf">create_db</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dbuser</span><span class="p">,</span> <span class="n">dbname</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a database in postgres</span>

<span class="sd">        :param dbuser: (str), Name of the user which should own the db.</span>
<span class="sd">        :param dbname: (str), Name of the database.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">_CREATE_DB_COMMAND</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dbname</span><span class="p">,</span> <span class="n">dbuser</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">_GRANT_PRIV_COMMAND</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dbname</span><span class="p">,</span> <span class="n">dbuser</span><span class="p">))</span></div>

<div class="viewcode-block" id="Postgres.drop_db"><a class="viewcode-back" href="../../../../apidoc/aiida.manage.external.html#aiida.manage.external.postgres.Postgres.drop_db">[docs]</a>    <span class="k">def</span> <span class="nf">drop_db</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dbname</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Drop a database in postgres</span>

<span class="sd">        :param dbname: (str), Name of the database.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">_DROP_DB_COMMAND</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dbname</span><span class="p">))</span></div>

<div class="viewcode-block" id="Postgres.copy_db"><a class="viewcode-back" href="../../../../apidoc/aiida.manage.external.html#aiida.manage.external.postgres.Postgres.copy_db">[docs]</a>    <span class="k">def</span> <span class="nf">copy_db</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">src_db</span><span class="p">,</span> <span class="n">dest_db</span><span class="p">,</span> <span class="n">dbuser</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">_COPY_DB_COMMAND</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dest_db</span><span class="p">,</span> <span class="n">src_db</span><span class="p">,</span> <span class="n">dbuser</span><span class="p">))</span></div>

<div class="viewcode-block" id="Postgres.db_exists"><a class="viewcode-back" href="../../../../apidoc/aiida.manage.external.html#aiida.manage.external.postgres.Postgres.db_exists">[docs]</a>    <span class="k">def</span> <span class="nf">db_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dbname</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check wether a postgres database with dbname exists</span>

<span class="sd">        :param dbname: Name of the database to check for</span>
<span class="sd">        :return: (bool), True if database exists, False otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">_CHECK_DB_EXISTS_COMMAND</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dbname</span><span class="p">)))</span></div></div>


<span class="k">def</span> <span class="nf">manual_setup_instructions</span><span class="p">(</span><span class="n">dbuser</span><span class="p">,</span> <span class="n">dbname</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Create a message with instructions for manually creating a database&quot;&quot;&quot;</span>
    <span class="n">dbpass</span> <span class="o">=</span> <span class="s1">&#39;&lt;password&gt;&#39;</span>
    <span class="n">instructions</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
        <span class="s1">&#39;Please run the following commands as the user for PostgreSQL (Ubuntu: $sudo su postgres):&#39;</span><span class="p">,</span>
        <span class="s1">&#39;&#39;</span><span class="p">,</span>
        <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">$ psql template1&#39;</span><span class="p">,</span>
        <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">==&gt; &#39;</span> <span class="o">+</span> <span class="n">_CREATE_USER_COMMAND</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dbuser</span><span class="p">,</span> <span class="n">dbpass</span><span class="p">),</span>
        <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">==&gt; &#39;</span> <span class="o">+</span> <span class="n">_CREATE_DB_COMMAND</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dbname</span><span class="p">,</span> <span class="n">dbuser</span><span class="p">),</span>
        <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">==&gt; &#39;</span> <span class="o">+</span> <span class="n">_GRANT_PRIV_COMMAND</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dbname</span><span class="p">,</span> <span class="n">dbuser</span><span class="p">),</span>
    <span class="p">])</span>
    <span class="k">return</span> <span class="n">instructions</span>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, ECOLE POLYTECHNIQUE FEDERALE DE LAUSANNE (Theory and Simulation of Materials (THEOS) and National Centre for Computational Design and Discovery of Novel Materials (NCCR MARVEL)), Switzerland and ROBERT BOSCH LLC, USA. All rights reserved

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>