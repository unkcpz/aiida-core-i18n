

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>aiida.schedulers.scheduler &mdash; AiiDA 1.0.0b2 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../_static/language_data.js"></script>
        <script type="text/javascript" src="../../../_static/contentui.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/contentui.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> AiiDA
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Installation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../install/quick_installation.html">Quick installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../install/prerequisites.html">Prerequisites</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../install/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../install/updating_installation.html">Updating AiiDA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../install/troubleshooting.html">Troubleshooting</a></li>
</ul>
<p class="caption"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../get_started/index.html">First things first</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../get_started/daemon.html">Setup the daemon</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../get_started/computers.html">Setup a computer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../get_started/codes.html">Setup a code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../get_started/plugins.html">Plugins</a></li>
</ul>
<p class="caption"><span class="caption-text">Concepts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../concepts/provenance.html">Provenance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../concepts/processes.html">Processes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../concepts/calculations.html">Calculations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../concepts/workflows.html">Workflows</a></li>
</ul>
<p class="caption"><span class="caption-text">Working with</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../working/processes.html">Processes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../working/functions.html">Calculation and work functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../working/calculations.html">Calculations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../working/workflows.html">Workflows</a></li>
</ul>
<p class="caption"><span class="caption-text">Working with AiiDA</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../working_with_aiida/index.html">Command line interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../working_with_aiida/index.html#scripting">Scripting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../working_with_aiida/index.html#data-types">Data types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../working_with_aiida/index.html#groups">Groups</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../working_with_aiida/index.html#schedulers">Schedulers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../working_with_aiida/index.html#querying-data">Querying data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../working_with_aiida/index.html#caching">Caching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../working_with_aiida/index.html#result-manager">Result manager</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../working_with_aiida/index.html#backups">Backups</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../working_with_aiida/index.html#troubleshooting">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../working_with_aiida/index.html#rest-api">REST API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../working_with_aiida/index.html#cookbook">Cookbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../import_export/index.html">Import and Export</a></li>
</ul>
<p class="caption"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../developer_guide/index.html">AiiDA design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developer_guide/index.html#aiida-core">AiiDA core</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developer_guide/index.html#aiida-plugins">AiiDA plugins</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorial/index.html">StructureData</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorial/index.html#pseudopotentials">Pseudopotentials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorial/index.html#plugin-development">Plugin development</a></li>
</ul>
<p class="caption"><span class="caption-text">API reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="`aiida package &lt;https://aiida-core.readthedocs.io/en/latest/apidoc/aiida.html&gt;`_">`aiida package &lt;https://aiida-core.readthedocs.io/en/latest/apidoc/aiida.html&gt;`_</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">AiiDA</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../../aiida.html">aiida</a> &raquo;</li>
        
      <li>aiida.schedulers.scheduler</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for aiida.schedulers.scheduler</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1">###########################################################################</span>
<span class="c1"># Copyright (c), The AiiDA team. All rights reserved.                     #</span>
<span class="c1"># This file is part of the AiiDA code.                                    #</span>
<span class="c1">#                                                                         #</span>
<span class="c1"># The code is hosted on GitHub at https://github.com/aiidateam/aiida_core #</span>
<span class="c1"># For further information on the license, see the LICENSE.txt file        #</span>
<span class="c1"># For further information please visit http://www.aiida.net               #</span>
<span class="c1">###########################################################################</span>
<span class="sd">&quot;&quot;&quot;Implementation of `Scheduler` base class.&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">division</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">print_function</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">absolute_import</span>

<span class="kn">from</span> <span class="nn">abc</span> <span class="k">import</span> <span class="n">ABCMeta</span><span class="p">,</span> <span class="n">abstractmethod</span>
<span class="kn">import</span> <span class="nn">six</span>

<span class="kn">import</span> <span class="nn">aiida.common</span>
<span class="kn">from</span> <span class="nn">aiida.common.lang</span> <span class="k">import</span> <span class="n">classproperty</span>
<span class="kn">from</span> <span class="nn">aiida.common.escaping</span> <span class="k">import</span> <span class="n">escape_for_bash</span>
<span class="kn">from</span> <span class="nn">aiida.common.exceptions</span> <span class="k">import</span> <span class="n">AiidaException</span><span class="p">,</span> <span class="n">FeatureNotAvailable</span>
<span class="kn">from</span> <span class="nn">aiida.schedulers.datastructures</span> <span class="k">import</span> <span class="n">JobTemplate</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Scheduler&#39;</span><span class="p">,</span> <span class="s1">&#39;SchedulerError&#39;</span><span class="p">,</span> <span class="s1">&#39;SchedulerParsingError&#39;</span><span class="p">)</span>


<div class="viewcode-block" id="SchedulerError"><a class="viewcode-back" href="../../../apidoc/aiida.schedulers.html#aiida.schedulers.SchedulerError">[docs]</a><span class="k">class</span> <span class="nc">SchedulerError</span><span class="p">(</span><span class="n">AiidaException</span><span class="p">):</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="SchedulerParsingError"><a class="viewcode-back" href="../../../apidoc/aiida.schedulers.html#aiida.schedulers.SchedulerParsingError">[docs]</a><span class="k">class</span> <span class="nc">SchedulerParsingError</span><span class="p">(</span><span class="n">SchedulerError</span><span class="p">):</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="Scheduler"><a class="viewcode-back" href="../../../apidoc/aiida.schedulers.html#aiida.schedulers.Scheduler">[docs]</a><span class="nd">@six</span><span class="o">.</span><span class="n">add_metaclass</span><span class="p">(</span><span class="n">ABCMeta</span><span class="p">)</span>  <span class="c1"># pylint: disable=useless-object-inheritance</span>
<span class="k">class</span> <span class="nc">Scheduler</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for all schedulers.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_logger</span> <span class="o">=</span> <span class="n">aiida</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">AIIDA_LOGGER</span><span class="o">.</span><span class="n">getChild</span><span class="p">(</span><span class="s1">&#39;scheduler&#39;</span><span class="p">)</span>

    <span class="c1"># A list of features</span>
    <span class="c1"># Features that should be defined in the plugins:</span>
    <span class="c1"># &#39;can_query_by_user&#39;: True if I can pass the &#39;user&#39; argument to</span>
    <span class="c1"># get_joblist_command (and in this case, no &#39;jobs&#39; should be given).</span>
    <span class="c1"># Otherwise, if False, a list of jobs is passed, and no &#39;user&#39; is given.</span>
    <span class="n">_features</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># The class to be used for the job resource.</span>
    <span class="n">_job_resource_class</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="Scheduler.__init__"><a class="viewcode-back" href="../../../apidoc/aiida.schedulers.html#aiida.schedulers.Scheduler.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_transport</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Scheduler.set_transport"><a class="viewcode-back" href="../../../apidoc/aiida.schedulers.html#aiida.schedulers.Scheduler.set_transport">[docs]</a>    <span class="k">def</span> <span class="nf">set_transport</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transport</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the transport to be used to query the machine or to submit scripts.</span>
<span class="sd">        This class assumes that the transport is open and active.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_transport</span> <span class="o">=</span> <span class="n">transport</span></div>

<div class="viewcode-block" id="Scheduler.get_valid_schedulers"><a class="viewcode-back" href="../../../apidoc/aiida.schedulers.html#aiida.schedulers.Scheduler.get_valid_schedulers">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_valid_schedulers</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">aiida.plugins.entry_point</span> <span class="k">import</span> <span class="n">get_entry_point_names</span>

        <span class="k">return</span> <span class="n">get_entry_point_names</span><span class="p">(</span><span class="s1">&#39;aiida.schedulers&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Scheduler.get_short_doc"><a class="viewcode-back" href="../../../apidoc/aiida.schedulers.html#aiida.schedulers.Scheduler.get_short_doc">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_short_doc</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the first non-empty line of the class docstring, if available</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Remove empty lines</span>
        <span class="n">docstring</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__doc__</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">docstring</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;No documentation available&quot;</span>

        <span class="n">doclines</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">docstring</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span> <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span>
        <span class="k">if</span> <span class="n">doclines</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">doclines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="k">return</span> <span class="s2">&quot;No documentation available&quot;</span></div>

<div class="viewcode-block" id="Scheduler.get_feature"><a class="viewcode-back" href="../../../apidoc/aiida.schedulers.html#aiida.schedulers.Scheduler.get_feature">[docs]</a>    <span class="k">def</span> <span class="nf">get_feature</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feature_name</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_features</span><span class="p">[</span><span class="n">feature_name</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Feature </span><span class="si">{}</span><span class="s2"> not implemented for this scheduler&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">feature_name</span><span class="p">))</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">logger</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the internal logger.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">aiida.common.exceptions</span> <span class="k">import</span> <span class="n">InternalError</span>

            <span class="k">raise</span> <span class="n">InternalError</span><span class="p">(</span><span class="s2">&quot;No self._logger configured for </span><span class="si">{}</span><span class="s2">!&quot;</span><span class="p">)</span>

    <span class="nd">@classproperty</span>
    <span class="k">def</span> <span class="nf">job_resource_class</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_job_resource_class</span>

<div class="viewcode-block" id="Scheduler.create_job_resource"><a class="viewcode-back" href="../../../apidoc/aiida.schedulers.html#aiida.schedulers.Scheduler.create_job_resource">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">create_job_resource</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a suitable job resource from the kwargs specified</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># pylint: disable=not-callable</span>

        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_job_resource_class</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_job_resource_class</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="Scheduler.get_submit_script"><a class="viewcode-back" href="../../../apidoc/aiida.schedulers.html#aiida.schedulers.Scheduler.get_submit_script">[docs]</a>    <span class="k">def</span> <span class="nf">get_submit_script</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job_tmpl</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the submit script as a string.</span>
<span class="sd">        :parameter job_tmpl: a aiida.schedulers.datastrutures.JobTemplate object.</span>

<span class="sd">        The plugin returns something like</span>

<span class="sd">        #!/bin/bash &lt;- this shebang line is configurable to some extent</span>
<span class="sd">        scheduler_dependent stuff to choose numnodes, numcores, walltime, ...</span>
<span class="sd">        prepend_computer [also from calcinfo, joined with the following?]</span>
<span class="sd">        prepend_code [from calcinfo]</span>
<span class="sd">        output of _get_script_main_content</span>
<span class="sd">        postpend_code</span>
<span class="sd">        postpend_computer</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="kn">from</span> <span class="nn">aiida.common.exceptions</span> <span class="k">import</span> <span class="n">InternalError</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">job_tmpl</span><span class="p">,</span> <span class="n">JobTemplate</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">InternalError</span><span class="p">(</span><span class="s2">&quot;job_tmpl should be of type JobTemplate&quot;</span><span class="p">)</span>

        <span class="n">empty_line</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="c1"># I fill the list with the lines, and finally join them and return</span>
        <span class="n">script_lines</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">job_tmpl</span><span class="o">.</span><span class="n">shebang</span><span class="p">:</span>
            <span class="n">script_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">job_tmpl</span><span class="o">.</span><span class="n">shebang</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">job_tmpl</span><span class="o">.</span><span class="n">shebang</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="c1"># Here I check whether the shebang was set explicitly as an empty line.</span>
            <span class="c1"># In such a case, the first line is empty, if that&#39;s what the user wants:</span>
            <span class="n">script_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">job_tmpl</span><span class="o">.</span><span class="n">shebang</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">job_tmpl</span><span class="o">.</span><span class="n">shebang</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">script_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;#!/bin/bash&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid shebang set: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">job_tmpl</span><span class="o">.</span><span class="n">shebang</span><span class="p">))</span>
        <span class="n">script_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_submit_script_header</span><span class="p">(</span><span class="n">job_tmpl</span><span class="p">))</span>
        <span class="n">script_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">empty_line</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">job_tmpl</span><span class="o">.</span><span class="n">prepend_text</span><span class="p">:</span>
            <span class="n">script_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">job_tmpl</span><span class="o">.</span><span class="n">prepend_text</span><span class="p">)</span>
            <span class="n">script_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">empty_line</span><span class="p">)</span>

        <span class="n">script_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_run_line</span><span class="p">(</span><span class="n">job_tmpl</span><span class="o">.</span><span class="n">codes_info</span><span class="p">,</span> <span class="n">job_tmpl</span><span class="o">.</span><span class="n">codes_run_mode</span><span class="p">))</span>
        <span class="n">script_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">empty_line</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">job_tmpl</span><span class="o">.</span><span class="n">append_text</span><span class="p">:</span>
            <span class="n">script_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">job_tmpl</span><span class="o">.</span><span class="n">append_text</span><span class="p">)</span>
            <span class="n">script_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">empty_line</span><span class="p">)</span>

        <span class="n">footer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_submit_script_footer</span><span class="p">(</span><span class="n">job_tmpl</span><span class="p">)</span>  <span class="c1"># pylint: disable=assignment-from-none</span>
        <span class="k">if</span> <span class="n">footer</span><span class="p">:</span>
            <span class="n">script_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">footer</span><span class="p">)</span>
            <span class="n">script_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">empty_line</span><span class="p">)</span>

        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">script_lines</span><span class="p">)</span></div>

<div class="viewcode-block" id="Scheduler._get_submit_script_header"><a class="viewcode-back" href="../../../apidoc/aiida.schedulers.html#aiida.schedulers.Scheduler._get_submit_script_header">[docs]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">_get_submit_script_header</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job_tmpl</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the submit script header, using the parameters from the</span>
<span class="sd">        job_tmpl.</span>

<span class="sd">        :param job_tmpl: a JobTemplate instance with relevant parameters set.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

<div class="viewcode-block" id="Scheduler._get_submit_script_footer"><a class="viewcode-back" href="../../../apidoc/aiida.schedulers.html#aiida.schedulers.Scheduler._get_submit_script_footer">[docs]</a>    <span class="k">def</span> <span class="nf">_get_submit_script_footer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job_tmpl</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the submit script final part, using the parameters from the</span>
<span class="sd">        job_tmpl.</span>

<span class="sd">        :param job_tmpl: a JobTemplate instance with relevant parameters set.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># pylint: disable=no-self-use, unused-argument</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Scheduler._get_run_line"><a class="viewcode-back" href="../../../apidoc/aiida.schedulers.html#aiida.schedulers.Scheduler._get_run_line">[docs]</a>    <span class="k">def</span> <span class="nf">_get_run_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">codes_info</span><span class="p">,</span> <span class="n">codes_run_mode</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a string with the line to execute a specific code with</span>
<span class="sd">        specific arguments.</span>

<span class="sd">        :parameter codes_info: a list of aiida.common.datastructures.CodeInfo</span>
<span class="sd">          objects. Each contains the information needed to run the code. I.e.</span>
<span class="sd">          cmdline_params, stdin_name, stdout_name, stderr_name, join_files.</span>
<span class="sd">          See the documentation of JobTemplate and CodeInfo</span>
<span class="sd">        :parameter codes_run_mode: contains the information on how to launch the</span>
<span class="sd">          multiple codes. As described in aiida.common.datastructures.CodeRunMode</span>


<span class="sd">            argv: an array with the executable and the command line arguments.</span>
<span class="sd">              The first argument is the executable. This should contain</span>
<span class="sd">              everything, including the mpirun command etc.</span>
<span class="sd">            stdin_name: the filename to be used as stdin, relative to the</span>
<span class="sd">              working dir, or None if no stdin redirection is required.</span>
<span class="sd">            stdout_name: the filename to be used to store the standard output,</span>
<span class="sd">              relative to the working dir,</span>
<span class="sd">              or None if no stdout redirection is required.</span>
<span class="sd">            stderr_name: the filename to be used to store the standard error,</span>
<span class="sd">              relative to the working dir,</span>
<span class="sd">              or None if no stderr redirection is required.</span>
<span class="sd">            join_files: if True, stderr is redirected to stdout; the value of</span>
<span class="sd">              stderr_name is ignored.</span>

<span class="sd">        Return a string with the following format:</span>
<span class="sd">        [executable] [args] {[ &lt; stdin ]} {[ &lt; stdout ]} {[2&gt;&amp;1 | 2&gt; stderr]}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">aiida.common.datastructures</span> <span class="k">import</span> <span class="n">CodeRunMode</span>

        <span class="n">list_of_runlines</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">code_info</span> <span class="ow">in</span> <span class="n">codes_info</span><span class="p">:</span>
            <span class="n">command_to_exec_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">code_info</span><span class="o">.</span><span class="n">cmdline_params</span><span class="p">:</span>
                <span class="n">command_to_exec_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">escape_for_bash</span><span class="p">(</span><span class="n">arg</span><span class="p">))</span>
            <span class="n">command_to_exec</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">command_to_exec_list</span><span class="p">)</span>

            <span class="n">stdin_str</span> <span class="o">=</span> <span class="s2">&quot;&lt; </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">escape_for_bash</span><span class="p">(</span><span class="n">code_info</span><span class="o">.</span><span class="n">stdin_name</span><span class="p">))</span> <span class="k">if</span> <span class="n">code_info</span><span class="o">.</span><span class="n">stdin_name</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
            <span class="n">stdout_str</span> <span class="o">=</span> <span class="s2">&quot;&gt; </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">escape_for_bash</span><span class="p">(</span><span class="n">code_info</span><span class="o">.</span><span class="n">stdout_name</span><span class="p">))</span> <span class="k">if</span> <span class="n">code_info</span><span class="o">.</span><span class="n">stdout_name</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>

            <span class="n">join_files</span> <span class="o">=</span> <span class="n">code_info</span><span class="o">.</span><span class="n">join_files</span>
            <span class="k">if</span> <span class="n">join_files</span><span class="p">:</span>
                <span class="n">stderr_str</span> <span class="o">=</span> <span class="s2">&quot;2&gt;&amp;1&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">stderr_str</span> <span class="o">=</span> <span class="s2">&quot;2&gt; </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">escape_for_bash</span><span class="p">(</span><span class="n">code_info</span><span class="o">.</span><span class="n">stderr_name</span><span class="p">))</span> <span class="k">if</span> <span class="n">code_info</span><span class="o">.</span><span class="n">stderr_name</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>

            <span class="n">output_string</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">command_to_exec</span><span class="p">,</span> <span class="n">stdin_str</span><span class="p">,</span> <span class="n">stdout_str</span><span class="p">,</span> <span class="n">stderr_str</span><span class="p">))</span>

            <span class="n">list_of_runlines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output_string</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;_get_run_line output: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">list_of_runlines</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">codes_run_mode</span> <span class="o">==</span> <span class="n">CodeRunMode</span><span class="o">.</span><span class="n">PARALLEL</span><span class="p">:</span>
            <span class="n">list_of_runlines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;wait</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="s2">&quot; &amp;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">list_of_runlines</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">codes_run_mode</span> <span class="o">==</span> <span class="n">CodeRunMode</span><span class="o">.</span><span class="n">SERIAL</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">list_of_runlines</span><span class="p">)</span>

        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;Unrecognized code run mode&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Scheduler._get_joblist_command"><a class="viewcode-back" href="../../../apidoc/aiida.schedulers.html#aiida.schedulers.Scheduler._get_joblist_command">[docs]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">_get_joblist_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jobs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the qstat (or equivalent) command to run with the required</span>
<span class="sd">        command-line parameters to get the most complete description possible;</span>
<span class="sd">        also specifies the output format of qsub to be the one to be used</span>
<span class="sd">        by the parse_queue_output method.</span>

<span class="sd">        Must be implemented in the plugin.</span>

<span class="sd">        :param jobs: either None to get a list of all jobs in the machine,</span>
<span class="sd">               or a list of jobs.</span>
<span class="sd">        :param user: either None, or a string with the username (to show only</span>
<span class="sd">                     jobs of the specific user).</span>

<span class="sd">        Note: typically one can pass only either jobs or user, depending on the</span>
<span class="sd">            specific plugin. The choice can be done according to the value</span>
<span class="sd">            returned by self.get_feature(&#39;can_query_by_user&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

<div class="viewcode-block" id="Scheduler._get_detailed_jobinfo_command"><a class="viewcode-back" href="../../../apidoc/aiida.schedulers.html#aiida.schedulers.Scheduler._get_detailed_jobinfo_command">[docs]</a>    <span class="k">def</span> <span class="nf">_get_detailed_jobinfo_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jobid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the command to run to get the detailed information on a job.</span>
<span class="sd">        This is typically called after the job has finished, to retrieve</span>
<span class="sd">        the most detailed information possible about the job. This is done</span>
<span class="sd">        because most schedulers just make finished jobs disappear from the</span>
<span class="sd">        &#39;qstat&#39; command, and instead sometimes it is useful to know some</span>
<span class="sd">        more detailed information about the job exit status, etc.</span>

<span class="sd">        :raises: :class:`aiida.common.exceptions.FeatureNotAvailable`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># pylint: disable=no-self-use, not-callable, unused-argument</span>
        <span class="k">raise</span> <span class="n">FeatureNotAvailable</span><span class="p">(</span><span class="s2">&quot;Cannot get detailed job info&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Scheduler.get_detailed_jobinfo"><a class="viewcode-back" href="../../../apidoc/aiida.schedulers.html#aiida.schedulers.Scheduler.get_detailed_jobinfo">[docs]</a>    <span class="k">def</span> <span class="nf">get_detailed_jobinfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jobid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a string with the output of the detailed_jobinfo command.</span>

<span class="sd">        At the moment, the output text is just retrieved</span>
<span class="sd">        and stored for logging purposes, but no parsing is performed.</span>

<span class="sd">        :raises: :class:`aiida.common.exceptions.FeatureNotAvailable`</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">command</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_detailed_jobinfo_command</span><span class="p">(</span><span class="n">jobid</span><span class="o">=</span><span class="n">jobid</span><span class="p">)</span>  <span class="c1"># pylint: disable=assignment-from-no-return</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="p">:</span>
            <span class="n">retval</span><span class="p">,</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">exec_command_wait</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>

        <span class="k">return</span> <span class="sa">u</span><span class="s2">&quot;&quot;&quot;Detailed jobinfo obtained with command &#39;</span><span class="si">{}</span><span class="s2">&#39;</span>
<span class="s2">Return Code: </span><span class="si">{}</span><span class="s2"></span>
<span class="s2">-------------------------------------------------------------</span>
<span class="s2">stdout:</span>
<span class="si">{}</span><span class="s2"></span>
<span class="s2">stderr:</span>
<span class="si">{}</span><span class="s2"></span>
<span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">retval</span><span class="p">,</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span><span class="p">)</span></div>

<div class="viewcode-block" id="Scheduler._parse_joblist_output"><a class="viewcode-back" href="../../../apidoc/aiida.schedulers.html#aiida.schedulers.Scheduler._parse_joblist_output">[docs]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">_parse_joblist_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">retval</span><span class="p">,</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parse the joblist output (&#39;qstat&#39;), as returned by executing the</span>
<span class="sd">        command returned by _get_joblist_command method.</span>

<span class="sd">        To be implemented by the plugin.</span>

<span class="sd">        Return a list of JobInfo objects, one of each job,</span>
<span class="sd">        each with at least its default params implemented.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

<div class="viewcode-block" id="Scheduler.get_jobs"><a class="viewcode-back" href="../../../apidoc/aiida.schedulers.html#aiida.schedulers.Scheduler.get_jobs">[docs]</a>    <span class="k">def</span> <span class="nf">get_jobs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jobs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">as_dict</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the list of jobs and return it.</span>

<span class="sd">        Typically, this function does not need to be modified by the plugins.</span>

<span class="sd">        :param list jobs: a list of jobs to check; only these are checked</span>
<span class="sd">        :param str user: a string with a user: only jobs of this user are checked</span>
<span class="sd">        :param list as_dict: if False (default), a list of JobInfo objects is</span>
<span class="sd">             returned. If True, a dictionary is returned, having as key the</span>
<span class="sd">             job_id and as value the JobInfo object.</span>

<span class="sd">        Note: typically, only either jobs or user can be specified. See also</span>
<span class="sd">        comments in _get_joblist_command.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="p">:</span>
            <span class="n">retval</span><span class="p">,</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">exec_command_wait</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_joblist_command</span><span class="p">(</span><span class="n">jobs</span><span class="o">=</span><span class="n">jobs</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="n">user</span><span class="p">))</span>

        <span class="n">joblist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_joblist_output</span><span class="p">(</span><span class="n">retval</span><span class="p">,</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">as_dict</span><span class="p">:</span>
            <span class="n">jobdict</span> <span class="o">=</span> <span class="p">{</span><span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">:</span> <span class="n">job</span> <span class="k">for</span> <span class="n">job</span> <span class="ow">in</span> <span class="n">joblist</span><span class="p">}</span>
            <span class="k">if</span> <span class="kc">None</span> <span class="ow">in</span> <span class="n">jobdict</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">SchedulerError</span><span class="p">(</span><span class="s2">&quot;Found at least one job without jobid&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">jobdict</span>

        <span class="k">return</span> <span class="n">joblist</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">transport</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the transport set for this scheduler.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transport</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">SchedulerError</span><span class="p">(</span><span class="s2">&quot;Use the set_transport function to set the transport for the scheduler first.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transport</span>

<div class="viewcode-block" id="Scheduler._get_submit_command"><a class="viewcode-back" href="../../../apidoc/aiida.schedulers.html#aiida.schedulers.Scheduler._get_submit_command">[docs]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">_get_submit_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">submit_script</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the string to execute to submit a given script.</span>

<span class="sd">        To be implemented by the plugin.</span>

<span class="sd">        :param str submit_script: the path of the submit script relative to the</span>
<span class="sd">            working directory.</span>
<span class="sd">            IMPORTANT: submit_script should be already escaped.</span>
<span class="sd">        :return: the string to execute to submit a given script.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

<div class="viewcode-block" id="Scheduler._parse_submit_output"><a class="viewcode-back" href="../../../apidoc/aiida.schedulers.html#aiida.schedulers.Scheduler._parse_submit_output">[docs]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">_parse_submit_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">retval</span><span class="p">,</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parse the output of the submit command, as returned by executing the</span>
<span class="sd">        command returned by _get_submit_command command.</span>

<span class="sd">        To be implemented by the plugin.</span>

<span class="sd">        :return: a string with the JobID.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

<div class="viewcode-block" id="Scheduler.submit_from_script"><a class="viewcode-back" href="../../../apidoc/aiida.schedulers.html#aiida.schedulers.Scheduler.submit_from_script">[docs]</a>    <span class="k">def</span> <span class="nf">submit_from_script</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">working_directory</span><span class="p">,</span> <span class="n">submit_script</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Goes in the working directory and submits the submit_script.</span>

<span class="sd">        Return a string with the JobID in a valid format to be used for</span>
<span class="sd">        querying.</span>

<span class="sd">        Typically, this function does not need to be modified by the plugins.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">working_directory</span><span class="p">)</span>
        <span class="n">retval</span><span class="p">,</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">exec_command_wait</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_get_submit_command</span><span class="p">(</span><span class="n">escape_for_bash</span><span class="p">(</span><span class="n">submit_script</span><span class="p">)))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_submit_output</span><span class="p">(</span><span class="n">retval</span><span class="p">,</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span><span class="p">)</span></div>

<div class="viewcode-block" id="Scheduler.kill"><a class="viewcode-back" href="../../../apidoc/aiida.schedulers.html#aiida.schedulers.Scheduler.kill">[docs]</a>    <span class="k">def</span> <span class="nf">kill</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jobid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Kill a remote job, and try to parse the output message of the scheduler</span>
<span class="sd">        to check if the scheduler accepted the command.</span>

<span class="sd">        ..note:: On some schedulers, even if the command is accepted, it may</span>
<span class="sd">        take some seconds for the job to actually disappear from the queue.</span>

<span class="sd">        :param str jobid: the job id to be killed</span>

<span class="sd">        :return: True if everything seems ok, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">retval</span><span class="p">,</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">exec_command_wait</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_kill_command</span><span class="p">(</span><span class="n">jobid</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_kill_output</span><span class="p">(</span><span class="n">retval</span><span class="p">,</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span><span class="p">)</span></div>

<div class="viewcode-block" id="Scheduler._get_kill_command"><a class="viewcode-back" href="../../../apidoc/aiida.schedulers.html#aiida.schedulers.Scheduler._get_kill_command">[docs]</a>    <span class="k">def</span> <span class="nf">_get_kill_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jobid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the command to kill the job with specified jobid.</span>

<span class="sd">        To be implemented by the plugin.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

<div class="viewcode-block" id="Scheduler._parse_kill_output"><a class="viewcode-back" href="../../../apidoc/aiida.schedulers.html#aiida.schedulers.Scheduler._parse_kill_output">[docs]</a>    <span class="k">def</span> <span class="nf">_parse_kill_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">retval</span><span class="p">,</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parse the output of the kill command.</span>

<span class="sd">        To be implemented by the plugin.</span>

<span class="sd">        :return: True if everything seems ok, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, ECOLE POLYTECHNIQUE FEDERALE DE LAUSANNE (Theory and Simulation of Materials (THEOS) and National Centre for Computational Design and Discovery of Novel Materials (NCCR MARVEL)), Switzerland and ROBERT BOSCH LLC, USA. All rights reserved

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>