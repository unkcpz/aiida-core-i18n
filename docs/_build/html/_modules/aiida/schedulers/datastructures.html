

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>aiida.schedulers.datastructures &mdash; AiiDA 1.0.0b2 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../_static/language_data.js"></script>
        <script type="text/javascript" src="../../../_static/contentui.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/contentui.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> AiiDA
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Installation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../install/quick_installation.html">Quick installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../install/prerequisites.html">Prerequisites</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../install/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../install/updating_installation.html">Updating AiiDA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../install/troubleshooting.html">Troubleshooting</a></li>
</ul>
<p class="caption"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../get_started/index.html">First things first</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../get_started/daemon.html">Setup the daemon</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../get_started/computers.html">Setup a computer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../get_started/codes.html">Setup a code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../get_started/plugins.html">Plugins</a></li>
</ul>
<p class="caption"><span class="caption-text">Concepts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../concepts/provenance.html">Provenance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../concepts/processes.html">Processes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../concepts/calculations.html">Calculations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../concepts/workflows.html">Workflows</a></li>
</ul>
<p class="caption"><span class="caption-text">Working with</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../working/processes.html">Processes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../working/functions.html">Calculation and work functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../working/calculations.html">Calculations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../working/workflows.html">Workflows</a></li>
</ul>
<p class="caption"><span class="caption-text">Working with AiiDA</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../working_with_aiida/index.html">Command line interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../working_with_aiida/index.html#scripting">Scripting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../working_with_aiida/index.html#data-types">Data types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../working_with_aiida/index.html#groups">Groups</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../working_with_aiida/index.html#schedulers">Schedulers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../working_with_aiida/index.html#querying-data">Querying data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../working_with_aiida/index.html#caching">Caching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../working_with_aiida/index.html#result-manager">Result manager</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../working_with_aiida/index.html#backups">Backups</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../working_with_aiida/index.html#troubleshooting">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../working_with_aiida/index.html#rest-api">REST API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../working_with_aiida/index.html#cookbook">Cookbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../import_export/index.html">Import and Export</a></li>
</ul>
<p class="caption"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../developer_guide/index.html">AiiDA design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developer_guide/index.html#aiida-core">AiiDA core</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developer_guide/index.html#aiida-plugins">AiiDA plugins</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorial/index.html">StructureData</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorial/index.html#pseudopotentials">Pseudopotentials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorial/index.html#plugin-development">Plugin development</a></li>
</ul>
<p class="caption"><span class="caption-text">API reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="`aiida package &lt;https://aiida-core.readthedocs.io/en/latest/apidoc/aiida.html&gt;`_">`aiida package &lt;https://aiida-core.readthedocs.io/en/latest/apidoc/aiida.html&gt;`_</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">AiiDA</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../../aiida.html">aiida</a> &raquo;</li>
        
      <li>aiida.schedulers.datastructures</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for aiida.schedulers.datastructures</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1">###########################################################################</span>
<span class="c1"># Copyright (c), The AiiDA team. All rights reserved.                     #</span>
<span class="c1"># This file is part of the AiiDA code.                                    #</span>
<span class="c1">#                                                                         #</span>
<span class="c1"># The code is hosted on GitHub at https://github.com/aiidateam/aiida_core #</span>
<span class="c1"># For further information on the license, see the LICENSE.txt file        #</span>
<span class="c1"># For further information please visit http://www.aiida.net               #</span>
<span class="c1">###########################################################################</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This module defines the main data structures used by the Scheduler.</span>

<span class="sd">In particular, there is the definition of possible job states (job_states),</span>
<span class="sd">the data structure to be filled for job submission (JobTemplate), and</span>
<span class="sd">the data structure that is returned when querying for jobs in the scheduler</span>
<span class="sd">(JobInfo).</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">print_function</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">division</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">absolute_import</span>

<span class="kn">from</span> <span class="nn">enum</span> <span class="k">import</span> <span class="n">Enum</span>

<span class="kn">from</span> <span class="nn">aiida.common</span> <span class="k">import</span> <span class="n">AIIDA_LOGGER</span>
<span class="kn">from</span> <span class="nn">aiida.common.extendeddicts</span> <span class="k">import</span> <span class="n">DefaultFieldsAttributeDict</span>

<span class="n">SCHEDULER_LOGGER</span> <span class="o">=</span> <span class="n">AIIDA_LOGGER</span><span class="o">.</span><span class="n">getChild</span><span class="p">(</span><span class="s1">&#39;scheduler&#39;</span><span class="p">)</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;JobState&#39;</span><span class="p">,</span> <span class="s1">&#39;JobResource&#39;</span><span class="p">,</span> <span class="s1">&#39;JobTemplate&#39;</span><span class="p">,</span> <span class="s1">&#39;JobInfo&#39;</span><span class="p">,</span> <span class="s1">&#39;NodeNumberJobResource&#39;</span><span class="p">,</span> <span class="s1">&#39;ParEnvJobResource&#39;</span><span class="p">,</span> <span class="s1">&#39;MachineInfo&#39;</span><span class="p">)</span>


<div class="viewcode-block" id="JobState"><a class="viewcode-back" href="../../../apidoc/aiida.schedulers.html#aiida.schedulers.JobState">[docs]</a><span class="k">class</span> <span class="nc">JobState</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Enumeration of possible scheduler states of a CalcJob.</span>

<span class="sd">    There is no FAILED state as every completed job is put in DONE, regardless of success.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">UNDETERMINED</span> <span class="o">=</span> <span class="s1">&#39;undetermined&#39;</span>
    <span class="n">QUEUED</span> <span class="o">=</span> <span class="s1">&#39;queued&#39;</span>
    <span class="n">QUEUED_HELD</span> <span class="o">=</span> <span class="s1">&#39;queued held&#39;</span>
    <span class="n">RUNNING</span> <span class="o">=</span> <span class="s1">&#39;running&#39;</span>
    <span class="n">SUSPENDED</span> <span class="o">=</span> <span class="s1">&#39;suspended&#39;</span>
    <span class="n">DONE</span> <span class="o">=</span> <span class="s1">&#39;done&#39;</span></div>


<div class="viewcode-block" id="JobResource"><a class="viewcode-back" href="../../../apidoc/aiida.schedulers.html#aiida.schedulers.JobResource">[docs]</a><span class="k">class</span> <span class="nc">JobResource</span><span class="p">(</span><span class="n">DefaultFieldsAttributeDict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A class to store the job resources. It must be inherited and redefined by the specific</span>
<span class="sd">    plugin, that should contain a ``_job_resource_class`` attribute pointing to the correct</span>
<span class="sd">    JobResource subclass.</span>

<span class="sd">    It should at least define the get_tot_num_mpiprocs() method, plus an __init__ to accept</span>
<span class="sd">    its set of variables.</span>

<span class="sd">    Typical attributes are:</span>

<span class="sd">    * ``num_machines``</span>
<span class="sd">    * ``num_mpiprocs_per_machine``</span>

<span class="sd">    or (e.g. for SGE)</span>

<span class="sd">    * ``tot_num_mpiprocs``</span>
<span class="sd">    * ``parallel_env``</span>

<span class="sd">    The __init__ should take care of checking the values.</span>
<span class="sd">    The init should raise only ValueError or TypeError on invalid parameters.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_default_fields</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">()</span>

<div class="viewcode-block" id="JobResource.accepts_default_mpiprocs_per_machine"><a class="viewcode-back" href="../../../apidoc/aiida.schedulers.html#aiida.schedulers.JobResource.accepts_default_mpiprocs_per_machine">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">accepts_default_mpiprocs_per_machine</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return True if this JobResource accepts a &#39;default_mpiprocs_per_machine&#39;</span>
<span class="sd">        key, False otherwise.</span>

<span class="sd">        Should be implemented in each subclass.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

<div class="viewcode-block" id="JobResource.get_valid_keys"><a class="viewcode-back" href="../../../apidoc/aiida.schedulers.html#aiida.schedulers.JobResource.get_valid_keys">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_valid_keys</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a list of valid keys to be passed to the __init__</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">_default_fields</span><span class="p">)</span></div>

<div class="viewcode-block" id="JobResource.get_tot_num_mpiprocs"><a class="viewcode-back" href="../../../apidoc/aiida.schedulers.html#aiida.schedulers.JobResource.get_tot_num_mpiprocs">[docs]</a>    <span class="k">def</span> <span class="nf">get_tot_num_mpiprocs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the total number of cpus of this job resource.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div></div>


<div class="viewcode-block" id="NodeNumberJobResource"><a class="viewcode-back" href="../../../apidoc/aiida.schedulers.html#aiida.schedulers.NodeNumberJobResource">[docs]</a><span class="k">class</span> <span class="nc">NodeNumberJobResource</span><span class="p">(</span><span class="n">JobResource</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An implementation of JobResource for schedulers that support</span>
<span class="sd">    the specification of a number of nodes and a number of cpus per node</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_default_fields</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s1">&#39;num_machines&#39;</span><span class="p">,</span>
        <span class="s1">&#39;num_mpiprocs_per_machine&#39;</span><span class="p">,</span>
        <span class="s1">&#39;num_cores_per_machine&#39;</span><span class="p">,</span>
        <span class="s1">&#39;num_cores_per_mpiproc&#39;</span><span class="p">,</span>
    <span class="p">)</span>

<div class="viewcode-block" id="NodeNumberJobResource.get_valid_keys"><a class="viewcode-back" href="../../../apidoc/aiida.schedulers.html#aiida.schedulers.NodeNumberJobResource.get_valid_keys">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_valid_keys</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a list of valid keys to be passed to the __init__</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">NodeNumberJobResource</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">get_valid_keys</span><span class="p">()</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;tot_num_mpiprocs&quot;</span><span class="p">,</span> <span class="s2">&quot;default_mpiprocs_per_machine&quot;</span><span class="p">]</span></div>

<div class="viewcode-block" id="NodeNumberJobResource.accepts_default_mpiprocs_per_machine"><a class="viewcode-back" href="../../../apidoc/aiida.schedulers.html#aiida.schedulers.NodeNumberJobResource.accepts_default_mpiprocs_per_machine">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">accepts_default_mpiprocs_per_machine</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return True if this JobResource accepts a &#39;default_mpiprocs_per_machine&#39;</span>
<span class="sd">        key, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="NodeNumberJobResource.__init__"><a class="viewcode-back" href="../../../apidoc/aiida.schedulers.html#aiida.schedulers.NodeNumberJobResource.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the job resources from the passed arguments (the valid keys can be</span>
<span class="sd">        obtained with the function self.get_valid_keys()).</span>

<span class="sd">        Should raise only ValueError or TypeError on invalid parameters.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">NodeNumberJobResource</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">num_machines</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;num_machines&#39;</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">num_machines</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;num_machines must an integer&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">default_mpiprocs_per_machine</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;default_mpiprocs_per_machine&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">default_mpiprocs_per_machine</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">default_mpiprocs_per_machine</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">default_mpiprocs_per_machine</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">default_mpiprocs_per_machine</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;default_mpiprocs_per_machine must an integer&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">num_mpiprocs_per_machine</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;num_mpiprocs_per_machine&#39;</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">num_mpiprocs_per_machine</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;num_mpiprocs_per_machine must an integer&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">tot_num_mpiprocs</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;tot_num_mpiprocs&#39;</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">tot_num_mpiprocs</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;tot_num_mpiprocs must an integer&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num_cores_per_machine</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;num_cores_per_machine&#39;</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num_cores_per_machine</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;num_cores_per_machine must an integer&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num_cores_per_mpiproc</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;num_cores_per_mpiproc&#39;</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num_cores_per_mpiproc</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;num_cores_per_mpiproc must an integer&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The following parameters were not recognized for &quot;</span>
                            <span class="s2">&quot;the JobResource: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>

        <span class="k">if</span> <span class="n">num_machines</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Use default value, if not provided</span>
            <span class="k">if</span> <span class="n">num_mpiprocs_per_machine</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">num_mpiprocs_per_machine</span> <span class="o">=</span> <span class="n">default_mpiprocs_per_machine</span>

            <span class="k">if</span> <span class="n">num_mpiprocs_per_machine</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">tot_num_mpiprocs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;At least two among num_machines, &quot;</span>
                                <span class="s2">&quot;num_mpiprocs_per_machine or tot_num_mpiprocs must be specified&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># To avoid divisions by zero</span>
                <span class="k">if</span> <span class="n">num_mpiprocs_per_machine</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;num_mpiprocs_per_machine must be &gt;= 1&quot;</span><span class="p">)</span>
                <span class="n">num_machines</span> <span class="o">=</span> <span class="n">tot_num_mpiprocs</span> <span class="o">//</span> <span class="n">num_mpiprocs_per_machine</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">tot_num_mpiprocs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># Only set the default value if tot_num_mpiprocs is not provided.</span>
                <span class="c1"># Otherwise, it means that the user provided both</span>
                <span class="c1"># num_machines and tot_num_mpiprocs, and we have to ignore</span>
                <span class="c1"># the default value of tot_num_mpiprocs</span>
                <span class="k">if</span> <span class="n">num_mpiprocs_per_machine</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">num_mpiprocs_per_machine</span> <span class="o">=</span> <span class="n">default_mpiprocs_per_machine</span>

            <span class="k">if</span> <span class="n">num_mpiprocs_per_machine</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">tot_num_mpiprocs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;At least two among num_machines, &quot;</span>
                                    <span class="s2">&quot;num_mpiprocs_per_machine or tot_num_mpiprocs must be specified&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># To avoid divisions by zero</span>
                    <span class="k">if</span> <span class="n">num_machines</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;num_machines must be &gt;= 1&quot;</span><span class="p">)</span>
                    <span class="n">num_mpiprocs_per_machine</span> <span class="o">=</span> <span class="n">tot_num_mpiprocs</span> <span class="o">//</span> <span class="n">num_machines</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">num_machines</span> <span class="o">=</span> <span class="n">num_machines</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_mpiprocs_per_machine</span> <span class="o">=</span> <span class="n">num_mpiprocs_per_machine</span>

        <span class="k">if</span> <span class="n">tot_num_mpiprocs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">tot_num_mpiprocs</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_mpiprocs_per_machine</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_machines</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;tot_num_mpiprocs must be equal to &quot;</span>
                                 <span class="s2">&quot;num_mpiprocs_per_machine * num_machines, and in particular it &quot;</span>
                                 <span class="s2">&quot;should be a multiple of num_mpiprocs_per_machine and/or &quot;</span>
                                 <span class="s2">&quot;num_machines&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_mpiprocs_per_machine</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;num_mpiprocs_per_machine must be &gt;= 1&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_machines</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;num_machine must be &gt;= 1&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="NodeNumberJobResource.get_tot_num_mpiprocs"><a class="viewcode-back" href="../../../apidoc/aiida.schedulers.html#aiida.schedulers.NodeNumberJobResource.get_tot_num_mpiprocs">[docs]</a>    <span class="k">def</span> <span class="nf">get_tot_num_mpiprocs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the total number of cpus of this job resource.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_machines</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_mpiprocs_per_machine</span></div></div>


<div class="viewcode-block" id="ParEnvJobResource"><a class="viewcode-back" href="../../../apidoc/aiida.schedulers.html#aiida.schedulers.ParEnvJobResource">[docs]</a><span class="k">class</span> <span class="nc">ParEnvJobResource</span><span class="p">(</span><span class="n">JobResource</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An implementation of JobResource for schedulers that support</span>
<span class="sd">    the specification of a parallel environment (a string) + the total number of nodes</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_default_fields</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s1">&#39;parallel_env&#39;</span><span class="p">,</span>
        <span class="s1">&#39;tot_num_mpiprocs&#39;</span><span class="p">,</span>
        <span class="s1">&#39;default_mpiprocs_per_machine&#39;</span><span class="p">,</span>
    <span class="p">)</span>

<div class="viewcode-block" id="ParEnvJobResource.__init__"><a class="viewcode-back" href="../../../apidoc/aiida.schedulers.html#aiida.schedulers.ParEnvJobResource.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the job resources from the passed arguments (the valid keys can be</span>
<span class="sd">        obtained with the function self.get_valid_keys()).</span>

<span class="sd">        :raise ValueError: on invalid parameters.</span>
<span class="sd">        :raise TypeError: on invalid parameters.</span>
<span class="sd">        :raise aiida.common.ConfigurationError: if default_mpiprocs_per_machine was set for this</span>
<span class="sd">            computer, since ParEnvJobResource cannot accept this parameter.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">aiida.common.exceptions</span> <span class="k">import</span> <span class="n">ConfigurationError</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ParEnvJobResource</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parallel_env</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;parallel_env&#39;</span><span class="p">))</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;&#39;parallel_env&#39; must be specified and must be a string&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tot_num_mpiprocs</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;tot_num_mpiprocs&#39;</span><span class="p">))</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;tot_num_mpiprocs must be specified and must be an integer&quot;</span><span class="p">)</span>

        <span class="n">default_mpiprocs_per_machine</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;default_mpiprocs_per_machine&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">default_mpiprocs_per_machine</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ConfigurationError</span><span class="p">(</span><span class="s2">&quot;default_mpiprocs_per_machine cannot be set &quot;</span>
                                     <span class="s2">&quot;for schedulers that use ParEnvJobResource&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tot_num_mpiprocs</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;tot_num_mpiprocs must be &gt;= 1&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="ParEnvJobResource.get_tot_num_mpiprocs"><a class="viewcode-back" href="../../../apidoc/aiida.schedulers.html#aiida.schedulers.ParEnvJobResource.get_tot_num_mpiprocs">[docs]</a>    <span class="k">def</span> <span class="nf">get_tot_num_mpiprocs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the total number of cpus of this job resource.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tot_num_mpiprocs</span></div>

<div class="viewcode-block" id="ParEnvJobResource.accepts_default_mpiprocs_per_machine"><a class="viewcode-back" href="../../../apidoc/aiida.schedulers.html#aiida.schedulers.ParEnvJobResource.accepts_default_mpiprocs_per_machine">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">accepts_default_mpiprocs_per_machine</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return True if this JobResource accepts a &#39;default_mpiprocs_per_machine&#39;</span>
<span class="sd">        key, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">False</span></div></div>


<div class="viewcode-block" id="JobTemplate"><a class="viewcode-back" href="../../../apidoc/aiida.schedulers.html#aiida.schedulers.JobTemplate">[docs]</a><span class="k">class</span> <span class="nc">JobTemplate</span><span class="p">(</span><span class="n">DefaultFieldsAttributeDict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A template for submitting jobs. This contains all required information</span>
<span class="sd">    to create the job header.</span>

<span class="sd">    The required fields are: working_directory, job_name, num_machines,</span>
<span class="sd">      num_mpiprocs_per_machine, argv.</span>

<span class="sd">    Fields:</span>

<span class="sd">      * ``shebang line``: The first line of the submission script</span>
<span class="sd">      * ``submit_as_hold``: if set, the job will be in a &#39;hold&#39; status right</span>
<span class="sd">        after the submission</span>
<span class="sd">      * ``rerunnable``: if the job is rerunnable (boolean)</span>
<span class="sd">      * ``job_environment``: a dictionary with environment variables to set</span>
<span class="sd">        before the execution of the code.</span>
<span class="sd">      * ``working_directory``: the working directory for this job. During</span>
<span class="sd">        submission, the transport will first do a &#39;chdir&#39; to this directory,</span>
<span class="sd">        and then possibly set a scheduler parameter, if this is supported</span>
<span class="sd">        by the scheduler.</span>
<span class="sd">      * ``email``: an email address for sending emails on job events.</span>
<span class="sd">      * ``email_on_started``: if True, ask the scheduler to send an email when the</span>
<span class="sd">        job starts.</span>
<span class="sd">      * ``email_on_terminated``: if True, ask the scheduler to send an email when</span>
<span class="sd">        the job ends. This should also send emails on job failure, when</span>
<span class="sd">        possible.</span>
<span class="sd">      * ``job_name``: the name of this job. The actual name of the job can be</span>
<span class="sd">        different from the one specified here, e.g. if there are unsupported</span>
<span class="sd">        characters, or the name is too long.</span>
<span class="sd">      * ``sched_output_path``: a (relative) file name for the stdout of this job</span>
<span class="sd">      * ``sched_error_path``: a (relative) file name for the stdout of this job</span>
<span class="sd">      * ``sched_join_files``: if True, write both stdout and stderr on the same</span>
<span class="sd">        file (the one specified for stdout)</span>
<span class="sd">      * ``queue_name``: the name of the scheduler queue (sometimes also called</span>
<span class="sd">        partition), on which the job will be submitted.</span>
<span class="sd">      * ``account``: the name of the scheduler account (sometimes also called</span>
<span class="sd">        projectid), on which the job will be submitted.</span>
<span class="sd">      * ``qos``: the quality of service of the scheduler account,</span>
<span class="sd">        on which the job will be submitted.</span>
<span class="sd">      * ``job_resource``: a suitable :py:class:`JobResource`</span>
<span class="sd">        subclass with information on how many</span>
<span class="sd">        nodes and cpus it should use. It must be an instance of the</span>
<span class="sd">        ``aiida.schedulers.Scheduler.job_resource_class`` class.</span>
<span class="sd">        Use the Scheduler.create_job_resource method to create it.</span>
<span class="sd">      * ``num_machines``: how many machines (or nodes) should be used</span>
<span class="sd">      * ``num_mpiprocs_per_machine``: how many MPI procs should be used on each</span>
<span class="sd">        machine (or node).</span>
<span class="sd">      * ``priority``: a priority for this job. Should be in the format accepted</span>
<span class="sd">        by the specific scheduler.</span>
<span class="sd">      * ``max_memory_kb``: The maximum amount of memory the job is allowed</span>
<span class="sd">        to allocate ON EACH NODE, in kilobytes</span>
<span class="sd">      * ``max_wallclock_seconds``: The maximum wall clock time that all processes</span>
<span class="sd">        of a job are allowed to exist, in seconds</span>
<span class="sd">      * ``custom_scheduler_commands``: a string that will be inserted right</span>
<span class="sd">        after the last scheduler command, and before any other non-scheduler</span>
<span class="sd">        command; useful if some specific flag needs to be added and is not</span>
<span class="sd">        supported by the plugin</span>
<span class="sd">      * ``prepend_text``: a (possibly multi-line) string to be inserted</span>
<span class="sd">        in the scheduler script before the main execution line</span>
<span class="sd">      * ``append_text``: a (possibly multi-line) string to be inserted</span>
<span class="sd">        in the scheduler script after the main execution line</span>
<span class="sd">      * ``import_sys_environment``: import the system environment variables</span>
<span class="sd">      * ``codes_info``: a list of aiida.common.datastructures.CalcInfo objects.</span>
<span class="sd">        Each contains the information necessary to run a single code. At the</span>
<span class="sd">        moment, it can contain:</span>

<span class="sd">        * ``cmdline_parameters``: a list of strings with the command line arguments</span>
<span class="sd">          of the program to run. This is the main program to be executed.</span>
<span class="sd">          NOTE: The first one is the executable name.</span>
<span class="sd">          For MPI runs, this will probably be &quot;mpirun&quot; or a similar program;</span>
<span class="sd">          this has to be chosen at a upper level.</span>
<span class="sd">        * ``stdin_name``: the (relative) file name to be used as stdin for the</span>
<span class="sd">          program specified with argv.</span>
<span class="sd">        * ``stdout_name``: the (relative) file name to be used as stdout for the</span>
<span class="sd">          program specified with argv.</span>
<span class="sd">        * ``stderr_name``: the (relative) file name to be used as stderr for the</span>
<span class="sd">          program specified with argv.</span>
<span class="sd">        * ``join_files``: if True, stderr is redirected on the same file</span>
<span class="sd">          specified for stdout.</span>

<span class="sd">      * ``codes_run_mode``: sets the run_mode with which the (multiple) codes</span>
<span class="sd">        have to be executed. For example, parallel execution::</span>

<span class="sd">          mpirun -np 8 a.x &amp;</span>
<span class="sd">          mpirun -np 8 b.x &amp;</span>
<span class="sd">          wait</span>

<span class="sd">        The serial execution would be without the &amp;&#39;s.</span>
<span class="sd">        Values are given by aiida.common.datastructures.CodeRunMode.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># #TODO: validation key? also call the validate function in the proper</span>
    <span class="c1">#        place then.</span>

    <span class="n">_default_fields</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s1">&#39;shebang&#39;</span><span class="p">,</span>
        <span class="s1">&#39;submit_as_hold&#39;</span><span class="p">,</span>
        <span class="s1">&#39;rerunnable&#39;</span><span class="p">,</span>
        <span class="s1">&#39;job_environment&#39;</span><span class="p">,</span>
        <span class="s1">&#39;working_directory&#39;</span><span class="p">,</span>
        <span class="s1">&#39;email&#39;</span><span class="p">,</span>
        <span class="s1">&#39;email_on_started&#39;</span><span class="p">,</span>
        <span class="s1">&#39;email_on_terminated&#39;</span><span class="p">,</span>
        <span class="s1">&#39;job_name&#39;</span><span class="p">,</span>
        <span class="s1">&#39;sched_output_path&#39;</span><span class="p">,</span>
        <span class="s1">&#39;sched_error_path&#39;</span><span class="p">,</span>
        <span class="s1">&#39;sched_join_files&#39;</span><span class="p">,</span>
        <span class="s1">&#39;queue_name&#39;</span><span class="p">,</span>
        <span class="s1">&#39;account&#39;</span><span class="p">,</span>
        <span class="s1">&#39;qos&#39;</span><span class="p">,</span>
        <span class="s1">&#39;job_resource&#39;</span><span class="p">,</span>
        <span class="s1">&#39;priority&#39;</span><span class="p">,</span>
        <span class="s1">&#39;max_memory_kb&#39;</span><span class="p">,</span>
        <span class="s1">&#39;max_wallclock_seconds&#39;</span><span class="p">,</span>
        <span class="s1">&#39;custom_scheduler_commands&#39;</span><span class="p">,</span>
        <span class="s1">&#39;prepend_text&#39;</span><span class="p">,</span>
        <span class="s1">&#39;append_text&#39;</span><span class="p">,</span>
        <span class="s1">&#39;import_sys_environment&#39;</span><span class="p">,</span>
        <span class="s1">&#39;codes_run_mode&#39;</span><span class="p">,</span>
        <span class="s1">&#39;codes_info&#39;</span><span class="p">,</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="MachineInfo"><a class="viewcode-back" href="../../../apidoc/aiida.schedulers.html#aiida.schedulers.MachineInfo">[docs]</a><span class="k">class</span> <span class="nc">MachineInfo</span><span class="p">(</span><span class="n">DefaultFieldsAttributeDict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Similarly to what is defined in the DRMAA v.2 as SlotInfo; this identifies</span>
<span class="sd">    each machine (also called &#39;node&#39; on some schedulers)</span>
<span class="sd">    on which a job is running, and how many CPUs are being used. (Some of them</span>
<span class="sd">    could be undefined)</span>

<span class="sd">    * ``name``: name of the machine</span>
<span class="sd">    * ``num_cpus``: number of cores used by the job on this machine</span>
<span class="sd">    * ``num_mpiprocs``: number of MPI processes used by the job on this machine</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_default_fields</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s1">&#39;name&#39;</span><span class="p">,</span>
        <span class="s1">&#39;num_mpiprocs&#39;</span><span class="p">,</span>
        <span class="s1">&#39;num_cpus&#39;</span><span class="p">,</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="JobInfo"><a class="viewcode-back" href="../../../apidoc/aiida.schedulers.html#aiida.schedulers.JobInfo">[docs]</a><span class="k">class</span> <span class="nc">JobInfo</span><span class="p">(</span><span class="n">DefaultFieldsAttributeDict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Contains properties for a job in the queue.</span>
<span class="sd">    Most of the fields are taken from DRMAA v.2.</span>

<span class="sd">    Note that default fields may be undefined. This</span>
<span class="sd">    is an expected behavior and the application must cope with this</span>
<span class="sd">    case. An example for instance is the exit_status for jobs that have</span>
<span class="sd">    not finished yet; or features not supported by the given scheduler.</span>

<span class="sd">    Fields:</span>

<span class="sd">       * ``job_id``: the job ID on the scheduler</span>
<span class="sd">       * ``title``: the job title, as known by the scheduler</span>
<span class="sd">       * ``exit_status``: the exit status of the job as reported by the operating</span>
<span class="sd">         system on the execution host</span>
<span class="sd">       * ``terminating_signal``: the UNIX signal that was responsible for the end</span>
<span class="sd">         of the job.</span>
<span class="sd">       * ``annotation``: human-readable description of the reason for the job</span>
<span class="sd">         being in the current state or substate.</span>
<span class="sd">       * ``job_state``: the job state (one of those defined in</span>
<span class="sd">         ``aiida.schedulers.datastructures.JobState``)</span>
<span class="sd">       * ``job_substate``: a string with the implementation-specific sub-state</span>
<span class="sd">       * ``allocated_machines``: a list of machines used for the current job.</span>
<span class="sd">         This is a list of :py:class:`aiida.schedulers.datastructures.MachineInfo` objects.</span>
<span class="sd">       * ``job_owner``: the job owner as reported by the scheduler</span>
<span class="sd">       * ``num_mpiprocs``: the *total* number of requested MPI procs</span>
<span class="sd">       * ``num_cpus``: the *total* number of requested CPUs (cores) [may be undefined]</span>
<span class="sd">       * ``num_machines``: the number of machines (i.e., nodes), required by the</span>
<span class="sd">         job. If ``allocated_machines`` is not None, this number must be equal to</span>
<span class="sd">         ``len(allocated_machines)``. Otherwise, for schedulers not supporting</span>
<span class="sd">         the retrieval of the full list of allocated machines, this</span>
<span class="sd">         attribute can be used to know at least the number of machines.</span>
<span class="sd">       * ``queue_name``: The name of the queue in which the job is queued or</span>
<span class="sd">         running.</span>
<span class="sd">       * ``account``: The account/projectid in which the job is queued or</span>
<span class="sd">         running in.</span>
<span class="sd">       * ``qos``: The quality of service in which the job is queued or</span>
<span class="sd">         running in.</span>
<span class="sd">       * ``wallclock_time_seconds``: the accumulated wallclock time, in seconds</span>
<span class="sd">       * ``requested_wallclock_time_seconds``: the requested wallclock time,</span>
<span class="sd">         in seconds</span>
<span class="sd">       * ``cpu_time``: the accumulated cpu time, in seconds</span>
<span class="sd">       * ``submission_time``: the absolute time at which the job was submitted,</span>
<span class="sd">         of type datetime.datetime</span>
<span class="sd">       * ``dispatch_time``: the absolute time at which the job first entered the</span>
<span class="sd">         &#39;started&#39; state, of type datetime.datetime</span>
<span class="sd">       * ``finish_time``: the absolute time at which the job first entered the</span>
<span class="sd">         &#39;finished&#39; state, of type datetime.datetime</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_default_fields</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;job_id&#39;</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;exit_status&#39;</span><span class="p">,</span> <span class="s1">&#39;terminating_signal&#39;</span><span class="p">,</span> <span class="s1">&#39;annotation&#39;</span><span class="p">,</span> <span class="s1">&#39;job_state&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;job_substate&#39;</span><span class="p">,</span> <span class="s1">&#39;allocated_machines&#39;</span><span class="p">,</span> <span class="s1">&#39;job_owner&#39;</span><span class="p">,</span> <span class="s1">&#39;num_mpiprocs&#39;</span><span class="p">,</span> <span class="s1">&#39;num_cpus&#39;</span><span class="p">,</span> <span class="s1">&#39;num_machines&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;queue_name&#39;</span><span class="p">,</span> <span class="s1">&#39;account&#39;</span><span class="p">,</span> <span class="s1">&#39;qos&#39;</span><span class="p">,</span> <span class="s1">&#39;wallclock_time_seconds&#39;</span><span class="p">,</span> <span class="s1">&#39;requested_wallclock_time_seconds&#39;</span><span class="p">,</span> <span class="s1">&#39;cpu_time&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;submission_time&#39;</span><span class="p">,</span> <span class="s1">&#39;dispatch_time&#39;</span><span class="p">,</span> <span class="s1">&#39;finish_time&#39;</span><span class="p">)</span>

    <span class="c1"># If some fields require special serializers, specify them here.</span>
    <span class="c1"># You then need to define also the respective _serialize_FIELDTYPE and</span>
    <span class="c1"># _deserialize_FIELDTYPE methods</span>
    <span class="n">_special_serializers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;submission_time&#39;</span><span class="p">:</span> <span class="s1">&#39;date&#39;</span><span class="p">,</span>
        <span class="s1">&#39;dispatch_time&#39;</span><span class="p">:</span> <span class="s1">&#39;date&#39;</span><span class="p">,</span>
        <span class="s1">&#39;finish_time&#39;</span><span class="p">:</span> <span class="s1">&#39;date&#39;</span><span class="p">,</span>
        <span class="s1">&#39;job_state&#39;</span><span class="p">:</span> <span class="s1">&#39;job_state&#39;</span><span class="p">,</span>
    <span class="p">}</span>

<div class="viewcode-block" id="JobInfo._serialize_job_state"><a class="viewcode-back" href="../../../apidoc/aiida.schedulers.html#aiida.schedulers.JobInfo._serialize_job_state">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_serialize_job_state</span><span class="p">(</span><span class="n">job_state</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the serialized value of the JobState instance.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">job_state</span><span class="p">,</span> <span class="n">JobState</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;invalid type for value </span><span class="si">{}</span><span class="s1">, should be an instance of `JobState`&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">job_state</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">job_state</span><span class="o">.</span><span class="n">value</span></div>

<div class="viewcode-block" id="JobInfo._deserialize_job_state"><a class="viewcode-back" href="../../../apidoc/aiida.schedulers.html#aiida.schedulers.JobInfo._deserialize_job_state">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_deserialize_job_state</span><span class="p">(</span><span class="n">job_state</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return an instance of JobState from the job_state string.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">JobState</span><span class="p">(</span><span class="n">job_state</span><span class="p">)</span></div>

<div class="viewcode-block" id="JobInfo._serialize_date"><a class="viewcode-back" href="../../../apidoc/aiida.schedulers.html#aiida.schedulers.JobInfo._serialize_date">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_serialize_date</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Serialise a data value</span>
<span class="sd">        :param value: The value to serialise</span>
<span class="sd">        :return: The serialised value</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="kn">import</span> <span class="nn">datetime</span>
        <span class="kn">import</span> <span class="nn">pytz</span>

        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">value</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid type for the date, should be a datetime&quot;</span><span class="p">)</span>

        <span class="c1"># is_naive check from django.utils.timezone</span>
        <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">tzinfo</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">value</span><span class="o">.</span><span class="n">tzinfo</span><span class="o">.</span><span class="n">utcoffset</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># TODO: FIX TIMEZONE</span>
            <span class="n">SCHEDULER_LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Datetime to serialize in JobInfo is naive, this should be fixed!&quot;</span><span class="p">)</span>
            <span class="c1"># v = v.replace(tzinfo = pytz.utc)</span>
            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;date&#39;</span><span class="p">:</span> <span class="n">value</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">T%H:%M:%S.</span><span class="si">%f</span><span class="s1">&#39;</span><span class="p">),</span> <span class="s1">&#39;timezone&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>

        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;date&#39;</span><span class="p">:</span> <span class="n">value</span><span class="o">.</span><span class="n">astimezone</span><span class="p">(</span><span class="n">pytz</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">T%H:%M:%S.</span><span class="si">%f</span><span class="s1">&#39;</span><span class="p">),</span> <span class="s1">&#39;timezone&#39;</span><span class="p">:</span> <span class="s1">&#39;UTC&#39;</span><span class="p">}</span></div>

<div class="viewcode-block" id="JobInfo._deserialize_date"><a class="viewcode-back" href="../../../apidoc/aiida.schedulers.html#aiida.schedulers.JobInfo._deserialize_date">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_deserialize_date</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Deserialise a date</span>
<span class="sd">        :param value: The date vlue</span>
<span class="sd">        :return: The deserialised date</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">datetime</span>
        <span class="kn">import</span> <span class="nn">pytz</span>

        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">value</span>

        <span class="k">if</span> <span class="n">value</span><span class="p">[</span><span class="s1">&#39;timezone&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># naive date</span>
            <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">],</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">T%H:%M:%S.</span><span class="si">%f</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">value</span><span class="p">[</span><span class="s1">&#39;timezone&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;UTC&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">],</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">T%H:%M:%S.</span><span class="si">%f</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="n">pytz</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>

        <span class="c1"># Try your best</span>
        <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">],</span>
                                          <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">T%H:%M:%S.</span><span class="si">%f</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="n">pytz</span><span class="o">.</span><span class="n">timezone</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;timezone&#39;</span><span class="p">]))</span></div>

<div class="viewcode-block" id="JobInfo.serialize_field"><a class="viewcode-back" href="../../../apidoc/aiida.schedulers.html#aiida.schedulers.JobInfo.serialize_field">[docs]</a>    <span class="k">def</span> <span class="nf">serialize_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">field_type</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Serialise a particular field value</span>

<span class="sd">        :param value: The value to serialise</span>
<span class="sd">        :param field_type: The field type</span>
<span class="sd">        :return: The serialised value</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">field_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">value</span>

        <span class="n">serializer_method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_serialize_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">field_type</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">serializer_method</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="JobInfo.deserialize_field"><a class="viewcode-back" href="../../../apidoc/aiida.schedulers.html#aiida.schedulers.JobInfo.deserialize_field">[docs]</a>    <span class="k">def</span> <span class="nf">deserialize_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">field_type</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Deserialise the value of a particular field with a type</span>
<span class="sd">        :param value: The value</span>
<span class="sd">        :param field_type: The field type</span>
<span class="sd">        :return: The deserialised value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">field_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">value</span>

        <span class="n">deserializer_method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_deserialize_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">field_type</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">deserializer_method</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="JobInfo.serialize"><a class="viewcode-back" href="../../../apidoc/aiida.schedulers.html#aiida.schedulers.JobInfo.serialize">[docs]</a>    <span class="k">def</span> <span class="nf">serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Serialise the current data</span>
<span class="sd">        :return: A serialised representation of the current data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">aiida.common</span> <span class="k">import</span> <span class="n">json</span>

        <span class="n">ser_data</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">serialize_field</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_special_serializers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">ser_data</span><span class="p">)</span></div>

<div class="viewcode-block" id="JobInfo.load_from_serialized"><a class="viewcode-back" href="../../../apidoc/aiida.schedulers.html#aiida.schedulers.JobInfo.load_from_serialized">[docs]</a>    <span class="k">def</span> <span class="nf">load_from_serialized</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load value from serialised data</span>
<span class="sd">        :param data: The data to load from</span>
<span class="sd">        :return: The value after loading</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">aiida.common</span> <span class="k">import</span> <span class="n">json</span>

        <span class="n">deser_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">deser_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">deserialize_field</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_special_serializers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, ECOLE POLYTECHNIQUE FEDERALE DE LAUSANNE (Theory and Simulation of Materials (THEOS) and National Centre for Computational Design and Discovery of Novel Materials (NCCR MARVEL)), Switzerland and ROBERT BOSCH LLC, USA. All rights reserved

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>