

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>aiida.schedulers.plugins.sge &mdash; AiiDA 1.0.0b2 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../../_static/language_data.js"></script>
        <script type="text/javascript" src="../../../../_static/contentui.js"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/contentui.css" type="text/css" />
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../index.html" class="icon icon-home"> AiiDA
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Installation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../install/quick_installation.html">Quick installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../install/prerequisites.html">Prerequisites</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../install/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../install/updating_installation.html">Updating AiiDA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../install/troubleshooting.html">Troubleshooting</a></li>
</ul>
<p class="caption"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../get_started/index.html">First things first</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../get_started/daemon.html">Setup the daemon</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../get_started/computers.html">Setup a computer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../get_started/codes.html">Setup a code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../get_started/plugins.html">Plugins</a></li>
</ul>
<p class="caption"><span class="caption-text">Concepts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../concepts/provenance.html">Provenance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../concepts/processes.html">Processes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../concepts/calculations.html">Calculations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../concepts/workflows.html">Workflows</a></li>
</ul>
<p class="caption"><span class="caption-text">Working with</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../working/processes.html">Processes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working/functions.html">Calculation and work functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working/calculations.html">Calculations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working/workflows.html">Workflows</a></li>
</ul>
<p class="caption"><span class="caption-text">Working with AiiDA</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../working_with_aiida/index.html">Command line interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working_with_aiida/index.html#scripting">Scripting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working_with_aiida/index.html#data-types">Data types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working_with_aiida/index.html#groups">Groups</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working_with_aiida/index.html#schedulers">Schedulers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working_with_aiida/index.html#querying-data">Querying data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working_with_aiida/index.html#caching">Caching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working_with_aiida/index.html#result-manager">Result manager</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working_with_aiida/index.html#backups">Backups</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working_with_aiida/index.html#troubleshooting">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working_with_aiida/index.html#rest-api">REST API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../working_with_aiida/index.html#cookbook">Cookbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../import_export/index.html">Import and Export</a></li>
</ul>
<p class="caption"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../developer_guide/index.html">AiiDA design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../developer_guide/index.html#aiida-core">AiiDA core</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../developer_guide/index.html#aiida-plugins">AiiDA plugins</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../tutorial/index.html">StructureData</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tutorial/index.html#pseudopotentials">Pseudopotentials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tutorial/index.html#plugin-development">Plugin development</a></li>
</ul>
<p class="caption"><span class="caption-text">API reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="`aiida package &lt;https://aiida-core.readthedocs.io/en/latest/apidoc/aiida.html&gt;`_">`aiida package &lt;https://aiida-core.readthedocs.io/en/latest/apidoc/aiida.html&gt;`_</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">AiiDA</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../../../aiida.html">aiida</a> &raquo;</li>
        
      <li>aiida.schedulers.plugins.sge</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for aiida.schedulers.plugins.sge</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1">###########################################################################</span>
<span class="c1"># Copyright (c), The AiiDA team. All rights reserved.                     #</span>
<span class="c1"># This file is part of the AiiDA code.                                    #</span>
<span class="c1">#                                                                         #</span>
<span class="c1"># The code is hosted on GitHub at https://github.com/aiidateam/aiida_core #</span>
<span class="c1"># For further information on the license, see the LICENSE.txt file        #</span>
<span class="c1"># For further information please visit http://www.aiida.net               #</span>
<span class="c1">###########################################################################</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Plugin for SGE.</span>
<span class="sd">This has been tested on GE 6.2u3.</span>

<span class="sd">Plugin originally written by Marco Dorigo.</span>
<span class="sd">Email: marco(DOT)dorigo(AT)rub(DOT)de</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">print_function</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">division</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">absolute_import</span>
<span class="kn">import</span> <span class="nn">xml.parsers.expat</span>
<span class="kn">import</span> <span class="nn">xml.dom.minidom</span>

<span class="kn">from</span> <span class="nn">aiida.common.escaping</span> <span class="k">import</span> <span class="n">escape_for_bash</span>
<span class="kn">import</span> <span class="nn">aiida.schedulers</span>
<span class="kn">from</span> <span class="nn">aiida.schedulers</span> <span class="k">import</span> <span class="n">SchedulerError</span><span class="p">,</span> <span class="n">SchedulerParsingError</span>
<span class="kn">from</span> <span class="nn">aiida.schedulers.datastructures</span> <span class="k">import</span> <span class="p">(</span><span class="n">JobInfo</span><span class="p">,</span> <span class="n">JobState</span><span class="p">,</span> <span class="n">ParEnvJobResource</span><span class="p">)</span>

<span class="c1"># &#39;http://www.loni.ucla.edu/twiki/bin/view/Infrastructure/GridComputing?skin=plain&#39;:</span>
<span class="c1"># Jobs Status:</span>
<span class="c1">#     &#39;qw&#39; - Queued and waiting,</span>
<span class="c1">#     &#39;w&#39; - Job waiting,</span>
<span class="c1">#     &#39;s&#39; - Job suspended,</span>
<span class="c1">#     &#39;t&#39; - Job transferring and about to start,</span>
<span class="c1">#     &#39;r&#39; - Job running,</span>
<span class="c1">#     &#39;h&#39; - Job hold,</span>
<span class="c1">#     &#39;R&#39; - Job restarted,</span>
<span class="c1">#     &#39;d&#39; - Job has been marked for deletion,</span>
<span class="c1">#     &#39;Eqw&#39; - An error occurred with the job.</span>
<span class="c1">#</span>
<span class="c1"># &#39;http://confluence.rcs.griffith.edu.au:8080/display/v20zCluster/</span>
<span class="c1"># Sun+Grid+Engine+SGE+state+letter+symbol+codes+meanings&#39;:</span>
<span class="c1">#</span>
<span class="c1"># Category     State     SGE Letter Code</span>
<span class="c1"># Pending:     pending     qw</span>
<span class="c1"># Pending:     pending, user hold     qw</span>
<span class="c1"># Pending:     pending, system hold     hqw</span>
<span class="c1"># Pending:     pending, user and system hold     hqw</span>
<span class="c1"># Pending:     pending, user hold, re-queue     hRwq</span>
<span class="c1"># Pending:     pending, system hold, re-queue     hRwq</span>
<span class="c1"># Pending:     pending, user and system hold, re-queue     hRwq</span>
<span class="c1"># Pending:     pending, user hold     qw</span>
<span class="c1"># Pending:     pending, user hold     qw</span>
<span class="c1"># Running     running     r</span>
<span class="c1"># Running     transferring     t</span>
<span class="c1"># Running     running, re-submit     Rr</span>
<span class="c1"># Running     transferring, re-submit     Rt</span>
<span class="c1"># Suspended     job suspended     s, ts</span>
<span class="c1"># Suspended     queue suspended     S, tS</span>
<span class="c1"># Suspended     queue suspended by alarm     T, tT</span>
<span class="c1"># Suspended     all suspended with re-submit     Rs, Rts, RS, RtS, RT, RtT</span>
<span class="c1"># Error     all pending states with error     Eqw, Ehqw, EhRqw</span>
<span class="c1"># Deleted     all running and suspended states with deletion     dr, dt, dRr, dRt,</span>
<span class="c1">#                                                                ds, dS, dT, dRs,</span>
<span class="c1">#                                                                dRS, dRT</span>
<span class="n">_MAP_STATUS_SGE</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;qw&#39;</span><span class="p">:</span> <span class="n">JobState</span><span class="o">.</span><span class="n">QUEUED</span><span class="p">,</span>
    <span class="s1">&#39;w&#39;</span><span class="p">:</span> <span class="n">JobState</span><span class="o">.</span><span class="n">QUEUED</span><span class="p">,</span>
    <span class="s1">&#39;hqw&#39;</span><span class="p">:</span> <span class="n">JobState</span><span class="o">.</span><span class="n">QUEUED_HELD</span><span class="p">,</span>
    <span class="s1">&#39;hRwq&#39;</span><span class="p">:</span> <span class="n">JobState</span><span class="o">.</span><span class="n">QUEUED_HELD</span><span class="p">,</span>
    <span class="s1">&#39;r&#39;</span><span class="p">:</span> <span class="n">JobState</span><span class="o">.</span><span class="n">RUNNING</span><span class="p">,</span>
    <span class="s1">&#39;t&#39;</span><span class="p">:</span> <span class="n">JobState</span><span class="o">.</span><span class="n">RUNNING</span><span class="p">,</span>
    <span class="s1">&#39;R&#39;</span><span class="p">:</span> <span class="n">JobState</span><span class="o">.</span><span class="n">RUNNING</span><span class="p">,</span>
    <span class="s1">&#39;Rr&#39;</span><span class="p">:</span> <span class="n">JobState</span><span class="o">.</span><span class="n">RUNNING</span><span class="p">,</span>
    <span class="s1">&#39;Rt&#39;</span><span class="p">:</span> <span class="n">JobState</span><span class="o">.</span><span class="n">RUNNING</span><span class="p">,</span>
    <span class="s1">&#39;s&#39;</span><span class="p">:</span> <span class="n">JobState</span><span class="o">.</span><span class="n">SUSPENDED</span><span class="p">,</span>
    <span class="s1">&#39;st&#39;</span><span class="p">:</span> <span class="n">JobState</span><span class="o">.</span><span class="n">SUSPENDED</span><span class="p">,</span>
    <span class="s1">&#39;Rs&#39;</span><span class="p">:</span> <span class="n">JobState</span><span class="o">.</span><span class="n">SUSPENDED</span><span class="p">,</span>
    <span class="s1">&#39;Rts&#39;</span><span class="p">:</span> <span class="n">JobState</span><span class="o">.</span><span class="n">SUSPENDED</span><span class="p">,</span>
    <span class="s1">&#39;dr&#39;</span><span class="p">:</span> <span class="n">JobState</span><span class="o">.</span><span class="n">UNDETERMINED</span><span class="p">,</span>
    <span class="s1">&#39;dt&#39;</span><span class="p">:</span> <span class="n">JobState</span><span class="o">.</span><span class="n">UNDETERMINED</span><span class="p">,</span>
    <span class="s1">&#39;ds&#39;</span><span class="p">:</span> <span class="n">JobState</span><span class="o">.</span><span class="n">UNDETERMINED</span><span class="p">,</span>
    <span class="s1">&#39;dRr&#39;</span><span class="p">:</span> <span class="n">JobState</span><span class="o">.</span><span class="n">UNDETERMINED</span><span class="p">,</span>
    <span class="s1">&#39;dRt&#39;</span><span class="p">:</span> <span class="n">JobState</span><span class="o">.</span><span class="n">UNDETERMINED</span><span class="p">,</span>
    <span class="s1">&#39;dRs&#39;</span><span class="p">:</span> <span class="n">JobState</span><span class="o">.</span><span class="n">UNDETERMINED</span><span class="p">,</span>
    <span class="s1">&#39;Eqw&#39;</span><span class="p">:</span> <span class="n">JobState</span><span class="o">.</span><span class="n">UNDETERMINED</span><span class="p">,</span>
    <span class="s1">&#39;Ehqw&#39;</span><span class="p">:</span> <span class="n">JobState</span><span class="o">.</span><span class="n">UNDETERMINED</span><span class="p">,</span>
    <span class="s1">&#39;EhRqw&#39;</span><span class="p">:</span> <span class="n">JobState</span><span class="o">.</span><span class="n">UNDETERMINED</span>
<span class="p">}</span>


<div class="viewcode-block" id="SgeJobResource"><a class="viewcode-back" href="../../../../apidoc/aiida.schedulers.plugins.html#aiida.schedulers.plugins.sge.SgeJobResource">[docs]</a><span class="k">class</span> <span class="nc">SgeJobResource</span><span class="p">(</span><span class="n">ParEnvJobResource</span><span class="p">):</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="SgeScheduler"><a class="viewcode-back" href="../../../../apidoc/aiida.schedulers.plugins.html#aiida.schedulers.plugins.sge.SgeScheduler">[docs]</a><span class="k">class</span> <span class="nc">SgeScheduler</span><span class="p">(</span><span class="n">aiida</span><span class="o">.</span><span class="n">schedulers</span><span class="o">.</span><span class="n">Scheduler</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Support for the Sun Grid Engine scheduler and its variants/forks (Son of Grid Engine, Oracle Grid Engine, ...)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_logger</span> <span class="o">=</span> <span class="n">aiida</span><span class="o">.</span><span class="n">schedulers</span><span class="o">.</span><span class="n">Scheduler</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">getChild</span><span class="p">(</span><span class="s1">&#39;sge&#39;</span><span class="p">)</span>

    <span class="c1"># For SGE, we can have a good qstat xml output by querying by</span>
    <span class="c1"># user, but not by job id</span>
    <span class="n">_features</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;can_query_by_user&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="c1"># The class to be used for the job resource.</span>
    <span class="n">_job_resource_class</span> <span class="o">=</span> <span class="n">SgeJobResource</span>

<div class="viewcode-block" id="SgeScheduler._get_joblist_command"><a class="viewcode-back" href="../../../../apidoc/aiida.schedulers.plugins.html#aiida.schedulers.plugins.sge.SgeScheduler._get_joblist_command">[docs]</a>    <span class="k">def</span> <span class="nf">_get_joblist_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jobs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The command to report full information on existing jobs.</span>

<span class="sd">        TODO: in the case of job arrays, decide what to do (i.e., if we want</span>
<span class="sd">              to pass the -t options to list each subjob).</span>

<span class="sd">        !!!ALL COPIED FROM PBSPRO!!!</span>
<span class="sd">        TODO: understand if it is worth escaping the username,</span>
<span class="sd">        or rather leave it unescaped to allow to pass $USER</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">aiida.common.exceptions</span> <span class="k">import</span> <span class="n">FeatureNotAvailable</span>

        <span class="k">if</span> <span class="n">jobs</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">FeatureNotAvailable</span><span class="p">(</span><span class="s2">&quot;Cannot query by jobid in SGE&quot;</span><span class="p">)</span>

        <span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;qstat -ext -urg -xml &quot;</span>

        <span class="k">if</span> <span class="n">user</span><span class="p">:</span>
            <span class="n">command</span> <span class="o">+=</span> <span class="s2">&quot;-u </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">user</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># All users if no user is specified</span>
            <span class="n">command</span> <span class="o">+=</span> <span class="s2">&quot;-u &#39;*&#39;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;qstat command: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">command</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">command</span></div>
        <span class="c1"># raise NotImplementedError</span>

<div class="viewcode-block" id="SgeScheduler._get_detailed_jobinfo_command"><a class="viewcode-back" href="../../../../apidoc/aiida.schedulers.plugins.html#aiida.schedulers.plugins.sge.SgeScheduler._get_detailed_jobinfo_command">[docs]</a>    <span class="k">def</span> <span class="nf">_get_detailed_jobinfo_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jobid</span><span class="p">):</span>
        <span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;qacct -j </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">escape_for_bash</span><span class="p">(</span><span class="n">jobid</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">command</span></div>

<div class="viewcode-block" id="SgeScheduler._get_submit_script_header"><a class="viewcode-back" href="../../../../apidoc/aiida.schedulers.plugins.html#aiida.schedulers.plugins.sge.SgeScheduler._get_submit_script_header">[docs]</a>    <span class="k">def</span> <span class="nf">_get_submit_script_header</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job_tmpl</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the submit script header, using the parameters from the</span>
<span class="sd">        job_tmpl.</span>

<span class="sd">        Args:</span>
<span class="sd">           job_tmpl: an JobTemplate instance with relevant parameters set.</span>

<span class="sd">        TODO: truncate the title if too long</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">re</span>
        <span class="kn">import</span> <span class="nn">string</span>

        <span class="n">empty_line</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># SGE provides flags for wd and cwd</span>
        <span class="k">if</span> <span class="n">job_tmpl</span><span class="o">.</span><span class="n">working_directory</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;#$ -wd </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">job_tmpl</span><span class="o">.</span><span class="n">working_directory</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;#$ -cwd&#39;</span><span class="p">)</span>

        <span class="c1"># Enforce bash shell</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;#$ -S /bin/bash&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">job_tmpl</span><span class="o">.</span><span class="n">submit_as_hold</span><span class="p">:</span>
            <span class="c1"># if isinstance(job_tmpl.submit_as_hold, str):</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;#$ -h </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">job_tmpl</span><span class="o">.</span><span class="n">submit_as_hold</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">job_tmpl</span><span class="o">.</span><span class="n">rerunnable</span><span class="p">:</span>
            <span class="c1"># if isinstance(job_tmpl.rerunnable, str):</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;#$ -r </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">job_tmpl</span><span class="o">.</span><span class="n">rerunnable</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">job_tmpl</span><span class="o">.</span><span class="n">email</span><span class="p">:</span>
            <span class="c1"># If not specified, but email events are set, PBSPro</span>
            <span class="c1"># sends the mail to the job owner by default</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;#$ -M </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">job_tmpl</span><span class="o">.</span><span class="n">email</span><span class="p">))</span>

        <span class="n">email_events</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="n">job_tmpl</span><span class="o">.</span><span class="n">email_on_started</span><span class="p">:</span>
            <span class="n">email_events</span> <span class="o">+=</span> <span class="s2">&quot;b&quot;</span>
        <span class="k">if</span> <span class="n">job_tmpl</span><span class="o">.</span><span class="n">email_on_terminated</span><span class="p">:</span>
            <span class="n">email_events</span> <span class="o">+=</span> <span class="s2">&quot;ea&quot;</span>
        <span class="k">if</span> <span class="n">email_events</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;#$ -m </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">email_events</span><span class="p">))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">job_tmpl</span><span class="o">.</span><span class="n">email</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Email triggers provided to SGE script for job,&quot;</span>
                                 <span class="s2">&quot;but no email field set; will send emails to &quot;</span>
                                 <span class="s2">&quot;the job owner as set in the scheduler&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;#$ -m n&quot;</span><span class="p">)</span>

        <span class="c1"># From the qsub man page:</span>
        <span class="c1"># &quot;The name may be any arbitrary alphanumeric ASCII string, but</span>
        <span class="c1"># may  not contain  &quot;\n&quot;, &quot;\t&quot;, &quot;\r&quot;, &quot;/&quot;, &quot;:&quot;, &quot;@&quot;, &quot;\&quot;, &quot;*&quot;,</span>
        <span class="c1"># or &quot;?&quot;.&quot;</span>
        <span class="k">if</span> <span class="n">job_tmpl</span><span class="o">.</span><span class="n">job_name</span><span class="p">:</span>
            <span class="n">job_title</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[^a-zA-Z0-9_.-]+&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">job_tmpl</span><span class="o">.</span><span class="n">job_name</span><span class="p">)</span>

            <span class="c1"># prepend a &#39;j&#39; (for &#39;job&#39;) before the string if the string</span>
            <span class="c1"># is now empty or does not start with a valid character</span>
            <span class="c1"># (the first symbol cannot be digit, at least in some versions</span>
            <span class="c1">#  of the scheduler)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">job_title</span> <span class="ow">or</span> <span class="p">(</span><span class="n">job_title</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">string</span><span class="o">.</span><span class="n">ascii_letters</span><span class="p">):</span>
                <span class="n">job_title</span> <span class="o">=</span> <span class="s1">&#39;j&#39;</span> <span class="o">+</span> <span class="n">job_title</span>

            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;#$ -N </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">job_tmpl</span><span class="o">.</span><span class="n">job_name</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">job_tmpl</span><span class="o">.</span><span class="n">import_sys_environment</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;#$ -V&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">job_tmpl</span><span class="o">.</span><span class="n">sched_output_path</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;#$ -o </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">job_tmpl</span><span class="o">.</span><span class="n">sched_output_path</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">job_tmpl</span><span class="o">.</span><span class="n">sched_join_files</span><span class="p">:</span>
            <span class="c1"># from qsub man page:</span>
            <span class="c1"># &#39;y&#39;: Standard error and standard output are merged  into</span>
            <span class="c1">#       standard output</span>
            <span class="c1"># &#39;n&#39; : Standard error and standard output are not merged (default)</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;#$ -j y&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">job_tmpl</span><span class="o">.</span><span class="n">sched_error_path</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;sched_join_files is True, but sched_error_path is set in &quot;</span>
                                 <span class="s2">&quot;SGE script; ignoring sched_error_path&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">job_tmpl</span><span class="o">.</span><span class="n">sched_error_path</span><span class="p">:</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;#$ -e </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">job_tmpl</span><span class="o">.</span><span class="n">sched_error_path</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">job_tmpl</span><span class="o">.</span><span class="n">queue_name</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;#$ -q </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">job_tmpl</span><span class="o">.</span><span class="n">queue_name</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">job_tmpl</span><span class="o">.</span><span class="n">account</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;#$ -P </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">job_tmpl</span><span class="o">.</span><span class="n">account</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">job_tmpl</span><span class="o">.</span><span class="n">priority</span><span class="p">:</span>
            <span class="c1"># Priority of the job.  Format: host-dependent integer.  Default:</span>
            <span class="c1"># zero.   Range:  [-1023,  +1024].  Sets job&#39;s Priority</span>
            <span class="c1"># attribute to priority.</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;#$ -p </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">job_tmpl</span><span class="o">.</span><span class="n">priority</span><span class="p">))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">job_tmpl</span><span class="o">.</span><span class="n">job_resource</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Job resources (as the tot_num_mpiprocs) are required for the SGE scheduler plugin&quot;</span><span class="p">)</span>
        <span class="c1"># Setting up the parallel environment</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;#$ -pe </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span> \
                     <span class="nb">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">job_tmpl</span><span class="o">.</span><span class="n">job_resource</span><span class="o">.</span><span class="n">parallel_env</span><span class="p">),</span> \
                            <span class="nb">int</span><span class="p">(</span><span class="n">job_tmpl</span><span class="o">.</span><span class="n">job_resource</span><span class="o">.</span><span class="n">tot_num_mpiprocs</span><span class="p">)))</span>

        <span class="k">if</span> <span class="n">job_tmpl</span><span class="o">.</span><span class="n">max_wallclock_seconds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">tot_secs</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">job_tmpl</span><span class="o">.</span><span class="n">max_wallclock_seconds</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">tot_secs</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;max_wallclock_seconds must be &quot;</span>
                                 <span class="s2">&quot;a positive integer (in seconds)! It is instead &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span>
                                 <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">((</span><span class="n">job_tmpl</span><span class="o">.</span><span class="n">max_wallclock_seconds</span><span class="p">)))</span>
            <span class="n">hours</span> <span class="o">=</span> <span class="n">tot_secs</span> <span class="o">//</span> <span class="mi">3600</span>
            <span class="n">tot_minutes</span> <span class="o">=</span> <span class="n">tot_secs</span> <span class="o">%</span> <span class="mi">3600</span>
            <span class="n">minutes</span> <span class="o">=</span> <span class="n">tot_minutes</span> <span class="o">//</span> <span class="mi">60</span>
            <span class="n">seconds</span> <span class="o">=</span> <span class="n">tot_minutes</span> <span class="o">%</span> <span class="mi">60</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;#$ -l h_rt=</span><span class="si">{:02d}</span><span class="s2">:</span><span class="si">{:02d}</span><span class="s2">:</span><span class="si">{:02d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">hours</span><span class="p">,</span> <span class="n">minutes</span><span class="p">,</span> <span class="n">seconds</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">job_tmpl</span><span class="o">.</span><span class="n">custom_scheduler_commands</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">job_tmpl</span><span class="o">.</span><span class="n">custom_scheduler_commands</span><span class="p">)</span>

        <span class="c1"># TAKEN FROM PBSPRO:</span>
        <span class="c1"># Job environment variables are to be set on one single line.</span>
        <span class="c1"># This is a tough job due to the escaping of commas, etc.</span>
        <span class="c1"># moreover, I am having issues making it work.</span>
        <span class="c1"># Therefore, I assume that this is bash and export variables by</span>
        <span class="c1"># and.</span>
        <span class="k">if</span> <span class="n">job_tmpl</span><span class="o">.</span><span class="n">job_environment</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">empty_line</span><span class="p">)</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;# ENVIRONMENT VARIABLES BEGIN ###&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">job_tmpl</span><span class="o">.</span><span class="n">job_environment</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;If you provide job_environment, it must be a dictionary&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">job_tmpl</span><span class="o">.</span><span class="n">job_environment</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;export </span><span class="si">{}</span><span class="s2">=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="n">escape_for_bash</span><span class="p">(</span><span class="n">value</span><span class="p">)))</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;# ENVIRONMENT VARIABLES  END  ###&quot;</span><span class="p">)</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">empty_line</span><span class="p">)</span>

        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span></div>

<div class="viewcode-block" id="SgeScheduler._get_submit_command"><a class="viewcode-back" href="../../../../apidoc/aiida.schedulers.plugins.html#aiida.schedulers.plugins.sge.SgeScheduler._get_submit_command">[docs]</a>    <span class="k">def</span> <span class="nf">_get_submit_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">submit_script</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the string to execute to submit a given script.</span>

<span class="sd">        Args:</span>
<span class="sd">            submit_script: the path of the submit script relative to the working</span>
<span class="sd">                directory.</span>
<span class="sd">                IMPORTANT: submit_script should be already escaped.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">submit_command</span> <span class="o">=</span> <span class="s1">&#39;qsub -terse </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">submit_script</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;submitting with: &quot;</span> <span class="o">+</span> <span class="n">submit_command</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">submit_command</span></div>

<div class="viewcode-block" id="SgeScheduler._parse_joblist_output"><a class="viewcode-back" href="../../../../apidoc/aiida.schedulers.plugins.html#aiida.schedulers.plugins.sge.SgeScheduler._parse_joblist_output">[docs]</a>    <span class="k">def</span> <span class="nf">_parse_joblist_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">retval</span><span class="p">,</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">retval</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error in _parse_joblist_output: retval=</span><span class="si">{}</span><span class="s2">; &quot;</span>
                              <span class="s2">&quot;stdout=</span><span class="si">{}</span><span class="s2">; stderr=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">retval</span><span class="p">,</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">SchedulerError</span><span class="p">(</span><span class="s2">&quot;Error during joblist retrieval, retval=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span> \
                                 <span class="nb">format</span><span class="p">(</span><span class="n">retval</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">stderr</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;in _parse_joblist_output for </span><span class="si">{}</span><span class="s2">: &quot;</span>
                                <span class="s2">&quot;there was some text in stderr: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="p">),</span> <span class="n">stderr</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">stdout</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">xmldata</span> <span class="o">=</span> <span class="n">xml</span><span class="o">.</span><span class="n">dom</span><span class="o">.</span><span class="n">minidom</span><span class="o">.</span><span class="n">parseString</span><span class="p">(</span><span class="n">stdout</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">xml</span><span class="o">.</span><span class="n">parsers</span><span class="o">.</span><span class="n">expat</span><span class="o">.</span><span class="n">ExpatError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;in sge._parse_joblist_output: xml parsing of stdout failed:&quot;</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">stdout</span><span class="p">))</span>
                <span class="k">raise</span> <span class="n">SchedulerParsingError</span><span class="p">(</span><span class="s2">&quot;Error during joblist retrieval,&quot;</span> <span class="s2">&quot;xml parsing of stdout failed&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error in sge._parse_joblist_output: retval=</span><span class="si">{}</span><span class="s2">; &quot;</span>
                              <span class="s2">&quot;stdout=</span><span class="si">{}</span><span class="s2">; stderr=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">retval</span><span class="p">,</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">SchedulerError</span><span class="p">(</span><span class="s2">&quot;Error during joblist retrieval,&quot;</span> <span class="s2">&quot;no stdout produced&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">first_child</span> <span class="o">=</span> <span class="n">xmldata</span><span class="o">.</span><span class="n">firstChild</span>
            <span class="n">second_childs</span> <span class="o">=</span> <span class="n">first_child</span><span class="o">.</span><span class="n">childNodes</span>
            <span class="n">tag_names_sec</span> <span class="o">=</span> <span class="p">[</span><span class="n">elem</span><span class="o">.</span><span class="n">tagName</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">second_childs</span> \
                             <span class="k">if</span> <span class="n">elem</span><span class="o">.</span><span class="n">nodeType</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;queue_info&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tag_names_sec</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error in sge._parse_joblist_output: &quot;</span>
                                  <span class="s2">&quot;no queue_info: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span> \
                                  <span class="nb">format</span><span class="p">(</span><span class="n">stdout</span><span class="p">))</span>
                <span class="k">raise</span> <span class="n">SchedulerError</span>
            <span class="k">if</span> <span class="s1">&#39;job_info&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tag_names_sec</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error in sge._parse_joblist_output: &quot;</span>
                                  <span class="s2">&quot;no job_info: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span> \
                                  <span class="nb">format</span><span class="p">(</span><span class="n">stdout</span><span class="p">))</span>
                <span class="k">raise</span> <span class="n">SchedulerError</span>
        <span class="k">except</span> <span class="n">SchedulerError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error in sge._parse_joblist_output: stdout=</span><span class="si">{}</span><span class="s2">&quot;</span> \
                              <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">stdout</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">SchedulerError</span><span class="p">(</span><span class="s2">&quot;Error during xml processing, of stdout:&quot;</span>
                                 <span class="s2">&quot;There is no &#39;job_info&#39; or no &#39;queue_info&#39;&quot;</span>
                                 <span class="s2">&quot;element or there are no jobs!&quot;</span><span class="p">)</span>
        <span class="c1"># If something weird happens while firstChild, pop, etc:</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error in sge._parse_joblist_output: stdout=</span><span class="si">{}</span><span class="s2">&quot;</span> \
                              <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">stdout</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">SchedulerError</span><span class="p">(</span><span class="s2">&quot;Error during xml processing, of stdout&quot;</span><span class="p">)</span>

        <span class="n">jobs</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">first_child</span><span class="o">.</span><span class="n">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;job_list&#39;</span><span class="p">)]</span>
        <span class="c1"># jobs = [i for i in jobinfo.getElementsByTagName(&#39;job_list&#39;)]</span>
        <span class="c1"># print [i[0].childNodes[0].data for i in job_numbers if i]</span>
        <span class="n">joblist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">job</span> <span class="ow">in</span> <span class="n">jobs</span><span class="p">:</span>
            <span class="n">this_job</span> <span class="o">=</span> <span class="n">JobInfo</span><span class="p">()</span>

            <span class="c1"># In case the user needs more information the xml-data for</span>
            <span class="c1"># each job is stored:</span>
            <span class="n">this_job</span><span class="o">.</span><span class="n">raw_data</span> <span class="o">=</span> <span class="n">job</span><span class="o">.</span><span class="n">toxml</span><span class="p">()</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">job_element</span> <span class="o">=</span> <span class="n">job</span><span class="o">.</span><span class="n">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;JB_job_number&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">element_child</span> <span class="o">=</span> <span class="n">job_element</span><span class="o">.</span><span class="n">childNodes</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">this_job</span><span class="o">.</span><span class="n">job_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">element_child</span><span class="o">.</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">this_job</span><span class="o">.</span><span class="n">job_id</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">SchedulerError</span>
            <span class="k">except</span> <span class="n">SchedulerError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error in sge._parse_joblist_output:&quot;</span>
                                  <span class="s2">&quot;no job id is given, stdout=</span><span class="si">{}</span><span class="s2">&quot;</span> \
                                  <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">stdout</span><span class="p">))</span>
                <span class="k">raise</span> <span class="n">SchedulerError</span><span class="p">(</span><span class="s2">&quot;Error in sge._parse_joblist_output:&quot;</span> <span class="s2">&quot;no job id is given&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;No &#39;job_number&#39; given for job index </span><span class="si">{}</span><span class="s2"> in &quot;</span>
                                  <span class="s2">&quot;job list, stdout=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">jobs</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">job</span><span class="p">)</span> \
                                                               <span class="p">,</span> <span class="n">stdout</span><span class="p">))</span>
                <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s2">&quot;Error in sge._parse_joblist_output:&quot;</span> <span class="s2">&quot;no job id is given&quot;</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">job_element</span> <span class="o">=</span> <span class="n">job</span><span class="o">.</span><span class="n">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;state&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">element_child</span> <span class="o">=</span> <span class="n">job_element</span><span class="o">.</span><span class="n">childNodes</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">job_state_string</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">element_child</span><span class="o">.</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">this_job</span><span class="o">.</span><span class="n">job_state</span> <span class="o">=</span> <span class="n">_MAP_STATUS_SGE</span><span class="p">[</span><span class="n">job_state_string</span><span class="p">]</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Unrecognized job_state &#39;</span><span class="si">{}</span><span class="s2">&#39; for job &quot;</span>
                                        <span class="s2">&quot;id </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">job_state_string</span><span class="p">,</span> <span class="n">this_job</span><span class="o">.</span><span class="n">job_id</span><span class="p">))</span>
                    <span class="n">this_job</span><span class="o">.</span><span class="n">job_state</span> <span class="o">=</span> <span class="n">JobState</span><span class="o">.</span><span class="n">UNDETERMINED</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No &#39;job_state&#39; field for job id </span><span class="si">{}</span><span class="s2"> in&quot;</span> <span class="s2">&quot;stdout=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">this_job</span><span class="o">.</span><span class="n">job_id</span><span class="p">,</span> <span class="n">stdout</span><span class="p">))</span>
                <span class="n">this_job</span><span class="o">.</span><span class="n">job_state</span> <span class="o">=</span> <span class="n">JobState</span><span class="o">.</span><span class="n">UNDETERMINED</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">job_element</span> <span class="o">=</span> <span class="n">job</span><span class="o">.</span><span class="n">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;JB_owner&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">element_child</span> <span class="o">=</span> <span class="n">job_element</span><span class="o">.</span><span class="n">childNodes</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">this_job</span><span class="o">.</span><span class="n">job_owner</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">element_child</span><span class="o">.</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No &#39;job_owner&#39; field for job id </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">this_job</span><span class="o">.</span><span class="n">job_id</span><span class="p">))</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">job_element</span> <span class="o">=</span> <span class="n">job</span><span class="o">.</span><span class="n">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;JB_name&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">element_child</span> <span class="o">=</span> <span class="n">job_element</span><span class="o">.</span><span class="n">childNodes</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">this_job</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">element_child</span><span class="o">.</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No &#39;title&#39; field for job id </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">this_job</span><span class="o">.</span><span class="n">job_id</span><span class="p">))</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">job_element</span> <span class="o">=</span> <span class="n">job</span><span class="o">.</span><span class="n">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;queue_name&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">element_child</span> <span class="o">=</span> <span class="n">job_element</span><span class="o">.</span><span class="n">childNodes</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">this_job</span><span class="o">.</span><span class="n">queue_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">element_child</span><span class="o">.</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">this_job</span><span class="o">.</span><span class="n">job_state</span> <span class="o">==</span> <span class="n">JobState</span><span class="o">.</span><span class="n">RUNNING</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No &#39;queue_name&#39; field for job id </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">this_job</span><span class="o">.</span><span class="n">job_id</span><span class="p">))</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">job_element</span> <span class="o">=</span> <span class="n">job</span><span class="o">.</span><span class="n">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;JB_submission_time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">element_child</span> <span class="o">=</span> <span class="n">job_element</span><span class="o">.</span><span class="n">childNodes</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">time_string</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">element_child</span><span class="o">.</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">this_job</span><span class="o">.</span><span class="n">submission_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_time_string</span><span class="p">(</span><span class="n">time_string</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Error parsing &#39;JB_submission_time&#39; &quot;</span>
                                        <span class="s2">&quot;for job id </span><span class="si">{}</span><span class="s2"> (&#39;</span><span class="si">{}</span><span class="s2">&#39;)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">this_job</span><span class="o">.</span><span class="n">job_id</span><span class="p">,</span> <span class="n">time_string</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">job_element</span> <span class="o">=</span> <span class="n">job</span><span class="o">.</span><span class="n">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;JAT_start_time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                    <span class="n">element_child</span> <span class="o">=</span> <span class="n">job_element</span><span class="o">.</span><span class="n">childNodes</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                    <span class="n">time_string</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">element_child</span><span class="o">.</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">this_job</span><span class="o">.</span><span class="n">dispatch_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_time_string</span><span class="p">(</span><span class="n">time_string</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Error parsing &#39;JAT_start_time&#39;&quot;</span>
                                            <span class="s2">&quot;for job id </span><span class="si">{}</span><span class="s2"> (&#39;</span><span class="si">{}</span><span class="s2">&#39;)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">this_job</span><span class="o">.</span><span class="n">job_id</span><span class="p">,</span> <span class="n">time_string</span><span class="p">))</span>
                <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No &#39;JB_submission_time&#39; and no &quot;</span>
                                        <span class="s2">&quot;&#39;JAT_start_time&#39; field for job &quot;</span>
                                        <span class="s2">&quot;id </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">this_job</span><span class="o">.</span><span class="n">job_id</span><span class="p">))</span>

            <span class="c1"># There is also cpu_usage, mem_usage, io_usage information available:</span>
            <span class="k">if</span> <span class="n">this_job</span><span class="o">.</span><span class="n">job_state</span> <span class="o">==</span> <span class="n">JobState</span><span class="o">.</span><span class="n">RUNNING</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">job_element</span> <span class="o">=</span> <span class="n">job</span><span class="o">.</span><span class="n">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;slots&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                    <span class="n">element_child</span> <span class="o">=</span> <span class="n">job_element</span><span class="o">.</span><span class="n">childNodes</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                    <span class="n">this_job</span><span class="o">.</span><span class="n">num_mpiprocs</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">element_child</span><span class="o">.</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No &#39;slots&#39; field for job id </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">this_job</span><span class="o">.</span><span class="n">job_id</span><span class="p">))</span>

            <span class="n">joblist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">this_job</span><span class="p">)</span>
        <span class="c1"># self.logger.debug(&quot;joblist final: {}&quot;.format(joblist))</span>
        <span class="k">return</span> <span class="n">joblist</span></div>

<div class="viewcode-block" id="SgeScheduler._parse_submit_output"><a class="viewcode-back" href="../../../../apidoc/aiida.schedulers.plugins.html#aiida.schedulers.plugins.sge.SgeScheduler._parse_submit_output">[docs]</a>    <span class="k">def</span> <span class="nf">_parse_submit_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">retval</span><span class="p">,</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parse the output of the submit command, as returned by executing the</span>
<span class="sd">        command returned by _get_submit_command command.</span>

<span class="sd">        To be implemented by the plugin.</span>

<span class="sd">        Return a string with the JobID.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">retval</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error in _parse_submit_output: retval=</span><span class="si">{}</span><span class="s2">; &quot;</span>
                              <span class="s2">&quot;stdout=</span><span class="si">{}</span><span class="s2">; stderr=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">retval</span><span class="p">,</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">SchedulerError</span><span class="p">(</span><span class="s2">&quot;Error during submission, retval=</span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span>
                                 <span class="s2">&quot;stdout=</span><span class="si">{}</span><span class="se">\n</span><span class="s2">stderr=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">retval</span><span class="p">,</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">stderr</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;in _parse_submit_output for </span><span class="si">{}</span><span class="s2">: &quot;</span>
                                <span class="s2">&quot;there was some text in stderr: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="p">),</span> <span class="n">stderr</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">stdout</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span></div>

<div class="viewcode-block" id="SgeScheduler._parse_time_string"><a class="viewcode-back" href="../../../../apidoc/aiida.schedulers.plugins.html#aiida.schedulers.plugins.sge.SgeScheduler._parse_time_string">[docs]</a>    <span class="k">def</span> <span class="nf">_parse_time_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">string</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">T%H:%M:%S&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parse a time string in the format returned from qstat -xml -ext and</span>
<span class="sd">        returns a datetime object.</span>
<span class="sd">        Example format: 2013-06-13T11:53:11</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">time</span>
        <span class="kn">import</span> <span class="nn">datetime</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">time_struct</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">fmt</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Unable to parse time string </span><span class="si">{}</span><span class="s2">, the message was </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">exc</span><span class="p">))</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Problem parsing the time string.&quot;</span><span class="p">)</span>

        <span class="c1"># I convert from a time_struct to a datetime object going through</span>
        <span class="c1"># the seconds since epoch, as suggested on stackoverflow:</span>
        <span class="c1"># http://stackoverflow.com/questions/1697815</span>
        <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">mktime</span><span class="p">(</span><span class="n">time_struct</span><span class="p">))</span></div>

<div class="viewcode-block" id="SgeScheduler._get_kill_command"><a class="viewcode-back" href="../../../../apidoc/aiida.schedulers.plugins.html#aiida.schedulers.plugins.sge.SgeScheduler._get_kill_command">[docs]</a>    <span class="k">def</span> <span class="nf">_get_kill_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jobid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the command to kill the job with specified jobid.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">submit_command</span> <span class="o">=</span> <span class="s1">&#39;qdel </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">jobid</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;killing job </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">jobid</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">submit_command</span></div>

<div class="viewcode-block" id="SgeScheduler._parse_kill_output"><a class="viewcode-back" href="../../../../apidoc/aiida.schedulers.plugins.html#aiida.schedulers.plugins.sge.SgeScheduler._parse_kill_output">[docs]</a>    <span class="k">def</span> <span class="nf">_parse_kill_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">retval</span><span class="p">,</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parse the output of the kill command.</span>

<span class="sd">        To be implemented by the plugin.</span>

<span class="sd">        :return: True if everything seems ok, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">retval</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error in _parse_kill_output: retval=</span><span class="si">{}</span><span class="s2">; &quot;</span>
                              <span class="s2">&quot;stdout=</span><span class="si">{}</span><span class="s2">; stderr=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">retval</span><span class="p">,</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span><span class="p">))</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">stderr</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;in _parse_kill_output for </span><span class="si">{}</span><span class="s2">: &quot;</span>
                                <span class="s2">&quot;there was some text in stderr: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="p">),</span> <span class="n">stderr</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">stdout</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;in _parse_kill_output for </span><span class="si">{}</span><span class="s2">: &quot;</span>
                             <span class="s2">&quot;there was some text in stdout: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="p">),</span> <span class="n">stdout</span><span class="p">))</span>

        <span class="k">return</span> <span class="kc">True</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, ECOLE POLYTECHNIQUE FEDERALE DE LAUSANNE (Theory and Simulation of Materials (THEOS) and National Centre for Computational Design and Discovery of Novel Materials (NCCR MARVEL)), Switzerland and ROBERT BOSCH LLC, USA. All rights reserved

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>