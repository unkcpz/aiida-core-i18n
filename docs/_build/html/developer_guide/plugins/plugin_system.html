

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>The AiiDA Plugin System &mdash; AiiDA 1.0.0b2 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
        <script type="text/javascript" src="../../_static/contentui.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/contentui.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Data plugin - Float Summation" href="../devel_tutorial/code_plugin_float_sum.html" />
    <link rel="prev" title="Updating an Existing Plugin" href="update_plugin.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> AiiDA
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Installation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../install/quick_installation.html">Quick installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../install/prerequisites.html">Prerequisites</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../install/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../install/updating_installation.html">Updating AiiDA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../install/troubleshooting.html">Troubleshooting</a></li>
</ul>
<p class="caption"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../get_started/index.html">First things first</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../get_started/daemon.html">Setup the daemon</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../get_started/computers.html">Setup a computer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../get_started/codes.html">Setup a code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../get_started/plugins.html">Plugins</a></li>
</ul>
<p class="caption"><span class="caption-text">Concepts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../concepts/provenance.html">Provenance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../concepts/processes.html">Processes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../concepts/calculations.html">Calculations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../concepts/workflows.html">Workflows</a></li>
</ul>
<p class="caption"><span class="caption-text">Working with</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../working/processes.html">Processes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../working/functions.html">Calculation and work functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../working/calculations.html">Calculations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../working/workflows.html">Workflows</a></li>
</ul>
<p class="caption"><span class="caption-text">Working with AiiDA</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../working_with_aiida/index.html">Command line interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../working_with_aiida/index.html#scripting">Scripting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../working_with_aiida/index.html#data-types">Data types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../working_with_aiida/index.html#groups">Groups</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../working_with_aiida/index.html#schedulers">Schedulers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../working_with_aiida/index.html#querying-data">Querying data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../working_with_aiida/index.html#caching">Caching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../working_with_aiida/index.html#result-manager">Result manager</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../working_with_aiida/index.html#backups">Backups</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../working_with_aiida/index.html#troubleshooting">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../working_with_aiida/index.html#rest-api">REST API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../working_with_aiida/index.html#cookbook">Cookbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../import_export/index.html">Import and Export</a></li>
</ul>
<p class="caption"><span class="caption-text">Development</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">AiiDA design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../index.html#aiida-core">AiiDA core</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html#aiida-plugins">AiiDA plugins</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Plugin Development</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="basics.html">Basics</a></li>
<li class="toctree-l3"><a class="reference internal" href="quickstart.html">Quickstart</a></li>
<li class="toctree-l3"><a class="reference internal" href="entry_points.html">Entry Points</a></li>
<li class="toctree-l3"><a class="reference internal" href="documenting.html">Documenting a plugin</a></li>
<li class="toctree-l3"><a class="reference internal" href="publish.html">Publishing a plugin</a></li>
<li class="toctree-l3"><a class="reference internal" href="update_plugin.html">Updating an Existing Plugin</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">The AiiDA Plugin System</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="#goals">Goals</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mechanism-overview">Mechanism overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="#limitations">Limitations</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../devel_tutorial/code_plugin_float_sum.html">Data plugin - Float Summation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../devel_tutorial/plugin_tests.html">Writing tests for plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="../devel_tutorial/cmdline_plugin.html">Commandline plugin - Data subcommand</a></li>
<li class="toctree-l2"><a class="reference internal" href="../devel_tutorial/parser_warnings_policy.html">Parser warnings policy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../aiida_sphinxext.html">AiiDA Sphinx extension</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial/index.html">StructureData</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial/index.html#pseudopotentials">Pseudopotentials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial/index.html#plugin-development">Plugin development</a></li>
</ul>
<p class="caption"><span class="caption-text">API reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="`aiida package &lt;https://aiida-core.readthedocs.io/en/latest/apidoc/aiida.html&gt;`_">`aiida package &lt;https://aiida-core.readthedocs.io/en/latest/apidoc/aiida.html&gt;`_</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">AiiDA</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">AiiDA design</a> &raquo;</li>
        
          <li><a href="index.html">Plugin Development</a> &raquo;</li>
        
      <li>The AiiDA Plugin System</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/developer_guide/plugins/plugin_system.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="the-aiida-plugin-system">
<h1>The AiiDA Plugin System<a class="headerlink" href="#the-aiida-plugin-system" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>The plugin system is the part of AiiDA that enables sharing workflows and distributing extensions to the core capabilities of AiiDA.</p>
<p>Since both are written in python and shared as source code, we believe they should be distributed in the usual way for python code - python packages using <a class="reference external" href="http://setuptools.readthedocs.io/en/latest/setuptools.html">setuptools</a>. This provides a well documented install process familiar to all python users. It simplifies the user experience for sharing workflows and extensions, especially since this allows AiiDA to be distributed and deployed in the same way.</p>
</div>
<div class="section" id="goals">
<h2>Goals<a class="headerlink" href="#goals" title="Permalink to this headline">¶</a></h2>
<p>The goals of the plugin system are the following</p>
<div class="section" id="sharing-of-workflows-and-extensions">
<h3>Sharing of workflows and extensions<a class="headerlink" href="#sharing-of-workflows-and-extensions" title="Permalink to this headline">¶</a></h3>
<p>A workflow or extension is written as a python package, distributed as a zip source archive, python <code class="docutils literal notranslate"><span class="pre">egg</span></code> or PyPI package. There is extensive documentation available for how to distribute python packages <a class="reference external" href="https://packaging.python.org/">here</a>.</p>
</div>
<div class="section" id="ease-of-use">
<h3>Ease of use<a class="headerlink" href="#ease-of-use" title="Permalink to this headline">¶</a></h3>
<p>Plugins can be found in an online curated list of plugins and installed with one simple command. This process is familiar to every regular python user.</p>
</div>
<div class="section" id="decouple-development-and-update-cycles-of-aiida-and-plugins">
<h3>Decouple development and update cycles of AiiDA and plugins<a class="headerlink" href="#decouple-development-and-update-cycles-of-aiida-and-plugins" title="Permalink to this headline">¶</a></h3>
<p>Since plugins are separate python packages, they can be developed in a separate code repository and updated when the developer sees fit without a need to update AiiDA. Similarly, if AiiDA is updated, plugins may not need to release a new version.</p>
</div>
<div class="section" id="promote-modular-design-in-aiida-development">
<h3>Promote modular design in AiiDA development<a class="headerlink" href="#promote-modular-design-in-aiida-development" title="Permalink to this headline">¶</a></h3>
<p>Separating plugins into their own python packages ensures that plugins can not (easily) access parts of the AiiDA code which are not part of the public API, enabling AiiDA development to stay agile. The same applies to plugins relying on other plugins.</p>
</div>
<div class="section" id="low-overhead-for-developers">
<h3>Low overhead for developers<a class="headerlink" href="#low-overhead-for-developers" title="Permalink to this headline">¶</a></h3>
<p>Plugin developers can write their extensions the same way they would write any python code meant for distribution.</p>
</div>
<div class="section" id="automatic-aiida-setup-and-testing-of-plugins">
<h3>Automatic AiiDA setup and testing of plugins<a class="headerlink" href="#automatic-aiida-setup-and-testing-of-plugins" title="Permalink to this headline">¶</a></h3>
<p>Installation of complete python environments consisting of many packages can be automated, provided all packages use <code class="docutils literal notranslate"><span class="pre">setuptools</span></code> as a distribution tool. This enables use of AiiDA in a service-based way using, e.g., docker images. At the same it becomes possible to create automated tests for any combination of plugins, as long as the plugins provide test entry points.</p>
</div>
</div>
<div class="section" id="mechanism-overview">
<h2>Mechanism overview<a class="headerlink" href="#mechanism-overview" title="Permalink to this headline">¶</a></h2>
<p>The new plugin system (introduced in AiiDA 0.9) takes advantage of the already well established entry points mechanism within <a class="reference external" href="http://setuptools.readthedocs.io/en/latest/setuptools.html">setuptools</a>, documented in the section “<a class="reference external" href="http://setuptools.readthedocs.io/en/latest/setuptools.html#extensible-applications-and-frameworks">Extensible Applications and Frameworks</a>” in the <code class="docutils literal notranslate"><span class="pre">setuptools</span></code> documentation. (Previously, plugins had to install python modules directly into specific source folders of AiiDA).</p>
<p>Conceptually, an entry point consists of a group name, an entry point name and a path to the definition of a python object (any object, including modules, classes, functions, variables). A plugin host like AiiDA can iterate through entry points by group, find a specific one by name and load the associated python object. Iterating and finding entry points does not require any python code to be imported. A plugin is a separately-distributed, self-contained python package which implements any number of plugin classes and declares entry points accordingly.</p>
<div class="section" id="example">
<h3>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h3>
<p>In the following snippet only the most relevant code lines are picked to give an idea of the functioning. We will look only at one type of plugin, calculations, for simplicity.</p>
<p>First of all, AiiDA defines groups of of entry points in <code class="docutils literal notranslate"><span class="pre">aiida_core/setup.py</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># in setuptools.setup() call</span>
<span class="n">entry_points</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;aiida.calculations&#39;</span> <span class="o">=</span> <span class="p">[</span><span class="o">...</span><span class="p">],</span>
    <span class="o">...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>AiiDA then provides a callable <code class="docutils literal notranslate"><span class="pre">CalculationFactory</span></code> which does something equivalent to this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">CalculationFactory</span><span class="p">(</span><span class="n">plugin_name</span><span class="p">):</span>
   <span class="kn">from</span> <span class="nn">pkg_resources</span> <span class="kn">import</span> <span class="n">iter_entry_points</span>
   <span class="n">entry_points</span> <span class="o">=</span> <span class="n">iter_entry_points</span><span class="p">(</span><span class="s1">&#39;aiida.calculations&#39;</span><span class="p">)</span>
   <span class="n">plugin</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">entry_points</span> <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">name</span><span class="o">==</span><span class="n">plugin_name</span><span class="p">]</span>
   <span class="k">if</span> <span class="n">plugin</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">plugin</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">plugin</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
   <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">plugin</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
      <span class="c1"># raise Error: Ambiguity</span>
   <span class="k">else</span><span class="p">:</span>
      <span class="c1"># raise Error: Plugin not found</span>
</pre></div>
</div>
<p>In <code class="docutils literal notranslate"><span class="pre">aiida-myplugin/setup.py</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># in setuptools.setup() call</span>
<span class="n">entry_points</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;aiida.calculations&#39;</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;myplugin.mycalc = aiida_myplugin.calculations.mycalc:MyPluginCalculation,</span>
        <span class="o">...</span>
    <span class="p">],</span>
    <span class="o">...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In <code class="docutils literal notranslate"><span class="pre">aiida-myplugin/aiida_myplugin/calculations/mycalc.py</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">aiida.orm</span> <span class="kn">import</span> <span class="n">Calculation</span>
<span class="k">class</span> <span class="nc">MyPluginCalculation</span><span class="p">(</span><span class="n">Calculation</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>In user code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">aiida.plugins</span> <span class="kn">import</span> <span class="n">CalculationFactory</span>
<span class="n">Mycalc</span> <span class="o">=</span> <span class="n">CalculationFactory</span><span class="p">(</span><span class="s1">&#39;myplugin.mycalc&#39;</span><span class="p">)</span>
<span class="o">...</span>
</pre></div>
</div>
<p>Note that the plugin developer can freely choose the code structure as well as the names of the modules and plugin classes. The developer is also free to refactor his code without fear of breaking compatibility, as long as no information stored in the database is changed (note that this unfortunately includes entry point name and class name).</p>
</div>
</div>
<div class="section" id="limitations">
<h2>Limitations<a class="headerlink" href="#limitations" title="Permalink to this headline">¶</a></h2>
<p>The chosen approach to plugins has some limitations:</p>
<ul class="simple">
<li>In the current version the interface for entry point objects is enforced implicitly by the way the object is used. It is the responsibility of the plugin developer to test for compliance, especially if the object is not derived from the recommended base classes provided by AiiDA. This is to be clearly communicated in the documentation for plugin developers;</li>
<li>The freedom of the plugin developer to name and rename classes ends where the information in question is stored in the database as, e.g., node attributes.</li>
<li>The system is designed with the possibility of plugin versioning in mind, however this is not implemented yet.</li>
<li>In principle, two different plugins can give the same name to an entry point, creating ambiguity when trying to load the associated objects. Plugin development guidelines in the documentation will advise on how to avoid this problem, and this is addressed via the use of a centralized registry of known AiiDA plugins.</li>
<li>Plugins can potentially contain malicious or otherwise dangerous code. In the registry of AiiDA plugins, we try to flag plugins that we know are safe to be used.</li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../devel_tutorial/code_plugin_float_sum.html" class="btn btn-neutral float-right" title="Data plugin - Float Summation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="update_plugin.html" class="btn btn-neutral float-left" title="Updating an Existing Plugin" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, ECOLE POLYTECHNIQUE FEDERALE DE LAUSANNE (Theory and Simulation of Materials (THEOS) and National Centre for Computational Design and Discovery of Novel Materials (NCCR MARVEL)), Switzerland and ROBERT BOSCH LLC, USA. All rights reserved

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>