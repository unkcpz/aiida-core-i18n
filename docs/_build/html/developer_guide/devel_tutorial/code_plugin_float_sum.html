

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Data plugin - Float Summation &mdash; AiiDA 1.0.0b2 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
        <script type="text/javascript" src="../../_static/contentui.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/contentui.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Writing tests for plugin" href="plugin_tests.html" />
    <link rel="prev" title="The AiiDA Plugin System" href="../plugins/plugin_system.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> AiiDA
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Installation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../install/quick_installation.html">Quick installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../install/prerequisites.html">Prerequisites</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../install/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../install/updating_installation.html">Updating AiiDA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../install/troubleshooting.html">Troubleshooting</a></li>
</ul>
<p class="caption"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../get_started/index.html">First things first</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../get_started/daemon.html">Setup the daemon</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../get_started/computers.html">Setup a computer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../get_started/codes.html">Setup a code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../get_started/plugins.html">Plugins</a></li>
</ul>
<p class="caption"><span class="caption-text">Concepts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../concepts/provenance.html">Provenance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../concepts/processes.html">Processes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../concepts/calculations.html">Calculations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../concepts/workflows.html">Workflows</a></li>
</ul>
<p class="caption"><span class="caption-text">Working with</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../working/processes.html">Processes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../working/functions.html">Calculation and work functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../working/calculations.html">Calculations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../working/workflows.html">Workflows</a></li>
</ul>
<p class="caption"><span class="caption-text">Working with AiiDA</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../working_with_aiida/index.html">Command line interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../working_with_aiida/index.html#scripting">Scripting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../working_with_aiida/index.html#data-types">Data types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../working_with_aiida/index.html#groups">Groups</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../working_with_aiida/index.html#schedulers">Schedulers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../working_with_aiida/index.html#querying-data">Querying data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../working_with_aiida/index.html#caching">Caching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../working_with_aiida/index.html#result-manager">Result manager</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../working_with_aiida/index.html#backups">Backups</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../working_with_aiida/index.html#troubleshooting">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../working_with_aiida/index.html#rest-api">REST API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../working_with_aiida/index.html#cookbook">Cookbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../import_export/index.html">Import and Export</a></li>
</ul>
<p class="caption"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">AiiDA design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../index.html#aiida-core">AiiDA core</a></li>
<li class="toctree-l1"><a class="reference internal" href="../index.html#aiida-plugins">AiiDA plugins</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../tutorial/index.html">StructureData</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial/index.html#pseudopotentials">Pseudopotentials</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../tutorial/index.html#plugin-development">Plugin development</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Data plugin - Float Summation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#introducing-a-new-data-type">Introducing a new data type</a></li>
<li class="toctree-l3"><a class="reference internal" href="#exercise-modifying-the-calculation-plugin">Exercise: Modifying the calculation plugin</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#changes-to-the-parser">Changes to the parser</a></li>
<li class="toctree-l4"><a class="reference internal" href="#changes-to-the-input-plugin">Changes to the input plugin</a></li>
<li class="toctree-l4"><a class="reference internal" href="#code">Code</a></li>
<li class="toctree-l4"><a class="reference internal" href="#submission-script">Submission script</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="plugin_tests.html">Writing tests for plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="cmdline_plugin.html">Commandline plugin - Data subcommand</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">API reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="`aiida package &lt;https://aiida-core.readthedocs.io/en/latest/apidoc/aiida.html&gt;`_">`aiida package &lt;https://aiida-core.readthedocs.io/en/latest/apidoc/aiida.html&gt;`_</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">AiiDA</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">AiiDA design</a> &raquo;</li>
        
      <li>Data plugin - Float Summation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/developer_guide/devel_tutorial/code_plugin_float_sum.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="data-plugin-float-summation">
<span id="developdataplugintutorialfloat"></span><h1>Data plugin - Float Summation<a class="headerlink" href="#data-plugin-float-summation" title="Permalink to this headline">¶</a></h1>
<div class="toctree-wrapper compound">
</div>
<div class="section" id="introducing-a-new-data-type">
<h2>Introducing a new data type<a class="headerlink" href="#introducing-a-new-data-type" title="Permalink to this headline">¶</a></h2>
<p>We will start by describing what is a data plugin, and by creating a new one.</p>
<p>A data plugin is a subclass of <a class="reference internal" href="../../apidoc/aiida.orm.nodes.data.html#aiida.orm.nodes.data.data.Data" title="aiida.orm.nodes.data.data.Data"><code class="xref py py-class docutils literal notranslate"><span class="pre">Data</span></code></a>.
In the class, you should provide methods that the end user should use to store
high-level objects (for instance, for a crystal structure, there can be a method
for setting the unit cell, one for adding an atom in a given position, …).
Internally, you should choose where to store the content. There are two options:</p>
<ul class="simple">
<li><strong>In the AiiDA database</strong>. This is useful for small amounts of data, that you plan
to query. In this case, use <code class="docutils literal notranslate"><span class="pre">self._set_attr(attr_name,</span> <span class="pre">attr_value)</span></code> to store
the required value.</li>
<li><strong>In the AiiDA file repository (as a file on the disk)</strong>. This is suitable
for big files and quantities that you do not
want to query. In this case, access the folder using <code class="docutils literal notranslate"><span class="pre">self.folder</span></code> and
use the methods of <code class="docutils literal notranslate"><span class="pre">self.folder</span></code> to create files, subfolders, …</li>
</ul>
<p>Of course, it is also good practice to provide “getter” methods to retrieve
the data in the database and return it back to the user. The idea is that the
user can operate directly only with the methods you provide, and should not
need to know how you decided to store the data inside the AiiDA database.</p>
<p>As a simple example that we will use for the exercise below,
imagine that we want to introduce a new type of data node that simply
stores a float number. We will call it <code class="docutils literal notranslate"><span class="pre">FloatData</span></code>, and the class
implementation can look like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">aiida.orm</span> <span class="k">import</span> <span class="n">Data</span>

<span class="k">class</span> <span class="nc">FloatData</span><span class="p">(</span><span class="n">Data</span><span class="p">):</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The value of the Float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s1">&#39;number&#39;</span><span class="p">)</span>

    <span class="nd">@value</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the value of the Float</span>

<span class="sd">        :raise ValueError:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_attr</span><span class="p">(</span><span class="s1">&#39;number&#39;</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
</pre></div>
</div>
<p>The definition of this new data type should reside below a <code class="docutils literal notranslate"><span class="pre">data</span></code> sub package in your
plugin package, with directory structure like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">aiida</span><span class="o">-</span><span class="n">yourplugin</span><span class="o">/</span>
   <span class="n">aiida_yourplugin</span><span class="o">/</span>
      <span class="fm">__init__</span><span class="o">.</span><span class="n">py</span>
      <span class="n">calcs</span><span class="o">/</span>
         <span class="fm">__init__</span><span class="o">.</span><span class="n">py</span>
         <span class="nb">sum</span><span class="o">.</span><span class="n">py</span>
      <span class="n">parsers</span><span class="o">/</span>
         <span class="fm">__init__</span><span class="o">.</span><span class="n">py</span>
         <span class="n">sum_parser</span><span class="o">.</span><span class="n">py</span>
      <span class="n">data</span><span class="o">/</span>
         <span class="fm">__init__</span><span class="o">.</span><span class="n">py</span>
         <span class="nb">float</span><span class="o">.</span><span class="n">py</span>  <span class="o">&lt;--</span> <span class="n">Put</span> <span class="n">the</span> <span class="n">code</span> <span class="n">here</span>
   <span class="n">setup</span><span class="o">.</span><span class="n">py</span>
   <span class="n">setup</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
<p>And following lines should be there in the <code class="docutils literal notranslate"><span class="pre">setup.json</span></code> file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
   <span class="o">...</span>
   <span class="s2">&quot;entry_points&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">&quot;aiida.data&quot;</span><span class="p">:</span> <span class="p">{</span>
         <span class="s2">&quot;yourplugin.float = aiida_yourplugin.data.float:FloatData&quot;</span>
      <span class="p">},</span>
      <span class="o">...</span>
   <span class="p">}</span>
   <span class="o">...</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">Please see the documentation about the <a class="reference internal" href="../plugins/entry_points.html#plugins-entry-points"><span class="std std-ref">entry points</span></a> to learn more about the plugin system.</p>
</div>
</div>
<div class="section" id="exercise-modifying-the-calculation-plugin">
<h2>Exercise: Modifying the calculation plugin<a class="headerlink" href="#exercise-modifying-the-calculation-plugin" title="Permalink to this headline">¶</a></h2>
<p>Your exercise consists in creating a new calculation plugin (let’s call it for instance
<code class="docutils literal notranslate"><span class="pre">SumFloatCalculation</span></code>) that will also perform the sum, but accept as input two <code class="docutils literal notranslate"><span class="pre">FloatData</span></code>
node and return also a <code class="docutils literal notranslate"><span class="pre">FloatData</span></code> node containing the sum.</p>
<p>Below, you will find some hints on the parts you need to modify with respect to the previous tutoria using instead <code class="docutils literal notranslate"><span class="pre">Dict</span></code> both as inputs and outputs.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Remember to add an entry point for the <code class="docutils literal notranslate"><span class="pre">SumFloatCalculation</span></code> in the <code class="docutils literal notranslate"><span class="pre">setup.json</span></code> file and re-install the package and refresh entry points.
It is up to you to either put the new class in the same <code class="docutils literal notranslate"><span class="pre">sum.py</span></code> or create a new <code class="docutils literal notranslate"><span class="pre">floatsum.py</span></code>.
The same also applies to the new parser class.</p>
</div>
<div class="section" id="changes-to-the-parser">
<h3>Changes to the parser<a class="headerlink" href="#changes-to-the-parser" title="Permalink to this headline">¶</a></h3>
<p>The plugin should now return a <code class="docutils literal notranslate"><span class="pre">FloatData</span></code> instead of a <code class="docutils literal notranslate"><span class="pre">Dict</span></code>,
therefore the parser code should contain something like the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">output_data</span> <span class="o">=</span> <span class="n">FloatData</span><span class="p">()</span>
<span class="n">output_data</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">out_dict</span><span class="p">[</span><span class="s2">&quot;sum&quot;</span><span class="p">]</span>
<span class="n">linkname</span> <span class="o">=</span> <span class="s1">&#39;output_data&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="changes-to-the-input-plugin">
<h3>Changes to the input plugin<a class="headerlink" href="#changes-to-the-input-plugin" title="Permalink to this headline">¶</a></h3>
<p>To be able to run your new <code class="docutils literal notranslate"><span class="pre">FloatsumParser</span></code>, you will need the corresponding
input plugin (<code class="docutils literal notranslate"><span class="pre">FloatsumCalculation</span></code>). The first modification is then to link
to the correct parser class:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">_default_parser</span> <span class="o">=</span> <span class="s1">&#39;sum.floatsum&#39;</span>  <span class="c1"># Name of the entry point</span>
</pre></div>
</div>
<p>For consistency, we also want that the input plugin accepts two
<code class="docutils literal notranslate"><span class="pre">FloatData</span></code> instead of a single <code class="docutils literal notranslate"><span class="pre">Dict</span></code>.
Therefore, you have to update the <code class="docutils literal notranslate"><span class="pre">retdict</span></code> object accordingly:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">retdict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
    <span class="s2">&quot;float_data_1&quot;</span><span class="p">:</span> <span class="p">{</span>
       <span class="s1">&#39;valid_types&#39;</span><span class="p">:</span> <span class="n">FloatData</span><span class="p">,</span>
       <span class="s1">&#39;additional_parameter&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
       <span class="s1">&#39;linkname&#39;</span><span class="p">:</span> <span class="s1">&#39;float_data_1&#39;</span><span class="p">,</span>
       <span class="s1">&#39;docstring&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;The first addend&quot;</span><span class="p">),</span>
       <span class="p">},</span>
    <span class="s2">&quot;float_data_2&quot;</span><span class="p">:</span> <span class="p">{</span>
       <span class="s1">&#39;valid_types&#39;</span><span class="p">:</span> <span class="n">FloatData</span><span class="p">,</span>
       <span class="s1">&#39;additional_parameter&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
       <span class="s1">&#39;linkname&#39;</span><span class="p">:</span> <span class="s1">&#39;float_data_2&#39;</span><span class="p">,</span>
       <span class="s1">&#39;docstring&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;The second addend&quot;</span><span class="p">),</span>
       <span class="p">},</span>
    <span class="p">})</span>
</pre></div>
</div>
<p>You need then to change the main code to use the values obtained from the
two nodes, rather than from a single node as before. This should be easy,
so we leave this task to you. Note that we plan to use the same python code
to actually perform the sum, so the JSON file to be generated should have
the same format.</p>
<p>We also suggest that you add utility methods (to the benefit of the end user)
to provide the addends to the code, something like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">set_addend1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="n">fl</span> <span class="o">=</span> <span class="n">FloatData</span><span class="p">()</span>
    <span class="n">fl</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">use_float_data_1</span><span class="p">(</span><span class="n">fl</span><span class="p">)</span>
</pre></div>
</div>
<p>and similarly for the second addend.</p>
</div>
<div class="section" id="code">
<h3>Code<a class="headerlink" href="#code" title="Permalink to this headline">¶</a></h3>
<p>The python code that actually performs the calculation does not need to be
modified. We can reuse the same file, but we suggest to setup a new code
in AiiDA, with a different name, using as default plugin the <code class="docutils literal notranslate"><span class="pre">sum.floatsum</span></code>
plugin.</p>
</div>
<div class="section" id="submission-script">
<h3>Submission script<a class="headerlink" href="#submission-script" title="Permalink to this headline">¶</a></h3>
<p>Finally, adapt your submission script to create the correct input nodes,
and try to perform a sum of two numbers to verify that you did all correctly!</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">After (re)registering the entry points, do not forget to restart the daemon so that
it will recognize the change! The same should be done if you do any change to
the plugin, otherwise the daemon may have cached the old file and will keep
using it.</p>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="plugin_tests.html" class="btn btn-neutral float-right" title="Writing tests for plugin" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../plugins/plugin_system.html" class="btn btn-neutral float-left" title="The AiiDA Plugin System" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, ECOLE POLYTECHNIQUE FEDERALE DE LAUSANNE (Theory and Simulation of Materials (THEOS) and National Centre for Computational Design and Discovery of Novel Materials (NCCR MARVEL)), Switzerland and ROBERT BOSCH LLC, USA. All rights reserved

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>