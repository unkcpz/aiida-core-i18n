

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Commandline plugin - Data subcommand &mdash; AiiDA 1.0.0b2 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
        <script type="text/javascript" src="../../_static/contentui.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/contentui.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Parser warnings policy" href="parser_warnings_policy.html" />
    <link rel="prev" title="Writing tests for plugin" href="plugin_tests.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> AiiDA
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Installation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../install/quick_installation.html">Quick installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../install/prerequisites.html">Prerequisites</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../install/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../install/updating_installation.html">Updating AiiDA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../install/troubleshooting.html">Troubleshooting</a></li>
</ul>
<p class="caption"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../get_started/index.html">First things first</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../get_started/daemon.html">Setup the daemon</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../get_started/computers.html">Setup a computer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../get_started/codes.html">Setup a code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../get_started/plugins.html">Plugins</a></li>
</ul>
<p class="caption"><span class="caption-text">Concepts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../concepts/provenance.html">Provenance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../concepts/processes.html">Processes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../concepts/calculations.html">Calculations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../concepts/workflows.html">Workflows</a></li>
</ul>
<p class="caption"><span class="caption-text">Working with</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../working/processes.html">Processes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../working/functions.html">Calculation and work functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../working/calculations.html">Calculations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../working/workflows.html">Workflows</a></li>
</ul>
<p class="caption"><span class="caption-text">Working with AiiDA</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../working_with_aiida/index.html">Command line interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../working_with_aiida/index.html#scripting">Scripting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../working_with_aiida/index.html#data-types">Data types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../working_with_aiida/index.html#groups">Groups</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../working_with_aiida/index.html#schedulers">Schedulers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../working_with_aiida/index.html#querying-data">Querying data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../working_with_aiida/index.html#caching">Caching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../working_with_aiida/index.html#result-manager">Result manager</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../working_with_aiida/index.html#backups">Backups</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../working_with_aiida/index.html#troubleshooting">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../working_with_aiida/index.html#rest-api">REST API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../working_with_aiida/index.html#cookbook">Cookbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../import_export/index.html">Import and Export</a></li>
</ul>
<p class="caption"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">AiiDA design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../index.html#aiida-core">AiiDA core</a></li>
<li class="toctree-l1"><a class="reference internal" href="../index.html#aiida-plugins">AiiDA plugins</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../tutorial/index.html">StructureData</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial/index.html#pseudopotentials">Pseudopotentials</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../tutorial/index.html#plugin-development">Plugin development</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="code_plugin_float_sum.html">Data plugin - Float Summation</a></li>
<li class="toctree-l2"><a class="reference internal" href="plugin_tests.html">Writing tests for plugin</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Commandline plugin - Data subcommand</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#exercise-command-to-export-floatdata-to-file">Exercise: command to export FloatData to file</a></li>
<li class="toctree-l3"><a class="reference internal" href="#understanding-commandline-plugins">Understanding commandline plugins</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">API reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="`aiida package &lt;https://aiida-core.readthedocs.io/en/latest/apidoc/aiida.html&gt;`_">`aiida package &lt;https://aiida-core.readthedocs.io/en/latest/apidoc/aiida.html&gt;`_</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">AiiDA</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">AiiDA design</a> &raquo;</li>
        
      <li>Commandline plugin - Data subcommand</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/developer_guide/devel_tutorial/cmdline_plugin.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="commandline-plugin-data-subcommand">
<span id="developercmdlineplugintutorial"></span><h1>Commandline plugin - Data subcommand<a class="headerlink" href="#commandline-plugin-data-subcommand" title="Permalink to this headline">¶</a></h1>
<div class="toctree-wrapper compound">
</div>
<p>If your plugin provides <a class="reference internal" href="code_plugin_float_sum.html"><span class="doc">custom data types</span></a>, you might want to provide commandline commands to handle them: Create them from files (example: pseudopotentials), provide export to file formats, visualize them, etc.</p>
<p>With commandline plugins you have the possibility to make you command accessible from the <code class="docutils literal notranslate"><span class="pre">verdi</span></code> commandline. Your cli plugin will be treated as a subcommand of <code class="docutils literal notranslate"><span class="pre">verdi</span> <span class="pre">data</span></code>.</p>
<div class="section" id="exercise-command-to-export-floatdata-to-file">
<h2>Exercise: command to export FloatData to file<a class="headerlink" href="#exercise-command-to-export-floatdata-to-file" title="Permalink to this headline">¶</a></h2>
<p>Plugin structure:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">aiida</span><span class="o">-</span><span class="n">yourplugin</span><span class="o">/</span>
   <span class="n">aiida_yourplugin</span><span class="o">/</span>
      <span class="fm">__init__</span><span class="o">.</span><span class="n">py</span>
      <span class="n">data</span><span class="o">/</span>
         <span class="fm">__init__</span><span class="o">.</span><span class="n">py</span>
         <span class="nb">float</span><span class="o">.</span><span class="n">py</span>
   <span class="n">setup</span><span class="o">.</span><span class="n">py</span>
   <span class="n">setup</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
<p>The file <code class="docutils literal notranslate"><span class="pre">float.py</span></code> can be taken from <a class="reference internal" href="code_plugin_float_sum.html"><span class="doc">the datatype tutorial</span></a> or replaced by your own custom data type.</p>
<p>File excerpt <code class="docutils literal notranslate"><span class="pre">setup.json</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
   <span class="o">...</span>
   <span class="s2">&quot;entry_points&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">&quot;aiida.data&quot;</span><span class="p">:</span> <span class="p">{</span>
         <span class="s2">&quot;yourplugin.float = aiida_yourplugin.data.float:FloatData&quot;</span>
      <span class="p">},</span>
      <span class="o">...</span>
   <span class="p">}</span>
   <span class="o">...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>We will assume your plugin provides a <code class="docutils literal notranslate"><span class="pre">FloatData</span></code> data class. Let’s provide a command that exports it to some file format.</p>
<p>First, we create a new subpackage (this is optional but helps structure our plugin), containing an empty module in which we will work. New plugin structure:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">aiida</span><span class="o">-</span><span class="n">yourplugin</span><span class="o">/</span>
   <span class="n">aiida_yourplugin</span><span class="o">/</span>
      <span class="fm">__init__</span><span class="o">.</span><span class="n">py</span>
      <span class="n">data</span><span class="o">/</span>
         <span class="fm">__init__</span><span class="o">.</span><span class="n">py</span>
         <span class="nb">float</span><span class="o">.</span><span class="n">py</span>
      <span class="n">cmdline</span><span class="o">/</span>
         <span class="fm">__init__</span><span class="o">.</span><span class="n">py</span>
         <span class="n">float_cmd</span><span class="o">.</span><span class="n">py</span>  <span class="o">&lt;--</span> <span class="n">new</span> <span class="n">empty</span> <span class="n">module</span>
   <span class="n">setup</span><span class="o">.</span><span class="n">py</span>
   <span class="n">setup</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
<p>Inside that module we will first create an empty command-group (it will do nothing but subcommands can be added to it later). which can be called from the commandline using <code class="docutils literal notranslate"><span class="pre">verdi</span> <span class="pre">data</span> <span class="pre">yourplugin-float</span></code>. Command groups are explained in the <a class="reference external" href="click_docs">Click documentation</a>.</p>
<p>File <code class="docutils literal notranslate"><span class="pre">float_cmd.py</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">click</span>  <span class="c1"># This we will use in a later step</span>

<span class="kn">from</span> <span class="nn">aiida.cmdline.commands</span> <span class="k">import</span> <span class="n">data_cmd</span>
<span class="kn">from</span> <span class="nn">aiida.cmdline.utils.decorators</span> <span class="k">import</span> <span class="n">load_dbenv_if_not_loaded</span>  <span class="c1"># Will be used in a later step</span>

<span class="nd">@data_cmd</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;yourplugin-float&#39;</span><span class="p">):</span>
<span class="k">def</span> <span class="nf">float_cmd</span><span class="p">():</span>
   <span class="sd">&quot;&quot;&quot;Commandline interface for working with FloatData&quot;&quot;&quot;</span>
</pre></div>
</div>
<p>This so far does nothing and will not yet be recognized by AiiDA. We will now expose it through an entry point for AiiDA to find.
Changes to file <code class="docutils literal notranslate"><span class="pre">setup.json</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
   <span class="o">...</span>
   <span class="s2">&quot;entry_points&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">&quot;aiida.data&quot;</span><span class="p">:</span> <span class="p">{</span>
         <span class="s2">&quot;yourplugin.float = aiida_yourplugin.data.float:FloatData&quot;</span>
      <span class="p">},</span>
      <span class="s2">&quot;aiida.cmdline.data&quot;</span><span class="p">:</span> <span class="p">{</span>                                              <span class="o">&lt;--</span> <span class="n">NEW</span>
         <span class="s2">&quot;yourplugin-float = aiida_yourplugin.cmdline.float_cmd:float_cmd&quot;</span> <span class="o">&lt;--</span> <span class="n">NEW</span>
      <span class="p">}</span>                                                                    <span class="o">&lt;--</span> <span class="n">NEW</span>
      <span class="o">...</span>
   <span class="p">}</span>
   <span class="o">...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Now we only have to reinstall our plugin (<code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">-e</span> <span class="pre">&lt;path/to/aiida-yourplugin&gt;</span></code>) and the command should be recognized. We can test it by running:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">verdi</span> <span class="n">data</span> <span class="n">yourplugin</span><span class="o">-</span><span class="nb">float</span> <span class="o">--</span><span class="n">help</span>
</pre></div>
</div>
<p>It should print some basic usage information containing the docstring we gave to the <code class="docutils literal notranslate"><span class="pre">float_cmd()</span></code> function.</p>
<p>The last step is now implementing <code class="docutils literal notranslate"><span class="pre">verdi</span> <span class="pre">data</span> <span class="pre">yourplugin-float</span> <span class="pre">export</span></code> command that exports our FloatData instance to a file.</p>
<p>Append to file <code class="docutils literal notranslate"><span class="pre">float_cmd.py</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@float_cmd</span><span class="o">.</span><span class="n">command</span><span class="p">()</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s1">&#39;--outfile&#39;</span><span class="p">,</span> <span class="s1">&#39;-o&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">click</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">dir_okay</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;write output to this file (by default print to stout).&#39;</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">argument</span><span class="p">(</span><span class="s1">&#39;pk&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">export</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="n">pk</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;Export a FloatData node, identified by PK to plain text format&quot;&quot;&quot;</span>
   <span class="n">load_dbenv_if_not_loaded</span><span class="p">()</span>  <span class="c1"># Important to load the dbenv in the last moment</span>
   <span class="kn">from</span> <span class="nn">aiida.orm</span> <span class="k">import</span> <span class="n">load_node</span>
   <span class="n">float_node</span> <span class="o">=</span> <span class="n">load_node</span><span class="p">(</span><span class="n">pk</span><span class="p">)</span>  <span class="c1"># Exercise left to the user: check if it is a FloatData</span>
   <span class="n">file_content</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">float_node</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
   <span class="k">if</span> <span class="n">outfile</span><span class="p">:</span>
      <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">out_file_obj</span><span class="p">:</span>
         <span class="n">out_file_obj</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">file_content</span><span class="p">)</span>
   <span class="k">else</span><span class="p">:</span>
      <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="n">file_content</span><span class="p">)</span>
</pre></div>
</div>
<p>A subcommand to a group can be defined using the following pattern:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@float_cmd</span><span class="o">.</span><span class="n">command</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">export</span><span class="p">(</span><span class="o">...</span><span class="p">):</span>
   <span class="o">...</span>
</pre></div>
</div>
<p>Where the subcommand will now automatically have the name of the function. If you want it to have a different name, simply pass it as an argument to the <code class="docutils literal notranslate"><span class="pre">&lt;group&gt;.command('&lt;subcmd</span> <span class="pre">name&gt;')</span></code> decorator.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">export</span><span class="p">(</span><span class="o">...</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;...&quot;&quot;&quot;</span>
   <span class="n">load_dbenv_if_not_loaded</span><span class="p">()</span>  <span class="c1"># Important to load the dbenv in the last moment</span>
</pre></div>
</div>
<p>As is mentioned in the comment, it is important to load the dbenv as late as possible. Particularly it should never be done at import time (on module level) but only inside whichever function requires it. This ensures that command completion does not get slowed down while importing your command.</p>
<p>Last but by no means least, it is important to test our plugin command, this example will use the builtin unittest framework but it is just as well possible to use pytest.</p>
<p>New structure:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">aiida</span><span class="o">-</span><span class="n">yourplugin</span><span class="o">/</span>
   <span class="n">aiida_yourplugin</span><span class="o">/</span>
      <span class="fm">__init__</span><span class="o">.</span><span class="n">py</span>
      <span class="n">data</span><span class="o">/</span>
         <span class="fm">__init__</span><span class="o">.</span><span class="n">py</span>
         <span class="nb">float</span><span class="o">.</span><span class="n">py</span>
      <span class="n">cmdline</span><span class="o">/</span>
         <span class="fm">__init__</span><span class="o">.</span><span class="n">py</span>
         <span class="n">float_cmd</span><span class="o">.</span><span class="n">py</span>
         <span class="n">test_float_cmd</span><span class="o">.</span><span class="n">py</span> <span class="o">&lt;--</span> <span class="n">new</span> <span class="n">empty</span> <span class="n">module</span>
   <span class="n">setup</span><span class="o">.</span><span class="n">py</span>
   <span class="n">setup</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
<p>Example test in <code class="docutils literal notranslate"><span class="pre">test_float_cmd.py</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>

<span class="kn">from</span> <span class="nn">click.testing</span> <span class="k">import</span> <span class="n">CliRunner</span>
<span class="kn">from</span> <span class="nn">aiida.manage.fixtures</span> <span class="k">import</span> <span class="n">PluginTestCase</span>

<span class="kn">from</span> <span class="nn">aiida_yourplugin.cmdline.float_cmd</span> <span class="k">import</span> <span class="n">float_cmd</span>

<span class="n">TestFloadCmd</span><span class="p">(</span><span class="n">PluginTestCase</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;Test correctness of the verdi data yourplugin-float export command&quot;&quot;&quot;</span>

     <span class="n">BACKEND</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;TEST_BACKEND&#39;</span><span class="p">)</span>
     <span class="c1"># load the backend to be tested from the environment variable</span>
     <span class="c1"># in your shell, simply prepend the test command with TEST_BACKEND=&#39;django&#39; or TEST_BACKEND=&#39;sqlalchemy&#39;</span>
     <span class="c1"># or set the TEST_BACKEND variable in your CI configuration</span>

   <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="kn">from</span> <span class="nn">aiida.plugins</span> <span class="k">import</span> <span class="n">DataFactory</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">float_node</span> <span class="o">=</span> <span class="n">DataFactory</span><span class="p">(</span><span class="s1">&#39;yourplugin.float&#39;</span><span class="p">)()</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">float_node</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="mf">1.2</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">runner</span> <span class="o">=</span> <span class="n">CliRunner</span><span class="p">()</span>

   <span class="k">def</span> <span class="nf">test_export</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">float_node</span><span class="o">.</span><span class="n">store</span><span class="p">()</span>
      <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">float_cmd</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;export&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">float_node</span><span class="o">.</span><span class="n">pk</span><span class="p">)])</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">output</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">float_node</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
</pre></div>
</div>
<p>This test can now be run using <code class="docutils literal notranslate"><span class="pre">TEST_BACKEND=django</span> <span class="pre">python</span> <span class="pre">-m</span> <span class="pre">unittest</span> <span class="pre">discover</span></code> from your top level project directory <code class="docutils literal notranslate"><span class="pre">aiida-yourplugin</span></code>.</p>
<p>As a further exercise, try adding a <code class="docutils literal notranslate"><span class="pre">--format</span></code> option to choose between plain text and, say json.</p>
</div>
<div class="section" id="understanding-commandline-plugins">
<h2>Understanding commandline plugins<a class="headerlink" href="#understanding-commandline-plugins" title="Permalink to this headline">¶</a></h2>
<p>The discovery of plugins via entry points follows exactly the same mechanisms as all other plugin types.</p>
<p>The possibility of plugging cli commands into each other is a feature of <code class="docutils literal notranslate"><span class="pre">click</span></code> a python library that greatly simplifies the task. You can find in-depth documentation here: <a class="reference external" href="click_docs">Click 6.0 docs</a>.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="parser_warnings_policy.html" class="btn btn-neutral float-right" title="Parser warnings policy" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="plugin_tests.html" class="btn btn-neutral float-left" title="Writing tests for plugin" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, ECOLE POLYTECHNIQUE FEDERALE DE LAUSANNE (Theory and Simulation of Materials (THEOS) and National Centre for Computational Design and Discovery of Novel Materials (NCCR MARVEL)), Switzerland and ROBERT BOSCH LLC, USA. All rights reserved

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>