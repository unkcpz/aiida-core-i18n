

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Introduction: Pseudopotential families &mdash; AiiDA 1.0.0b2 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script type="text/javascript" src="../_static/contentui.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/contentui.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="General comments" href="structure_tutorial.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> AiiDA
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Installation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../install/quick_installation.html">Quick installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install/prerequisites.html">Prerequisites</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install/updating_installation.html">Updating AiiDA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install/troubleshooting.html">Troubleshooting</a></li>
</ul>
<p class="caption"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../get_started/index.html">First things first</a></li>
<li class="toctree-l1"><a class="reference internal" href="../get_started/daemon.html">Setup the daemon</a></li>
<li class="toctree-l1"><a class="reference internal" href="../get_started/computers.html">Setup a computer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../get_started/codes.html">Setup a code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../get_started/plugins.html">Plugins</a></li>
</ul>
<p class="caption"><span class="caption-text">Concepts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../concepts/provenance.html">Provenance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../concepts/processes.html">Processes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../concepts/calculations.html">Calculations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../concepts/workflows.html">Workflows</a></li>
</ul>
<p class="caption"><span class="caption-text">Working with</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../working/processes.html">Processes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../working/functions.html">Calculation and work functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../working/calculations.html">Calculations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../working/workflows.html">Workflows</a></li>
</ul>
<p class="caption"><span class="caption-text">Working with AiiDA</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../working_with_aiida/index.html">Command line interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../working_with_aiida/index.html#scripting">Scripting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../working_with_aiida/index.html#data-types">Data types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../working_with_aiida/index.html#groups">Groups</a></li>
<li class="toctree-l1"><a class="reference internal" href="../working_with_aiida/index.html#schedulers">Schedulers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../working_with_aiida/index.html#querying-data">Querying data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../working_with_aiida/index.html#caching">Caching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../working_with_aiida/index.html#result-manager">Result manager</a></li>
<li class="toctree-l1"><a class="reference internal" href="../working_with_aiida/index.html#backups">Backups</a></li>
<li class="toctree-l1"><a class="reference internal" href="../working_with_aiida/index.html#troubleshooting">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../working_with_aiida/index.html#rest-api">REST API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../working_with_aiida/index.html#cookbook">Cookbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../import_export/index.html">Import and Export</a></li>
</ul>
<p class="caption"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../developer_guide/index.html">AiiDA design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer_guide/index.html#aiida-core">AiiDA core</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer_guide/index.html#aiida-plugins">AiiDA plugins</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../tutorial/index.html">StructureData</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../tutorial/index.html#pseudopotentials">Pseudopotentials</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Introduction: Pseudopotential families</a></li>
<li class="toctree-l2"><a class="reference internal" href="#creating-a-pseudopotential-family">Creating a pseudopotential family</a></li>
<li class="toctree-l2"><a class="reference internal" href="#getting-the-list-of-existing-families">Getting the list of existing families</a></li>
<li class="toctree-l2"><a class="reference internal" href="#manually-adding-pseudopotentials">Manually adding pseudopotentials</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/index.html#plugin-development">Plugin development</a></li>
</ul>
<p class="caption"><span class="caption-text">API reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="`aiida package &lt;https://aiida-core.readthedocs.io/en/latest/apidoc/aiida.html&gt;`_">`aiida package &lt;https://aiida-core.readthedocs.io/en/latest/apidoc/aiida.html&gt;`_</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">AiiDA</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../tutorial/index.html">StructureData</a> &raquo;</li>
        
      <li>Introduction: Pseudopotential families</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/examples/pseudo_tutorial.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="introduction-pseudopotential-families">
<span id="my-ref-to-pseudo-tutorial"></span><h1>Introduction: Pseudopotential families<a class="headerlink" href="#introduction-pseudopotential-families" title="Permalink to this headline">Â¶</a></h1>
<p>As you might have seen in the previous <code class="docutils literal notranslate"><span class="pre">PWscf</span></code> tutorial, the procedure of attaching a pseudopotential file to each atomic species could be a bit tedious. In many situations, you will not produce a different pseudopotential file for every calculation you do. More likely, when you start a project you will stick to a pseudopotential file for as long as possible. Moreover, in a high-throughput calculation, you will like to do calculation over several elements keeping the same functional. Thatâs also part of the reason why there are several projects (like <a class="reference external" href="http://qe-forge.org/gf/project/pslibrary/frs/">PSLibrary</a> or <a class="reference external" href="http://www.physics.rutgers.edu/gbrv/">GBRV</a> to name a few), that intend to develop a set of pseudopotentials that covers most of the periodic table for different functionals.</p>
<p>Thatâs why we added the <em>pseudopotential families</em>. Each family is a set of pseudopotentials that are grouped together in a special type of <cite>AiiDA Group of nodes</cite>. Within each family, at most one pseudopotential can be present for a given chemical element.</p>
<p>Of course, a pseudopotential family does not have to completely cover the periodic table (also because such pseudopotential sets do not exist). This means that you can create a pseudopotential family containing only the pseudopotentials for a few elements that you are interested in.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In principle, you can group different kinds of pseudopotentials into the same family. It is your responsibility to group only those with the same type, or obtained using the same functionals, approximations and / or levels of theory.</p>
</div>
</div>
<div class="section" id="creating-a-pseudopotential-family">
<h1>Creating a pseudopotential family<a class="headerlink" href="#creating-a-pseudopotential-family" title="Permalink to this headline">Â¶</a></h1>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The following commands are specific to the <a class="reference external" href="https://github.com/aiidateam/aiida-quantumespresso/">Quantum ESPRESSO interface</a>. For interfaces to other codes, please refer to the respective plugin documentation.</p>
</div>
<p>In the following, we will go through creating a pseudopotential family. First, you need to collect the pseudopotential files which should go into the family in a single folder â weâll call it <code class="docutils literal notranslate"><span class="pre">path/to/folder</span></code>. You can then add the family to the AiiDA database with <code class="docutils literal notranslate"><span class="pre">verdi</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">verdi</span> <span class="n">data</span> <span class="n">upf</span> <span class="n">uploadfamily</span> <span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">folder</span> <span class="n">name_of_the_family</span> <span class="s2">&quot;some description for your convenience&quot;</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">name_of_the_family</span></code> should be a unique name for the family, and the final parameter is a string that is set in the <code class="docutils literal notranslate"><span class="pre">description</span></code> field of the group.</p>
<p>If the a pseudopotential family with the same <code class="docutils literal notranslate"><span class="pre">name_of_the_family</span></code> exists already, the pseudopotentials in the folder will be added to the existing group. The code will raise an error if you try to add two (different) pseudopotentials for the same element.</p>
<p>After the upload (which may take some seconds, so please be patient)
the upffamily will be ready to use.</p>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">If you upload pseudopotentials which are already present in your database, AiiDA will use the existing <code class="docutils literal notranslate"><span class="pre">UPFData</span></code> node instead of creating a duplicate one. You can use the optional flag <code class="docutils literal notranslate"><span class="pre">--stop-if-existing</span></code> to instead abort (without changing anything in the database) if an existing pseudopotential is found.</p>
</div>
</div>
<div class="section" id="getting-the-list-of-existing-families">
<h1>Getting the list of existing families<a class="headerlink" href="#getting-the-list-of-existing-families" title="Permalink to this headline">Â¶</a></h1>
<p>To see wich pseudopotential families already exist in the database, type</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">verdi</span> <span class="n">data</span> <span class="n">upf</span> <span class="n">listfamilies</span>
</pre></div>
</div>
<p>Add a <code class="docutils literal notranslate"><span class="pre">-d</span></code> (or <code class="docutils literal notranslate"><span class="pre">--with-description</span></code>) flag if you also want to read the description of each family.</p>
<p>You can also filter the groups to get only a list of those containing a given set of elements using the <code class="docutils literal notranslate"><span class="pre">-e</span></code> option. For instance, if you want to get only the families containing the elements <code class="docutils literal notranslate"><span class="pre">Ba</span></code>, <code class="docutils literal notranslate"><span class="pre">Ti</span></code> and <code class="docutils literal notranslate"><span class="pre">O</span></code>, use</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">verdi</span> <span class="n">data</span> <span class="n">upf</span> <span class="n">listfamilies</span> <span class="o">-</span><span class="n">e</span> <span class="n">Ba</span> <span class="n">Ti</span> <span class="n">O</span>
</pre></div>
</div>
<p>For more help on the command line options, type</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">verdi</span> <span class="n">data</span> <span class="n">upf</span> <span class="n">listfamilies</span> <span class="o">-</span><span class="n">h</span>
</pre></div>
</div>
</div>
<div class="section" id="manually-adding-pseudopotentials">
<h1>Manually adding pseudopotentials<a class="headerlink" href="#manually-adding-pseudopotentials" title="Permalink to this headline">Â¶</a></h1>
<p>If you do not want to use pseudopotentials from a family, it is also possible to manually add them to the database (even though we discourage this in general).</p>
<p>A possible way of doing it is the following: we start by creating a list of pseudopotential filenames that we need to use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">raw_pseudos</span> <span class="o">=</span> <span class="p">[</span>
   <span class="s2">&quot;Ba.pbesol-spn-rrkjus_psl.0.2.3-tot-pslib030.UPF&quot;</span><span class="p">,</span>
   <span class="s2">&quot;Ti.pbesol-spn-rrkjus_psl.0.2.3-tot-pslib030.UPF&quot;</span><span class="p">,</span>
   <span class="s2">&quot;O.pbesol-n-rrkjus_psl.0.1-tested-pslib030.UPF&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>In this simple example, we expect the pseudopotentials to be in the same folder of the script. Then, we loop over the filenames and add them to the AiiDA database. The <code class="docutils literal notranslate"><span class="pre">get_or_create</span></code> method checks if the pseudopotential is already in the database and either stores it, or just returns the node already present in the database. The second value returned is a boolean and tells us if the pseudopotential was already present or not. We also store the returned nodes in a list (<code class="docutils literal notranslate"><span class="pre">pseudos_to_use</span></code>).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">UpfData</span> <span class="o">=</span> <span class="n">DataFactory</span><span class="p">(</span><span class="s1">&#39;upf&#39;</span><span class="p">)</span>
<span class="n">pseudos_to_use</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">raw_pseudos</span><span class="p">:</span>
    <span class="n">absname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="n">pseudo</span><span class="p">,</span> <span class="n">created</span> <span class="o">=</span> <span class="n">UpfData</span><span class="o">.</span><span class="n">get_or_create</span><span class="p">(</span><span class="n">absname</span><span class="p">,</span><span class="n">use_first</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">pseudos_to_use</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pseudo</span><span class="p">)</span>
</pre></div>
</div>
<p>As the last step, we make a loop over the pseudopotentials,
and attach its pseudopotential object to the calculation:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">pseudo</span> <span class="ow">in</span> <span class="n">pseudos_to_use</span><span class="p">:</span>
    <span class="n">calc</span><span class="o">.</span><span class="n">use_pseudo</span><span class="p">(</span><span class="n">pseudo</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">pseudo</span><span class="o">.</span><span class="n">element</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">When the pseudopotential is created, it is parsed and the elements to which it refers is stored in the database and can be accessed using the <code class="docutils literal notranslate"><span class="pre">pseudo.element</span></code> property, as shown above.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="structure_tutorial.html" class="btn btn-neutral float-left" title="General comments" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, ECOLE POLYTECHNIQUE FEDERALE DE LAUSANNE (Theory and Simulation of Materials (THEOS) and National Centre for Computational Design and Discovery of Novel Materials (NCCR MARVEL)), Switzerland and ROBERT BOSCH LLC, USA. All rights reserved

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>