

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>aiida.manage.database.integrity package &mdash; AiiDA 1.0.0b2 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script type="text/javascript" src="../_static/contentui.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/contentui.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> AiiDA
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Installation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../install/quick_installation.html">Quick installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install/prerequisites.html">Prerequisites</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install/updating_installation.html">Updating AiiDA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install/troubleshooting.html">Troubleshooting</a></li>
</ul>
<p class="caption"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../get_started/index.html">First things first</a></li>
<li class="toctree-l1"><a class="reference internal" href="../get_started/daemon.html">Setup the daemon</a></li>
<li class="toctree-l1"><a class="reference internal" href="../get_started/computers.html">Setup a computer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../get_started/codes.html">Setup a code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../get_started/plugins.html">Plugins</a></li>
</ul>
<p class="caption"><span class="caption-text">Concepts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../concepts/provenance.html">Provenance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../concepts/processes.html">Processes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../concepts/calculations.html">Calculations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../concepts/workflows.html">Workflows</a></li>
</ul>
<p class="caption"><span class="caption-text">Working with</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../working/processes.html">Processes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../working/functions.html">Calculation and work functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../working/calculations.html">Calculations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../working/workflows.html">Workflows</a></li>
</ul>
<p class="caption"><span class="caption-text">Working with AiiDA</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../working_with_aiida/index.html">Command line interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../working_with_aiida/index.html#scripting">Scripting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../working_with_aiida/index.html#data-types">Data types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../working_with_aiida/index.html#groups">Groups</a></li>
<li class="toctree-l1"><a class="reference internal" href="../working_with_aiida/index.html#schedulers">Schedulers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../working_with_aiida/index.html#querying-data">Querying data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../working_with_aiida/index.html#caching">Caching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../working_with_aiida/index.html#result-manager">Result manager</a></li>
<li class="toctree-l1"><a class="reference internal" href="../working_with_aiida/index.html#backups">Backups</a></li>
<li class="toctree-l1"><a class="reference internal" href="../working_with_aiida/index.html#troubleshooting">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../working_with_aiida/index.html#rest-api">REST API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../working_with_aiida/index.html#cookbook">Cookbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../import_export/index.html">Import and Export</a></li>
</ul>
<p class="caption"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../developer_guide/index.html">AiiDA design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer_guide/index.html#aiida-core">AiiDA core</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer_guide/index.html#aiida-plugins">AiiDA plugins</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/index.html">StructureData</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/index.html#pseudopotentials">Pseudopotentials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/index.html#plugin-development">Plugin development</a></li>
</ul>
<p class="caption"><span class="caption-text">API reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="`aiida package &lt;https://aiida-core.readthedocs.io/en/latest/apidoc/aiida.html&gt;`_">`aiida package &lt;https://aiida-core.readthedocs.io/en/latest/apidoc/aiida.html&gt;`_</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">AiiDA</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>aiida.manage.database.integrity package</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/apidoc/aiida.manage.database.integrity.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="module-aiida.manage.database.integrity">
<span id="aiida-manage-database-integrity-package"></span><h1>aiida.manage.database.integrity package<a class="headerlink" href="#module-aiida.manage.database.integrity" title="Permalink to this headline">¶</a></h1>
<p>Methods to validate the database integrity and fix violations.</p>
<dl class="function">
<dt id="aiida.manage.database.integrity.write_database_integrity_violation">
<code class="descclassname">aiida.manage.database.integrity.</code><code class="descname">write_database_integrity_violation</code><span class="sig-paren">(</span><em>results</em>, <em>headers</em>, <em>reason_message</em>, <em>action_message=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida/manage/database/integrity.html#write_database_integrity_violation"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida.manage.database.integrity.write_database_integrity_violation" title="Permalink to this definition">¶</a></dt>
<dd><p>Emit a integrity violation warning and write the violating records to a log file in the current directory</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>results</strong> – a list of tuples representing the violating records</li>
<li><strong>headers</strong> – a tuple of strings that will be used as a header for the log file. Should have the same length
as each tuple in the results list.</li>
<li><strong>reason_message</strong> – a human readable message detailing the reason of the integrity violation</li>
<li><strong>action_message</strong> – an optional human readable message detailing a performed action, if any</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<div class="section" id="subpackages">
<h2>Subpackages<a class="headerlink" href="#subpackages" title="Permalink to this headline">¶</a></h2>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="aiida.manage.database.integrity.sql.html">aiida.manage.database.integrity.sql package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="aiida.manage.database.integrity.sql.html#module-aiida.manage.database.integrity.sql.links">Submodules</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section" id="module-aiida.manage.database.integrity.duplicate_uuid">
<span id="submodules"></span><h2>Submodules<a class="headerlink" href="#module-aiida.manage.database.integrity.duplicate_uuid" title="Permalink to this headline">¶</a></h2>
<p>Generic functions to verify the integrity of the database and optionally apply patches to fix problems.</p>
<dl class="function">
<dt id="aiida.manage.database.integrity.duplicate_uuid.verify_uuid_uniqueness">
<code class="descclassname">aiida.manage.database.integrity.duplicate_uuid.</code><code class="descname">verify_uuid_uniqueness</code><span class="sig-paren">(</span><em>table</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida/manage/database/integrity/duplicate_uuid.html#verify_uuid_uniqueness"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida.manage.database.integrity.duplicate_uuid.verify_uuid_uniqueness" title="Permalink to this definition">¶</a></dt>
<dd><p>Check whether database table contains rows with duplicate UUIDS.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>table</strong> – Database table with uuid column, e.g. ‘db_dbnode’</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body">IntegrityError if table contains rows with duplicate UUIDS.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="aiida.manage.database.integrity.duplicate_uuid.get_duplicate_uuids">
<code class="descclassname">aiida.manage.database.integrity.duplicate_uuid.</code><code class="descname">get_duplicate_uuids</code><span class="sig-paren">(</span><em>table</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida/manage/database/integrity/duplicate_uuid.html#get_duplicate_uuids"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida.manage.database.integrity.duplicate_uuid.get_duplicate_uuids" title="Permalink to this definition">¶</a></dt>
<dd><p>Retrieve rows with duplicate UUIDS.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>table</strong> – database table with uuid column, e.g. ‘db_dbnode’</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">list of tuples of (id, uuid) of rows with duplicate UUIDs</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="aiida.manage.database.integrity.duplicate_uuid.deduplicate_uuids">
<code class="descclassname">aiida.manage.database.integrity.duplicate_uuid.</code><code class="descname">deduplicate_uuids</code><span class="sig-paren">(</span><em>table=None</em>, <em>dry_run=True</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida/manage/database/integrity/duplicate_uuid.html#deduplicate_uuids"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida.manage.database.integrity.duplicate_uuid.deduplicate_uuids" title="Permalink to this definition">¶</a></dt>
<dd><p>Detect and solve entities with duplicate UUIDs in a given database table.</p>
<p>Before aiida-core v1.0.0, there was no uniqueness constraint on the UUID column of the node table in the database
and a few other tables as well. This made it possible to store multiple entities with identical UUIDs in the same
table without the database complaining. This bug was fixed in aiida-core=1.0.0 by putting an explicit uniqueness
constraint on UUIDs on the database level. However, this would leave databases created before this patch with
duplicate UUIDs in an inconsistent state. This command will run an analysis to detect duplicate UUIDs in a given
table and solve it by generating new UUIDs. Note that it will not delete or merge any rows.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>dry_run</strong> – when True, no actual changes will be made</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">list of strings denoting the performed operations, or those that would have been applied for dry_run=False</td>
</tr>
<tr class="field-odd field"><th class="field-name">Raises:</th><td class="field-body"><strong>ValueError</strong> – if the specified table is invalid</td>
</tr>
</tbody>
</table>
</dd></dl>

<span class="target" id="module-aiida.manage.database.integrity.plugins"></span><p>Generic functions to verify the integrity of the database and optionally apply patches to fix problems.</p>
<dl class="function">
<dt id="aiida.manage.database.integrity.plugins.infer_calculation_entry_point">
<code class="descclassname">aiida.manage.database.integrity.plugins.</code><code class="descname">infer_calculation_entry_point</code><span class="sig-paren">(</span><em>type_strings</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/aiida/manage/database/integrity/plugins.html#infer_calculation_entry_point"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiida.manage.database.integrity.plugins.infer_calculation_entry_point" title="Permalink to this definition">¶</a></dt>
<dd><p>Try to infer a calculation entry point name for all the calculation type strings that are found in the database.</p>
<p>Before the plugin system was introduced, the <cite>type</cite> column of the node table was a string based on the base node
type with the module path and class name appended. For example, for the <cite>PwCalculation</cite> class, which was a sub
class of <cite>JobCalculation</cite>, would get <cite>calculation.job.quantumespresso.pw.PwCalculation.</cite> as its <cite>type</cite> string.
At this point, the <cite>JobCalculation</cite> also still fullfilled the role of both the <cite>Process</cite> class as well as the
<cite>Node</cite> class. In the migration for <cite>v1.0.0</cite>, this had to be migrated, where the <cite>type</cite> became that of the actual
node i.e. <cite>node.process.calculation.calcjob.CalcJobNode.</cite> which would lose the information of which actual sub class
it represented. This information should be stored in the <cite>process_type</cite> column, where the value is the name of the
entry point of that calculation class.</p>
<p>This function will, for a given set of calculation type strings of pre v1.0.0, try to map them on the known entry
points for the calculation category. This is the union of those entry points registered at the AiiDA registry (see
the mapping above) and those available in the environment in which this function is ran.</p>
<p>If a type string cannot be mapped onto an entry point name, a fallback <cite>process_type</cite> string will be generated
which is based on part of the old <cite>type</cite> string. For example, <cite>calculation.job.unknown.UnknownCalculation.</cite> would
get the process type string <cite>~unknown.UnknownCalculation</cite>.</p>
<p>The function will return a mapping of type strings onto their inferred process type strings.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>type_strings</strong> – a set of type strings whose entry point is to be inferred</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">a mapping of current node type string to the inferred entry point name</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, ECOLE POLYTECHNIQUE FEDERALE DE LAUSANNE (Theory and Simulation of Materials (THEOS) and National Centre for Computational Design and Discovery of Novel Materials (NCCR MARVEL)), Switzerland and ROBERT BOSCH LLC, USA. All rights reserved

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>