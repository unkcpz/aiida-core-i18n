

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Setup a computer &mdash; AiiDA 1.0.0b2 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script type="text/javascript" src="../_static/contentui.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/contentui.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Setup a code" href="codes.html" />
    <link rel="prev" title="Setup the daemon" href="daemon.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> AiiDA
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Installation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../install/quick_installation.html">Quick installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install/prerequisites.html">Prerequisites</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install/updating_installation.html">Updating AiiDA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install/troubleshooting.html">Troubleshooting</a></li>
</ul>
<p class="caption"><span class="caption-text">Getting started</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="index.html">First things first</a></li>
<li class="toctree-l1"><a class="reference internal" href="daemon.html">Setup the daemon</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Setup a computer</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#remote-computer-requirements">Remote computer requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="#computer-setup-and-configuration">Computer setup and configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#on-not-bombarding-the-remote-computer-with-requests">On not bombarding the remote computer with requests</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="codes.html">Setup a code</a></li>
<li class="toctree-l1"><a class="reference internal" href="plugins.html">Plugins</a></li>
</ul>
<p class="caption"><span class="caption-text">Concepts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../concepts/provenance.html">Provenance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../concepts/processes.html">Processes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../concepts/calculations.html">Calculations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../concepts/workflows.html">Workflows</a></li>
</ul>
<p class="caption"><span class="caption-text">Working with</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../working/processes.html">Processes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../working/functions.html">Calculation and work functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../working/calculations.html">Calculations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../working/workflows.html">Workflows</a></li>
</ul>
<p class="caption"><span class="caption-text">Working with AiiDA</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../working_with_aiida/index.html">Command line interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../working_with_aiida/index.html#scripting">Scripting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../working_with_aiida/index.html#data-types">Data types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../working_with_aiida/index.html#groups">Groups</a></li>
<li class="toctree-l1"><a class="reference internal" href="../working_with_aiida/index.html#schedulers">Schedulers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../working_with_aiida/index.html#querying-data">Querying data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../working_with_aiida/index.html#caching">Caching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../working_with_aiida/index.html#result-manager">Result manager</a></li>
<li class="toctree-l1"><a class="reference internal" href="../working_with_aiida/index.html#backups">Backups</a></li>
<li class="toctree-l1"><a class="reference internal" href="../working_with_aiida/index.html#troubleshooting">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../working_with_aiida/index.html#rest-api">REST API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../working_with_aiida/index.html#cookbook">Cookbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../import_export/index.html">Import and Export</a></li>
</ul>
<p class="caption"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../developer_guide/index.html">AiiDA design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer_guide/index.html#aiida-core">AiiDA core</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer_guide/index.html#aiida-plugins">AiiDA plugins</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/index.html">StructureData</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/index.html#pseudopotentials">Pseudopotentials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/index.html#plugin-development">Plugin development</a></li>
</ul>
<p class="caption"><span class="caption-text">API reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="`aiida package &lt;https://aiida-core.readthedocs.io/en/latest/apidoc/aiida.html&gt;`_">`aiida package &lt;https://aiida-core.readthedocs.io/en/latest/apidoc/aiida.html&gt;`_</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">AiiDA</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Setup a computer</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/get_started/computers.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="setup-a-computer">
<span id="setup-computer"></span><h1>Setup a computer<a class="headerlink" href="#setup-a-computer" title="Permalink to this headline">¶</a></h1>
<p>A computer in AiiDA denotes any computational resource (with a batch job scheduler) on which you will run your calculations.
Computers typically are clusters or supercomputers.</p>
<div class="section" id="remote-computer-requirements">
<h2>Remote computer requirements<a class="headerlink" href="#remote-computer-requirements" title="Permalink to this headline">¶</a></h2>
<p>Requirements for a computer are:</p>
<ul class="simple">
<li>It must run a Unix-like operating system</li>
<li>It must have <code class="docutils literal notranslate"><span class="pre">bash</span></code> installed</li>
<li>It should have a batch scheduler installed (see <a class="reference internal" href="../scheduler/index.html"><span class="doc">here</span></a>
for a list of supported batch schedulers)</li>
<li>It must be accessible from the machine that runs AiiDA using one of the
available transports (see below).</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">AiiDA will use <code class="docutils literal notranslate"><span class="pre">bash</span></code> on the remote computer, regardless of the default shell.
Please ensure that your remote <code class="docutils literal notranslate"><span class="pre">bash</span></code> configuration does not load a different shell.</p>
</div>
<p>The first step is to choose the transport to connect to the computer. Typically,
you will want to use the SSH transport, apart from a few special cases where
SSH connection is not possible (e.g., because you cannot setup a password-less
connection to the computer). In this case, you can install AiiDA directly on
the remote cluster, and use the <code class="docutils literal notranslate"><span class="pre">local</span></code> transport (in this way, commands to
submit the jobs are simply executed on the AiiDA machine, and files are simply
copied on the disk instead of opening an SFTP connection).</p>
<p>If you plan to use the <code class="docutils literal notranslate"><span class="pre">local</span></code> transport, you can skip to the next section.</p>
<p>If you plan to use the <code class="docutils literal notranslate"><span class="pre">SSH</span></code> transport, you have to configure a password-less
login from your user to the cluster. To do so type first (only if you do not
already have some keys in your local <code class="docutils literal notranslate"><span class="pre">~/.ssh</span> <span class="pre">directory</span></code> - i.e. files like
<code class="docutils literal notranslate"><span class="pre">id_rsa.pub</span></code>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ssh</span><span class="o">-</span><span class="n">keygen</span> <span class="o">-</span><span class="n">t</span> <span class="n">rsa</span>
</pre></div>
</div>
<p>Then copy your keys to the remote computer (in ~/.ssh/authorized_keys) with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ssh</span><span class="o">-</span><span class="n">copy</span><span class="o">-</span><span class="nb">id</span> <span class="n">YOURUSERNAME</span><span class="nd">@YOURCLUSTERADDRESS</span>
</pre></div>
</div>
<p>replacing <code class="docutils literal notranslate"><span class="pre">YOURUSERNAME</span></code> and <code class="docutils literal notranslate"><span class="pre">YOURCLUSTERADDRESS</span></code> by respectively your username
and cluster address. Finally add the following lines to ~/.ssh/config (leaving an empty
line before and after):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Host</span> <span class="n">YOURCLUSTERADDRESS</span>
  <span class="n">User</span> <span class="n">YOURUSERNAME</span>
  <span class="n">IdentityFile</span> <span class="n">YOURRSAKEY</span>
</pre></div>
</div>
<p>replacing <code class="docutils literal notranslate"><span class="pre">YOURRSAKEY</span></code> by the path to the rsa private key you want to use
(it should look like <code class="docutils literal notranslate"><span class="pre">~/.ssh/id_rsa</span></code>).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In principle you don’t have to put the <code class="docutils literal notranslate"><span class="pre">IdentityFile</span></code> line if you have
only one rsa key in your <code class="docutils literal notranslate"><span class="pre">~/.ssh</span></code> folder.</p>
</div>
<p>Before proceeding to setup the computer, be sure that you are able to
connect to your cluster using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ssh</span> <span class="n">YOURCLUSTERADDRESS</span>
</pre></div>
</div>
<p>without the need to type a password. Moreover, make also sure you can connect
via <code class="docutils literal notranslate"><span class="pre">sftp</span></code> (needed to copy files). The following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sftp</span> <span class="n">YOURCLUSTERADDRESS</span>
</pre></div>
</div>
<p>should show you a prompt without errors (possibly with a message saying
<code class="docutils literal notranslate"><span class="pre">Connected</span> <span class="pre">to</span> <span class="pre">YOURCLUSTERADDRESS</span></code>).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If the <code class="docutils literal notranslate"><span class="pre">ssh</span></code> command works, but the <code class="docutils literal notranslate"><span class="pre">sftp</span></code> command does not
(e.g. it just prints <code class="docutils literal notranslate"><span class="pre">Connection</span> <span class="pre">closed</span></code>), a possible reason can be
that there is a line in your <code class="docutils literal notranslate"><span class="pre">~/.bashrc</span></code> that either produces text output,
or an error. Remove/comment it until no output or error is produced: this
should make <code class="docutils literal notranslate"><span class="pre">sftp</span></code> working again.</p>
</div>
<p>Finally, try also:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ssh</span> <span class="n">YOURCLUSTERADDRESS</span> <span class="n">QUEUE_VISUALIZATION_COMMAND</span>
</pre></div>
</div>
<p>replacing <code class="docutils literal notranslate"><span class="pre">QUEUE_VISUALIZATION_COMMAND</span></code> by the scheduler command that prints on screen the
status of the queue on the cluster (i.e. <code class="docutils literal notranslate"><span class="pre">qstat</span></code> for PBSpro scheduler, <code class="docutils literal notranslate"><span class="pre">squeue</span></code> for SLURM, etc.).
It should print a snapshot of the queue status, without any errors.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>If there are errors with the previous command, then
edit your ~/.bashrc file in the remote computer and add a line at the beginning
that adds the path to the scheduler commands, typically (here for
PBSpro):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>export PATH=$PATH:/opt/pbs/default/bin
</pre></div>
</div>
<p class="last">Or, alternatively, find the path to the executables (like using <code class="docutils literal notranslate"><span class="pre">which</span> <span class="pre">qsub</span></code>)</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>If you need your remote .bashrc to be sourced before you execute the code
(for instance to change the PATH), make sure the .bashrc file <strong>does not</strong> contain
lines like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span> <span class="o">-</span><span class="n">z</span> <span class="s2">&quot;$PS1&quot;</span> <span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="k">return</span>
</pre></div>
</div>
<p>or:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>case $- in
    *i*) ;;
    *) return;;
esac
</pre></div>
</div>
<p>in the beginning (these would prevent the bashrc to be executed when you ssh
to the remote computer). You can check that e.g. the PATH variable is correctly
set upon ssh, by typing (in your local computer):</p>
<div class="last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ssh</span> <span class="n">YOURCLUSTERADDRESS</span> <span class="s1">&#39;echo $PATH&#39;</span>
</pre></div>
</div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you need to ssh to a computer A first, from which you can then
connect to computer B you wanted to connect to, you can use the
<code class="docutils literal notranslate"><span class="pre">proxy_command</span></code> feature of ssh, that we also support in
AiiDA. For more information, see <a class="reference internal" href="../setup/ssh_proxycommand.html#ssh-proxycommand"><span class="std std-ref">Using the proxy_command option with ssh</span></a>.</p>
</div>
</div>
<div class="section" id="computer-setup-and-configuration">
<span id="computer-setup"></span><h2>Computer setup and configuration<a class="headerlink" href="#computer-setup-and-configuration" title="Permalink to this headline">¶</a></h2>
<p>The configuration of computers happens in two steps.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The commands use some <code class="docutils literal notranslate"><span class="pre">readline</span></code> extensions to provide default
answers, that require an advanced terminal. Therefore, run the commands from
a standard terminal, and not from embedded terminals as the ones included in
text editors, unless you know what you are doing. For instance, the
terminal embedded in <code class="docutils literal notranslate"><span class="pre">emacs</span></code> is known to give problems.</p>
</div>
<ol class="arabic">
<li><p class="first"><strong>Setup of the computer</strong>, using the:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">verdi</span> <span class="n">computer</span> <span class="n">setup</span>
</pre></div>
</div>
<p>command. This command allows to create a new computer instance in the DB.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">The code will ask you a few pieces of information. At every prompt, you can
type the <code class="docutils literal notranslate"><span class="pre">?</span></code> character and press <code class="docutils literal notranslate"><span class="pre">&lt;enter&gt;</span></code> to get a more detailed
explanation of what is being asked.</p>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">You can press <code class="docutils literal notranslate"><span class="pre">&lt;CTRL&gt;+C</span></code> at any moment to abort the setup process.
Nothing will be stored in the DB.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For multiline inputs (like the prepend text and the append text, see below)
you have to press <code class="docutils literal notranslate"><span class="pre">&lt;CTRL&gt;+D</span></code> to complete the input, even if you do not want
any text.</p>
</div>
<p>Here is a list of what is asked, together with an explanation.</p>
<ul>
<li><p class="first"><strong>Computer name</strong>: the (user-friendly) name of the new computer instance
which is about to be created in the DB (the name is used for instance when
you have to pick up a computer to launch a calculation on it). Names must
be unique. This command should be thought as a AiiDA-wise configuration of
computer, independent of the AiiDA user that will actually use it.</p>
</li>
<li><p class="first"><strong>Fully-qualified hostname</strong>: the fully-qualified hostname of the computer
to which you want to connect (i.e., with all the dots: <code class="docutils literal notranslate"><span class="pre">bellatrix.epfl.ch</span></code>,
and not just <code class="docutils literal notranslate"><span class="pre">bellatrix</span></code>). Type <code class="docutils literal notranslate"><span class="pre">localhost</span></code> for the local transport.</p>
</li>
<li><p class="first"><strong>Description</strong>:  A human-readable description of this computer; this is
useful if you have a lot of computers and you want to add some text to
distinguish them (e.g.: “cluster of computers at EPFL, installed in 2012, 2 GB of RAM per CPU”)</p>
</li>
<li><p class="first"><strong>Enabled</strong>: either True or False; if False, the computer is disabled
and calculations associated with it will not be submitted. This allows to
disable temporarily a computer if it is giving problems or it is down for
maintenance, without the need to delete it from the DB.</p>
</li>
<li><p class="first"><strong>Transport type</strong>: The name of the transport to be used. A list of valid
transport types can be obtained typing <code class="docutils literal notranslate"><span class="pre">?</span></code></p>
</li>
<li><p class="first"><strong>Scheduler type</strong>: The name of the plugin to be used to manage the
job scheduler on the computer. A list of valid
scheduler plugins can be obtained typing <code class="docutils literal notranslate"><span class="pre">?</span></code>. See
<a class="reference internal" href="../scheduler/index.html"><span class="doc">here</span></a> for a documentation of scheduler plugins
in AiiDA.</p>
</li>
<li><p class="first"><strong>shebang line</strong> This is the first line in the beginning of the submission script.
The default is <code class="docutils literal notranslate"><span class="pre">#!/bin/bash</span></code>. You can change this in order, for example, to add options,
as for example the -l option. Note that AiiDA only supports bash at this point!</p>
</li>
<li><p class="first"><strong>AiiDA work directory</strong>: The absolute path of the directory on the
remote computer where AiiDA will run the calculations
(often, it is the scratch of the computer). You can (should) use the
<code class="docutils literal notranslate"><span class="pre">{username}</span></code> replacement, that will be replaced by your username on the
remote computer automatically: this allows the same computer to be used
by different users, without the need to setup a different computer for
each one. Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">scratch</span><span class="o">/</span><span class="p">{</span><span class="n">username</span><span class="p">}</span><span class="o">/</span><span class="n">aiida_work</span><span class="o">/</span>
</pre></div>
</div>
</li>
<li><p class="first"><strong>mpirun command</strong>: The <code class="docutils literal notranslate"><span class="pre">mpirun</span></code> command needed on the cluster to run parallel MPI
programs. You can (should) use the <code class="docutils literal notranslate"><span class="pre">{tot_num_mpiprocs}</span></code> replacement,
that will be replaced by the total number of cpus, or the other
scheduler-dependent fields (see the <a class="reference internal" href="../scheduler/index.html"><span class="doc">scheduler docs</span></a>
for more information). Some examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mpirun</span> <span class="o">-</span><span class="n">np</span> <span class="p">{</span><span class="n">tot_num_mpiprocs</span><span class="p">}</span>
<span class="n">aprun</span> <span class="o">-</span><span class="n">n</span> <span class="p">{</span><span class="n">tot_num_mpiprocs</span><span class="p">}</span>
<span class="n">poe</span>
</pre></div>
</div>
</li>
<li><p class="first"><strong>Text to prepend to each command execution</strong>: This is a multiline string,
whose content will be prepended inside the submission script before the
real execution of the job. It is your responsibility to write proper <code class="docutils literal notranslate"><span class="pre">bash</span></code> code!
This is intended for computer-dependent code, like for instance loading a
module that should always be loaded on that specific computer. <em>Remember</em>
<em>to end the input by pressing</em> <code class="docutils literal notranslate"><span class="pre">&lt;CTRL&gt;+D</span></code>.
A practical example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">export</span> <span class="n">NEWVAR</span><span class="o">=</span><span class="mi">1</span>
<span class="n">source</span> <span class="n">some</span><span class="o">/</span><span class="n">file</span>
</pre></div>
</div>
<p>A not-to-do example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#PBS -l nodes=4:ppn=12</span>
</pre></div>
</div>
<p>(it’s the plugin that will do this!)</p>
</li>
<li><p class="first"><strong>Text to append to each command execution</strong>: This is a multiline string,
whose content will be appended inside the submission script after the
real execution of the job. It is your responsibility to write proper <code class="docutils literal notranslate"><span class="pre">bash</span></code> code!
This is intended for computer-dependent code. <em>Remember</em>
<em>to end the input by pressing</em> <code class="docutils literal notranslate"><span class="pre">&lt;CTRL&gt;+D</span></code>.</p>
</li>
</ul>
</li>
</ol>
<blockquote>
<div>At the end, you will get a confirmation command, and also the ID in the
database (<code class="docutils literal notranslate"><span class="pre">pk</span></code>, i.e. the principal key, and <code class="docutils literal notranslate"><span class="pre">uuid</span></code>).</div></blockquote>
<ol class="arabic" start="2">
<li><p class="first"><strong>Configuration of the computer</strong>, using the:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">verdi</span> <span class="n">computer</span> <span class="n">configure</span> <span class="n">COMPUTERNAME</span>
</pre></div>
</div>
<p>command. This will allow to access more detailed configurations, that are
often user-dependent and also depend on the specific transport (for instance,
if the transport is <code class="docutils literal notranslate"><span class="pre">SSH</span></code>, it will ask for username, port, …).</p>
<p>The command will try to provide automatically default answers, mainly reading
the existing ssh configuration in <code class="docutils literal notranslate"><span class="pre">~/.ssh/config</span></code>, and in most cases one
simply need to press enter a few times.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">At the moment, the in-line help (i.e., just typing <code class="docutils literal notranslate"><span class="pre">?</span></code> to get
some help) is not yet supported in <code class="docutils literal notranslate"><span class="pre">verdi</span> <span class="pre">configure</span></code>, but only in
<code class="docutils literal notranslate"><span class="pre">verdi</span> <span class="pre">setup</span></code>.</p>
</div>
<p>For <code class="docutils literal notranslate"><span class="pre">local</span></code> transport, you <em>need to run the command</em>,
even if nothing will be asked to you.
For <code class="docutils literal notranslate"><span class="pre">ssh</span></code> transport, the following will be asked:</p>
<ul class="simple">
<li><strong>username</strong>: your username on the remote machine</li>
<li><strong>port</strong>: the port to connect to (the default SSH port is 22)</li>
<li><strong>look_for_keys</strong>: automatically look for the private key in <code class="docutils literal notranslate"><span class="pre">~/.ssh</span></code>.
Default: True.</li>
<li><strong>key_filename</strong>: the absolute path to your private SSH key. You can leave
it empty to use the default SSH key, if you set <code class="docutils literal notranslate"><span class="pre">look_for_keys</span></code> to True.</li>
<li><strong>timeout</strong>: A timeout in seconds if there is no response (e.g., the
machine is down. You can leave it empty to use the default value.</li>
<li><strong>allow_agent</strong>: If True, it will try to use an SSH agent.</li>
<li><strong>proxy_command</strong>: Leave empty if you do not need a proxy command (i.e.,
if you can directly connect to the machine). If you instead need to connect
to an intermediate computer first, you need to provide here the
command for the proxy: see documentation <a class="reference internal" href="../setup/ssh_proxycommand.html#ssh-proxycommand"><span class="std std-ref">here</span></a>
for how to use this option, and in particular the notes
<a class="reference internal" href="../setup/ssh_proxycommand.html#ssh-proxycommand-notes"><span class="std std-ref">here</span></a> for the format of this field.</li>
<li><strong>compress</strong>: True to compress the traffic (recommended)</li>
<li><strong>gss_auth</strong>: yes when using Kerberos token to connect</li>
<li><strong>gss_kex</strong>: yes when using Kerberos token to connect, in some cases
(depending on your <code class="docutils literal notranslate"><span class="pre">.ssh/config</span></code> file)</li>
<li><strong>gss_deleg_creds</strong>: yes when using Kerberos token to connect, in
some cases (depending on your <code class="docutils literal notranslate"><span class="pre">.ssh/config</span></code> file)</li>
<li><strong>gss_host</strong>: hostname when using Kerberos token to connect (default
to the remote computer hostname)</li>
<li><strong>load_system_host_keys</strong>: True to load the known hosts keys from the
default SSH location (recommended)</li>
<li><strong>key_policy</strong>: What is the policy in case the host is not known.
It is a string among the following:<ul>
<li><code class="docutils literal notranslate"><span class="pre">RejectPolicy</span></code> (default, recommended): reject the connection if the
host is not known.</li>
<li><code class="docutils literal notranslate"><span class="pre">WarningPolicy</span></code> (<em>not</em> recommended): issue a warning if the
host is not known.</li>
<li><code class="docutils literal notranslate"><span class="pre">AutoAddPolicy</span></code> (<em>not</em> recommended): automatically add the host key
at the first connection to the host.</li>
</ul>
</li>
</ul>
</li>
</ol>
<blockquote>
<div>After these two steps have been completed, your computer is ready to go!</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If the cluster you are using requires authentication through a Kerberos
token (that you need to obtain before using ssh), you typically need to install
<code class="docutils literal notranslate"><span class="pre">libffi</span></code> (<code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">apt-get</span> <span class="pre">install</span> <span class="pre">libffi-dev</span></code> under Ubuntu), and make sure you install
the <code class="docutils literal notranslate"><span class="pre">ssh_kerberos</span></code> <a class="reference internal" href="../install/installation.html#install-optional-dependencies"><span class="std std-ref">optional dependencies</span></a> during the installation process of AiiDA.
Then, if your <code class="docutils literal notranslate"><span class="pre">.ssh/config</span></code> file is configured properly (in particular includes
all the necessary <code class="docutils literal notranslate"><span class="pre">GSSAPI</span></code> options), <code class="docutils literal notranslate"><span class="pre">verdi</span> <span class="pre">computer</span> <span class="pre">configure</span></code> will
contain already the correct suggestions for all the gss options needed to support Kerberos.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>To check if you set up the computer correctly,
execute:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">verdi</span> <span class="n">computer</span> <span class="n">test</span> <span class="n">COMPUTERNAME</span>
</pre></div>
</div>
<p class="last">that will run a few tests (file copy, file retrieval, check of the jobs in
the scheduler queue) to verify that everything works as expected.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>If you are not sure if your computer is already set up, use the command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">verdi</span> <span class="n">computer</span> <span class="nb">list</span>
</pre></div>
</div>
<p>to get a list of existing computers, and:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">verdi</span> <span class="n">computer</span> <span class="n">show</span> <span class="n">COMPUTERNAME</span>
</pre></div>
</div>
<p>to get detailed information on the specific computer named <code class="docutils literal notranslate"><span class="pre">COMPUTERNAME</span></code>.
You have also the:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">verdi</span> <span class="n">computer</span> <span class="n">rename</span> <span class="n">OLDCOMPUTERNAME</span> <span class="n">NEWCOMPUTERNAME</span>
</pre></div>
</div>
<p>and:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">verdi</span> <span class="n">computer</span> <span class="n">delete</span> <span class="n">COMPUTERNAME</span>
</pre></div>
</div>
<p class="last">commands, whose meaning should be self-explanatory.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You can delete computers <strong>only if</strong> no entry in the database is using
them (as for instance Calculations, or RemoteData objects). Otherwise, you
will get an error message.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>It is possible to <strong>disable</strong> a computer.</p>
<p>Doing so will prevent AiiDA
from connecting to the given computer to check the state of calculations or
to submit new calculations. This is particularly useful if, for instance,
the computer is under maintenance but you still want to use AiiDA with
other computers, or submit the calculations in the AiiDA database anyway.</p>
<p>When the computer comes back online, you can re-enable it;
at this point pending calculations in the <code class="docutils literal notranslate"><span class="pre">TOSUBMIT</span></code> state will be
submitted, and calculations <code class="docutils literal notranslate"><span class="pre">WITHSCHEDULER</span></code> will be checked and possibly
retrieved.</p>
<p>The relevant commands are:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">verdi</span> <span class="n">computer</span> <span class="n">enable</span> <span class="n">COMPUTERNAME</span>
<span class="n">verdi</span> <span class="n">computer</span> <span class="n">disable</span> <span class="n">COMPUTERNAME</span>
</pre></div>
</div>
<p>Note that the above commands will disable the computer for all AiiDA users.
If instead, for some reason, you want to disable the computer only for a
given user, you can use the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">verdi</span> <span class="n">computer</span> <span class="n">disable</span> <span class="n">COMPUTERNAME</span> <span class="o">--</span><span class="n">only</span><span class="o">-</span><span class="k">for</span><span class="o">-</span><span class="n">user</span> <span class="n">USER_EMAIL</span>
</pre></div>
</div>
<p class="last">(and the corresponding <code class="docutils literal notranslate"><span class="pre">verdi</span> <span class="pre">computer</span> <span class="pre">enable</span></code> command to re-enable it).</p>
</div>
<div class="section" id="on-not-bombarding-the-remote-computer-with-requests">
<h3>On not bombarding the remote computer with requests<a class="headerlink" href="#on-not-bombarding-the-remote-computer-with-requests" title="Permalink to this headline">¶</a></h3>
<p>Some machine (particularly at supercomputing centres) may not tolerate opening
connections and executing scheduler commands with a high frequency.  To limit this
AiiDA currently has two settings:</p>
<blockquote>
<div><ul class="simple">
<li>The transport safe open interval, and,</li>
<li>the minimum job poll interval</li>
</ul>
</div></blockquote>
<p>Neither of these can ever be violated.  AiiDA will not try to update the jobs list
on a remove machine until the job poll interval has elapsed since the last update
(the first update will be immediate) at which point it will request a transport.
Because of this the maximum possible time before a job update could be the sum of
the two intervals, however this is unlikely to happen in practice.</p>
<p>The transport open interval is currently hardcoded by the transport plugin,
typically SSH is longer than local transport.</p>
<p>The job poll interval can be set programmatically on the corresponding <cite>Computer</cite>
object in verdi shell:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Computer</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;localhost&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">set_minimum_job_poll_interval</span><span class="p">(</span><span class="mf">30.0</span><span class="p">)</span>
</pre></div>
</div>
<p>would set the transport interval on a computer called ‘localhost’ to 30 seconds.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">All of these intervals apply per <em>worker</em> meaning that a daemon with
multiple workers will not necessarily, overall, respect these limits.
For the time being there is no way around this and if these limits must be
respected then do not run with more than one worker.</p>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="codes.html" class="btn btn-neutral float-right" title="Setup a code" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="daemon.html" class="btn btn-neutral float-left" title="Setup the daemon" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, ECOLE POLYTECHNIQUE FEDERALE DE LAUSANNE (Theory and Simulation of Materials (THEOS) and National Centre for Computational Design and Discovery of Novel Materials (NCCR MARVEL)), Switzerland and ROBERT BOSCH LLC, USA. All rights reserved

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>